(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))w($);new MutationObserver($=>{for(const I of $)if(I.type==="childList")for(const D of I.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&w(D)}).observe(document,{childList:!0,subtree:!0});function g($){const I={};return $.integrity&&(I.integrity=$.integrity),$.referrerPolicy&&(I.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?I.credentials="include":$.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function w($){if($.ep)return;$.ep=!0;const I=g($);fetch($.href,I)}})();/*!
 * ONNX Runtime Web v1.23.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var Ln=Object.defineProperty,Gp=Object.getOwnPropertyDescriptor,Hp=Object.getOwnPropertyNames,Fp=Object.prototype.hasOwnProperty,Wn=(d=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(d,{get:(m,g)=>(typeof require<"u"?require:m)[g]}):d)(function(d){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+d+'" is not supported')}),L$1=(d,m)=>()=>(d&&(m=d(d=0)),m),Wt=(d,m)=>{for(var g in m)Ln(d,g,{get:m[g],enumerable:!0})},qp=(d,m,g,w)=>{if(m&&typeof m=="object"||typeof m=="function")for(let $ of Hp(m))!Fp.call(d,$)&&$!==g&&Ln(d,$,{get:()=>m[$],enumerable:!(w=Gp(m,$))||w.enumerable});return d},Xt=d=>qp(Ln({},"__esModule",{value:!0}),d),wr,kt,Pt,jp,Qi,Gn=L$1(()=>{wr=new Map,kt=[],Pt=(d,m,g)=>{if(m&&typeof m.init=="function"&&typeof m.createInferenceSessionHandler=="function"){let w=wr.get(d);if(w===void 0)wr.set(d,{backend:m,priority:g});else{if(w.priority>g)return;if(w.priority===g&&w.backend!==m)throw new Error(`cannot register backend "${d}" using priority ${g}`)}if(g>=0){let $=kt.indexOf(d);$!==-1&&kt.splice($,1);for(let I=0;I<kt.length;I++)if(wr.get(kt[I]).priority<=g){kt.splice(I,0,d);return}kt.push(d)}return}throw new TypeError("not a valid backend")},jp=async d=>{let m=wr.get(d);if(!m)return"backend not found.";if(m.initialized)return m.backend;if(m.aborted)return m.error;{let g=!!m.initPromise;try{return g||(m.initPromise=m.backend.init(d)),await m.initPromise,m.initialized=!0,m.backend}catch(w){return g||(m.error=`${w}`,m.aborted=!0),m.error}finally{delete m.initPromise}}},Qi=async d=>{let m=d.executionProviders||[],g=m.map(U=>typeof U=="string"?U:U.name),w=g.length===0?kt:g,$,I=[],D=new Set;for(let U of w){let j=await jp(U);typeof j=="string"?I.push({name:U,err:j}):($||($=j),$===j&&D.add(U))}if(!$)throw new Error(`no available backend found. ERR: ${I.map(U=>`[${U.name}] ${U.err}`).join(", ")}`);for(let{name:U,err:j}of I)g.includes(U)&&console.warn(`removing requested execution provider "${U}" from session options because it is not available: ${j}`);let F=m.filter(U=>D.has(typeof U=="string"?U:U.name));return[$,new Proxy(d,{get:(U,j)=>j==="executionProviders"?F:Reflect.get(U,j)})]}}),Yi=L$1(()=>{Gn()}),Xi,Ji=L$1(()=>{Xi="1.23.0"}),ea,Ee,Hn=L$1(()=>{Ji(),ea="warning",Ee={wasm:{},webgl:{},webgpu:{},versions:{common:Xi},set logLevel(d){if(d!==void 0){if(typeof d!="string"||["verbose","info","warning","error","fatal"].indexOf(d)===-1)throw new Error(`Unsupported logging level: ${d}`);ea=d}},get logLevel(){return ea}},Object.defineProperty(Ee,"logLevel",{enumerable:!0})}),we,ta=L$1(()=>{Hn(),we=Ee}),ra,na,oa=L$1(()=>{ra=(d,m)=>{let g=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);g.width=d.dims[3],g.height=d.dims[2];let w=g.getContext("2d");if(w!=null){let $,I;m?.tensorLayout!==void 0&&m.tensorLayout==="NHWC"?($=d.dims[2],I=d.dims[3]):($=d.dims[3],I=d.dims[2]);let D=m?.format!==void 0?m.format:"RGB",F=m?.norm,U,j;F===void 0||F.mean===void 0?U=[255,255,255,255]:typeof F.mean=="number"?U=[F.mean,F.mean,F.mean,F.mean]:(U=[F.mean[0],F.mean[1],F.mean[2],0],F.mean[3]!==void 0&&(U[3]=F.mean[3])),F===void 0||F.bias===void 0?j=[0,0,0,0]:typeof F.bias=="number"?j=[F.bias,F.bias,F.bias,F.bias]:(j=[F.bias[0],F.bias[1],F.bias[2],0],F.bias[3]!==void 0&&(j[3]=F.bias[3]));let G=I*$,Z=0,H=G,q=G*2,V=-1;D==="RGBA"?(Z=0,H=G,q=G*2,V=G*3):D==="RGB"?(Z=0,H=G,q=G*2):D==="RBG"&&(Z=0,q=G,H=G*2);for(let Q=0;Q<I;Q++)for(let X=0;X<$;X++){let re=(d.data[Z++]-j[0])*U[0],J=(d.data[H++]-j[1])*U[1],se=(d.data[q++]-j[2])*U[2],ie=V===-1?255:(d.data[V++]-j[3])*U[3];w.fillStyle="rgba("+re+","+J+","+se+","+ie+")",w.fillRect(X,Q,1,1)}if("toDataURL"in g)return g.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},na=(d,m)=>{let g=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),w;if(g!=null){let $,I,D;m?.tensorLayout!==void 0&&m.tensorLayout==="NHWC"?($=d.dims[2],I=d.dims[1],D=d.dims[3]):($=d.dims[3],I=d.dims[2],D=d.dims[1]);let F=m!==void 0&&m.format!==void 0?m.format:"RGB",U=m?.norm,j,G;U===void 0||U.mean===void 0?j=[255,255,255,255]:typeof U.mean=="number"?j=[U.mean,U.mean,U.mean,U.mean]:(j=[U.mean[0],U.mean[1],U.mean[2],255],U.mean[3]!==void 0&&(j[3]=U.mean[3])),U===void 0||U.bias===void 0?G=[0,0,0,0]:typeof U.bias=="number"?G=[U.bias,U.bias,U.bias,U.bias]:(G=[U.bias[0],U.bias[1],U.bias[2],0],U.bias[3]!==void 0&&(G[3]=U.bias[3]));let Z=I*$;if(m!==void 0&&(m.format!==void 0&&D===4&&m.format!=="RGBA"||D===3&&m.format!=="RGB"&&m.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let H=4,q=0,V=1,Q=2,X=3,re=0,J=Z,se=Z*2,ie=-1;F==="RGBA"?(re=0,J=Z,se=Z*2,ie=Z*3):F==="RGB"?(re=0,J=Z,se=Z*2):F==="RBG"&&(re=0,se=Z,J=Z*2),w=g.createImageData($,I);for(let oe=0;oe<I*$;q+=H,V+=H,Q+=H,X+=H,oe++)w.data[q]=(d.data[re++]-G[0])*j[0],w.data[V]=(d.data[J++]-G[1])*j[1],w.data[Q]=(d.data[se++]-G[2])*j[2],w.data[X]=ie===-1?255:(d.data[ie++]-G[3])*j[3]}else throw new Error("Can not access image data");return w}}),Fn,ia,aa,sa,ua,la,da=L$1(()=>{vr(),Fn=(d,m)=>{if(d===void 0)throw new Error("Image buffer must be defined");if(m.height===void 0||m.width===void 0)throw new Error("Image height and width must be defined");if(m.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:g,width:w}=m,$=m.norm??{mean:255,bias:0},I,D;typeof $.mean=="number"?I=[$.mean,$.mean,$.mean,$.mean]:I=[$.mean[0],$.mean[1],$.mean[2],$.mean[3]??255],typeof $.bias=="number"?D=[$.bias,$.bias,$.bias,$.bias]:D=[$.bias[0],$.bias[1],$.bias[2],$.bias[3]??0];let F=m.format!==void 0?m.format:"RGBA",U=m.tensorFormat!==void 0&&m.tensorFormat!==void 0?m.tensorFormat:"RGB",j=g*w,G=U==="RGBA"?new Float32Array(j*4):new Float32Array(j*3),Z=4,H=0,q=1,V=2,Q=3,X=0,re=j,J=j*2,se=-1;F==="RGB"&&(Z=3,H=0,q=1,V=2,Q=-1),U==="RGBA"?se=j*3:U==="RBG"?(X=0,J=j,re=j*2):U==="BGR"&&(J=0,re=j,X=j*2);for(let ie=0;ie<j;ie++,H+=Z,V+=Z,q+=Z,Q+=Z)G[X++]=(d[H]+D[0])/I[0],G[re++]=(d[q]+D[1])/I[1],G[J++]=(d[V]+D[2])/I[2],se!==-1&&Q!==-1&&(G[se++]=(d[Q]+D[3])/I[3]);return U==="RGBA"?new De("float32",G,[1,4,g,w]):new De("float32",G,[1,3,g,w])},ia=async(d,m)=>{let g=typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement,w=typeof ImageData<"u"&&d instanceof ImageData,$=typeof ImageBitmap<"u"&&d instanceof ImageBitmap,I=typeof d=="string",D,F=m??{},U=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},j=G=>typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||G instanceof OffscreenCanvas?G.getContext("2d"):null;if(g){let G=U();G.width=d.width,G.height=d.height;let Z=j(G);if(Z!=null){let H=d.height,q=d.width;if(m!==void 0&&m.resizedHeight!==void 0&&m.resizedWidth!==void 0&&(H=m.resizedHeight,q=m.resizedWidth),m!==void 0){if(F=m,m.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");F.tensorFormat="RGBA",F.height=H,F.width=q}else F.tensorFormat="RGBA",F.height=H,F.width=q;Z.drawImage(d,0,0),D=Z.getImageData(0,0,q,H).data}else throw new Error("Can not access image data")}else if(w){let G,Z;if(m!==void 0&&m.resizedWidth!==void 0&&m.resizedHeight!==void 0?(G=m.resizedHeight,Z=m.resizedWidth):(G=d.height,Z=d.width),m!==void 0&&(F=m),F.format="RGBA",F.height=G,F.width=Z,m!==void 0){let H=U();H.width=Z,H.height=G;let q=j(H);if(q!=null)q.putImageData(d,0,0),D=q.getImageData(0,0,Z,G).data;else throw new Error("Can not access image data")}else D=d.data}else if($){if(m===void 0)throw new Error("Please provide image config with format for Imagebitmap");let G=U();G.width=d.width,G.height=d.height;let Z=j(G);if(Z!=null){let H=d.height,q=d.width;return Z.drawImage(d,0,0,q,H),D=Z.getImageData(0,0,q,H).data,F.height=H,F.width=q,Fn(D,F)}else throw new Error("Can not access image data")}else{if(I)return new Promise((G,Z)=>{let H=U(),q=j(H);if(!d||!q)return Z();let V=new Image;V.crossOrigin="Anonymous",V.src=d,V.onload=()=>{H.width=V.width,H.height=V.height,q.drawImage(V,0,0,H.width,H.height);let Q=q.getImageData(0,0,H.width,H.height);F.height=H.height,F.width=H.width,G(Fn(Q.data,F))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(D!==void 0)return Fn(D,F);throw new Error("Input data provided is not supported - aborted tensor creation")},aa=(d,m)=>{let{width:g,height:w,download:$,dispose:I}=m,D=[1,w,g,4];return new De({location:"texture",type:"float32",texture:d,dims:D,download:$,dispose:I})},sa=(d,m)=>{let{dataType:g,dims:w,download:$,dispose:I}=m;return new De({location:"gpu-buffer",type:g??"float32",gpuBuffer:d,dims:w,download:$,dispose:I})},ua=(d,m)=>{let{dataType:g,dims:w,download:$,dispose:I}=m;return new De({location:"ml-tensor",type:g??"float32",mlTensor:d,dims:w,download:$,dispose:I})},la=(d,m,g)=>new De({location:"cpu-pinned",type:d,data:m,dims:g??[m.length]})}),Ot,Jt,ca,pa,ma=L$1(()=>{Ot=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Jt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ca=!1,pa=()=>{if(!ca){ca=!0;let d=typeof BigInt64Array<"u"&&BigInt64Array.from,m=typeof BigUint64Array<"u"&&BigUint64Array.from,g=globalThis.Float16Array,w=typeof g<"u"&&g.from;d&&(Ot.set("int64",BigInt64Array),Jt.set(BigInt64Array,"int64")),m&&(Ot.set("uint64",BigUint64Array),Jt.set(BigUint64Array,"uint64")),w?(Ot.set("float16",g),Jt.set(g,"float16")):Ot.set("float16",Uint16Array)}}}),fa,ha,ga=L$1(()=>{vr(),fa=d=>{let m=1;for(let g=0;g<d.length;g++){let w=d[g];if(typeof w!="number"||!Number.isSafeInteger(w))throw new TypeError(`dims[${g}] must be an integer, got: ${w}`);if(w<0)throw new RangeError(`dims[${g}] must be a non-negative integer, got: ${w}`);m*=w}return m},ha=(d,m)=>{switch(d.location){case"cpu":return new De(d.type,d.data,m);case"cpu-pinned":return new De({location:"cpu-pinned",data:d.data,type:d.type,dims:m});case"texture":return new De({location:"texture",texture:d.texture,type:d.type,dims:m});case"gpu-buffer":return new De({location:"gpu-buffer",gpuBuffer:d.gpuBuffer,type:d.type,dims:m});case"ml-tensor":return new De({location:"ml-tensor",mlTensor:d.mlTensor,type:d.type,dims:m});default:throw new Error(`tensorReshape: tensor location ${d.location} is not supported`)}}}),De,vr=L$1(()=>{oa(),da(),ma(),ga(),De=class{constructor(d,m,g){pa();let w,$;if(typeof d=="object"&&"location"in d)switch(this.dataLocation=d.location,w=d.type,$=d.dims,d.location){case"cpu-pinned":{let D=Ot.get(w);if(!D)throw new TypeError(`unsupported type "${w}" to create tensor from pinned buffer`);if(!(d.data instanceof D))throw new TypeError(`buffer should be of type ${D.name}`);this.cpuData=d.data;break}case"texture":{if(w!=="float32")throw new TypeError(`unsupported type "${w}" to create tensor from texture`);this.gpuTextureData=d.texture,this.downloader=d.download,this.disposer=d.dispose;break}case"gpu-buffer":{if(w!=="float32"&&w!=="float16"&&w!=="int32"&&w!=="int64"&&w!=="uint32"&&w!=="uint8"&&w!=="bool"&&w!=="uint4"&&w!=="int4")throw new TypeError(`unsupported type "${w}" to create tensor from gpu buffer`);this.gpuBufferData=d.gpuBuffer,this.downloader=d.download,this.disposer=d.dispose;break}case"ml-tensor":{if(w!=="float32"&&w!=="float16"&&w!=="int32"&&w!=="int64"&&w!=="uint32"&&w!=="uint64"&&w!=="int8"&&w!=="uint8"&&w!=="bool"&&w!=="uint4"&&w!=="int4")throw new TypeError(`unsupported type "${w}" to create tensor from MLTensor`);this.mlTensorData=d.mlTensor,this.downloader=d.download,this.disposer=d.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let D,F;if(typeof d=="string")if(w=d,F=g,d==="string"){if(!Array.isArray(m))throw new TypeError("A string tensor's data must be a string array.");D=m}else{let U=Ot.get(d);if(U===void 0)throw new TypeError(`Unsupported tensor type: ${d}.`);if(Array.isArray(m)){if(d==="float16"&&U===Uint16Array||d==="uint4"||d==="int4")throw new TypeError(`Creating a ${d} tensor from number array is not supported. Please use ${U.name} as data.`);d==="uint64"||d==="int64"?D=U.from(m,BigInt):D=U.from(m)}else if(m instanceof U)D=m;else if(m instanceof Uint8ClampedArray)if(d==="uint8")D=Uint8Array.from(m);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(d==="float16"&&m instanceof Uint16Array&&U!==Uint16Array)D=new globalThis.Float16Array(m.buffer,m.byteOffset,m.length);else throw new TypeError(`A ${w} tensor's data must be type of ${U}`)}else if(F=m,Array.isArray(d)){if(d.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let U=typeof d[0];if(U==="string")w="string",D=d;else if(U==="boolean")w="bool",D=Uint8Array.from(d);else throw new TypeError(`Invalid element type of data array: ${U}.`)}else if(d instanceof Uint8ClampedArray)w="uint8",D=Uint8Array.from(d);else{let U=Jt.get(d.constructor);if(U===void 0)throw new TypeError(`Unsupported type for tensor data: ${d.constructor}.`);w=U,D=d}if(F===void 0)F=[D.length];else if(!Array.isArray(F))throw new TypeError("A tensor's dims must be a number array");$=F,this.cpuData=D,this.dataLocation="cpu"}let I=fa($);if(this.cpuData&&I!==this.cpuData.length&&!((w==="uint4"||w==="int4")&&Math.ceil(I/2)===this.cpuData.length))throw new Error(`Tensor's size(${I}) does not match data length(${this.cpuData.length}).`);this.type=w,this.dims=$,this.size=I}static async fromImage(d,m){return ia(d,m)}static fromTexture(d,m){return aa(d,m)}static fromGpuBuffer(d,m){return sa(d,m)}static fromMLTensor(d,m){return ua(d,m)}static fromPinnedBuffer(d,m,g){return la(d,m,g)}toDataURL(d){return ra(this,d)}toImageData(d){return na(this,d)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(d){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let m=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=m,d&&this.disposer&&(this.disposer(),this.disposer=void 0),m}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(d){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return ha(this,d)}}}),qe,qn=L$1(()=>{vr(),qe=De}),$r,ya,Ne,Me,wt,vt,jn=L$1(()=>{Hn(),$r=(d,m)=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||console.timeStamp(`${d}::ORT::${m}`)},ya=(d,m)=>{let g=new Error().stack?.split(/\r\n|\r|\n/g)||[],w=!1;for(let $=0;$<g.length;$++){if(w&&!g[$].includes("TRACE_FUNC")){let I=`FUNC_${d}::${g[$].trim().split(" ")[1]}`;m&&(I+=`::${m}`),$r("CPU",I);return}g[$].includes("TRACE_FUNC")&&(w=!0)}},Ne=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||ya("BEGIN",d)},Me=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||ya("END",d)},wt=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||console.time(`ORT::${d}`)},vt=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||console.timeEnd(`ORT::${d}`)}}),xr,ba=L$1(()=>{Gn(),qn(),jn(),xr=class ep{constructor(m){this.handler=m}async run(m,g,w){Ne(),wt("InferenceSession.run");let $={},I={};if(typeof m!="object"||m===null||m instanceof qe||Array.isArray(m))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let D=!0;if(typeof g=="object"){if(g===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(g instanceof qe)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(g)){if(g.length===0)throw new TypeError("'fetches' cannot be an empty array.");D=!1;for(let j of g){if(typeof j!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(j)===-1)throw new RangeError(`'fetches' contains invalid output name: ${j}.`);$[j]=null}if(typeof w=="object"&&w!==null)I=w;else if(typeof w<"u")throw new TypeError("'options' must be an object.")}else{let j=!1,G=Object.getOwnPropertyNames(g);for(let Z of this.outputNames)if(G.indexOf(Z)!==-1){let H=g[Z];(H===null||H instanceof qe)&&(j=!0,D=!1,$[Z]=H)}if(j){if(typeof w=="object"&&w!==null)I=w;else if(typeof w<"u")throw new TypeError("'options' must be an object.")}else I=g}}else if(typeof g<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let j of this.inputNames)if(typeof m[j]>"u")throw new Error(`input '${j}' is missing in 'feeds'.`);if(D)for(let j of this.outputNames)$[j]=null;let F=await this.handler.run(m,$,I),U={};for(let j in F)if(Object.hasOwnProperty.call(F,j)){let G=F[j];G instanceof qe?U[j]=G:U[j]=new qe(G.type,G.data,G.dims)}return vt("InferenceSession.run"),Me(),U}async release(){return this.handler.dispose()}static async create(m,g,w,$){Ne(),wt("InferenceSession.create");let I,D={};if(typeof m=="string"){if(I=m,typeof g=="object"&&g!==null)D=g;else if(typeof g<"u")throw new TypeError("'options' must be an object.")}else if(m instanceof Uint8Array){if(I=m,typeof g=="object"&&g!==null)D=g;else if(typeof g<"u")throw new TypeError("'options' must be an object.")}else if(m instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&m instanceof SharedArrayBuffer){let G=m,Z=0,H=m.byteLength;if(typeof g=="object"&&g!==null)D=g;else if(typeof g=="number"){if(Z=g,!Number.isSafeInteger(Z))throw new RangeError("'byteOffset' must be an integer.");if(Z<0||Z>=G.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${G.byteLength}).`);if(H=m.byteLength-Z,typeof w=="number"){if(H=w,!Number.isSafeInteger(H))throw new RangeError("'byteLength' must be an integer.");if(H<=0||Z+H>G.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${G.byteLength-Z}].`);if(typeof $=="object"&&$!==null)D=$;else if(typeof $<"u")throw new TypeError("'options' must be an object.")}else if(typeof w<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof g<"u")throw new TypeError("'options' must be an object.");I=new Uint8Array(G,Z,H)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[F,U]=await Qi(D),j=await F.createInferenceSessionHandler(I,U);return vt("InferenceSession.create"),Me(),new ep(j)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Kp,_a=L$1(()=>{ba(),Kp=xr}),wa=L$1(()=>{}),va=L$1(()=>{}),$a=L$1(()=>{}),xa=L$1(()=>{}),Kn={};Wt(Kn,{InferenceSession:()=>Kp,TRACE:()=>$r,TRACE_EVENT_BEGIN:()=>wt,TRACE_EVENT_END:()=>vt,TRACE_FUNC_BEGIN:()=>Ne,TRACE_FUNC_END:()=>Me,Tensor:()=>qe,env:()=>we,registerBackend:()=>Pt});var Ve=L$1(()=>{Yi(),ta(),_a(),qn(),wa(),va(),jn(),$a(),xa()}),Sr=L$1(()=>{}),Ia={};Wt(Ia,{default:()=>Zp});var Ta,Ca,Zp,Aa=L$1(()=>{Zn(),$t(),Tr(),Ta="ort-wasm-proxy-worker",Ca=globalThis.self?.name===Ta,Ca&&(self.onmessage=d=>{let{type:m,in:g}=d.data;try{switch(m){case"init-wasm":Cr(g.wasm).then(()=>{Ir(g).then(()=>{postMessage({type:m})},w=>{postMessage({type:m,err:w})})},w=>{postMessage({type:m,err:w})});break;case"init-ep":{let{epName:w,env:$}=g;Ar($,w).then(()=>{postMessage({type:m})},I=>{postMessage({type:m,err:I})});break}case"copy-from":{let{buffer:w}=g,$=er(w);postMessage({type:m,out:$});break}case"create":{let{model:w,options:$}=g;Er(w,$).then(I=>{postMessage({type:m,out:I})},I=>{postMessage({type:m,err:I})});break}case"release":kr(g),postMessage({type:m});break;case"run":{let{sessionId:w,inputIndices:$,inputs:I,outputIndices:D,options:F}=g;Pr(w,$,I,D,new Array(D.length).fill(null),F).then(U=>{U.some(j=>j[3]!=="cpu")?postMessage({type:m,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:m,out:U},zr([...I,...U]))},U=>{postMessage({type:m,err:U})});break}case"end-profiling":Or(g),postMessage({type:m});break;default:}}catch(w){postMessage({type:m,err:w})}}),Zp=Ca?null:d=>new Worker(d??Le,{type:"module",name:Ta})}),ka={};Wt(ka,{default:()=>Qp});var Ea,Qp,Yp,Pa=L$1(()=>{Ea=async function(d={}){var m,g,w=d,$=new Promise((ne,xe)=>{m=ne,g=xe}),I=typeof window=="object",D=typeof WorkerGlobalScope<"u",F=D&&self.name?.startsWith("em-pthread");w.mountExternalData=(ne,xe)=>{ne.startsWith("./")&&(ne=ne.substring(2)),(w.Fb||(w.Fb=new Map)).set(ne,xe)},w.unmountExternalData=()=>{delete w.Fb};var U=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let j=ne=>async(...xe)=>{try{if(w.Gb)throw Error("Session already started");let Ue=w.Gb={ec:xe[0],errors:[]},mt=await ne(...xe);if(w.Gb!==Ue)throw Error("Session mismatch");w.Kb?.flush();let zt=Ue.errors;if(0<zt.length){let cr=await Promise.all(zt);if(cr=cr.filter(ei=>ei),0<cr.length)throw Error(cr.join(`
`))}return mt}finally{w.Gb=null}};w.jsepInit=(ne,xe)=>{if(ne==="webgpu"){[w.Kb,w.Vb,w.Zb,w.Lb,w.Yb,w.Ab,w.$b,w.bc,w.Wb,w.Xb,w.ac]=xe;let Ue=w.Kb;w.jsepRegisterBuffer=(mt,zt,cr,ei)=>Ue.registerBuffer(mt,zt,cr,ei),w.jsepGetBuffer=mt=>Ue.getBuffer(mt),w.jsepCreateDownloader=(mt,zt,cr)=>Ue.createDownloader(mt,zt,cr),w.jsepOnCreateSession=mt=>{Ue.onCreateSession(mt)},w.jsepOnReleaseSession=mt=>{Ue.onReleaseSession(mt)},w.jsepOnRunStart=mt=>Ue.onRunStart(mt),w.cc=(mt,zt)=>{Ue.upload(mt,zt)}}else if(ne==="webnn"){let Ue=xe[0];[w.oc,w.Ob,w.webnnEnsureTensor,w.Pb,w.webnnDownloadTensor,w.nc,w.webnnEnableTraceEvent]=xe.slice(1),w.webnnReleaseTensorId=w.Ob,w.webnnUploadTensor=w.Pb,w.webnnRegisterMLContext=w.nc,w.webnnOnRunStart=mt=>Ue.onRunStart(mt),w.webnnOnRunEnd=Ue.onRunEnd.bind(Ue),w.webnnOnReleaseSession=mt=>{Ue.onReleaseSession(mt)},w.webnnCreateMLTensorDownloader=(mt,zt)=>Ue.createMLTensorDownloader(mt,zt),w.webnnRegisterMLTensor=(mt,zt,cr,ei)=>Ue.registerMLTensor(mt,zt,cr,ei),w.webnnCreateMLContext=mt=>Ue.createMLContext(mt),w.webnnRegisterMLConstant=(mt,zt,cr,ei,si,ci)=>Ue.registerMLConstant(mt,zt,cr,ei,si,w.Fb,ci),w.webnnRegisterGraphInput=Ue.registerGraphInput.bind(Ue),w.webnnIsGraphInput=Ue.isGraphInput.bind(Ue),w.webnnRegisterGraphOutput=Ue.registerGraphOutput.bind(Ue),w.webnnIsGraphOutput=Ue.isGraphOutput.bind(Ue),w.webnnCreateTemporaryTensor=Ue.createTemporaryTensor.bind(Ue),w.webnnIsGraphInputOutputTypeSupported=Ue.isGraphInputOutputTypeSupported.bind(Ue)}};let G=()=>{let ne=(xe,Ue,mt)=>(...zt)=>{let cr=Vi,ei=Ue?.();zt=xe(...zt);let si=Ue?.();return ei!==si&&(xe=si,mt(ei),Ue=mt=null),Vi!=cr?new Promise((ci,pi)=>{Wo={resolve:ci,reject:pi}}):zt};(()=>{for(let xe of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])w[xe]=ne(w[xe],()=>w[xe],Ue=>w[xe]=Ue)})(),j!==void 0&&(w._OrtRun=j(w._OrtRun),w._OrtRunWithBinding=j(w._OrtRunWithBinding)),G=void 0};w.asyncInit=()=>{G?.()};var Z,H,q=(ne,xe)=>{throw xe},V=import.meta.url,Q="";if(I||D){try{Q=new URL(".",V).href}catch{}D&&(H=ne=>{var xe=new XMLHttpRequest;return xe.open("GET",ne,!1),xe.responseType="arraybuffer",xe.send(null),new Uint8Array(xe.response)}),Z=async ne=>{if(Zt(ne))return new Promise((Ue,mt)=>{var zt=new XMLHttpRequest;zt.open("GET",ne,!0),zt.responseType="arraybuffer",zt.onload=()=>{zt.status==200||zt.status==0&&zt.response?Ue(zt.response):mt(zt.status)},zt.onerror=mt,zt.send(null)});var xe=await fetch(ne,{credentials:"same-origin"});if(xe.ok)return xe.arrayBuffer();throw Error(xe.status+" : "+xe.url)}}var X,re,J,se,ie,oe,pe,de,ge,ce,Ie,fe,Te,ut,ze,Ce=console.log.bind(console),Fe=console.error.bind(console),Et=Ce,bt=Fe,ht=!1,Zt=ne=>ne.startsWith("file://");function Ye(){return re.buffer!=ie.buffer&&Nt(),ie}function _t(){return re.buffer!=ie.buffer&&Nt(),oe}function Vt(){return re.buffer!=ie.buffer&&Nt(),pe}function Lt(){return re.buffer!=ie.buffer&&Nt(),de}function dt(){return re.buffer!=ie.buffer&&Nt(),ge}function It(){return re.buffer!=ie.buffer&&Nt(),ce}function dr(){return re.buffer!=ie.buffer&&Nt(),Ie}function fr(){return re.buffer!=ie.buffer&&Nt(),ut}if(F){let ne=function(xe){try{var Ue=xe.data,mt=Ue.Db;if(mt==="load"){let zt=[];self.onmessage=cr=>zt.push(cr),self.startWorker=()=>{postMessage({Db:"loaded"});for(let cr of zt)ne(cr);self.onmessage=ne};for(let cr of Ue.Sb)w[cr]&&!w[cr].proxy||(w[cr]=(...ei)=>{postMessage({Db:"callHandler",Rb:cr,args:ei})},cr=="print"&&(Et=w[cr]),cr=="printErr"&&(bt=w[cr]));re=Ue.kc,Nt(),ze(Ue.lc)}else if(mt==="run"){di(Ue.Bb),Ko(Ue.Bb,0,0,1,0,0),Ei(),jo(Ue.Bb),pr||(jc(),pr=!0);try{_r(Ue.hc,Ue.Jb)}catch(zt){if(zt!="unwind")throw zt}}else Ue.target!=="setimmediate"&&(mt==="checkMailbox"?pr&&Cn():mt&&(bt(`worker: received unknown command ${mt}`),bt(Ue)))}catch(zt){throw Gc(),zt}};var pr=!1;self.onunhandledrejection=xe=>{throw xe.reason||xe},self.onmessage=ne}function Nt(){var ne=re.buffer;w.HEAP8=ie=new Int8Array(ne),pe=new Int16Array(ne),w.HEAPU8=oe=new Uint8Array(ne),de=new Uint16Array(ne),w.HEAP32=ge=new Int32Array(ne),w.HEAPU32=ce=new Uint32Array(ne),Ie=new Float32Array(ne),ut=new Float64Array(ne),fe=new BigInt64Array(ne),Te=new BigUint64Array(ne)}function $e(){F?startWorker(w):li.Da()}var At,Ge=0,st=null;function Xe(){if(--Ge==0&&st){var ne=st;st=null,ne()}}function gt(ne){throw bt(ne="Aborted("+ne+")"),ht=!0,ne=new WebAssembly.RuntimeError(ne+". Build with -sASSERTIONS for more info."),g(ne),ne}function Qt(){return{a:{L:E0,Aa:$0,b:yt,$:$i,A:hr,pa:yr,X:ti,Z:vi,qa:mi,na:yi,ga:Si,ma:Li,J:Ai,Y:Mi,V:Ri,oa:Oi,W:Hi,va:Bi,E:Tn,Q:An,O:ip,D:np,v:sp,s:op,P:up,z:mp,R:gp,ja:_p,T:bp,aa:yp,M:wp,F:vp,ia:jo,sa:xp,r:$p,Ca:Ep,w:Ip,o:Tp,m:Cp,c:$n,Ba:Mp,n:zp,j:Rp,u:Op,p:Np,f:Dp,t:Lp,l:Up,e:Wp,k:Vp,h:e0,g:t0,d:r0,da:i0,ea:a0,fa:n0,ba:Tc,ca:Ac,N:Cc,xa:o0,ua:l0,i:d0,C:h0,G:f0,ta:u0,x:c0,ra:p0,U:m0,q:s0,y:g0,K:_0,S:b0,za:y0,ya:w0,ka:Bc,la:Rc,_:ai,B:Oc,I:Nc,ha:Dc,H:Fc,a:re,wa:oi}}}class me{name="ExitStatus";constructor(xe){this.message=`Program terminated with exit(${xe})`,this.status=xe}}var Be=ne=>{ne.terminate(),ne.onmessage=()=>{}},lt=[],ft=ne=>{fi.length==0&&(Yt(),gi(fi[0]));var xe=fi.pop();if(!xe)return 6;ui.push(xe),_i[ne.Bb]=xe,xe.Bb=ne.Bb;var Ue={Db:"run",hc:ne.fc,Jb:ne.Jb,Bb:ne.Bb};return xe.postMessage(Ue,ne.Nb),0},mr=0,gr=(ne,xe,...Ue)=>{for(var mt=2*Ue.length,zt=Jo(),cr=Xo(8*mt),ei=cr>>>3,si=0;si<Ue.length;si++){var ci=Ue[si];typeof ci=="bigint"?(fe[ei+2*si]=1n,fe[ei+2*si+1]=ci):(fe[ei+2*si]=0n,fr()[ei+2*si+1>>>0]=ci)}return ne=Wc(ne,0,mt,cr,xe),Un(zt),ne};function oi(ne){if(F)return gr(0,1,ne);if(se=ne,!(0<mr)){for(var xe of ui)Be(xe);for(xe of fi)Be(xe);fi=[],ui=[],_i={},ht=!0}q(0,new me(ne))}function hi(ne){if(F)return gr(1,0,ne);ai(ne)}var ai=ne=>{if(se=ne,F)throw hi(ne),"unwind";oi(ne)},fi=[],ui=[],wi=[],_i={},bi=ne=>{var xe=ne.Bb;delete _i[xe],fi.push(ne),ui.splice(ui.indexOf(ne),1),ne.Bb=0,Zc(xe)};function Ei(){wi.forEach(ne=>ne())}var gi=ne=>new Promise(xe=>{ne.onmessage=zt=>{var cr=(zt=zt.data).Db;if(zt.Hb&&zt.Hb!=Qo()){var ei=_i[zt.Hb];ei?ei.postMessage(zt,zt.Nb):bt(`Internal error! Worker sent a message "${cr}" to target pthread ${zt.Hb}, but that thread no longer exists!`)}else cr==="checkMailbox"?Cn():cr==="spawnThread"?ft(zt):cr==="cleanupThread"?bi(_i[zt.ic]):cr==="loaded"?(ne.loaded=!0,xe(ne)):zt.target==="setimmediate"?ne.postMessage(zt):cr==="callHandler"?w[zt.Rb](...zt.args):cr&&bt(`worker sent an unknown command ${cr}`)},ne.onerror=zt=>{throw bt(`worker sent an error! ${zt.filename}:${zt.lineno}: ${zt.message}`),zt};var Ue,mt=[];for(Ue of[])w.propertyIsEnumerable(Ue)&&mt.push(Ue);ne.postMessage({Db:"load",Sb:mt,kc:re,lc:J})});function Yt(){var ne=new Worker((()=>{let xe=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new xe("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});fi.push(ne)}var di=ne=>{Nt();var xe=It()[ne+52>>>2>>>0];ne=It()[ne+56>>>2>>>0],Vc(xe,xe-ne),Un(xe)},_r=(ne,xe)=>{mr=0,ne=Qc(ne,xe),0<mr?se=ne:Yo(ne)};class ri{constructor(xe){this.Ib=xe-24}}function yt(ne,xe,Ue){var mt=new ri(ne>>>=0);throw xe>>>=0,Ue>>>=0,It()[mt.Ib+16>>>2>>>0]=0,It()[mt.Ib+4>>>2>>>0]=xe,It()[mt.Ib+8>>>2>>>0]=Ue,ne}function ni(ne,xe,Ue,mt){return F?gr(2,1,ne,xe,Ue,mt):$i(ne,xe,Ue,mt)}function $i(ne,xe,Ue,mt){if(ne>>>=0,Ue>>>=0,mt>>>=0,U===void 0)return 6;var zt=[];return F&&zt.length===0?ni(ne,xe>>>=0,Ue,mt):(ne={fc:Ue,Bb:ne,Jb:mt,Nb:zt},F?(ne.Db="spawnThread",postMessage(ne,zt),0):ft(ne))}var Oe=typeof TextDecoder<"u"?new TextDecoder:void 0,ii=(ne,xe=0,Ue=NaN)=>{var mt=(xe>>>=0)+Ue;for(Ue=xe;ne[Ue]&&!(Ue>=mt);)++Ue;if(16<Ue-xe&&ne.buffer&&Oe)return Oe.decode(ne.buffer instanceof ArrayBuffer?ne.subarray(xe,Ue):ne.slice(xe,Ue));for(mt="";xe<Ue;){var zt=ne[xe++];if(128&zt){var cr=63&ne[xe++];if((224&zt)==192)mt+=String.fromCharCode((31&zt)<<6|cr);else{var ei=63&ne[xe++];65536>(zt=(240&zt)==224?(15&zt)<<12|cr<<6|ei:(7&zt)<<18|cr<<12|ei<<6|63&ne[xe++])?mt+=String.fromCharCode(zt):(zt-=65536,mt+=String.fromCharCode(55296|zt>>10,56320|1023&zt))}}else mt+=String.fromCharCode(zt)}return mt},br=(ne,xe)=>(ne>>>=0)?ii(_t(),ne,xe):"";function hr(ne,xe,Ue){return F?gr(3,1,ne,xe,Ue):0}function yr(ne,xe){if(F)return gr(4,1,ne,xe)}function ti(ne,xe){if(F)return gr(5,1,ne,xe)}function vi(ne,xe,Ue){if(F)return gr(6,1,ne,xe,Ue)}function mi(ne,xe,Ue){return F?gr(7,1,ne,xe,Ue):0}function yi(ne,xe){if(F)return gr(8,1,ne,xe)}function Si(ne,xe,Ue){if(F)return gr(9,1,ne,xe,Ue)}function Li(ne,xe,Ue,mt){if(F)return gr(10,1,ne,xe,Ue,mt)}function Ai(ne,xe,Ue,mt){if(F)return gr(11,1,ne,xe,Ue,mt)}function Mi(ne,xe,Ue,mt){if(F)return gr(12,1,ne,xe,Ue,mt)}function Ri(ne){if(F)return gr(13,1,ne)}function Oi(ne,xe){if(F)return gr(14,1,ne,xe)}function Hi(ne,xe,Ue){if(F)return gr(15,1,ne,xe,Ue)}var qi,Bi=()=>gt(""),zi=ne=>{for(var xe="";_t()[ne>>>0];)xe+=qi[_t()[ne++>>>0]];return xe},Ui={},Di={},Pi=w.BindingError=class extends Error{constructor(ne){super(ne),this.name="BindingError"}};function Ci(ne,xe,Ue={}){return(function(mt,zt,cr={}){var ei=zt.name;if(!mt)throw new Pi(`type "${ei}" must have a positive integer typeid pointer`);if(Di.hasOwnProperty(mt)){if(cr.Tb)return;throw new Pi(`Cannot register type '${ei}' twice`)}Di[mt]=zt,Ui.hasOwnProperty(mt)&&(zt=Ui[mt],delete Ui[mt],zt.forEach(si=>si()))})(ne,xe,Ue)}var Ki=(ne,xe,Ue)=>{switch(xe){case 1:return Ue?mt=>Ye()[mt>>>0]:mt=>_t()[mt>>>0];case 2:return Ue?mt=>Vt()[mt>>>1>>>0]:mt=>Lt()[mt>>>1>>>0];case 4:return Ue?mt=>dt()[mt>>>2>>>0]:mt=>It()[mt>>>2>>>0];case 8:return Ue?mt=>fe[mt>>>3]:mt=>Te[mt>>>3];default:throw new TypeError(`invalid integer width (${xe}): ${ne}`)}};function Tn(ne,xe,Ue){Ue>>>=0,Ci(ne>>>=0,{name:xe=zi(xe>>>0),fromWireType:mt=>mt,toWireType:function(mt,zt){if(typeof zt!="bigint"&&typeof zt!="number")throw zt=zt===null?"null":(mt=typeof zt)=="object"||mt==="array"||mt==="function"?zt.toString():""+zt,new TypeError(`Cannot convert "${zt}" to ${this.name}`);return typeof zt=="number"&&(zt=BigInt(zt)),zt},Cb:Zi,readValueFromPointer:Ki(xe,Ue,xe.indexOf("u")==-1),Eb:null})}var Zi=8;function An(ne,xe,Ue,mt){Ci(ne>>>=0,{name:xe=zi(xe>>>0),fromWireType:function(zt){return!!zt},toWireType:function(zt,cr){return cr?Ue:mt},Cb:Zi,readValueFromPointer:function(zt){return this.fromWireType(_t()[zt>>>0])},Eb:null})}var xn=[],Gi=[];function $n(ne){9<(ne>>>=0)&&--Gi[ne+1]==0&&(Gi[ne]=void 0,xn.push(ne))}var Fi=ne=>{if(!ne)throw new Pi(`Cannot use deleted val. handle = ${ne}`);return Gi[ne]},Wi=ne=>{switch(ne){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let xe=xn.pop()||Gi.length;return Gi[xe]=ne,Gi[xe+1]=1,xe}};function No(ne){return this.fromWireType(It()[ne>>>2>>>0])}var rp={name:"emscripten::val",fromWireType:ne=>{var xe=Fi(ne);return $n(ne),xe},toWireType:(ne,xe)=>Wi(xe),Cb:Zi,readValueFromPointer:No,Eb:null};function ip(ne){return Ci(ne>>>0,rp)}var ap=(ne,xe)=>{switch(xe){case 4:return function(Ue){return this.fromWireType(dr()[Ue>>>2>>>0])};case 8:return function(Ue){return this.fromWireType(fr()[Ue>>>3>>>0])};default:throw new TypeError(`invalid float width (${xe}): ${ne}`)}};function np(ne,xe,Ue){Ue>>>=0,Ci(ne>>>=0,{name:xe=zi(xe>>>0),fromWireType:mt=>mt,toWireType:(mt,zt)=>zt,Cb:Zi,readValueFromPointer:ap(xe,Ue),Eb:null})}function sp(ne,xe,Ue,mt,zt){if(ne>>>=0,Ue>>>=0,xe=zi(xe>>>0),zt===-1&&(zt=4294967295),zt=si=>si,mt===0){var cr=32-8*Ue;zt=si=>si<<cr>>>cr}var ei=xe.includes("unsigned")?function(si,ci){return ci>>>0}:function(si,ci){return ci};Ci(ne,{name:xe,fromWireType:zt,toWireType:ei,Cb:Zi,readValueFromPointer:Ki(xe,Ue,mt!==0),Eb:null})}function op(ne,xe,Ue){function mt(cr){var ei=It()[cr>>>2>>>0];return cr=It()[cr+4>>>2>>>0],new zt(Ye().buffer,cr,ei)}var zt=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][xe];Ci(ne>>>=0,{name:Ue=zi(Ue>>>0),fromWireType:mt,Cb:Zi,readValueFromPointer:mt},{Tb:!0})}var wn=(ne,xe,Ue)=>{var mt=_t();if(xe>>>=0,0<Ue){var zt=xe;Ue=xe+Ue-1;for(var cr=0;cr<ne.length;++cr){var ei=ne.charCodeAt(cr);if(55296<=ei&&57343>=ei&&(ei=65536+((1023&ei)<<10)|1023&ne.charCodeAt(++cr)),127>=ei){if(xe>=Ue)break;mt[xe++>>>0]=ei}else{if(2047>=ei){if(xe+1>=Ue)break;mt[xe++>>>0]=192|ei>>6}else{if(65535>=ei){if(xe+2>=Ue)break;mt[xe++>>>0]=224|ei>>12}else{if(xe+3>=Ue)break;mt[xe++>>>0]=240|ei>>18,mt[xe++>>>0]=128|ei>>12&63}mt[xe++>>>0]=128|ei>>6&63}mt[xe++>>>0]=128|63&ei}}mt[xe>>>0]=0,ne=xe-zt}else ne=0;return ne},Fo=ne=>{for(var xe=0,Ue=0;Ue<ne.length;++Ue){var mt=ne.charCodeAt(Ue);127>=mt?xe++:2047>=mt?xe+=2:55296<=mt&&57343>=mt?(xe+=4,++Ue):xe+=3}return xe};function up(ne,xe){Ci(ne>>>=0,{name:xe=zi(xe>>>0),fromWireType:function(Ue){for(var mt,zt=It()[Ue>>>2>>>0],cr=Ue+4,ei=cr,si=0;si<=zt;++si){var ci=cr+si;si!=zt&&_t()[ci>>>0]!=0||(ei=br(ei,ci-ei),mt===void 0?mt=ei:(mt+="\0",mt+=ei),ei=ci+1)}return _n(Ue),mt},toWireType:function(Ue,mt){mt instanceof ArrayBuffer&&(mt=new Uint8Array(mt));var zt=typeof mt=="string";if(!(zt||ArrayBuffer.isView(mt)&&mt.BYTES_PER_ELEMENT==1))throw new Pi("Cannot pass non-string to std::string");var cr=zt?Fo(mt):mt.length,ei=Dn(4+cr+1),si=ei+4;return It()[ei>>>2>>>0]=cr,zt?wn(mt,si,cr+1):_t().set(mt,si>>>0),Ue!==null&&Ue.push(_n,ei),ei},Cb:Zi,readValueFromPointer:No,Eb(Ue){_n(Ue)}})}var oh=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,lp=(ne,xe)=>{for(var Ue=ne>>1,mt=Ue+xe/2;!(Ue>=mt)&&Lt()[Ue>>>0];)++Ue;if(32<(Ue<<=1)-ne&&oh)return oh.decode(_t().slice(ne,Ue));for(Ue="",mt=0;!(mt>=xe/2);++mt){var zt=Vt()[ne+2*mt>>>1>>>0];if(zt==0)break;Ue+=String.fromCharCode(zt)}return Ue},dp=(ne,xe,Ue)=>{if(Ue??=2147483647,2>Ue)return 0;var mt=xe;Ue=(Ue-=2)<2*ne.length?Ue/2:ne.length;for(var zt=0;zt<Ue;++zt){var cr=ne.charCodeAt(zt);Vt()[xe>>>1>>>0]=cr,xe+=2}return Vt()[xe>>>1>>>0]=0,xe-mt},hp=ne=>2*ne.length,fp=(ne,xe)=>{for(var Ue=0,mt="";!(Ue>=xe/4);){var zt=dt()[ne+4*Ue>>>2>>>0];if(zt==0)break;++Ue,65536<=zt?(zt-=65536,mt+=String.fromCharCode(55296|zt>>10,56320|1023&zt)):mt+=String.fromCharCode(zt)}return mt},cp=(ne,xe,Ue)=>{if(xe>>>=0,Ue??=2147483647,4>Ue)return 0;var mt=xe;Ue=mt+Ue-4;for(var zt=0;zt<ne.length;++zt){var cr=ne.charCodeAt(zt);if(55296<=cr&&57343>=cr&&(cr=65536+((1023&cr)<<10)|1023&ne.charCodeAt(++zt)),dt()[xe>>>2>>>0]=cr,(xe+=4)+4>Ue)break}return dt()[xe>>>2>>>0]=0,xe-mt},pp=ne=>{for(var xe=0,Ue=0;Ue<ne.length;++Ue){var mt=ne.charCodeAt(Ue);55296<=mt&&57343>=mt&&++Ue,xe+=4}return xe};function mp(ne,xe,Ue){if(ne>>>=0,xe>>>=0,Ue=zi(Ue>>>=0),xe===2)var mt=lp,zt=dp,cr=hp,ei=si=>Lt()[si>>>1>>>0];else xe===4&&(mt=fp,zt=cp,cr=pp,ei=si=>It()[si>>>2>>>0]);Ci(ne,{name:Ue,fromWireType:si=>{for(var ci,pi=It()[si>>>2>>>0],xi=si+4,ki=0;ki<=pi;++ki){var Ii=si+4+ki*xe;ki!=pi&&ei(Ii)!=0||(xi=mt(xi,Ii-xi),ci===void 0?ci=xi:(ci+="\0",ci+=xi),xi=Ii+xe)}return _n(si),ci},toWireType:(si,ci)=>{if(typeof ci!="string")throw new Pi(`Cannot pass non-string to C++ string type ${Ue}`);var pi=cr(ci),xi=Dn(4+pi+xe);return It()[xi>>>2>>>0]=pi/xe,zt(ci,xi+4,pi+xe),si!==null&&si.push(_n,xi),xi},Cb:Zi,readValueFromPointer:No,Eb(si){_n(si)}})}function gp(ne,xe){Ci(ne>>>=0,{Ub:!0,name:xe=zi(xe>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function _p(ne){Ko(ne>>>0,!D,1,!I,131072,!1),Ei()}var Lo=ne=>{if(!ht)try{if(ne(),!(0<mr))try{F?Yo(se):ai(se)}catch(xe){xe instanceof me||xe=="unwind"||q(0,xe)}}catch(xe){xe instanceof me||xe=="unwind"||q(0,xe)}};function jo(ne){ne>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(dt(),ne>>>2,ne).value.then(Cn),ne+=128,Atomics.store(dt(),ne>>>2,1))}var Cn=()=>{var ne=Qo();ne&&(jo(ne),Lo(qc))};function bp(ne,xe){(ne>>>=0)==xe>>>0?setTimeout(Cn):F?postMessage({Hb:ne,Db:"checkMailbox"}):(ne=_i[ne])&&ne.postMessage({Db:"checkMailbox"})}var Go=[];function yp(ne,xe,Ue,mt,zt){for(xe>>>=0,mt/=2,Go.length=mt,Ue=zt>>>0>>>3,zt=0;zt<mt;zt++)Go[zt]=fe[Ue+2*zt]?fe[Ue+2*zt+1]:fr()[Ue+2*zt+1>>>0];return(xe?Vo[xe]:x0[ne])(...Go)}var wp=()=>{mr=0};function vp(ne){ne>>>=0,F?postMessage({Db:"cleanupThread",ic:ne}):bi(_i[ne])}function xp(ne){}var Mn=(ne,xe)=>{var Ue=Di[ne];if(Ue===void 0)throw ne=Uc(ne),Ue=zi(ne),_n(ne),new Pi(`${xe} has unknown type ${Ue}`);return Ue},Dh=(ne,xe,Ue)=>{var mt=[];return ne=ne.toWireType(mt,Ue),mt.length&&(It()[xe>>>2>>>0]=Wi(mt)),ne};function $p(ne,xe,Ue){return xe>>>=0,Ue>>>=0,ne=Fi(ne>>>0),xe=Mn(xe,"emval::as"),Dh(xe,Ue,ne)}function Ep(ne,xe){return xe>>>=0,ne=Fi(ne>>>0),(xe=Mn(xe,"emval::as")).toWireType(null,ne)}var zn=ne=>{try{ne()}catch(xe){gt(xe)}},yn=0,Vi=null,uf=0,Pn=[],vc={},xc={},kp=0,Wo=null,Sp=[];function $c(ne){return(function(xe){if(!ht){if(yn===0){var Ue=!1,mt=!1;xe((zt=0)=>{if(!ht&&(uf=zt,Ue=!0,mt)){yn=2,zn(()=>Xc(Vi)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),zt=!1;try{var cr=(function(){var ci=dt()[Vi+8>>>2>>>0];return ci=li[xc[ci]],--mr,ci()})()}catch(ci){cr=ci,zt=!0}var ei=!1;if(!Vi){var si=Wo;si&&(Wo=null,(zt?si.reject:si.resolve)(cr),ei=!0)}if(zt&&!ei)throw cr}}),mt=!0,Ue||(yn=1,Vi=(function(){var zt=Dn(65548),cr=zt+12;It()[zt>>>2>>>0]=cr,It()[zt+4>>>2>>>0]=cr+65536,cr=Pn[0];var ei=vc[cr];return ei===void 0&&(ei=kp++,vc[cr]=ei,xc[ei]=cr),cr=ei,dt()[zt+8>>>2>>>0]=cr,zt})(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),zn(()=>Kc(Vi)))}else yn===2?(yn=0,zn(Jc),_n(Vi),Vi=null,Sp.forEach(Lo)):gt(`invalid state: ${yn}`);return uf}})(xe=>{ne().then(xe)})}function Ip(ne){return ne>>>=0,$c(async()=>{var xe=await Fi(ne);return Wi(xe)})}var Bn=[];function Tp(ne,xe,Ue,mt){return Ue>>>=0,mt>>>=0,(ne=Bn[ne>>>0])(null,xe=Fi(xe>>>0),Ue,mt)}var Ap={},Rn=ne=>{var xe=Ap[ne];return xe===void 0?zi(ne):xe};function Cp(ne,xe,Ue,mt,zt){return Ue>>>=0,mt>>>=0,zt>>>=0,(ne=Bn[ne>>>0])(xe=Fi(xe>>>0),xe[Ue=Rn(Ue)],mt,zt)}function Mp(ne,xe){return xe>>>=0,(ne=Fi(ne>>>0))==Fi(xe)}var Ec=()=>typeof globalThis=="object"?globalThis:Function("return this")();function zp(ne){return(ne>>>=0)==0?Wi(Ec()):(ne=Rn(ne),Wi(Ec()[ne]))}var Pp=ne=>{var xe=Bn.length;return Bn.push(ne),xe},Bp=(ne,xe)=>{for(var Ue=Array(ne),mt=0;mt<ne;++mt)Ue[mt]=Mn(It()[xe+4*mt>>>2>>>0],`parameter ${mt}`);return Ue};function Rp(ne,xe,Ue){var mt=(xe=Bp(ne,xe>>>0)).shift();ne--;var zt=`return function (obj, func, destructorsRef, args) {
`,cr=0,ei=[];Ue===0&&ei.push("obj");for(var si=["retType"],ci=[mt],pi=0;pi<ne;++pi)ei.push(`arg${pi}`),si.push(`argType${pi}`),ci.push(xe[pi]),zt+=`  var arg${pi} = argType${pi}.readValueFromPointer(args${cr?"+"+cr:""});
`,cr+=xe[pi].Cb;return zt+=`  var rv = ${Ue===1?"new func":"func.call"}(${ei.join(", ")});
`,mt.Ub||(si.push("emval_returnValue"),ci.push(Dh),zt+=`  return emval_returnValue(retType, destructorsRef, rv);
`),ne=new Function(...si,zt+`};
`)(...ci),Ue=`methodCaller<(${xe.map(xi=>xi.name).join(", ")}) => ${mt.name}>`,Pp(Object.defineProperty(ne,"name",{value:Ue}))}function Op(ne){return ne=Rn(ne>>>0),Wi(w[ne])}function Np(ne,xe){return xe>>>=0,ne=Fi(ne>>>0),xe=Fi(xe),Wi(ne[xe])}function Dp(ne){9<(ne>>>=0)&&(Gi[ne+1]+=1)}function Lp(){return Wi([])}function Up(ne){ne=Fi(ne>>>0);for(var xe=Array(ne.length),Ue=0;Ue<ne.length;Ue++)xe[Ue]=ne[Ue];return Wi(xe)}function Wp(ne){return Wi(Rn(ne>>>0))}function Vp(){return Wi({})}function e0(ne){for(var xe=Fi(ne>>>=0);xe.length;){var Ue=xe.pop();xe.pop()(Ue)}$n(ne)}function t0(ne,xe,Ue){xe>>>=0,Ue>>>=0,ne=Fi(ne>>>0),xe=Fi(xe),Ue=Fi(Ue),ne[xe]=Ue}function r0(ne,xe){return xe>>>=0,ne=(ne=Mn(ne>>>0,"_emval_take_value")).readValueFromPointer(xe),Wi(ne)}function i0(ne,xe){ne=-9007199254740992>ne||9007199254740992<ne?NaN:Number(ne),xe>>>=0,ne=new Date(1e3*ne),dt()[xe>>>2>>>0]=ne.getUTCSeconds(),dt()[xe+4>>>2>>>0]=ne.getUTCMinutes(),dt()[xe+8>>>2>>>0]=ne.getUTCHours(),dt()[xe+12>>>2>>>0]=ne.getUTCDate(),dt()[xe+16>>>2>>>0]=ne.getUTCMonth(),dt()[xe+20>>>2>>>0]=ne.getUTCFullYear()-1900,dt()[xe+24>>>2>>>0]=ne.getUTCDay(),ne=(ne.getTime()-Date.UTC(ne.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,dt()[xe+28>>>2>>>0]=ne}var kc=ne=>ne%4==0&&(ne%100!=0||ne%400==0),Sc=[0,31,60,91,121,152,182,213,244,274,305,335],Ic=[0,31,59,90,120,151,181,212,243,273,304,334];function a0(ne,xe){ne=-9007199254740992>ne||9007199254740992<ne?NaN:Number(ne),xe>>>=0,ne=new Date(1e3*ne),dt()[xe>>>2>>>0]=ne.getSeconds(),dt()[xe+4>>>2>>>0]=ne.getMinutes(),dt()[xe+8>>>2>>>0]=ne.getHours(),dt()[xe+12>>>2>>>0]=ne.getDate(),dt()[xe+16>>>2>>>0]=ne.getMonth(),dt()[xe+20>>>2>>>0]=ne.getFullYear()-1900,dt()[xe+24>>>2>>>0]=ne.getDay();var Ue=(kc(ne.getFullYear())?Sc:Ic)[ne.getMonth()]+ne.getDate()-1|0;dt()[xe+28>>>2>>>0]=Ue,dt()[xe+36>>>2>>>0]=-60*ne.getTimezoneOffset(),Ue=new Date(ne.getFullYear(),6,1).getTimezoneOffset();var mt=new Date(ne.getFullYear(),0,1).getTimezoneOffset();ne=0|(Ue!=mt&&ne.getTimezoneOffset()==Math.min(mt,Ue)),dt()[xe+32>>>2>>>0]=ne}function n0(ne){ne>>>=0;var xe=new Date(dt()[ne+20>>>2>>>0]+1900,dt()[ne+16>>>2>>>0],dt()[ne+12>>>2>>>0],dt()[ne+8>>>2>>>0],dt()[ne+4>>>2>>>0],dt()[ne>>>2>>>0],0),Ue=dt()[ne+32>>>2>>>0],mt=xe.getTimezoneOffset(),zt=new Date(xe.getFullYear(),6,1).getTimezoneOffset(),cr=new Date(xe.getFullYear(),0,1).getTimezoneOffset(),ei=Math.min(cr,zt);return 0>Ue?dt()[ne+32>>>2>>>0]=+(zt!=cr&&ei==mt):0<Ue!=(ei==mt)&&(zt=Math.max(cr,zt),xe.setTime(xe.getTime()+6e4*((0<Ue?ei:zt)-mt))),dt()[ne+24>>>2>>>0]=xe.getDay(),Ue=(kc(xe.getFullYear())?Sc:Ic)[xe.getMonth()]+xe.getDate()-1|0,dt()[ne+28>>>2>>>0]=Ue,dt()[ne>>>2>>>0]=xe.getSeconds(),dt()[ne+4>>>2>>>0]=xe.getMinutes(),dt()[ne+8>>>2>>>0]=xe.getHours(),dt()[ne+12>>>2>>>0]=xe.getDate(),dt()[ne+16>>>2>>>0]=xe.getMonth(),dt()[ne+20>>>2>>>0]=xe.getYear(),ne=xe.getTime(),BigInt(isNaN(ne)?-1:ne/1e3)}function Tc(ne,xe,Ue,mt,zt,cr,ei){return F?gr(16,1,ne,xe,Ue,mt,zt,cr,ei):-52}function Ac(ne,xe,Ue,mt,zt,cr){if(F)return gr(17,1,ne,xe,Ue,mt,zt,cr)}var En={},s0=()=>performance.timeOrigin+performance.now();function Cc(ne,xe){if(F)return gr(18,1,ne,xe);if(En[ne]&&(clearTimeout(En[ne].id),delete En[ne]),!xe)return 0;var Ue=setTimeout(()=>{delete En[ne],Lo(()=>Hc(ne,performance.timeOrigin+performance.now()))},xe);return En[ne]={id:Ue,rc:xe},0}function o0(ne,xe,Ue,mt){ne>>>=0,xe>>>=0,Ue>>>=0,mt>>>=0;var zt=new Date().getFullYear(),cr=new Date(zt,0,1).getTimezoneOffset();zt=new Date(zt,6,1).getTimezoneOffset();var ei=Math.max(cr,zt);It()[ne>>>2>>>0]=60*ei,dt()[xe>>>2>>>0]=+(cr!=zt),ne=(xe=si=>{var ci=Math.abs(si);return`UTC${0<=si?"-":"+"}${String(Math.floor(ci/60)).padStart(2,"0")}${String(ci%60).padStart(2,"0")}`})(cr),xe=xe(zt),zt<cr?(wn(ne,Ue,17),wn(xe,mt,17)):(wn(ne,mt,17),wn(xe,Ue,17))}var u0=()=>Date.now();function l0(ne,xe,Ue){return 0<=ne&&3>=ne?(ne===0?ne=Date.now():ne=performance.timeOrigin+performance.now(),fe[Ue>>>0>>>3]=BigInt(Math.round(1e6*ne)),0):28}var Zo=[],Mc=(ne,xe)=>{Zo.length=0;for(var Ue;Ue=_t()[ne++>>>0];){var mt=Ue!=105;xe+=(mt&=Ue!=112)&&xe%8?4:0,Zo.push(Ue==112?It()[xe>>>2>>>0]:Ue==106?fe[xe>>>3]:Ue==105?dt()[xe>>>2>>>0]:fr()[xe>>>3>>>0]),xe+=mt?8:4}return Zo};function d0(ne,xe,Ue){return ne>>>=0,xe=Mc(xe>>>0,Ue>>>0),Vo[ne](...xe)}function h0(ne,xe,Ue){return ne>>>=0,xe=Mc(xe>>>0,Ue>>>0),Vo[ne](...xe)}var f0=()=>{};function c0(ne,xe){return bt(br(ne>>>0,xe>>>0))}var p0=()=>{throw mr+=1,"unwind"};function m0(){return 4294901760}var g0=()=>navigator.hardwareConcurrency;function _0(){return gt("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function b0(ne){ne>>>=0;var xe=_t().length;if(ne<=xe||4294901760<ne)return!1;for(var Ue=1;4>=Ue;Ue*=2){var mt=xe*(1+.2/Ue);mt=Math.min(mt,ne+100663296);e:{mt=(Math.min(4294901760,65536*Math.ceil(Math.max(ne,mt)/65536))-re.buffer.byteLength+65535)/65536|0;try{re.grow(mt),Nt();var zt=1;break e}catch{}zt=void 0}if(zt)return!0}return!1}var On=()=>(gt("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),kn={},zc=ne=>{ne.forEach(xe=>{On()})};function y0(){var ne=Error().stack.toString().split(`
`);return ne[0]=="Error"&&ne.shift(),zc(ne),kn.Mb=On(),kn.dc=ne,kn.Mb}function w0(ne,xe,Ue){if(ne>>>=0,xe>>>=0,kn.Mb==ne)var mt=kn.dc;else(mt=Error().stack.toString().split(`
`))[0]=="Error"&&mt.shift(),zc(mt);for(var zt=3;mt[zt]&&On()!=ne;)++zt;for(ne=0;ne<Ue&&mt[ne+zt];++ne)dt()[xe+4*ne>>>2>>>0]=On();return ne}var Ho,qo={},Pc=()=>{if(!Ho){var ne,xe={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(ne in qo)qo[ne]===void 0?delete xe[ne]:xe[ne]=qo[ne];var Ue=[];for(ne in xe)Ue.push(`${ne}=${xe[ne]}`);Ho=Ue}return Ho};function Bc(ne,xe){if(F)return gr(19,1,ne,xe);ne>>>=0,xe>>>=0;var Ue,mt=0,zt=0;for(Ue of Pc()){var cr=xe+mt;It()[ne+zt>>>2>>>0]=cr,mt+=wn(Ue,cr,1/0)+1,zt+=4}return 0}function Rc(ne,xe){if(F)return gr(20,1,ne,xe);ne>>>=0,xe>>>=0;var Ue=Pc();for(var mt of(It()[ne>>>2>>>0]=Ue.length,ne=0,Ue))ne+=Fo(mt)+1;return It()[xe>>>2>>>0]=ne,0}function Oc(ne){return F?gr(21,1,ne):52}function Nc(ne,xe,Ue,mt){return F?gr(22,1,ne,xe,Ue,mt):52}function Dc(ne,xe,Ue,mt){return F?gr(23,1,ne,xe,Ue,mt):70}var v0=[null,[],[]];function Fc(ne,xe,Ue,mt){if(F)return gr(24,1,ne,xe,Ue,mt);xe>>>=0,Ue>>>=0,mt>>>=0;for(var zt=0,cr=0;cr<Ue;cr++){var ei=It()[xe>>>2>>>0],si=It()[xe+4>>>2>>>0];xe+=8;for(var ci=0;ci<si;ci++){var pi=ne,xi=_t()[ei+ci>>>0],ki=v0[pi];xi===0||xi===10?((pi===1?Et:bt)(ii(ki)),ki.length=0):ki.push(xi)}zt+=si}return It()[mt>>>2>>>0]=zt,0}F||(function(){for(var ne=w.numThreads-1;ne--;)Yt();lt.push(()=>{Ge++,(function(xe){F?xe():Promise.all(fi.map(gi)).then(xe)})(()=>Xe())})})();for(var Lc=Array(256),Nn=0;256>Nn;++Nn)Lc[Nn]=String.fromCharCode(Nn);qi=Lc,Gi.push(0,1,void 0,1,null,1,!0,1,!1,1),w.count_emval_handles=()=>Gi.length/2-5-xn.length,F||(re=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Nt()),w.wasmBinary&&(X=w.wasmBinary),w.stackSave=()=>Jo(),w.stackRestore=ne=>Un(ne),w.stackAlloc=ne=>Xo(ne),w.setValue=function(ne,xe,Ue="i8"){switch(Ue.endsWith("*")&&(Ue="*"),Ue){case"i1":case"i8":Ye()[ne>>>0]=xe;break;case"i16":Vt()[ne>>>1>>>0]=xe;break;case"i32":dt()[ne>>>2>>>0]=xe;break;case"i64":fe[ne>>>3]=BigInt(xe);break;case"float":dr()[ne>>>2>>>0]=xe;break;case"double":fr()[ne>>>3>>>0]=xe;break;case"*":It()[ne>>>2>>>0]=xe;break;default:gt(`invalid type for setValue: ${Ue}`)}},w.getValue=function(ne,xe="i8"){switch(xe.endsWith("*")&&(xe="*"),xe){case"i1":case"i8":return Ye()[ne>>>0];case"i16":return Vt()[ne>>>1>>>0];case"i32":return dt()[ne>>>2>>>0];case"i64":return fe[ne>>>3];case"float":return dr()[ne>>>2>>>0];case"double":return fr()[ne>>>3>>>0];case"*":return It()[ne>>>2>>>0];default:gt(`invalid type for getValue: ${xe}`)}},w.UTF8ToString=br,w.stringToUTF8=wn,w.lengthBytesUTF8=Fo;var x0=[oi,hi,ni,hr,yr,ti,vi,mi,yi,Si,Li,Ai,Mi,Ri,Oi,Hi,Tc,Ac,Cc,Bc,Rc,Oc,Nc,Dc,Fc],Vo={892060:(ne,xe,Ue,mt,zt)=>{if(w===void 0||!w.Fb)return 1;if((ne=br(Number(ne>>>0))).startsWith("./")&&(ne=ne.substring(2)),!(ne=w.Fb.get(ne)))return 2;if(xe=Number(xe>>>0),Ue=Number(Ue>>>0),mt=Number(mt>>>0),xe+Ue>ne.byteLength)return 3;try{let cr=ne.subarray(xe,xe+Ue);switch(zt){case 0:_t().set(cr,mt>>>0);break;case 1:w.mc?w.mc(mt,cr):w.cc(mt,cr);break;default:return 4}return 0}catch{return 4}},892884:(ne,xe,Ue)=>{w.Pb(ne,_t().subarray(xe>>>0,xe+Ue>>>0))},892948:()=>w.oc(),892990:ne=>{w.Ob(ne)},893027:()=>{w.Wb()},893058:()=>{w.Xb()},893087:()=>{w.ac()},893112:ne=>w.Vb(ne),893145:ne=>w.Zb(ne),893177:(ne,xe,Ue)=>{w.Lb(Number(ne),Number(xe),Number(Ue),!0)},893240:(ne,xe,Ue)=>{w.Lb(Number(ne),Number(xe),Number(Ue))},893297:()=>typeof wasmOffsetConverter<"u",893354:ne=>{w.Ab("Abs",ne,void 0)},893405:ne=>{w.Ab("Neg",ne,void 0)},893456:ne=>{w.Ab("Floor",ne,void 0)},893509:ne=>{w.Ab("Ceil",ne,void 0)},893561:ne=>{w.Ab("Reciprocal",ne,void 0)},893619:ne=>{w.Ab("Sqrt",ne,void 0)},893671:ne=>{w.Ab("Exp",ne,void 0)},893722:ne=>{w.Ab("Erf",ne,void 0)},893773:ne=>{w.Ab("Sigmoid",ne,void 0)},893828:(ne,xe,Ue)=>{w.Ab("HardSigmoid",ne,{alpha:xe,beta:Ue})},893907:ne=>{w.Ab("Log",ne,void 0)},893958:ne=>{w.Ab("Sin",ne,void 0)},894009:ne=>{w.Ab("Cos",ne,void 0)},894060:ne=>{w.Ab("Tan",ne,void 0)},894111:ne=>{w.Ab("Asin",ne,void 0)},894163:ne=>{w.Ab("Acos",ne,void 0)},894215:ne=>{w.Ab("Atan",ne,void 0)},894267:ne=>{w.Ab("Sinh",ne,void 0)},894319:ne=>{w.Ab("Cosh",ne,void 0)},894371:ne=>{w.Ab("Asinh",ne,void 0)},894424:ne=>{w.Ab("Acosh",ne,void 0)},894477:ne=>{w.Ab("Atanh",ne,void 0)},894530:ne=>{w.Ab("Tanh",ne,void 0)},894582:ne=>{w.Ab("Not",ne,void 0)},894633:(ne,xe,Ue)=>{w.Ab("Clip",ne,{min:xe,max:Ue})},894702:ne=>{w.Ab("Clip",ne,void 0)},894754:(ne,xe)=>{w.Ab("Elu",ne,{alpha:xe})},894812:ne=>{w.Ab("Gelu",ne,void 0)},894864:ne=>{w.Ab("Relu",ne,void 0)},894916:(ne,xe)=>{w.Ab("LeakyRelu",ne,{alpha:xe})},894980:(ne,xe)=>{w.Ab("ThresholdedRelu",ne,{alpha:xe})},895050:(ne,xe)=>{w.Ab("Cast",ne,{to:xe})},895108:ne=>{w.Ab("Add",ne,void 0)},895159:ne=>{w.Ab("Sub",ne,void 0)},895210:ne=>{w.Ab("Mul",ne,void 0)},895261:ne=>{w.Ab("Div",ne,void 0)},895312:ne=>{w.Ab("Pow",ne,void 0)},895363:ne=>{w.Ab("Equal",ne,void 0)},895416:ne=>{w.Ab("Greater",ne,void 0)},895471:ne=>{w.Ab("GreaterOrEqual",ne,void 0)},895533:ne=>{w.Ab("Less",ne,void 0)},895585:ne=>{w.Ab("LessOrEqual",ne,void 0)},895644:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceMean",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},895819:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceMax",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},895993:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceMin",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},896167:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceProd",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},896342:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceSum",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},896516:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceL1",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},896689:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceL2",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},896862:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceLogSum",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},897039:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceSumSquare",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},897219:(ne,xe,Ue,mt,zt)=>{w.Ab("ReduceLogSumExp",ne,{keepDims:!!xe,noopWithEmptyAxes:!!Ue,axes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},897399:ne=>{w.Ab("Where",ne,void 0)},897452:(ne,xe,Ue)=>{w.Ab("Transpose",ne,{perm:xe?Array.from(dt().subarray(Number(xe)>>>0,Number(Ue)>>>0)):[]})},897576:(ne,xe,Ue,mt)=>{w.Ab("DepthToSpace",ne,{blocksize:xe,mode:br(Ue),format:mt?"NHWC":"NCHW"})},897709:(ne,xe,Ue,mt)=>{w.Ab("DepthToSpace",ne,{blocksize:xe,mode:br(Ue),format:mt?"NHWC":"NCHW"})},897842:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni)=>{w.Ab("ConvTranspose",ne,{format:ci?"NHWC":"NCHW",autoPad:xe,dilations:[Ue],group:mt,kernelShape:[zt],pads:[cr,ei],strides:[si],wIsConst:()=>!!Ye()[pi>>>0],outputPadding:xi?Array.from(dt().subarray(Number(xi)>>>0,Number(ki)>>>0)):[],outputShape:Ii?Array.from(dt().subarray(Number(Ii)>>>0,Number(Ti)>>>0)):[],activation:br(Ni)})},898275:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>{w.Ab("ConvTranspose",ne,{format:si?"NHWC":"NCHW",autoPad:xe,dilations:Array.from(dt().subarray(Number(Ue)>>>0,2+(Number(Ue)>>>0)>>>0)),group:mt,kernelShape:Array.from(dt().subarray(Number(zt)>>>0,2+(Number(zt)>>>0)>>>0)),pads:Array.from(dt().subarray(Number(cr)>>>0,4+(Number(cr)>>>0)>>>0)),strides:Array.from(dt().subarray(Number(ei)>>>0,2+(Number(ei)>>>0)>>>0)),wIsConst:()=>!!Ye()[ci>>>0],outputPadding:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],outputShape:ki?Array.from(dt().subarray(Number(ki)>>>0,Number(Ii)>>>0)):[],activation:br(Ti)})},898936:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni)=>{w.Ab("ConvTranspose",ne,{format:ci?"NHWC":"NCHW",autoPad:xe,dilations:[Ue],group:mt,kernelShape:[zt],pads:[cr,ei],strides:[si],wIsConst:()=>!!Ye()[pi>>>0],outputPadding:xi?Array.from(dt().subarray(Number(xi)>>>0,Number(ki)>>>0)):[],outputShape:Ii?Array.from(dt().subarray(Number(Ii)>>>0,Number(Ti)>>>0)):[],activation:br(Ni)})},899369:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>{w.Ab("ConvTranspose",ne,{format:si?"NHWC":"NCHW",autoPad:xe,dilations:Array.from(dt().subarray(Number(Ue)>>>0,2+(Number(Ue)>>>0)>>>0)),group:mt,kernelShape:Array.from(dt().subarray(Number(zt)>>>0,2+(Number(zt)>>>0)>>>0)),pads:Array.from(dt().subarray(Number(cr)>>>0,4+(Number(cr)>>>0)>>>0)),strides:Array.from(dt().subarray(Number(ei)>>>0,2+(Number(ei)>>>0)>>>0)),wIsConst:()=>!!Ye()[ci>>>0],outputPadding:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],outputShape:ki?Array.from(dt().subarray(Number(ki)>>>0,Number(Ii)>>>0)):[],activation:br(Ti)})},900030:(ne,xe)=>{w.Ab("GlobalAveragePool",ne,{format:xe?"NHWC":"NCHW"})},900121:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>{w.Ab("AveragePool",ne,{format:Ti?"NHWC":"NCHW",auto_pad:xe,ceil_mode:Ue,count_include_pad:mt,storage_order:zt,dilations:cr?Array.from(dt().subarray(Number(cr)>>>0,Number(ei)>>>0)):[],kernel_shape:si?Array.from(dt().subarray(Number(si)>>>0,Number(ci)>>>0)):[],pads:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],strides:ki?Array.from(dt().subarray(Number(ki)>>>0,Number(Ii)>>>0)):[]})},900600:(ne,xe)=>{w.Ab("GlobalAveragePool",ne,{format:xe?"NHWC":"NCHW"})},900691:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>{w.Ab("AveragePool",ne,{format:Ti?"NHWC":"NCHW",auto_pad:xe,ceil_mode:Ue,count_include_pad:mt,storage_order:zt,dilations:cr?Array.from(dt().subarray(Number(cr)>>>0,Number(ei)>>>0)):[],kernel_shape:si?Array.from(dt().subarray(Number(si)>>>0,Number(ci)>>>0)):[],pads:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],strides:ki?Array.from(dt().subarray(Number(ki)>>>0,Number(Ii)>>>0)):[]})},901170:(ne,xe)=>{w.Ab("GlobalMaxPool",ne,{format:xe?"NHWC":"NCHW"})},901257:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>{w.Ab("MaxPool",ne,{format:Ti?"NHWC":"NCHW",auto_pad:xe,ceil_mode:Ue,count_include_pad:mt,storage_order:zt,dilations:cr?Array.from(dt().subarray(Number(cr)>>>0,Number(ei)>>>0)):[],kernel_shape:si?Array.from(dt().subarray(Number(si)>>>0,Number(ci)>>>0)):[],pads:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],strides:ki?Array.from(dt().subarray(Number(ki)>>>0,Number(Ii)>>>0)):[]})},901732:(ne,xe)=>{w.Ab("GlobalMaxPool",ne,{format:xe?"NHWC":"NCHW"})},901819:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>{w.Ab("MaxPool",ne,{format:Ti?"NHWC":"NCHW",auto_pad:xe,ceil_mode:Ue,count_include_pad:mt,storage_order:zt,dilations:cr?Array.from(dt().subarray(Number(cr)>>>0,Number(ei)>>>0)):[],kernel_shape:si?Array.from(dt().subarray(Number(si)>>>0,Number(ci)>>>0)):[],pads:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],strides:ki?Array.from(dt().subarray(Number(ki)>>>0,Number(Ii)>>>0)):[]})},902294:(ne,xe,Ue,mt,zt)=>{w.Ab("Gemm",ne,{alpha:xe,beta:Ue,transA:mt,transB:zt})},902398:ne=>{w.Ab("MatMul",ne,void 0)},902452:(ne,xe,Ue,mt)=>{w.Ab("ArgMax",ne,{keepDims:!!xe,selectLastIndex:!!Ue,axis:mt})},902560:(ne,xe,Ue,mt)=>{w.Ab("ArgMin",ne,{keepDims:!!xe,selectLastIndex:!!Ue,axis:mt})},902668:(ne,xe)=>{w.Ab("Softmax",ne,{axis:xe})},902731:(ne,xe)=>{w.Ab("Concat",ne,{axis:xe})},902791:(ne,xe,Ue,mt,zt)=>{w.Ab("Split",ne,{axis:xe,numOutputs:Ue,splitSizes:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},902947:ne=>{w.Ab("Expand",ne,void 0)},903001:(ne,xe)=>{w.Ab("Gather",ne,{axis:Number(xe)})},903072:(ne,xe)=>{w.Ab("GatherElements",ne,{axis:Number(xe)})},903151:(ne,xe)=>{w.Ab("GatherND",ne,{batch_dims:Number(xe)})},903230:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi)=>{w.Ab("Resize",ne,{antialias:xe,axes:Ue?Array.from(dt().subarray(Number(Ue)>>>0,Number(mt)>>>0)):[],coordinateTransformMode:br(zt),cubicCoeffA:cr,excludeOutside:ei,extrapolationValue:si,keepAspectRatioPolicy:br(ci),mode:br(pi),nearestMode:br(xi)})},903592:(ne,xe,Ue,mt,zt,cr,ei)=>{w.Ab("Slice",ne,{starts:xe?Array.from(dt().subarray(Number(xe)>>>0,Number(Ue)>>>0)):[],ends:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[],axes:cr?Array.from(dt().subarray(Number(cr)>>>0,Number(ei)>>>0)):[]})},903856:ne=>{w.Ab("Tile",ne,void 0)},903908:(ne,xe,Ue)=>{w.Ab("InstanceNormalization",ne,{epsilon:xe,format:Ue?"NHWC":"NCHW"})},904022:(ne,xe,Ue)=>{w.Ab("InstanceNormalization",ne,{epsilon:xe,format:Ue?"NHWC":"NCHW"})},904136:ne=>{w.Ab("Range",ne,void 0)},904189:(ne,xe)=>{w.Ab("Einsum",ne,{equation:br(xe)})},904270:(ne,xe,Ue,mt,zt)=>{w.Ab("Pad",ne,{mode:xe,value:Ue,pads:mt?Array.from(dt().subarray(Number(mt)>>>0,Number(zt)>>>0)):[]})},904413:(ne,xe,Ue,mt,zt,cr)=>{w.Ab("BatchNormalization",ne,{epsilon:xe,momentum:Ue,spatial:!!zt,trainingMode:!!mt,format:cr?"NHWC":"NCHW"})},904582:(ne,xe,Ue,mt,zt,cr)=>{w.Ab("BatchNormalization",ne,{epsilon:xe,momentum:Ue,spatial:!!zt,trainingMode:!!mt,format:cr?"NHWC":"NCHW"})},904751:(ne,xe,Ue)=>{w.Ab("CumSum",ne,{exclusive:Number(xe),reverse:Number(Ue)})},904848:(ne,xe,Ue)=>{w.Ab("DequantizeLinear",ne,{axis:xe,blockSize:Ue})},904938:(ne,xe,Ue,mt,zt)=>{w.Ab("GridSample",ne,{align_corners:xe,mode:br(Ue),padding_mode:br(mt),format:zt?"NHWC":"NCHW"})},905108:(ne,xe,Ue,mt,zt)=>{w.Ab("GridSample",ne,{align_corners:xe,mode:br(Ue),padding_mode:br(mt),format:zt?"NHWC":"NCHW"})},905278:(ne,xe)=>{w.Ab("ScatterND",ne,{reduction:br(xe)})},905363:(ne,xe,Ue,mt,zt,cr,ei,si,ci)=>{w.Ab("Attention",ne,{numHeads:xe,isUnidirectional:Ue,maskFilterValue:mt,scale:zt,doRotary:cr,qkvHiddenSizes:ei?Array.from(dt().subarray(Number(si)>>>0,Number(si)+ei>>>0)):[],pastPresentShareBuffer:!!ci})},905635:ne=>{w.Ab("BiasAdd",ne,void 0)},905690:ne=>{w.Ab("BiasSplitGelu",ne,void 0)},905751:ne=>{w.Ab("FastGelu",ne,void 0)},905807:(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji)=>{w.Ab("Conv",ne,{format:ki?"NHWC":"NCHW",auto_pad:xe,dilations:Ue?Array.from(dt().subarray(Number(Ue)>>>0,Number(mt)>>>0)):[],group:zt,kernel_shape:cr?Array.from(dt().subarray(Number(cr)>>>0,Number(ei)>>>0)):[],pads:si?Array.from(dt().subarray(Number(si)>>>0,Number(ci)>>>0)):[],strides:pi?Array.from(dt().subarray(Number(pi)>>>0,Number(xi)>>>0)):[],w_is_const:()=>!!Ye()[Number(Ii)>>>0],activation:br(Ti),activation_params:Ni?Array.from(dr().subarray(Number(Ni)>>>0,Number(ji)>>>0)):[]})},906391:ne=>{w.Ab("Gelu",ne,void 0)},906443:(ne,xe,Ue,mt,zt,cr,ei,si,ci)=>{w.Ab("GroupQueryAttention",ne,{numHeads:xe,kvNumHeads:Ue,scale:mt,softcap:zt,doRotary:cr,rotaryInterleaved:ei,smoothSoftmax:si,localWindowSize:ci})},906660:(ne,xe,Ue,mt)=>{w.Ab("LayerNormalization",ne,{axis:xe,epsilon:Ue,simplified:!!mt})},906771:(ne,xe,Ue,mt)=>{w.Ab("LayerNormalization",ne,{axis:xe,epsilon:Ue,simplified:!!mt})},906882:(ne,xe,Ue,mt,zt,cr)=>{w.Ab("MatMulNBits",ne,{k:xe,n:Ue,accuracyLevel:mt,bits:zt,blockSize:cr})},907009:(ne,xe,Ue,mt,zt,cr)=>{w.Ab("MultiHeadAttention",ne,{numHeads:xe,isUnidirectional:Ue,maskFilterValue:mt,scale:zt,doRotary:cr})},907168:(ne,xe)=>{w.Ab("QuickGelu",ne,{alpha:xe})},907232:(ne,xe,Ue,mt,zt)=>{w.Ab("RotaryEmbedding",ne,{interleaved:!!xe,numHeads:Ue,rotaryEmbeddingDim:mt,scale:zt})},907371:(ne,xe,Ue)=>{w.Ab("SkipLayerNormalization",ne,{epsilon:xe,simplified:!!Ue})},907473:(ne,xe,Ue)=>{w.Ab("SkipLayerNormalization",ne,{epsilon:xe,simplified:!!Ue})},907575:(ne,xe,Ue,mt)=>{w.Ab("GatherBlockQuantized",ne,{gatherAxis:xe,quantizeAxis:Ue,blockSize:mt})},907696:ne=>{w.$b(ne)},907730:(ne,xe)=>w.bc(Number(ne),Number(xe),w.Gb.ec,w.Gb.errors)};function $0(ne,xe,Ue){return $c(async()=>{await w.Yb(Number(ne),Number(xe),Number(Ue))})}function E0(){return typeof wasmOffsetConverter<"u"}var li=await(async function(){function ne(mt,zt){return li=mt.exports,li=(function(){var cr=li,ei={};for(let[si,ci]of Object.entries(cr))ei[si]=typeof ci=="function"?(...pi)=>{Pn.push(si);try{return ci(...pi)}finally{ht||(Pn.pop(),Vi&&yn===1&&Pn.length===0&&(yn=0,mr+=1,zn(Yc),typeof Fibers<"u"&&Fibers.sc()))}}:ci;return ei})(),li=(function(){var cr=li,ei=ci=>pi=>ci(pi)>>>0,si=ci=>()=>ci()>>>0;return(cr=Object.assign({},cr)).Ea=ei(cr.Ea),cr.gb=si(cr.gb),cr.ib=ei(cr.ib),cr.tb=ei(cr.tb),cr.ub=si(cr.ub),cr.__cxa_get_exception_ptr=ei(cr.__cxa_get_exception_ptr),cr})(),wi.push(li.jb),J=zt,Xe(),li}Ge++;var xe=Qt();if(w.instantiateWasm)return new Promise(mt=>{w.instantiateWasm(xe,(zt,cr)=>{mt(ne(zt,cr))})});if(F)return new Promise(mt=>{ze=zt=>{var cr=new WebAssembly.Instance(zt,Qt());mt(ne(cr,zt))}});At??=w.locateFile?w.locateFile?w.locateFile("ort-wasm-simd-threaded.jsep.wasm",Q):Q+"ort-wasm-simd-threaded.jsep.wasm":new URL("/assets/ort-wasm-simd-threaded.jsep-CLmJQkb_.wasm",import.meta.url).href;try{var Ue=await(async function(mt){var zt=At;if(!X&&typeof WebAssembly.instantiateStreaming=="function"&&!Zt(zt))try{var cr=fetch(zt,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(cr,mt)}catch(ei){bt(`wasm streaming compile failed: ${ei}`),bt("falling back to ArrayBuffer instantiation")}return(async function(ei,si){try{var ci=await(async function(pi){if(!X)try{var xi=await Z(pi);return new Uint8Array(xi)}catch{}if(pi==At&&X)pi=new Uint8Array(X);else{if(!H)throw"both async and sync fetching of the wasm failed";pi=H(pi)}return pi})(ei);return await WebAssembly.instantiate(ci,si)}catch(pi){bt(`failed to asynchronously prepare wasm: ${pi}`),gt(pi)}})(zt,mt)})(xe);return ne(Ue.instance,Ue.module)}catch(mt){return g(mt),Promise.reject(mt)}})(),Uc=ne=>(Uc=li.Ea)(ne),jc=()=>(jc=li.Fa)();w._OrtInit=(ne,xe)=>(w._OrtInit=li.Ga)(ne,xe),w._OrtGetLastError=(ne,xe)=>(w._OrtGetLastError=li.Ha)(ne,xe),w._OrtCreateSessionOptions=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi)=>(w._OrtCreateSessionOptions=li.Ia)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi),w._OrtAppendExecutionProvider=(ne,xe,Ue,mt,zt)=>(w._OrtAppendExecutionProvider=li.Ja)(ne,xe,Ue,mt,zt),w._OrtAddFreeDimensionOverride=(ne,xe,Ue)=>(w._OrtAddFreeDimensionOverride=li.Ka)(ne,xe,Ue),w._OrtAddSessionConfigEntry=(ne,xe,Ue)=>(w._OrtAddSessionConfigEntry=li.La)(ne,xe,Ue),w._OrtReleaseSessionOptions=ne=>(w._OrtReleaseSessionOptions=li.Ma)(ne),w._OrtCreateSession=(ne,xe,Ue)=>(w._OrtCreateSession=li.Na)(ne,xe,Ue),w._OrtReleaseSession=ne=>(w._OrtReleaseSession=li.Oa)(ne),w._OrtGetInputOutputCount=(ne,xe,Ue)=>(w._OrtGetInputOutputCount=li.Pa)(ne,xe,Ue),w._OrtGetInputOutputMetadata=(ne,xe,Ue,mt)=>(w._OrtGetInputOutputMetadata=li.Qa)(ne,xe,Ue,mt),w._OrtFree=ne=>(w._OrtFree=li.Ra)(ne),w._OrtCreateTensor=(ne,xe,Ue,mt,zt,cr)=>(w._OrtCreateTensor=li.Sa)(ne,xe,Ue,mt,zt,cr),w._OrtGetTensorData=(ne,xe,Ue,mt,zt)=>(w._OrtGetTensorData=li.Ta)(ne,xe,Ue,mt,zt),w._OrtReleaseTensor=ne=>(w._OrtReleaseTensor=li.Ua)(ne),w._OrtCreateRunOptions=(ne,xe,Ue,mt)=>(w._OrtCreateRunOptions=li.Va)(ne,xe,Ue,mt),w._OrtAddRunConfigEntry=(ne,xe,Ue)=>(w._OrtAddRunConfigEntry=li.Wa)(ne,xe,Ue),w._OrtReleaseRunOptions=ne=>(w._OrtReleaseRunOptions=li.Xa)(ne),w._OrtCreateBinding=ne=>(w._OrtCreateBinding=li.Ya)(ne),w._OrtBindInput=(ne,xe,Ue)=>(w._OrtBindInput=li.Za)(ne,xe,Ue),w._OrtBindOutput=(ne,xe,Ue,mt)=>(w._OrtBindOutput=li._a)(ne,xe,Ue,mt),w._OrtClearBoundOutputs=ne=>(w._OrtClearBoundOutputs=li.$a)(ne),w._OrtReleaseBinding=ne=>(w._OrtReleaseBinding=li.ab)(ne),w._OrtRunWithBinding=(ne,xe,Ue,mt,zt)=>(w._OrtRunWithBinding=li.bb)(ne,xe,Ue,mt,zt),w._OrtRun=(ne,xe,Ue,mt,zt,cr,ei,si)=>(w._OrtRun=li.cb)(ne,xe,Ue,mt,zt,cr,ei,si),w._OrtEndProfiling=ne=>(w._OrtEndProfiling=li.db)(ne),w._JsepOutput=(ne,xe,Ue)=>(w._JsepOutput=li.eb)(ne,xe,Ue),w._JsepGetNodeName=ne=>(w._JsepGetNodeName=li.fb)(ne);var Qo=()=>(Qo=li.gb)(),_n=w._free=ne=>(_n=w._free=li.hb)(ne),Dn=w._malloc=ne=>(Dn=w._malloc=li.ib)(ne),Ko=(ne,xe,Ue,mt,zt,cr)=>(Ko=li.kb)(ne,xe,Ue,mt,zt,cr),Gc=()=>(Gc=li.lb)(),Wc=(ne,xe,Ue,mt,zt)=>(Wc=li.mb)(ne,xe,Ue,mt,zt),Zc=ne=>(Zc=li.nb)(ne),Yo=ne=>(Yo=li.ob)(ne),Hc=(ne,xe)=>(Hc=li.pb)(ne,xe),qc=()=>(qc=li.qb)(),Vc=(ne,xe)=>(Vc=li.rb)(ne,xe),Un=ne=>(Un=li.sb)(ne),Xo=ne=>(Xo=li.tb)(ne),Jo=()=>(Jo=li.ub)(),Qc=w.dynCall_ii=(ne,xe)=>(Qc=w.dynCall_ii=li.vb)(ne,xe);w.dynCall_vii=(ne,xe,Ue)=>(w.dynCall_vii=li.dynCall_vii)(ne,xe,Ue),w.dynCall_iiiii=(ne,xe,Ue,mt,zt)=>(w.dynCall_iiiii=li.dynCall_iiiii)(ne,xe,Ue,mt,zt),w.dynCall_iii=(ne,xe,Ue)=>(w.dynCall_iii=li.dynCall_iii)(ne,xe,Ue),w.dynCall_iiiiii=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_iiiiii=li.dynCall_iiiiii)(ne,xe,Ue,mt,zt,cr),w.dynCall_iiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si)=>(w.dynCall_iiiiiiii=li.dynCall_iiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si),w.dynCall_iiiiiii=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_iiiiiii=li.dynCall_iiiiiii)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_vi=(ne,xe)=>(w.dynCall_vi=li.dynCall_vi)(ne,xe),w.dynCall_iiii=(ne,xe,Ue,mt)=>(w.dynCall_iiii=li.dynCall_iiii)(ne,xe,Ue,mt),w.dynCall_i=ne=>(w.dynCall_i=li.dynCall_i)(ne),w.dynCall_viiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci)=>(w.dynCall_viiiiiiii=li.dynCall_viiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci),w.dynCall_viii=(ne,xe,Ue,mt)=>(w.dynCall_viii=li.dynCall_viii)(ne,xe,Ue,mt),w.dynCall_viijj=(ne,xe,Ue,mt,zt)=>(w.dynCall_viijj=li.dynCall_viijj)(ne,xe,Ue,mt,zt),w.dynCall_viiiiii=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_viiiiii=li.dynCall_viiiiii)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_viiii=(ne,xe,Ue,mt,zt)=>(w.dynCall_viiii=li.dynCall_viiii)(ne,xe,Ue,mt,zt),w.dynCall_viiiii=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_viiiii=li.dynCall_viiiii)(ne,xe,Ue,mt,zt,cr),w.dynCall_vfiii=(ne,xe,Ue,mt,zt)=>(w.dynCall_vfiii=li.dynCall_vfiii)(ne,xe,Ue,mt,zt),w.dynCall_viiiiff=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_viiiiff=li.dynCall_viiiiff)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_viiiiiff=(ne,xe,Ue,mt,zt,cr,ei,si)=>(w.dynCall_viiiiiff=li.dynCall_viiiiiff)(ne,xe,Ue,mt,zt,cr,ei,si),w.dynCall_ffff=(ne,xe,Ue,mt)=>(w.dynCall_ffff=li.dynCall_ffff)(ne,xe,Ue,mt),w.dynCall_viiff=(ne,xe,Ue,mt,zt)=>(w.dynCall_viiff=li.dynCall_viiff)(ne,xe,Ue,mt,zt),w.dynCall_fffffff=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_fffffff=li.dynCall_fffffff)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_jjjjjjj=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_jjjjjjj=li.dynCall_jjjjjjj)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_jjjjjj=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_jjjjjj=li.dynCall_jjjjjj)(ne,xe,Ue,mt,zt,cr),w.dynCall_iijjii=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_iijjii=li.dynCall_iijjii)(ne,xe,Ue,mt,zt,cr),w.dynCall_viiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti)=>(w.dynCall_viiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti),w.dynCall_viiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi)=>(w.dynCall_viiiiiiiiii=li.dynCall_viiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi),w.dynCall_viiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki)=>(w.dynCall_viiiiiiiiiii=li.dynCall_viiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki),w.dynCall_viiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii)=>(w.dynCall_viiiiiiiiiiii=li.dynCall_viiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii),w.dynCall_viiiiiiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn,Sn)=>(w.dynCall_viiiiiiiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn,Sn),w.dynCall_viiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi)=>(w.dynCall_viiiiiiiii=li.dynCall_viiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi),w.dynCall_viiiiiiiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn,Sn,xu)=>(w.dynCall_viiiiiiiiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn,Sn,xu),w.dynCall_viiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si)=>(w.dynCall_viiiiiii=li.dynCall_viiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si),w.dynCall_viiiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji)=>(w.dynCall_viiiiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji),w.dynCall_jiji=(ne,xe,Ue,mt)=>(w.dynCall_jiji=li.dynCall_jiji)(ne,xe,Ue,mt),w.dynCall_v=ne=>(w.dynCall_v=li.dynCall_v)(ne),w.dynCall_iidiiii=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_iidiiii=li.dynCall_iidiiii)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_iiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci)=>(w.dynCall_iiiiiiiii=li.dynCall_iiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci),w.dynCall_iiij=(ne,xe,Ue,mt)=>(w.dynCall_iiij=li.dynCall_iiij)(ne,xe,Ue,mt),w.dynCall_iiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi)=>(w.dynCall_iiiiiiiiii=li.dynCall_iiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi),w.dynCall_iiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii)=>(w.dynCall_iiiiiiiiiiiii=li.dynCall_iiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii),w.dynCall_iiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi)=>(w.dynCall_iiiiiiiiiii=li.dynCall_iiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi),w.dynCall_ji=(ne,xe)=>(w.dynCall_ji=li.dynCall_ji)(ne,xe),w.dynCall_iijii=(ne,xe,Ue,mt,zt)=>(w.dynCall_iijii=li.dynCall_iijii)(ne,xe,Ue,mt,zt),w.dynCall_vij=(ne,xe,Ue)=>(w.dynCall_vij=li.dynCall_vij)(ne,xe,Ue),w.dynCall_viiijii=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_viiijii=li.dynCall_viiijii)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_viijiiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn)=>(w.dynCall_viijiiiiiiiiiiiiii=li.dynCall_viijiiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn),w.dynCall_viiiji=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_viiiji=li.dynCall_viiiji)(ne,xe,Ue,mt,zt,cr),w.dynCall_fiii=(ne,xe,Ue,mt)=>(w.dynCall_fiii=li.dynCall_fiii)(ne,xe,Ue,mt),w.dynCall_viijii=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_viijii=li.dynCall_viijii)(ne,xe,Ue,mt,zt,cr),w.dynCall_viij=(ne,xe,Ue,mt)=>(w.dynCall_viij=li.dynCall_viij)(ne,xe,Ue,mt),w.dynCall_jiij=(ne,xe,Ue,mt)=>(w.dynCall_jiij=li.dynCall_jiij)(ne,xe,Ue,mt),w.dynCall_fi=(ne,xe)=>(w.dynCall_fi=li.dynCall_fi)(ne,xe),w.dynCall_fii=(ne,xe,Ue)=>(w.dynCall_fii=li.dynCall_fii)(ne,xe,Ue),w.dynCall_jii=(ne,xe,Ue)=>(w.dynCall_jii=li.dynCall_jii)(ne,xe,Ue),w.dynCall_dii=(ne,xe,Ue)=>(w.dynCall_dii=li.dynCall_dii)(ne,xe,Ue),w.dynCall_fiiii=(ne,xe,Ue,mt,zt)=>(w.dynCall_fiiii=li.dynCall_fiiii)(ne,xe,Ue,mt,zt),w.dynCall_fif=(ne,xe,Ue)=>(w.dynCall_fif=li.dynCall_fif)(ne,xe,Ue),w.dynCall_jfi=(ne,xe,Ue)=>(w.dynCall_jfi=li.dynCall_jfi)(ne,xe,Ue),w.dynCall_viiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni)=>(w.dynCall_viiiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni),w.dynCall_viiiiiiiiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn,Sn,xu,k0)=>(w.dynCall_viiiiiiiiiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn,vn,Sn,xu,k0),w.dynCall_viiiiiiiiiiiiiiii=(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn)=>(w.dynCall_viiiiiiiiiiiiiiii=li.dynCall_viiiiiiiiiiiiiiii)(ne,xe,Ue,mt,zt,cr,ei,si,ci,pi,xi,ki,Ii,Ti,Ni,ji,bn),w.dynCall_iif=(ne,xe,Ue)=>(w.dynCall_iif=li.dynCall_iif)(ne,xe,Ue),w.dynCall_jiiii=(ne,xe,Ue,mt,zt)=>(w.dynCall_jiiii=li.dynCall_jiiii)(ne,xe,Ue,mt,zt),w.dynCall_jiii=(ne,xe,Ue,mt)=>(w.dynCall_jiii=li.dynCall_jiii)(ne,xe,Ue,mt),w.dynCall_viif=(ne,xe,Ue,mt)=>(w.dynCall_viif=li.dynCall_viif)(ne,xe,Ue,mt),w.dynCall_viiij=(ne,xe,Ue,mt,zt)=>(w.dynCall_viiij=li.dynCall_viiij)(ne,xe,Ue,mt,zt),w.dynCall_viiiijii=(ne,xe,Ue,mt,zt,cr,ei,si)=>(w.dynCall_viiiijii=li.dynCall_viiiijii)(ne,xe,Ue,mt,zt,cr,ei,si),w.dynCall_iiiiij=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_iiiiij=li.dynCall_iiiiij)(ne,xe,Ue,mt,zt,cr),w.dynCall_iiiiid=(ne,xe,Ue,mt,zt,cr)=>(w.dynCall_iiiiid=li.dynCall_iiiiid)(ne,xe,Ue,mt,zt,cr),w.dynCall_iiiiijj=(ne,xe,Ue,mt,zt,cr,ei)=>(w.dynCall_iiiiijj=li.dynCall_iiiiijj)(ne,xe,Ue,mt,zt,cr,ei),w.dynCall_iiiiiijj=(ne,xe,Ue,mt,zt,cr,ei,si)=>(w.dynCall_iiiiiijj=li.dynCall_iiiiiijj)(ne,xe,Ue,mt,zt,cr,ei,si);var Kc=ne=>(Kc=li.wb)(ne),Yc=()=>(Yc=li.xb)(),Xc=ne=>(Xc=li.yb)(ne),Jc=()=>(Jc=li.zb)();return(function ne(){if(0<Ge)st=ne;else if(F)m(w),$e();else{for(;0<lt.length;)lt.shift()(w);0<Ge?st=ne:(w.calledRun=!0,ht||($e(),m(w)))}})(),w.PTR_SIZE=4,$},Qp=Ea,Yp=globalThis.self?.name?.startsWith("em-pthread"),Yp&&Ea()}),Da,Yn,Xp,Le,Ba,Qn,Jp,em,Ma,tm,Oa,Ra,za,Ua,Tr=L$1(()=>{Sr(),Da=typeof location>"u"?void 0:location.origin,Yn=import.meta.url>"file:"&&import.meta.url<"file;",Xp=()=>{{if(Yn){let d=URL;return new URL(new d("ort.bundle.min.mjs",import.meta.url).href,Da).href}return import.meta.url}},Le=Xp(),Ba=()=>{if(Le&&!Le.startsWith("blob:"))return Le.substring(0,Le.lastIndexOf("/")+1)},Qn=(d,m)=>{try{let g=m??Le;return(g?new URL(d,g):new URL(d)).origin===Da}catch{return!1}},Jp=(d,m)=>{let g=m??Le;try{return(g?new URL(d,g):new URL(d)).href}catch{return}},em=(d,m)=>`${m??"./"}${d}`,Ma=async d=>{let m=await(await fetch(d,{credentials:"same-origin"})).blob();return URL.createObjectURL(m)},tm=async d=>(await import(d)).default,Oa=(Aa(),Xt(Ia)).default,Ra=async()=>{if(!Le)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Qn(Le))return[void 0,Oa()];let d=await Ma(Le);return[d,Oa(d)]},za=(Pa(),Xt(ka)).default,Ua=async(d,m,g,w)=>{let $=za&&!(d||m);if($)if(Le)$=Qn(Le);else if(w&&!g)$=!0;else throw new Error("cannot determine the script source URL.");if($)return[void 0,za];{let I="ort-wasm-simd-threaded.jsep.mjs",D=d??Jp(I,m),F=g&&D&&!Qn(D,m),U=F?await Ma(D):D??em(I,m);return[F?U:void 0,await tm(U)]}}}),Xn,Jn,Dr,Na,rm,nm,om,Cr,_e,$t=L$1(()=>{Tr(),Jn=!1,Dr=!1,Na=!1,rm=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},nm=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},om=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Cr=async d=>{if(Jn)return Promise.resolve();if(Dr)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Na)throw new Error("previous call to 'initializeWebAssembly()' failed.");Dr=!0;let m=d.initTimeout,g=d.numThreads;if(d.simd!==!1){if(d.simd==="relaxed"){if(!om())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!nm())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let w=rm();g>1&&!w&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+g+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),d.numThreads=g=1);let $=d.wasmPaths,I=typeof $=="string"?$:void 0,D=$?.mjs,F=D?.href??D,U=$?.wasm,j=U?.href??U,G=d.wasmBinary,[Z,H]=await Ua(F,I,g>1,!!G||!!j),q=!1,V=[];if(m>0&&V.push(new Promise(Q=>{setTimeout(()=>{q=!0,Q()},m)})),V.push(new Promise((Q,X)=>{let re={numThreads:g};if(G)re.wasmBinary=G;else if(j||I)re.locateFile=J=>j??I+J;else if(F&&F.indexOf("blob:")!==0)re.locateFile=J=>new URL(J,F).href;else if(Z){let J=Ba();J&&(re.locateFile=se=>J+se)}H(re).then(J=>{Dr=!1,Jn=!0,Xn=J,Q(),Z&&URL.revokeObjectURL(Z)},J=>{Dr=!1,Na=!0,X(J)})})),await Promise.race(V),q)throw new Error(`WebAssembly backend initializing failed due to timeout: ${m}ms`)},_e=()=>{if(Jn&&Xn)return Xn;throw new Error("WebAssembly is not initialized yet.")}}),We,tr,ye,Br=L$1(()=>{$t(),We=(d,m)=>{let g=_e(),w=g.lengthBytesUTF8(d)+1,$=g._malloc(w);return g.stringToUTF8(d,$,w),m.push($),$},tr=(d,m,g,w)=>{if(typeof d=="object"&&d!==null){if(g.has(d))throw new Error("Circular reference in options");g.add(d)}Object.entries(d).forEach(([$,I])=>{let D=m?m+$:$;if(typeof I=="object")tr(I,D+".",g,w);else if(typeof I=="string"||typeof I=="number")w(D,I.toString());else if(typeof I=="boolean")w(D,I?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof I}`)})},ye=d=>{let m=_e(),g=m.stackSave();try{let w=m.PTR_SIZE,$=m.stackAlloc(2*w);m._OrtGetLastError($,$+w);let I=Number(m.getValue($,w===4?"i32":"i64")),D=m.getValue($+w,"*"),F=D?m.UTF8ToString(D):"";throw new Error(`${d} ERROR_CODE: ${I}, ERROR_MESSAGE: ${F}`)}finally{m.stackRestore(g)}}}),Va,La=L$1(()=>{$t(),Br(),Va=d=>{let m=_e(),g=0,w=[],$=d||{};try{if(d?.logSeverityLevel===void 0)$.logSeverityLevel=2;else if(typeof d.logSeverityLevel!="number"||!Number.isInteger(d.logSeverityLevel)||d.logSeverityLevel<0||d.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${d.logSeverityLevel}`);if(d?.logVerbosityLevel===void 0)$.logVerbosityLevel=0;else if(typeof d.logVerbosityLevel!="number"||!Number.isInteger(d.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${d.logVerbosityLevel}`);d?.terminate===void 0&&($.terminate=!1);let I=0;return d?.tag!==void 0&&(I=We(d.tag,w)),g=m._OrtCreateRunOptions($.logSeverityLevel,$.logVerbosityLevel,!!$.terminate,I),g===0&&ye("Can't create run options."),d?.extra!==void 0&&tr(d.extra,"",new WeakSet,(D,F)=>{let U=We(D,w),j=We(F,w);m._OrtAddRunConfigEntry(g,U,j)!==0&&ye(`Can't set a run config entry: ${D} - ${F}.`)}),[g,w]}catch(I){throw g!==0&&m._OrtReleaseRunOptions(g),w.forEach(D=>m._free(D)),I}}}),im,am,sm,Mr,um,Wa,Ga=L$1(()=>{$t(),Br(),im=d=>{switch(d){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${d}`)}},am=d=>{switch(d){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${d}`)}},sm=d=>{d.extra||(d.extra={}),d.extra.session||(d.extra.session={});let m=d.extra.session;m.use_ort_model_bytes_directly||(m.use_ort_model_bytes_directly="1"),d.executionProviders&&d.executionProviders.some(g=>(typeof g=="string"?g:g.name)==="webgpu")&&(d.enableMemPattern=!1)},Mr=(d,m,g,w)=>{let $=We(m,w),I=We(g,w);_e()._OrtAddSessionConfigEntry(d,$,I)!==0&&ye(`Can't set a session config entry: ${m} - ${g}.`)},um=async(d,m,g)=>{for(let w of m){let $=typeof w=="string"?w:w.name,I=[];switch($){case"webnn":if($="WEBNN",typeof w!="string"){let G=w?.deviceType;G&&Mr(d,"deviceType",G,g)}break;case"webgpu":if($="JS",typeof w!="string"){let G=w;if(G?.preferredLayout){if(G.preferredLayout!=="NCHW"&&G.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${G.preferredLayout}`);Mr(d,"preferredLayout",G.preferredLayout,g)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${$}`)}let D=We($,g),F=I.length,U=0,j=0;if(F>0){U=_e()._malloc(F*_e().PTR_SIZE),g.push(U),j=_e()._malloc(F*_e().PTR_SIZE),g.push(j);for(let G=0;G<F;G++)_e().setValue(U+G*_e().PTR_SIZE,I[G][0],"*"),_e().setValue(j+G*_e().PTR_SIZE,I[G][1],"*")}await _e()._OrtAppendExecutionProvider(d,D,U,j,F)!==0&&ye(`Can't append execution provider: ${$}.`)}},Wa=async d=>{let m=_e(),g=0,w=[],$=d||{};sm($);try{let I=im($.graphOptimizationLevel??"all"),D=am($.executionMode??"sequential"),F=typeof $.logId=="string"?We($.logId,w):0,U=$.logSeverityLevel??2;if(!Number.isInteger(U)||U<0||U>4)throw new Error(`log severity level is not valid: ${U}`);let j=$.logVerbosityLevel??0;if(!Number.isInteger(j)||j<0||j>4)throw new Error(`log verbosity level is not valid: ${j}`);let G=typeof $.optimizedModelFilePath=="string"?We($.optimizedModelFilePath,w):0;if(g=m._OrtCreateSessionOptions(I,!!$.enableCpuMemArena,!!$.enableMemPattern,D,!!$.enableProfiling,0,F,U,j,G),g===0&&ye("Can't create session options."),$.executionProviders&&await um(g,$.executionProviders,w),$.enableGraphCapture!==void 0){if(typeof $.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${$.enableGraphCapture}`);Mr(g,"enableGraphCapture",$.enableGraphCapture.toString(),w)}if($.freeDimensionOverrides)for(let[Z,H]of Object.entries($.freeDimensionOverrides)){if(typeof Z!="string")throw new Error(`free dimension override name must be a string: ${Z}`);if(typeof H!="number"||!Number.isInteger(H)||H<0)throw new Error(`free dimension override value must be a non-negative integer: ${H}`);let q=We(Z,w);m._OrtAddFreeDimensionOverride(g,q,H)!==0&&ye(`Can't set a free dimension override: ${Z} - ${H}.`)}return $.extra!==void 0&&tr($.extra,"",new WeakSet,(Z,H)=>{Mr(g,Z,H,w)}),[g,w]}catch(I){throw g!==0&&m._OrtReleaseSessionOptions(g)!==0&&ye("Can't release session options."),w.forEach(D=>m._free(D)),I}}}),xt,Je,St,Gt,rr,Rr,Ur,eo,ee=L$1(()=>{xt=d=>{switch(d){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${d}`)}},Je=d=>{switch(d){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${d}`)}},St=(d,m)=>{let g=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][d],w=typeof m=="number"?m:m.reduce(($,I)=>$*I,1);return g>0?Math.ceil(w*g):void 0},Gt=d=>{switch(d){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${d}`)}},rr=d=>{switch(d){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${d}`)}},Rr=d=>d==="float32"||d==="float16"||d==="int32"||d==="int64"||d==="uint32"||d==="uint8"||d==="bool"||d==="uint4"||d==="int4",Ur=d=>d==="float32"||d==="float16"||d==="int32"||d==="int64"||d==="uint32"||d==="uint64"||d==="int8"||d==="uint8"||d==="bool"||d==="uint4"||d==="int4",eo=d=>{switch(d){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${d}`)}}}),nr,to$1=L$1(()=>{Sr(),nr=async d=>{if(typeof d=="string"){let m=await fetch(d);if(!m.ok)throw new Error(`failed to load external data file: ${d}`);let g=m.headers.get("Content-Length"),w=g?parseInt(g,10):0;if(w<1073741824)return new Uint8Array(await m.arrayBuffer());{if(!m.body)throw new Error(`failed to load external data file: ${d}, no response body.`);let $=m.body.getReader(),I;try{I=new ArrayBuffer(w)}catch(F){if(F instanceof RangeError){let U=Math.ceil(w/65536);I=new WebAssembly.Memory({initial:U,maximum:U}).buffer}else throw F}let D=0;for(;;){let{done:F,value:U}=await $.read();if(F)break;let j=U.byteLength;new Uint8Array(I,D,j).set(U),D+=j}return new Uint8Array(I,0,w)}}else return d instanceof Blob?new Uint8Array(await d.arrayBuffer()):d instanceof Uint8Array?d:new Uint8Array(d)}}),lm,dm,Ha,Fa,Nr,cm,le,et=L$1(()=>{ee(),lm=["V","I","W","E","F"],dm=(d,m)=>{console.log(`[${lm[d]},${new Date().toISOString()}]${m}`)},Nr=(d,m)=>{Ha=d,Fa=m},cm=(d,m)=>{let g=rr(d),w=rr(Ha);g>=w&&dm(g,typeof m=="function"?m():m)},le=(...d)=>{Fa&&cm(...d)}}),ro,tt,E$1,Dt,Vr,qa,ja,ae=L$1(()=>{ro=class{static calcMatMulShape(d,m){return d[1]!==m[0]?void 0:[d[0],m[1]]}},tt=class{static calcShape(d,m,g=!1){let w=d.length,$=m.length;if(w===0)return m;if($===0)return d;let I=Math.max(d.length,m.length),D=new Array(I);if(g){if(w<2||$<2)return;let F=ro.calcMatMulShape([d[w-2],d[w-1]],[m[$-2],m[$-1]]);if(F===void 0)return;[D[I-2],D[I-1]]=F}for(let F=g?3:1;F<=I;F++){let U=w-F<0?1:d[w-F],j=$-F<0?1:m[$-F];if(U!==j&&U>1&&j>1)return;let G=Math.max(U,j);if(U&&j)D[I-F]=Math.max(U,j);else{if(G>1)return;D[I-F]=0}}return D}static isValidBroadcast(d,m){let g=d.length,w=m.length;if(g>w)return!1;for(let $=1;$<=g;$++)if(d[g-$]!==1&&d[g-$]!==m[w-$])return!1;return!0}},E$1=class Vn{static size(m){return Vn.getSizeFromDimensionRange(m,0,m.length)}static convertShape(m,g=4){let w=m.length;if(w===0)return[];let $=new Array(w),I=w-1;for(;I>=0;){if(m[I]%g===0){$[I]=m[I]/g;break}if(g%m[I]!==0)throw new Error("cannot convert shape");$[I]=1,g/=m[I],I--}for(I--;I>=0;I--)$[I]=m[I];return $}static sizeFromDimension(m,g){if(g<0||g>m.length)throw new Error(`invalid dimension of ${g} for sizeFromDimension as Tensor has ${m.length} dimensions.`);return Vn.getSizeFromDimensionRange(m,g,m.length)}static sizeToDimension(m,g){if(g<0||g>m.length)throw new Error(`invalid dimension of ${g} for sizeToDimension as Tensor has ${m.length} dimensions.`);return Vn.getSizeFromDimensionRange(m,0,g)}static getSizeFromDimensionRange(m,g,w){let $=1;for(let I=g;I<w;I++){if(m[I]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");$*=Number(m[I])}return $}static computeStrides(m){let g=m.length;if(g===0)return[];if(g===1)return[1];let w=new Array(g);w[g-1]=1,w[g-2]=m[g-1];for(let $=g-3;$>=0;--$)w[$]=w[$+1]*m[$+1];return w}static normalizeAxis(m,g){if(m<-g&&m>=g)throw new Error("unsupported axis for this operation.");return m<0?m+g:m}static normalizeAxes(m,g){return m.map(w=>this.normalizeAxis(w,g??m.length))}static sortBasedOnPerm(m,g){return g?g.map(w=>m[w]):m.slice().reverse()}static padShape(m,g){let w=m.length;return m.map(($,I)=>$+g[I]+g[I+w])}static areEqual(m,g){return m.length!==g.length?!1:m.every((w,$)=>w===g[$])}},Dt=class In{static adjustPoolAttributes(m,g,w,$,I,D){if(!m&&w.length!==g.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(m)for(let F=0;F<g.length-2;F++)F>=w.length?w.push(g[F+2]):w[F]=g[F+2];for(let F=0;F<w.length;F++)if(F<$.length){if($[F]<0)throw new Error("strides should be greater than or equal to 1")}else $.push(1);for(let F=0;F<w.length;F++)if(F<I.length){if(I[F]<0)throw new Error("dilations should be greater than or equal to 1")}else I.push(1);for(let F=0;F<w.length*2;F++)if(F<D.length){if(D[F]<0)throw new Error("pad should be greater than or equal to 1")}else D.push(0);for(let F=0;F<w.length;F++){if(w[F]<=0)throw new Error("kernel shapes need to be greater than 0");if(D[F]>=w[F]||D[F+w.length]>=w[F])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(m,g,w,$,I,D,F){if(F){if(I.length!==2*(m.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(g.length!==m.length-2)throw new Error("length of strides should be the length of data dimensions");if($.length!==m.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let U=0;U<m.length-2;U++)In.adjustPadAndReturnShape(m[U+(D?1:2)],g[U],w[U],$[U],I,U,U+m.length-2,F)}}static computePoolOutputShape(m,g,w,$,I,D,F){if(g.length<=0)throw new Error("input shape must be of size greater than 0");let U=[g[0],g[1]];return In.computeShapeHelper(m,g,U,w,$,I,D,F),U}static computeConvOutputShape(m,g,w,$,I,D,F){if(m.length<=0||g.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let U=[m[0],g[0]];return In.computeShapeHelper(!1,m,U,w,$,I,D,F),U}static computeShapeHelper(m,g,w,$,I,D,F,U){if(m)for(let j=0;j<g.length-2;j++)w.push(1);else for(let j=0;j<g.length-2;j++)w.push(In.adjustPadAndReturnShape(g[j+2],$[j],I[j],D[j],F,j,j+g.length-2,U))}static adjustPadAndReturnShape(m,g,w,$,I,D,F,U){let j=w*($-1)+1;if(U&&U!=="NOTSET")switch(U){case"VALID":return I[D]=0,I[F]=0,Math.floor((m-j)/g+1);case"SAME_LOWER":case"SAME_UPPER":if(w!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let G=((m+g-1)/g-1)*g+$-m;return I[D]=Math.floor(U==="SAME_LOWER"?(G+1)/2:G/2),I[F]=G-I[D],Math.floor((m+G-$)/g+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((m+I[D]+I[F]-j)/g+1)}},Vr=class{static getShapeOfGemmResult(d,m,g,w,$){if(d.length!==2||g.length!==2)throw new Error("shape need to be of size 2");let I,D,F;m?(I=d[1],D=d[0]):(I=d[0],D=d[1]);let U=-1;if(w?(F=g[0],U=1):(F=g[1],U=0),g[U]!==D)throw new Error("dimension mismatch");if(I<=0||F<=0||D<=0)throw new Error("invalid shape specified");if($&&!tt.isValidBroadcast($,[I,F]))throw new Error("gemm: invalid bias shape for broadcast");return[I,F,D]}},qa=-34028234663852886e22,ja=34028234663852886e22}),Lr,no=L$1(()=>{ee(),Lr=(d,m)=>new(Gt(m))(d)}),Za,io,Qa,pm,Ka,mm,Ya,Wr,Gr,oo,Xa,Ja=L$1(()=>{ee(),et(),Za=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),io=(d,m)=>{if(m==="int32")return d;let g=Za.get(m);if(!g)throw new Error(`WebNN backend does not support data type: ${m}`);let w=g/8;if(d.byteLength%w!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${w}.`);let $=d.byteLength/w,I=new(Gt(m))(d.buffer,d.byteOffset,$);switch(m){case"int64":case"uint64":{let D=new Int32Array($);for(let F=0;F<$;F++){let U=I[F];if(U>2147483647n||U<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");D[F]=Number(U)}return new Uint8Array(D.buffer)}case"int8":case"uint8":case"uint32":{if(m==="uint32"&&I.some(F=>F>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let D=Int32Array.from(I,Number);return new Uint8Array(D.buffer)}default:throw new Error(`Unsupported data conversion from ${m} to 'int32'`)}},Qa=(d,m)=>{if(m==="int32")return d;if(d.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let g=d.byteLength/4,w=new Int32Array(d.buffer,d.byteOffset,g);switch(m){case"int64":{let $=BigInt64Array.from(w,BigInt);return new Uint8Array($.buffer)}case"uint64":{if(w.some(I=>I<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let $=BigUint64Array.from(w,BigInt);return new Uint8Array($.buffer)}case"int8":{if(w.some(I=>I<-128||I>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let $=Int8Array.from(w,Number);return new Uint8Array($.buffer)}case"uint8":{if(w.some($=>$<0||$>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(w,Number)}case"uint32":{if(w.some(I=>I<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let $=Uint32Array.from(w,Number);return new Uint8Array($.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${m}`)}},pm=1,Ka=()=>pm++,mm=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ya=(d,m)=>{let g=Za.get(d);if(!g)throw new Error(`WebNN backend does not support data type: ${d}`);return m.length>0?Math.ceil(m.reduce((w,$)=>w*$)*g/8):0},Wr=class{constructor(d){this.isDataConverted=!1;let{sessionId:m,context:g,tensor:w,dataType:$,shape:I,fallbackDataType:D}=d;this.sessionId=m,this.mlContext=g,this.mlTensor=w,this.dataType=$,this.tensorShape=I,this.fallbackDataType=D}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ya(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(d){this.mlContext.writeTensor(this.mlTensor,d)}async read(d){if(this.fallbackDataType){let m=await this.mlContext.readTensor(this.mlTensor),g=Qa(new Uint8Array(m),this.dataType);if(d){(d instanceof ArrayBuffer?new Uint8Array(d):new Uint8Array(d.buffer,d.byteOffset,d.byteLength)).set(g);return}else return g.buffer}else return d?this.mlContext.readTensor(this.mlTensor,d):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(d,m,g){return this.mlContext===d&&this.dataType===m&&this.tensorShape.length===g.length&&this.tensorShape.every((w,$)=>w===g[$])}setIsDataConverted(d){this.isDataConverted=d}},Gr=class{constructor(d,m){this.tensorManager=d,this.wrapper=m}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(d,m,g,w){let $=this.tensorManager.getMLContext(d),I;if(!$.opSupportLimits().input.dataTypes.includes(m)){if(I=mm.get(m),!I||!$.opSupportLimits().input.dataTypes.includes(I))throw new Error(`WebNN backend does not support data type: ${m}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${m} to ${I}`)}if(this.wrapper){if(this.wrapper.canReuseTensor($,m,g))return this.wrapper.tensor;if(w){if(this.wrapper.byteLength!==Ya(m,g))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let D=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(d,m,g,D,!0,!0,I),w&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(d){let m=d;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")m=io(d,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(d.byteLength===this.wrapper.byteLength){this.wrapper.write(m);return}else le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(m):this.activeUpload=new Uint8Array(m)}async download(d){if(this.activeUpload){let m=this.wrapper?.isDataConverted?Qa(this.activeUpload,this.wrapper?.type):this.activeUpload;if(d){d instanceof ArrayBuffer?new Uint8Array(d).set(m):new Uint8Array(d.buffer,d.byteOffset,d.byteLength).set(m);return}else return m.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return d?this.wrapper.read(d):this.wrapper.read()}},oo=class{constructor(d){this.backend=d,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(d){let m=this.backend.getMLContext(d);if(!m)throw new Error("MLContext not found for session.");return m}reserveTensorId(){let d=Ka();return this.tensorTrackersById.set(d,new Gr(this)),d}releaseTensorId(d){let m=this.tensorTrackersById.get(d);m&&(this.tensorTrackersById.delete(d),m.tensorWrapper&&this.releaseTensor(m.tensorWrapper))}async ensureTensor(d,m,g,w,$){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${m}, dataType: ${g}, shape: ${w}, copyOld: ${$}}`);let I=this.tensorTrackersById.get(m);if(!I)throw new Error("Tensor not found.");return I.ensureTensor(d,g,w,$)}upload(d,m){let g=this.tensorTrackersById.get(d);if(!g)throw new Error("Tensor not found.");g.upload(m)}async download(d,m){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${d}, dstBuffer: ${m?.byteLength}}`);let g=this.tensorTrackersById.get(d);if(!g)throw new Error("Tensor not found.");return g.download(m)}releaseTensorsForSession(d){for(let m of this.freeTensors)m.sessionId===d&&m.destroy();this.freeTensors=this.freeTensors.filter(m=>m.sessionId!==d)}registerTensor(d,m,g,w){let $=this.getMLContext(d),I=Ka(),D=new Wr({sessionId:d,context:$,tensor:m,dataType:g,shape:w});return this.tensorTrackersById.set(I,new Gr(this,D)),this.externalTensors.add(D),I}async getCachedTensor(d,m,g,w,$,I,D){let F=this.getMLContext(d);for(let[j,G]of this.freeTensors.entries())if(G.canReuseTensor(F,m,g)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${m}, ${D?`fallbackDataType: ${D},`:""} shape: ${g}`);let Z=this.freeTensors.splice(j,1)[0];return Z.sessionId=d,Z}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${m}, ${D?`fallbackDataType: ${D},`:""} shape: ${g}}`);let U=await F.createTensor({dataType:D??m,shape:g,dimensions:g,usage:w,writable:$,readable:I});return new Wr({sessionId:d,context:F,tensor:U,dataType:m,shape:g,fallbackDataType:D})}releaseTensor(d){this.externalTensors.has(d)&&this.externalTensors.delete(d),this.freeTensors.push(d)}},Xa=(...d)=>new oo(...d)}),Hr,fm,Fr,es=L$1(()=>{ee(),$t(),no(),Ja(),et(),Hr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),fm=(d,m)=>{if(d===m)return!0;if(d===void 0||m===void 0)return!1;let g=Object.keys(d).sort(),w=Object.keys(m).sort();return g.length===w.length&&g.every(($,I)=>$===w[I]&&d[$]===m[$])},Fr=class{constructor(d){this.tensorManager=Xa(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Nr(d.logLevel,!!d.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(d){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${d}}`),this.activeSessionId=d}onRunEnd(d){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${d}}`);let m=this.temporarySessionTensorIds.get(d);if(m){for(let g of m)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${g}}`),this.tensorManager.releaseTensorId(g);this.temporarySessionTensorIds.delete(d),this.activeSessionId=void 0}}async createMLContext(d){if(d instanceof GPUDevice){let g=this.mlContextCache.findIndex(w=>w.gpuDevice===d);if(g!==-1)return this.mlContextCache[g].mlContext;{let w=await navigator.ml.createContext(d);return this.mlContextCache.push({gpuDevice:d,mlContext:w}),w}}else if(d===void 0){let g=this.mlContextCache.findIndex(w=>w.options===void 0&&w.gpuDevice===void 0);if(g!==-1)return this.mlContextCache[g].mlContext;{let w=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:w}),w}}let m=this.mlContextCache.findIndex(g=>fm(g.options,d));if(m!==-1)return this.mlContextCache[m].mlContext;{let g=await navigator.ml.createContext(d);return this.mlContextCache.push({options:d,mlContext:g}),g}}registerMLContext(d,m){this.mlContextBySessionId.set(d,m);let g=this.sessionIdsByMLContext.get(m);g||(g=new Set,this.sessionIdsByMLContext.set(m,g)),g.add(d),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(d,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(d,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(d){this.sessionGraphInputs.delete(d),this.sessionGraphOutputs.delete(d);let m=this.mlContextBySessionId.get(d);if(!m)return;this.tensorManager.releaseTensorsForSession(d),this.mlContextBySessionId.delete(d);let g=this.sessionIdsByMLContext.get(m);if(g.delete(d),g.size===0){this.sessionIdsByMLContext.delete(m);let w=this.mlContextCache.findIndex($=>$.mlContext===m);w!==-1&&this.mlContextCache.splice(w,1)}}getMLContext(d){return this.mlContextBySessionId.get(d)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(d){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${d}}`),this.tensorManager.releaseTensorId(d)}async ensureTensor(d,m,g,w,$){let I=Hr.get(g);if(!I)throw new Error(`Unsupported ONNX data type: ${g}`);return this.tensorManager.ensureTensor(d??this.currentSessionId,m,I,w,$)}async createTemporaryTensor(d,m,g){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${m}, shape: ${g}}`);let w=Hr.get(m);if(!w)throw new Error(`Unsupported ONNX data type: ${m}`);let $=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(d,$,w,g,!1);let I=this.temporarySessionTensorIds.get(d);return I?I.push($):this.temporarySessionTensorIds.set(d,[$]),$}uploadTensor(d,m){if(!_e().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${d}, data: ${m.byteLength}}`),this.tensorManager.upload(d,m)}async downloadTensor(d,m){return this.tensorManager.download(d,m)}createMLTensorDownloader(d,m){return async()=>{let g=await this.tensorManager.download(d);return Lr(g,m)}}registerMLTensor(d,m,g,w){let $=Hr.get(g);if(!$)throw new Error(`Unsupported ONNX data type: ${g}`);let I=this.tensorManager.registerTensor(d,m,$,w);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${m}, dataType: ${$}, dimensions: ${w}} -> {tensorId: ${I}}`),I}registerMLConstant(d,m,g,w,$,I,D=!1){if(!I)throw new Error("External mounted files are not available.");let F=d;d.startsWith("./")&&(F=d.substring(2));let U=I.get(F);if(!U)throw new Error(`File with name ${F} not found in preloaded files.`);if(m+g>U.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let j=U.slice(m,m+g).buffer,G;switch($.dataType){case"float32":G=new Float32Array(j);break;case"float16":G=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(j):new Uint16Array(j);break;case"int32":G=new Int32Array(j);break;case"uint32":G=new Uint32Array(j);break;case"int64":if(D){let Z=io(new Uint8Array(j),"int64");G=new Int32Array(Z.buffer),$.dataType="int32"}else G=new BigInt64Array(j);break;case"uint64":G=new BigUint64Array(j);break;case"int8":G=new Int8Array(j);break;case"int4":case"uint4":case"uint8":G=new Uint8Array(j);break;default:throw new Error(`Unsupported data type: ${$.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${$.dataType}, shape: ${$.shape}}} ${D?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),w.constant($,G)}registerGraphInput(d){this.temporaryGraphInputs.push(d)}registerGraphOutput(d){this.temporaryGraphOutputs.push(d)}isGraphInput(d,m){let g=this.sessionGraphInputs.get(d);return g?g.includes(m):!1}isGraphOutput(d,m){let g=this.sessionGraphOutputs.get(d);return g?g.includes(m):!1}isGraphInputOutputTypeSupported(d,m,g=!0){let w=this.mlContextBySessionId.get(d),$=Hr.get(xt(m));return typeof $>"u"?!1:g?!!w?.opSupportLimits().input.dataTypes.includes($):!!w?.opSupportLimits().output.dataTypes.includes($)}flush(){}}}),qr=L$1(()=>{}),ts,ao,so,hm,gm,rs,lo,uo,os,is=L$1(()=>{et(),qr(),ts=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),ao=[],so=d=>Math.ceil(Number(d)/16)*16,hm=d=>{for(let m=0;m<ao.length;m++){let g=ao[m];if(d<=g)return g}return Math.ceil(d/16)*16},gm=1,rs=()=>gm++,lo=async(d,m,g,w)=>{let $=so(g),I=d.device.createBuffer({size:$,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let D=d.getCommandEncoder();d.endComputePass(),D.copyBufferToBuffer(m,0,I,0,$),d.flush(),await I.mapAsync(GPUMapMode.READ);let F=I.getMappedRange();if(w){let U=w();return U.set(new Uint8Array(F,0,g)),U}else return new Uint8Array(F.slice(0,g))}finally{I.destroy()}},uo=class{constructor(d){this.backend=d,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[m]of ts)ao.push(m),this.freeBuffers.set(m,[]),this.freeUniformBuffers.set(m,[]);this.sessionCount=0}upload(d,m){let g=m.buffer,w=m.byteOffset,$=m.byteLength,I=so($),D=this.storageCache.get(d);if(!D)throw new Error("gpu data for uploading does not exist");if(Number(D.originalSize)!==$)throw new Error(`inconsistent data size. gpu data size=${D.originalSize}, data size=${$}`);let F=this.backend.device.createBuffer({mappedAtCreation:!0,size:I,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),U=F.getMappedRange();new Uint8Array(U).set(new Uint8Array(g,w,$)),F.unmap();let j=this.backend.device.createCommandEncoder();j.copyBufferToBuffer(F,0,D.gpuData.buffer,0,I),this.backend.device.queue.submit([j.finish()]),F.destroy(),le("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${d})`)}memcpy(d,m){let g=this.storageCache.get(d);if(!g)throw new Error("source gpu data for memcpy does not exist");let w=this.storageCache.get(m);if(!w)throw new Error("destination gpu data for memcpy does not exist");if(g.originalSize!==w.originalSize)throw new Error("inconsistent source and destination gpu data size");let $=so(g.originalSize),I=this.backend.getCommandEncoder();this.backend.endComputePass(),I.copyBufferToBuffer(g.gpuData.buffer,0,w.gpuData.buffer,0,$)}registerExternalBuffer(d,m,g){let w;if(g){if(w=g[0],d===g[1])return le("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${m}) => id=${w}, buffer is the same, skip.`),w;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else w=rs();return this.storageCache.set(w,{gpuData:{id:w,type:0,buffer:d},originalSize:m}),le("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${m}) => id=${w}, registered.`),w}unregisterExternalBuffer(d){d!==void 0&&(this.storageCache.delete(d),le("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${d}`))}create(d,m=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let g=hm(d),w,$=(m&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,I=(m&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if($||I){let F=($?this.freeBuffers:this.freeUniformBuffers).get(g);F?F.length>0?w=F.pop():w=this.backend.device.createBuffer({size:g,usage:m}):w=this.backend.device.createBuffer({size:g,usage:m})}else w=this.backend.device.createBuffer({size:g,usage:m});let D={id:rs(),type:0,buffer:w};return this.storageCache.set(D.id,{gpuData:D,originalSize:Number(d)}),le("verbose",()=>`[WebGPU] GpuDataManager.create(size=${d}) => id=${D.id}`),D}get(d){return this.storageCache.get(d)?.gpuData}release(d){let m=typeof d=="bigint"?Number(d):d,g=this.storageCache.get(m);if(!g){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return le("verbose",()=>`[WebGPU] GpuDataManager.release(id=${m}), gpuDataId=${g.gpuData.id}`),this.storageCache.delete(m),this.buffersPending.push(g.gpuData.buffer),g.originalSize}async download(d,m){let g=this.storageCache.get(Number(d));if(!g)throw new Error("data does not exist");await lo(this.backend,g.gpuData.buffer,g.originalSize,m)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let d of this.buffersPending){let m=ts.get(d.size);if((d.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let g=this.freeBuffers.get(d.size)||[];m===void 0||g.length>=m?d.destroy():g.push(d)}else if((d.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let g=this.freeUniformBuffers.get(d.size)||[];m===void 0||g.length>=m?d.destroy():g.push(d)}else d.destroy()}this.buffersPending=[]}else{let d=this.capturedPendingBuffers.get(this.backend.currentSessionId);d||(d=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,d));for(let m of this.buffersPending)d.push(m);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.freeUniformBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.storageCache.forEach(d=>{d.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(d){let m=this.capturedPendingBuffers.get(d);m&&(m.forEach(g=>{g.destroy()}),this.capturedPendingBuffers.delete(d)),this.sessionCount-=1,this.sessionCount===0&&(le("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(g=>{g.gpuData.buffer.destroy()}),this.storageCache=new Map)}},os=(...d)=>new uo(...d)}),co,te,Se=L$1(()=>{co=class{constructor(d){Object.assign(this,d)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(d=>`${this[d]}`).join(";")),this.key}},te=d=>new co(d)}),Bt,mo,ve,ke,W,he,fo,Mt,je,K,jr,P,N$1,as,Kr,po,ss,ue=L$1(()=>{ee(),ae(),Bt=64,mo=(d,m)=>{if(m===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(d)){case 10:return m>1?`vec${m}<f16>`:"f16";case 1:return m>1?`vec${m}<f32>`:"f32";case 6:return m>1?`vec${m}<i32>`:"i32";case 12:return m>1?`vec${m}<u32>`:"u32";case 7:if(m>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(m>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(m!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${d}`)}},ve=(d,m=1)=>{let g=mo(d,m);return typeof g=="string"?g:g[0]},ke=(d,m=1)=>{let g=mo(d,m);return typeof g=="string"?g:g[1]},W=(...d)=>{let m=[];return d.forEach(g=>{g.length!==0&&m.push({type:12,data:g},{type:12,data:E$1.computeStrides(g)})}),m},he=d=>d%4===0?4:d%2===0?2:1,fo=(d="f32",m,g="0")=>!m||m===1?`${d}(${g})`:`vec${m}<${d}>(${g})`,Mt=(d,m,g)=>d==="f32"?g:m===1?`f32(${g})`:`vec${m}<f32>(${g})`,je=(d,m)=>m===4?`(${d}.x + ${d}.y + ${d}.z + ${d}.w)`:m===2?`(${d}.x + ${d}.y)`:m===3?`(${d}.x + ${d}.y + ${d}.z)`:d,K=(d,m,g,w)=>d.startsWith("uniforms.")&&g>4?typeof m=="string"?w==="f16"?`${d}[(${m}) / 8][(${m}) % 8 / 4][(${m}) % 8 % 4]`:`${d}[(${m}) / 4][(${m}) % 4]`:w==="f16"?`${d}[${Math.floor(m/8)}][${Math.floor(m%8/4)}][${m%8%4}]`:`${d}[${Math.floor(m/4)}][${m%4}]`:g>1?`${d}[${m}]`:d,jr=(d,m,g,w,$)=>{let I=typeof g=="number",D=I?g:g.length,F=[...new Array(D).keys()],U=D<2?"u32":D<=4?`vec${D}<u32>`:`array<u32, ${D}>`,j=mo(m,$),G=typeof j=="string"?j:j[1],Z=typeof j=="string"?j:j[0],H={indices:U,value:G,storage:Z,tensor:m},q=Ye=>typeof Ye=="string"?Ye:`${Ye}u`,V={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},Q=I?"uniforms.":"",X=`${Q}${d}_shape`,re=`${Q}${d}_strides`,J="";for(let Ye=0;Ye<D-1;Ye++)J+=`
    let dim${Ye} = current / ${K(re,Ye,D)};
    let rest${Ye} = current % ${K(re,Ye,D)};
    indices[${Ye}] = dim${Ye};
    current = rest${Ye};
    `;J+=`indices[${D-1}] = current;`;let se=D<2?"":`
  fn o2i_${d}(offset: u32) -> ${H.indices} {
    var indices: ${H.indices};
    var current = offset;
    ${J}
    return indices;
  }`,ie=Ye=>(V.offsetToIndices=!0,D<2?Ye:`o2i_${d}(${Ye})`),oe=[];if(D>=2)for(let Ye=D-1;Ye>=0;Ye--)oe.push(`${K(re,Ye,D)} * (indices[${Ye}])`);let pe=D<2?"":`
  fn i2o_${d}(indices: ${H.indices}) -> u32 {
    return ${oe.join("+")};
  }`,de=Ye=>(V.indicesToOffset=!0,D<2?Ye:`i2o_${d}(${Ye})`),ge=(...Ye)=>D===0?"0u":`${H.indices}(${Ye.map(q).join(",")})`,ce=(Ye,_t)=>D<2?`${Ye}`:`${K(Ye,_t,D)}`,Ie=(Ye,_t,Vt)=>D<2?`${Ye}=${Vt};`:`${K(Ye,_t,D)}=${Vt};`,fe={},Te=(Ye,_t)=>{V.broadcastedIndicesToOffset=!0;let Vt=`${_t.name}broadcastedIndicesTo${d}Offset`;if(Vt in fe)return`${Vt}(${Ye})`;let Lt=[];for(let dt=D-1;dt>=0;dt--){let It=_t.indicesGet("outputIndices",dt+_t.rank-D);Lt.push(`${ce(re,dt)} * (${It} % ${ce(X,dt)})`)}return fe[Vt]=`fn ${Vt}(outputIndices: ${_t.type.indices}) -> u32 {
             return ${Lt.length>0?Lt.join("+"):"0u"};
           }`,`${Vt}(${Ye})`},ut=(Ye,_t)=>(()=>{if(H.storage===H.value)return`${d}[${Ye}]=${_t};`;if(H.storage==="vec2<u32>"&&H.value==="i32")return`${d}[${Ye}]=vec2<u32>(u32(${_t}), select(0u, 0xFFFFFFFFu, ${_t} < 0));`;if(H.storage==="vec2<u32>"&&H.value==="u32")return`${d}[${Ye}]=vec2<u32>(u32(${_t}), 0u);`;if(H.storage==="u32"&&H.value==="vec4<bool>")return`${d}[${Ye}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${_t}));`;throw new Error(`not supported combination of storage type ${H.storage} and value type ${H.value} yet`)})(),ze=Ye=>(()=>{if(H.storage===H.value)return`${d}[${Ye}]`;if(H.storage==="vec2<u32>"&&H.value==="i32")return`i32(${d}[${Ye}].x)`;if(H.storage==="vec2<u32>"&&H.value==="u32")return`u32(${d}[${Ye}].x)`;if(H.storage==="u32"&&H.value==="vec4<bool>")return`vec4<bool>(bool(${d}[${Ye}] & 0xFFu), bool(${d}[${Ye}] & 0xFF00u), bool(${d}[${Ye}] & 0xFF0000u), bool(${d}[${Ye}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${H.storage} and value type ${H.value} yet`)})(),Ce=D<2?"":`
  fn get_${d}ByIndices(indices: ${H.indices}) -> ${G} {
    return ${ze(`i2o_${d}(indices)`)};
  }`,Fe=D<2?"":(()=>{let Ye=F.map(Vt=>`d${Vt}: u32`).join(", "),_t=F.map(Vt=>`d${Vt}`).join(", ");return`
  fn get_${d}(${Ye}) -> ${G} {
    return get_${d}ByIndices(${ge(_t)});
  }`})(),Et=(...Ye)=>{if(Ye.length!==D)throw new Error(`indices length must be ${D}`);let _t=Ye.map(q).join(",");return D===0?ze("0u"):D===1?ze(_t[0]):(V.get=!0,V.getByIndices=!0,V.indicesToOffset=!0,`get_${d}(${_t})`)},bt=Ye=>D<2?ze(Ye):(V.getByIndices=!0,V.indicesToOffset=!0,`get_${d}ByIndices(${Ye})`),ht=D<2?"":`
  fn set_${d}ByIndices(indices: ${H.indices}, value: ${G}) {
    ${ut(`i2o_${d}(indices)`,"value")}
  }`,Zt=D<2?"":(()=>{let Ye=F.map(Vt=>`d${Vt}: u32`).join(", "),_t=F.map(Vt=>`d${Vt}`).join(", ");return`
  fn set_${d}(${Ye}, value: ${G}) {
    set_${d}ByIndices(${ge(_t)}, value);
  }`})();return{impl:()=>{let Ye=[],_t=!1;return V.offsetToIndices&&(Ye.push(se),_t=!0),V.indicesToOffset&&(Ye.push(pe),_t=!0),V.broadcastedIndicesToOffset&&(Object.values(fe).forEach(Vt=>Ye.push(Vt)),_t=!0),V.set&&(Ye.push(Zt),_t=!0),V.setByIndices&&(Ye.push(ht),_t=!0),V.get&&(Ye.push(Fe),_t=!0),V.getByIndices&&(Ye.push(Ce),_t=!0),!I&&_t&&Ye.unshift(`const ${X} = ${H.indices}(${g.join(",")});`,`const ${re} = ${H.indices}(${E$1.computeStrides(g).join(",")});`),Ye.join(`
`)},type:H,offsetToIndices:ie,indicesToOffset:de,broadcastedIndicesToOffset:Te,indices:ge,indicesGet:ce,indicesSet:Ie,set:(...Ye)=>{if(Ye.length!==D+1)throw new Error(`indices length must be ${D}`);let _t=Ye[D];if(typeof _t!="string")throw new Error("value must be string");let Vt=Ye.slice(0,D).map(q).join(",");return D===0?ut("0u",_t):D===1?ut(Vt[0],_t):(V.set=!0,V.setByIndices=!0,V.indicesToOffset=!0,`set_${d}(${Vt}, ${_t})`)},setByOffset:ut,setByIndices:(Ye,_t)=>D<2?ut(Ye,_t):(V.setByIndices=!0,V.indicesToOffset=!0,`set_${d}ByIndices(${Ye}, ${_t});`),get:Et,getByOffset:ze,getByIndices:bt,usage:w,name:d,strides:re,shape:X,rank:D}},P=(d,m,g,w=1)=>jr(d,m,g,"input",w),N$1=(d,m,g,w=1)=>jr(d,m,g,"output",w),as=(d,m,g)=>jr(d,m,g,"atomicOutput",1),Kr=(d,m,g,w=1)=>jr(d,m,g,"internal",w),po=class{constructor(d,m){this.normalizedDispatchGroup=d,this.limits=m,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(d){return`if (global_idx >= ${typeof d=="number"?`${d}u`:d}) { return; }`}mainStart(d=Bt){let m=typeof d=="number"?d:d[0],g=typeof d=="number"?1:d[1],w=typeof d=="number"?1:d[2];if(m>this.limits.maxComputeWorkgroupSizeX||g>this.limits.maxComputeWorkgroupSizeY||w>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${m}, ${g}, ${w}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(m*g*w>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${m}, ${g}, ${w}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let $=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,I=$?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,D=$?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${m*g*w}u + local_idx;`;return`@compute @workgroup_size(${m}, ${g}, ${w})
  fn main(${I}) {
    ${D}
  `}appendVariableUniforms(d){d.rank!==0&&(d.shape.startsWith("uniforms.")&&this.uniforms.push({name:d.shape.replace("uniforms.",""),type:"u32",length:d.rank}),d.strides.startsWith("uniforms.")&&this.uniforms.push({name:d.strides.replace("uniforms.",""),type:"u32",length:d.rank}))}declareVariable(d,m){if(d.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(d),this.appendVariableUniforms(d);let g=d.usage==="input"?"read":"read_write",w=d.usage==="atomicOutput"?"atomic<i32>":d.type.storage;return`@group(0) @binding(${m}) var<storage, ${g}> ${d.name}: array<${w}>;`}declareVariables(...d){return d.map(m=>this.declareVariable(m,this.variableIndex++)).join(`
`)}registerInternalVariable(d){if(d.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(d),this.appendVariableUniforms(d)}registerInternalVariables(...d){return d.forEach(m=>this.registerInternalVariable(m)),this}registerUniform(d,m,g=1){return this.uniforms.push({name:d,type:m,length:g}),this}registerUniforms(d){return this.uniforms=this.uniforms.concat(d),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let d=[];for(let{name:m,type:g,length:w}of this.uniforms)if(w&&w>4)g==="f16"?d.push(`@align(16) ${m}:array<mat2x4<${g}>, ${Math.ceil(w/8)}>`):d.push(`${m}:array<vec4<${g}>, ${Math.ceil(w/4)}>`);else{let $=w==null||w===1?g:`vec${w}<${g}>`;d.push(`${m}:${$}`)}return`
      struct Uniforms { ${d.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(d=>d.impl()).join(`
`)+this.internalVariables.map(d=>d.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let d=m=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(m)];return this.uniforms.map(m=>[d(m.type),m.length??1])}},ss=(d,m)=>new po(d,m)}),ym,us,bm,_m,wm,vm,Pe,ls,ds,ct=L$1(()=>{ee(),ae(),Se(),ue(),ym=(d,m)=>{if(!d||d.length!==1)throw new Error("Transpose requires 1 input.");if(m.length!==0&&m.length!==d[0].dims.length)throw new Error(`perm size ${m.length} does not match input rank ${d[0].dims.length}`)},us=(d,m)=>m.length!==0?m:[...new Array(d).keys()].reverse(),bm=(d,m)=>E$1.sortBasedOnPerm(d,us(d.length,m)),_m=(d,m,g,w)=>{let $=`fn perm(i: ${w.type.indices}) -> ${g.type.indices} {
    var a: ${g.type.indices};`;for(let I=0;I<m;++I)$+=`a[${d[I]}]=i[${I}];`;return $+="return a;}"},wm=(d,m)=>{let g=[],w=[];for(let $=0;$<d.length;++$)d[$]!==1&&g.push(d[$]),d[m[$]]!==1&&w.push(m[$]);return{newShape:g,newPerm:w}},vm=(d,m)=>{let g=0;for(let w=0;w<d.length;++w)if(m[d[w]]!==1){if(d[w]<g)return!1;g=d[w]}return!0},Pe=(d,m)=>{let g=d.dataType,w=d.dims.length,$=us(w,m),I=bm(d.dims,$),D=d.dims,F=I,U=w<2||vm($,d.dims),j;if(U)return j=V=>{let Q=P("input",g,D,4),X=N$1("output",g,F,4);return`
  ${V.registerUniform("output_size","u32").declareVariables(Q,X)}
  ${V.mainStart()}
    ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let V=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(V/64/4)},programUniforms:[{type:12,data:Math.ceil(V/4)}]}},getShaderSource:j};let{newShape:G,newPerm:Z}=wm(d.dims,$),H=E$1.areEqual(Z,[2,3,1]),q=E$1.areEqual(Z,[3,1,2]);if(G.length===2||H||q){D=H?[G[0],G[1]*G[2]]:q?[G[0]*G[1],G[2]]:G,F=[D[1],D[0]];let V=16;return j=Q=>{let X=P("a",g,D.length),re=N$1("output",g,F.length);return`
  ${Q.registerUniform("output_size","u32").declareVariables(X,re)}
  var<workgroup> tile : array<array<${re.type.value}, ${V+1}>, ${V}>;
  ${Q.mainStart([V,V,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${V} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${V}u + local_id.x;
    let input_row = workgroup_id_x * ${V}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${X.getByIndices(`${X.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${V}u + local_id.x;
    let output_row = workgroup_id_y * ${V}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${re.setByIndices(`${re.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let Q=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(F[1]/V),y:Math.ceil(F[0]/V)},programUniforms:[{type:12,data:Q},...W(D,F)]}},getShaderSource:j}}return j=V=>{let Q=P("a",g,D.length),X=N$1("output",g,F.length);return`
  ${V.registerUniform("output_size","u32").declareVariables(Q,X)}

  ${_m($,w,Q,X)}

  ${V.mainStart()}
    ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${X.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${X.setByOffset("global_idx",Q.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${m}`,inputDependencies:["rank"]},getRunData:()=>{let V=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:[{type:12,data:V},...W(D,F)]}},getShaderSource:j}},ls=(d,m)=>{ym(d.inputs,m.perm),d.compute(Pe(d.inputs[0],m.perm))},ds=d=>te({perm:d.perm})}),$m,xm,Sm,Tm,Cm,Im,Am,Em,km,Pm,rt,cs,ps,ms,fs,hs,gs,ys,bs,_s,ws,vs=L$1(()=>{ee(),ae(),ue(),Zr(),ct(),$m={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},xm={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Sm={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Tm={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Cm=(d,m)=>{let g=[];for(let w=m-d;w<m;++w)g.push(w);return g},Im=(d,m)=>{let g=[],w=d.length;for(let I=0;I<w;I++)m.indexOf(I)===-1&&g.push(d[I]);let $=m.map(I=>d[I]);return[g,$]},Am=(d,m)=>{let g=d.length+m.length,w=[],$=0;for(let I=0;I<g;I++)m.indexOf(I)===-1?w.push(d[$++]):w.push(1);return w},Em=(d,m)=>{for(let g=0;g<d.length;++g)if(d[d.length-g-1]!==m-1-g)return!1;return!0},km=(d,m)=>{let g=[];if(!Em(d,m)){for(let w=0;w<m;++w)d.indexOf(w)===-1&&g.push(w);d.forEach(w=>g.push(w))}return g},Pm=(d,m,g,w,$,I,D)=>{let F=g[0].dims,U=E$1.size(I),j=E$1.size(D),G=P("_A",g[0].dataType,F),Z=N$1("output",$,I),H=64;U===1&&(H=256);let q=`
          var<workgroup> aBestValues : array<f32, ${H}>;
       `,V=Q=>`
        ${Q.registerUniform("reduceSize","u32").declareVariables(G,Z)}
        ${q}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${Q.mainStart(H)}

          let outputIndex = global_idx / ${H};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Sm[w]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${H}) {
           let candidate = f32(${G.getByOffset("offset + k")});
           bestValue = ${$m[w]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${H}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${xm[w]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${Z.setByOffset("outputIndex",`${w==="mean"?`${Z.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${Z.type.storage}(${Tm[w]})`}`)};
         }
        }`;return{name:d,shaderCache:{hint:`${m};${H}`,inputDependencies:["type"]},getShaderSource:V,getRunData:()=>({outputs:[{dims:I,dataType:$}],dispatchGroup:{x:U},programUniforms:[{type:12,data:j}]})}},rt=(d,m,g,w)=>{let $=d.inputs.length===1?g:ho(d.inputs,g),I=$.axes;I.length===0&&!$.noopWithEmptyAxes&&(I=d.inputs[0].dims.map((q,V)=>V));let D=E$1.normalizeAxes(I,d.inputs[0].dims.length),F=D,U=d.inputs[0],j=km(F,d.inputs[0].dims.length);j.length>0&&(U=d.compute(Pe(d.inputs[0],j),{inputs:[0],outputs:[-1]})[0],F=Cm(F.length,U.dims.length));let[G,Z]=Im(U.dims,F),H=G;$.keepDims&&(H=Am(G,D)),d.compute(Pm(m,$.cacheKey,[U],w,d.inputs[0].dataType,H,Z),{inputs:[U]})},cs=(d,m)=>{rt(d,"ReduceMeanShared",m,"mean")},ps=(d,m)=>{rt(d,"ReduceL1Shared",m,"l1")},ms=(d,m)=>{rt(d,"ReduceL2Shared",m,"l2")},fs=(d,m)=>{rt(d,"ReduceLogSumExpShared",m,"logSumExp")},hs=(d,m)=>{rt(d,"ReduceMaxShared",m,"max")},gs=(d,m)=>{rt(d,"ReduceMinShared",m,"min")},ys=(d,m)=>{rt(d,"ReduceProdShared",m,"prod")},bs=(d,m)=>{rt(d,"ReduceSumShared",m,"sum")},_s=(d,m)=>{rt(d,"ReduceSumSquareShared",m,"sumSquare")},ws=(d,m)=>{rt(d,"ReduceLogSumShared",m,"logSum")}}),nt,Om,Qr,ho,ot,zm,Dm,Bm,Mm,Rm,Um,Nm,Vm,Lm,Wm,it,$s,xs,Ss,Ts,Cs,Is,As,Es,ks,Ps,Zr=L$1(()=>{ee(),ae(),Se(),ue(),vs(),nt=d=>{if(!d||d.length===0||d.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(d.length===2&&d[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Om=d=>["","",`var value = ${d.getByIndices("input_indices")};`,""],Qr=(d,m,g,w,$,I,D=!1,F=!1)=>{let U=[],j=g[0].dims,G=j.length,Z=E$1.normalizeAxes($,G),H=!F&&Z.length===0;j.forEach((Q,X)=>{H||Z.indexOf(X)>=0?D&&U.push(1):U.push(Q)});let q=U.length,V=E$1.size(U);return{name:d,shaderCache:m,getShaderSource:Q=>{let X=[],re=P("_A",g[0].dataType,G),J=N$1("output",I,q),se=w(re,J,Z),ie=se[2];for(let oe=0,pe=0;oe<G;oe++)H||Z.indexOf(oe)>=0?(D&&pe++,ie=`for(var j${oe}: u32 = 0; j${oe} < ${j[oe]}; j${oe}++) {
                  ${se[2].includes("last_index")?`let last_index = j${oe};`:""}
                  ${re.indicesSet("input_indices",oe,`j${oe}`)}
                  ${ie}
                }`):(X.push(`${re.indicesSet("input_indices",oe,J.indicesGet("output_indices",pe))};`),pe++);return`

        ${Q.registerUniform("output_size","u32").declareVariables(re,J)}

        ${Q.mainStart()}
          ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${re.type.indices};
          let output_indices = ${J.offsetToIndices("global_idx")};

          ${X.join(`
`)}
          ${se[0]}       // init ops for reduce max/min
          ${se[1]}
          ${ie}
          ${se[3]}
          ${se.length===4?J.setByOffset("global_idx","value"):se.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:U,dataType:I}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:[{type:12,data:V},...W(j,U)]})}},ho=(d,m)=>{let g=[];return d[1].dims[0]>0&&d[1].getBigInt64Array().forEach(w=>g.push(Number(w))),te({axes:g,keepDims:m.keepDims,noopWithEmptyAxes:m.noopWithEmptyAxes})},ot=(d,m,g,w)=>{let $=d.inputs,I=$.length===1?g:ho($,g);d.compute(Qr(m,{hint:I.cacheKey,inputDependencies:["rank"]},[$[0]],I.noopWithEmptyAxes&&I.axes.length===0?Om:w,I.axes,$[0].dataType,I.keepDims,I.noopWithEmptyAxes),{inputs:[0]})},zm=(d,m)=>{nt(d.inputs),ot(d,"ReduceLogSum",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += ${g.getByIndices("input_indices")};`,"value = log(value);"])},Dm=(d,m)=>{nt(d.inputs),ot(d,"ReduceL1",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += abs(${g.getByIndices("input_indices")});`,""])},Bm=(d,m)=>{nt(d.inputs),ot(d,"ReduceL2",m,(g,w)=>[`var t = ${w.type.value}(0); var value = ${w.type.value}(0);`,"",`t = ${g.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Mm=(d,m)=>{nt(d.inputs),ot(d,"ReduceLogSumExp",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += exp(${g.getByIndices("input_indices")});`,"value = log(value);"])},Rm=(d,m)=>{nt(d.inputs),ot(d,"ReduceMax",m,(g,w,$)=>{let I=[];for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&I.push(g.indicesSet("input_indices",D,0));return[`${I.join(`
`)}`,`var value = ${g.getByIndices("input_indices")};`,`value = max(value, ${g.getByIndices("input_indices")});`,""]})},Um=(d,m)=>{nt(d.inputs),ot(d,"ReduceMean",m,(g,w,$)=>{let I=1;for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&(I*=d.inputs[0].dims[D]);return["var sum = f32(0);","",`sum += f32(${g.getByIndices("input_indices")});`,`let value = ${w.type.value}(sum / ${I});`]})},Nm=(d,m)=>{nt(d.inputs),ot(d,"ReduceMin",m,(g,w,$)=>{let I=[];for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&I.push(`input_indices[${D}] = 0;`);return[`${I.join(`
`)}`,`var value = ${g.getByIndices("input_indices")};`,`value = min(value, ${g.getByIndices("input_indices")});`,""]})},Vm=(d,m)=>{nt(d.inputs),ot(d,"ReduceProd",m,(g,w)=>[`var value = ${w.type.storage}(1);`,"",`value *= ${g.getByIndices("input_indices")};`,""])},Lm=(d,m)=>{nt(d.inputs),ot(d,"ReduceSum",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += ${g.getByIndices("input_indices")};`,""])},Wm=(d,m)=>{nt(d.inputs),ot(d,"ReduceSumSquare",m,(g,w)=>[`var t = ${w.type.value}(0); var value = ${w.type.value}(0);`,"",`t = ${g.getByIndices("input_indices")}; value += t * t;`,""])},it=(d,m,g)=>{if(m.length===0)return g;let w=1,$=1;for(let I=0;I<m.length;I++)m.indexOf(I)===-1?w*=d[I]:$*=d[I];return $<32&&w>1024},$s=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Um(d,m):cs(d,m)},xs=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Dm(d,m):ps(d,m)},Ss=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Bm(d,m):ms(d,m)},Ts=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Mm(d,m):fs(d,m)},Cs=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Rm(d,m):hs(d,m)},Is=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Nm(d,m):gs(d,m)},As=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Vm(d,m):ys(d,m)},Es=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Lm(d,m):bs(d,m)},ks=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Wm(d,m):_s(d,m)},Ps=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?zm(d,m):ws(d,m)}}),Os,zs,Ds,go,Bs=L$1(()=>{ee(),Se(),Zr(),Os=d=>{if(!d||d.length===0||d.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(d[0].dataType!==1)throw new Error("Invalid input type.")},zs=(d,m)=>{Os(d.inputs);let g=(w,$,I)=>{let D=[];for(let F=0;F<w.rank;F++)(I.indexOf(F)>=0||I.length===0)&&D.push(`input_indices[${F}] = 0;`);return[`${D.join(`
`)}`,`var value = ${w.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${w.getByIndices("input_indices")} ${m.selectLastIndex>0?"<=":"<"} value) {
         value = ${w.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",$.setByOffset("global_idx","best_index")]};d.compute(Qr("ArgMin",{hint:m.cacheKey,inputDependencies:["rank"]},[d.inputs[0]],g,[m.axis],7,m.keepDims),{inputs:[0]})},Ds=(d,m)=>{Os(d.inputs);let g=(w,$,I)=>{let D=[];for(let F=0;F<w.rank;F++)(I.indexOf(F)>=0||I.length===0)&&D.push(`input_indices[${F}] = 0;`);return[`${D.join(`
`)}`,`var value = ${w.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${w.getByIndices("input_indices")} ${m.selectLastIndex>0?">=":">"} value) {
         value = ${w.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",$.setByOffset("global_idx","best_index")]};d.compute(Qr("argMax",{hint:m.cacheKey,inputDependencies:["rank"]},[d.inputs[0]],g,[m.axis],7,m.keepDims),{inputs:[0]})},go=d=>te(d)}),Gm,yo,Hm,Fm,qm,Ht,jm,Ms,Yr=L$1(()=>{ee(),ae(),qr(),ue(),Gm=(d,m)=>{let g=d[0],w=d[1],$=d[2],I=d[3],D=d[4],F=d[5];if(D&&F)throw new Error("Attention cannot have both past and attention_bias");if(g.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let U=g.dims[0],j=g.dims[1],G=g.dims[2];if($.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(w.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(w.dims[0]!==G)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if($.dims[0]!==w.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let Z=$.dims[0]/3,H=Z,q=H;if(m.qkvHiddenSizes.length>0){if(m.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let se of m.qkvHiddenSizes)if(se%m.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");Z=m.qkvHiddenSizes[0],H=m.qkvHiddenSizes[1],q=m.qkvHiddenSizes[2]}let V=j;if(Z!==H)throw new Error("qkv_hidden_sizes first element should be same as the second");if($.dims[0]!==Z+H+q)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let Q=0;if(D){if(H!==q)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(D.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(D.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(D.dims[1]!==U)throw new Error('Input "past" second dimension must be batch_size');if(D.dims[2]!==m.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(D.dims[4]!==H/m.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');m.pastPresentShareBuffer||(Q=D.dims[3])}let X=V+Q,re=-1,J=0;if(I)throw new Error("Mask not supported");if(D)throw new Error("past is not supported");if(F){if(F.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(F.dims[0]!==U||F.dims[1]!==m.numHeads||F.dims[2]!==j||F.dims[3]!==X)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:U,sequenceLength:j,pastSequenceLength:Q,kvSequenceLength:V,totalSequenceLength:X,maxSequenceLength:re,inputHiddenSize:G,hiddenSize:Z,vHiddenSize:q,headSize:Math.floor(Z/m.numHeads),vHeadSize:Math.floor(q/m.numHeads),numHeads:m.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:m.maskFilterValue,maskType:J,scale:m.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},yo=(d,m,g)=>m&&d?`
      let total_sequence_length_input = u32(${m.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${d?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${g?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Hm=(d,m,g,w,$,I,D,F)=>{let U=he(D?1:I),j=64,G=I/U;G<j&&(j=32);let Z=Math.ceil(I/U/j),H=[{type:12,data:m},{type:12,data:g},{type:12,data:w},{type:12,data:$},{type:12,data:G},{type:12,data:Z}],q=ve(d.dataType,U),V=ke(1,U),Q=["type"];D&&Q.push("type"),F&&Q.push("type");let X=re=>{let J=N$1("x",d.dataType,d.dims,U),se=[J],ie=D?P("seq_lens",D.dataType,D.dims):void 0;ie&&se.push(ie);let oe=F?P("total_sequence_length_input",F.dataType,F.dims):void 0;oe&&se.push(oe);let pe=ke(d.dataType),de=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${j}>;
  var<workgroup> thread_sum: array<f32, ${j}>;
  ${re.registerUniforms(de).declareVariables(...se)}
  ${re.mainStart([j,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${yo(ie,oe,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${j}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${D?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${V}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${V}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(U){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${U}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${j}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${V}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${V}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(U){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${U}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${j}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${J.type.value}(${pe}(1.0) / ${pe}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${V}(x[offset + i]);
        x[offset + i] = ${J.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${D?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${J.type.value}(${pe}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${j};${q};${U}`,inputDependencies:Q},getShaderSource:X,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:$,z:m*g},programUniforms:H})}},Fm=(d,m,g,w,$,I,D,F,U)=>{let j=D+I.kvSequenceLength,G=[I.batchSize,I.numHeads,I.sequenceLength,j],Z=d>1&&w,H=I.kvNumHeads?I.kvNumHeads:I.numHeads,q=Z?[I.batchSize,H,j,I.headSize]:void 0,V=I.nReps?I.nReps:1,Q=I.scale===0?1/Math.sqrt(I.headSize):I.scale,X=he(I.headSize),re=I.headSize/X,J=12,se={x:Math.ceil(j/J),y:Math.ceil(I.sequenceLength/J),z:I.batchSize*I.numHeads},ie=[{type:12,data:I.sequenceLength},{type:12,data:re},{type:12,data:j},{type:12,data:I.numHeads},{type:12,data:I.headSize},{type:1,data:Q},{type:12,data:D},{type:12,data:I.kvSequenceLength},{type:12,data:V}],oe=Z&&w&&E$1.size(w.dims)>0,pe=["type","type"];oe&&pe.push("type"),$&&pe.push("type"),F&&pe.push("type"),U&&pe.push("type");let de=[{dims:G,dataType:m.dataType,gpuDataType:0}];Z&&de.push({dims:q,dataType:m.dataType,gpuDataType:0});let ge=ce=>{let Ie=P("q",m.dataType,m.dims,X),fe=P("key",g.dataType,g.dims,X),Te=[Ie,fe];if(oe){let ht=P("past_key",w.dataType,w.dims,X);Te.push(ht)}$&&Te.push(P("attention_bias",$.dataType,$.dims));let ut=F?P("seq_lens",F.dataType,F.dims):void 0;ut&&Te.push(ut);let ze=U?P("total_sequence_length_input",U.dataType,U.dims):void 0;ze&&Te.push(ze);let Ce=N$1("output",m.dataType,G),Fe=[Ce];Z&&Fe.push(N$1("present_key",m.dataType,q,X));let Et=ke(1,X),bt=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${J}u;

  var<workgroup> tileQ: array<${Ie.type.storage}, ${J*J}>;
  var<workgroup> tileK: array<${Ie.type.storage}, ${J*J}>;
  ${ce.registerUniforms(bt).declareVariables(...Te,...Fe)}
  ${ce.mainStart([J,J,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${V===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${V===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${yo(ut,ze,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${oe&&Z?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${Z?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${Et}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${oe&&Z?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${Z?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${Et}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(X){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${X}`)}})()};
        output[outputIdx] = ${Ce.type.value} (sum * uniforms.alpha) + ${$?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${X};${$!==void 0};${w!==void 0};${d}`,inputDependencies:pe},getRunData:()=>({outputs:de,dispatchGroup:se,programUniforms:ie}),getShaderSource:ge}},qm=(d,m,g,w,$,I,D=void 0,F=void 0)=>{let U=I+$.kvSequenceLength,j=$.nReps?$.nReps:1,G=$.vHiddenSize*j,Z=d>1&&w,H=$.kvNumHeads?$.kvNumHeads:$.numHeads,q=Z?[$.batchSize,H,U,$.headSize]:void 0,V=[$.batchSize,$.sequenceLength,G],Q=12,X={x:Math.ceil($.vHeadSize/Q),y:Math.ceil($.sequenceLength/Q),z:$.batchSize*$.numHeads},re=[{type:12,data:$.sequenceLength},{type:12,data:U},{type:12,data:$.vHeadSize},{type:12,data:$.numHeads},{type:12,data:$.headSize},{type:12,data:G},{type:12,data:I},{type:12,data:$.kvSequenceLength},{type:12,data:j}],J=Z&&w&&E$1.size(w.dims)>0,se=["type","type"];J&&se.push("type"),D&&se.push("type"),F&&se.push("type");let ie=[{dims:V,dataType:m.dataType,gpuDataType:0}];Z&&ie.push({dims:q,dataType:m.dataType,gpuDataType:0});let oe=pe=>{let de=P("probs",m.dataType,m.dims),ge=P("v",g.dataType,g.dims),ce=[de,ge];J&&ce.push(P("past_value",w.dataType,w.dims));let Ie=D?P("seq_lens",D.dataType,D.dims):void 0;D&&ce.push(Ie);let fe=F?P("total_sequence_length_input",F.dataType,F.dims):void 0;F&&ce.push(fe);let Te=[N$1("output",m.dataType,V)];Z&&Te.push(N$1("present_value",m.dataType,q));let ut=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${Q}u;
  var<workgroup> tileQ: array<${de.type.value}, ${Q*Q}>;
  var<workgroup> tileV: array<${de.type.value}, ${Q*Q}>;
  ${pe.registerUniforms(ut).declareVariables(...ce,...Te)}
  ${pe.mainStart([Q,Q,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${j===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${j===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${yo(Ie,fe,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${J&&Z?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${Z?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${de.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${J&&Z?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${Z?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${w!==void 0};${d}`,inputDependencies:se},getRunData:()=>({outputs:ie,dispatchGroup:X,programUniforms:re}),getShaderSource:oe}},Ht=(d,m,g,w,$,I,D,F,U,j,G=void 0,Z=void 0)=>{let H=Math.min(d.outputCount,1+(D?1:0)+(F?1:0)),q=H>1?j.pastSequenceLength:0,V=q+j.kvSequenceLength,Q=U&&E$1.size(U.dims)>0?U:void 0,X=[m,g];H>1&&D&&E$1.size(D.dims)>0&&X.push(D),Q&&X.push(Q),G&&X.push(G),Z&&X.push(Z);let re=d.compute(Fm(H,m,g,D,Q,j,q,G,Z),{inputs:X,outputs:H>1?[-1,1]:[-1]})[0];d.compute(Hm(re,j.batchSize,j.numHeads,q,j.sequenceLength,V,G,Z),{inputs:G&&Z?[re,G,Z]:[re],outputs:[]});let J=[re,w];H>1&&F&&E$1.size(F.dims)>0&&J.push(F),G&&J.push(G),Z&&J.push(Z),d.compute(qm(H,re,w,F,j,q,G,Z),{inputs:J,outputs:H>1?[0,2]:[0]})},jm=(d,m)=>{let g=[m.batchSize,m.numHeads,m.sequenceLength,m.headSize],w=m.sequenceLength,$=m.inputHiddenSize,I=m.headSize,D=12,F={x:Math.ceil(m.headSize/D),y:Math.ceil(m.sequenceLength/D),z:m.batchSize*m.numHeads},U=[d.inputs[0],d.inputs[1],d.inputs[2]],j=[{type:12,data:w},{type:12,data:$},{type:12,data:I},{type:12,data:m.numHeads},{type:12,data:m.headSize},{type:12,data:m.hiddenSize},{type:12,data:m.hiddenSize+m.hiddenSize+m.vHiddenSize}],G=Z=>{let H=N$1("output_q",U[0].dataType,g),q=N$1("output_k",U[0].dataType,g),V=N$1("output_v",U[0].dataType,g),Q=P("input",U[0].dataType,U[0].dims),X=P("weight",U[1].dataType,U[1].dims),re=P("bias",U[2].dataType,U[2].dims),J=Q.type.storage,se=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${D}u;
  var<workgroup> tileInput: array<${J}, ${D*D}>;
  var<workgroup> tileWeightQ: array<${J}, ${D*D}>;
  var<workgroup> tileWeightK: array<${J}, ${D*D}>;
  var<workgroup> tileWeightV: array<${J}, ${D*D}>;
  ${Z.registerUniforms(se).declareVariables(Q,X,re,H,q,V)}
  ${Z.mainStart([D,D,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${J}(0);
    var valueK = ${J}(0);
    var valueV = ${J}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return d.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0},{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0},{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0}],dispatchGroup:F,programUniforms:j}),getShaderSource:G},{inputs:U,outputs:[-1,-1,-1]})},Ms=(d,m)=>{let g=Gm(d.inputs,m),[w,$,I]=jm(d,g);return Ht(d,w,$,I,d.inputs[4],void 0,void 0,void 0,d.inputs[5],g)}}),Km,Zm,Qm,Rs,Us=L$1(()=>{Ve(),ee(),ae(),Se(),ue(),Km=(d,m)=>{if(!d||d.length!==5)throw new Error("BatchNormalization requires 5 inputs");let g=(w,$,I)=>{let D=$.length;if(D!==w.length)throw new Error(`${I}: num dimensions != ${D}`);$.forEach((F,U)=>{if(F!==w[U])throw new Error(`${I}: dim[${U}] do not match`)})};if(d[0].dims.length>1){let w=m.format==="NHWC"?m.spatial?d[0].dims.slice(-1):d[0].dims.slice(-1).concat(d[0].dims.slice(1,d[0].dims.length-1)):d[0].dims.slice(1,m.spatial?2:void 0);g(d[1].dims,w,"Invalid input scale"),g(d[2].dims,w,"Invalid input B"),g(d[3].dims,w,"Invalid input mean"),g(d[4].dims,w,"Invalid input var")}else g(d[1].dims,[1],"Invalid input scale"),g(d[2].dims,[1],"Invalid input B"),g(d[3].dims,[1],"Invalid input mean"),g(d[4].dims,[1],"Invalid input var")},Zm=(d,m)=>{let{epsilon:g,spatial:w,format:$}=m,I=d[0].dims,D=w?he(I[I.length-1]):1,F=$==="NHWC"&&I.length>1?D:1,U=E$1.size(I)/D,j=w,G=j?I.length:I,Z=P("x",d[0].dataType,d[0].dims,D),H=P("scale",d[1].dataType,d[1].dims,F),q=P("bias",d[2].dataType,d[2].dims,F),V=P("inputMean",d[3].dataType,d[3].dims,F),Q=P("inputVar",d[4].dataType,d[4].dims,F),X=N$1("y",d[0].dataType,G,D),re=()=>{let se="";if(w)se=`let cOffset = ${I.length===1?"0u":$==="NHWC"?`outputIndices[${I.length-1}] / ${D}`:"outputIndices[1]"};`;else if($==="NCHW")se=`
            ${X.indicesSet("outputIndices","0","0")}
            let cOffset = ${X.indicesToOffset("outputIndices")};`;else{se=`var cIndices = ${H.type.indices}(0);
                       cIndices[0] = outputIndices[${I.length-1}];`;for(let ie=1;ie<H.rank;ie++)se+=`cIndices[${ie}] = outputIndices[${ie}];`;se+=`let cOffset = ${H.indicesToOffset("cIndices")};`}return se},J=se=>`
  const epsilon = ${g};
  ${se.registerUniform("outputSize","u32").declareVariables(Z,H,q,V,Q,X)}
  ${se.mainStart()}
  ${se.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${X.offsetToIndices(`global_idx * ${D}`)};
    ${re()}
    let scale = ${H.getByOffset("cOffset")};
    let bias = ${q.getByOffset("cOffset")};
    let inputMean = ${V.getByOffset("cOffset")};
    let inputVar = ${Q.getByOffset("cOffset")};
    let x = ${Z.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${X.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${m.epsilon}_${m.format}_${w}_${D}`,inputDependencies:j?["rank","type","type","type","type"]:void 0},getShaderSource:J,getRunData:()=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:j?[{type:12,data:U},...W(I)]:[{type:12,data:U}]})}},Qm=d=>te(d),Rs=(d,m)=>{let{inputs:g,outputCount:w}=d,$=Qm({...m,outputCount:w});if(we.webgpu.validateInputContent&&Km(g,$),m.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");d.compute(Zm(g,$))}}),Ym,Xm,Ns,Vs=L$1(()=>{ae(),ue(),Ym=d=>{if(d[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(d[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(d[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(d[0].dims[2]!==d[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Xm=d=>{let m=d[0].dims,g=d[0].dims[2],w=E$1.size(m)/4,$=d[0].dataType,I=P("input",$,m,4),D=P("bias",$,[g],4),F=P("residual",$,m,4),U=N$1("output",$,m,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:m,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(w/64)}}),getShaderSource:j=>`
  const channels = ${g}u / 4;
  ${j.declareVariables(I,D,F,U)}

  ${j.mainStart()}
    ${j.guardAgainstOutOfBoundsWorkgroupSizes(w)}
    let value = ${I.getByOffset("global_idx")}
      + ${D.getByOffset("global_idx % channels")} + ${F.getByOffset("global_idx")};
    ${U.setByOffset("global_idx","value")}
  }`}},Ns=d=>{Ym(d.inputs),d.compute(Xm(d.inputs))}}),Jm,be,Ls,Ws,Gs,Hs,Fs,qs,js,Ks,Zs,ef,Qs,Ys,Xs,Js,or,eu,Xr,tu,ru,nu,ou,iu,au,su,uu,lu,du,cu,pu,mu,fu,hu,gu,yu,bu,bo,_o,_u,wu,vu,tf,rf,$u,Jr=L$1(()=>{ee(),ae(),Se(),ue(),Jm=(d,m,g,w,$,I,D)=>{let F=Math.ceil(m/4),U="";typeof $=="string"?U=`${$}(a)`:U=$("a");let j=P("inputData",g,[F],4),G=N$1("outputData",w,[F],4),Z=[{name:"vec_size",type:"u32"}];return D&&Z.push(...D),`
      ${d.registerUniforms(Z).declareVariables(j,G)}

  ${I??""}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${j.getByOffset("global_idx")};
    ${G.setByOffset("global_idx",U)}
  }`},be=(d,m,g,w,$,I=d.dataType,D,F)=>{let U=[{type:12,data:Math.ceil(E$1.size(d.dims)/4)}];return D&&U.push(...D),{name:m,shaderCache:{hint:$,inputDependencies:["type"]},getShaderSource:j=>Jm(j,E$1.size(d.dims),d.dataType,I,g,w,F),getRunData:j=>({outputs:[{dims:d.dims,dataType:I}],dispatchGroup:{x:Math.ceil(E$1.size(j[0].dims)/64/4)},programUniforms:U})}},Ls=d=>{d.compute(be(d.inputs[0],"Abs","abs"))},Ws=d=>{d.compute(be(d.inputs[0],"Acos","acos"))},Gs=d=>{d.compute(be(d.inputs[0],"Acosh","acosh"))},Hs=d=>{d.compute(be(d.inputs[0],"Asin","asin"))},Fs=d=>{d.compute(be(d.inputs[0],"Asinh","asinh"))},qs=d=>{d.compute(be(d.inputs[0],"Atan","atan"))},js=d=>{d.compute(be(d.inputs[0],"Atanh","atanh"))},Ks=d=>te(d),Zs=(d,m)=>{let g;switch(m.to){case 10:g="vec4<f16>";break;case 1:g="vec4<f32>";break;case 12:g="vec4<u32>";break;case 6:g="vec4<i32>";break;case 9:g="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${m.to}`)}d.compute(be(d.inputs[0],"Cast",g,void 0,m.cacheKey,m.to))},ef=d=>{let m,g,w=d.length>=2&&d[1].data!==0,$=d.length>=3&&d[2].data!==0;switch(d[0].dataType){case 1:m=w?d[1].getFloat32Array()[0]:-34028234663852886e22,g=$?d[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:m=w?d[1].getUint16Array()[0]:64511,g=$?d[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return te({min:m,max:g})},Qs=(d,m)=>{let g=m||ef(d.inputs),w=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Clip",$=>`clamp(${$}, vec4<${w}>(uniforms.min), vec4<${w}>(uniforms.max))`,void 0,g.cacheKey,void 0,[{type:d.inputs[0].dataType,data:g.min},{type:d.inputs[0].dataType,data:g.max}],[{name:"min",type:w},{name:"max",type:w}]),{inputs:[0]})},Ys=d=>{d.compute(be(d.inputs[0],"Ceil","ceil"))},Xs=d=>{d.compute(be(d.inputs[0],"Cos","cos"))},Js=d=>{d.compute(be(d.inputs[0],"Cosh","cosh"))},or=d=>te(d),eu=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Elu",w=>`elu_vf32(${w})`,`
  const elu_alpha_ = ${g}(${m.alpha});

  fn elu_f32(a: ${g}) -> ${g} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${g}>) -> vec4<${g}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,m.cacheKey))},Xr=(d="f32")=>`
const r0: ${d} = 0.3275911;
const r1: ${d} = 0.254829592;
const r2: ${d} = -0.284496736;
const r3: ${d} = 1.421413741;
const r4: ${d} = -1.453152027;
const r5: ${d} = 1.061405429;

fn erf_vf32(v: vec4<${d}>) -> vec4<${d}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,tu=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Erf",g=>`erf_vf32(${g})`,Xr(m)))},ru=d=>{d.compute(be(d.inputs[0],"Exp","exp"))},nu=d=>{d.compute(be(d.inputs[0],"Floor","floor"))},ou=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Gelu",g=>`0.5 * ${g} * (1.0 + erf_vf32(${g} * 0.7071067811865475))`,Xr(m)))},iu=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"LeakyRelu",w=>`select(leaky_relu_alpha_ * ${w}, ${w}, ${w} >= vec4<${g}>(0.0))`,`const leaky_relu_alpha_ = ${g}(${m.alpha});`,m.cacheKey))},au=d=>{d.compute(be(d.inputs[0],"Not",m=>`!${m}`))},su=d=>{d.compute(be(d.inputs[0],"Neg",m=>`-${m}`))},uu=d=>{d.compute(be(d.inputs[0],"Reciprocal",m=>`1.0/${m}`))},lu=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Relu",g=>`select(vec4<${m}>(0.0), ${g}, ${g} > vec4<${m}>(0.0))`))},du=d=>{d.compute(be(d.inputs[0],"Sigmoid",m=>`(1.0 / (1.0 + exp(-${m})))`))},cu=d=>te(d),pu=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"HardSigmoid",w=>`max(vec4<${g}>(0.0), min(vec4<${g}>(1.0), ${m.alpha} * ${w} + vec4<${g}>(${m.beta})))`,void 0,m.cacheKey))},mu=d=>{d.compute(be(d.inputs[0],"Sin","sin"))},fu=d=>{d.compute(be(d.inputs[0],"Sinh","sinh"))},hu=d=>{d.compute(be(d.inputs[0],"Sqrt","sqrt"))},gu=d=>{d.compute(be(d.inputs[0],"Tan","tan"))},yu=d=>`sign(${d}) * (1 - exp(-2 * abs(${d}))) / (1 + exp(-2 * abs(${d})))`,bu=d=>{d.compute(be(d.inputs[0],"Tanh",yu))},bo=(d="f32")=>`
const fast_gelu_a: ${d} = 0.5;
const fast_gelu_b: ${d} = 0.7978845608028654;
const fast_gelu_c: ${d} = 0.035677408136300125;

fn tanh_v(v: vec4<${d}>) -> vec4<${d}> {
  return ${yu("v")};
}
`,_o=d=>`(fast_gelu_a + fast_gelu_a * tanh_v(${d} * (fast_gelu_c * ${d} * ${d} + fast_gelu_b))) * ${d}`,_u=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"FastGelu",_o,bo(m),void 0,d.inputs[0].dataType))},wu=(d,m)=>{let g=ke(d.inputs[0].dataType);return d.compute(be(d.inputs[0],"ThresholdedRelu",w=>`select(vec4<${g}>(0.0), ${w}, ${w} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${g}>(${m.alpha});`,m.cacheKey)),0},vu=d=>{d.compute(be(d.inputs[0],"Log","log"))},tf=(d,m)=>`
const alpha = vec4<${d}>(${m});
const one = ${d}(1.0);
const zero = ${d}(0.0);

fn quick_gelu_impl(x: vec4<${d}>) -> vec4<${d}> {
  let v = x *alpha;
  var x1 : vec4<${d}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,rf=d=>`quick_gelu_impl(${d})`,$u=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"QuickGelu",rf,tf(g,m.alpha),m.cacheKey,d.inputs[0].dataType))}}),nf,of,Su,Tu=L$1(()=>{ae(),ue(),Jr(),nf=d=>{if(d[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(d[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(d[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(d[0].dims[2]!==d[1].dims[0])throw new Error("last dimension of input and bias are not the same")},of=d=>{let m=d[0].dims.slice();m[2]=m[2]/2;let g=P("input",d[0].dataType,d[0].dims,4),w=P("bias",d[0].dataType,[d[0].dims[2]],4),$=N$1("output",d[0].dataType,m,4),I=E$1.size(m)/4,D=ve(d[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:m,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)}}),getShaderSource:F=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${d[0].dims[2]/4/2}u;

  ${F.declareVariables(g,w,$)}

  ${Xr(D)}

  ${F.mainStart()}
    ${F.guardAgainstOutOfBoundsWorkgroupSizes(I)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${$.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},Su=d=>{nf(d.inputs),d.compute(of(d.inputs))}}),af,sf,at,Cu,Iu,Au,Eu,ku,Pu,Ou,zu,Du,Bu,Mu=L$1(()=>{ee(),ae(),ue(),af=(d,m,g,w,$,I,D,F,U,j,G,Z)=>{let H,q;typeof F=="string"?H=q=(J,se)=>`${F}((${J}),(${se}))`:typeof F=="function"?H=q=F:(H=F.scalar,q=F.vector);let V=N$1("outputData",G,w.length,4),Q=P("aData",U,m.length,4),X=P("bData",j,g.length,4),re;if($)if(I){let J=E$1.size(m)===1,se=E$1.size(g)===1,ie=m.length>0&&m[m.length-1]%4===0,oe=g.length>0&&g[g.length-1]%4===0;J||se?re=V.setByOffset("global_idx",q(J?`${Q.type.value}(${Q.getByOffset("0")}.x)`:Q.getByOffset("global_idx"),se?`${X.type.value}(${X.getByOffset("0")}.x)`:X.getByOffset("global_idx"))):re=`
            let outputIndices = ${V.offsetToIndices("global_idx * 4u")};
            let offsetA = ${Q.broadcastedIndicesToOffset("outputIndices",V)};
            let offsetB = ${X.broadcastedIndicesToOffset("outputIndices",V)};
            ${V.setByOffset("global_idx",q(D||ie?Q.getByOffset("offsetA / 4u"):`${Q.type.value}(${Q.getByOffset("offsetA / 4u")}[offsetA % 4u])`,D||oe?X.getByOffset("offsetB / 4u"):`${X.type.value}(${X.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else re=V.setByOffset("global_idx",q(Q.getByOffset("global_idx"),X.getByOffset("global_idx")));else{if(!I)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let J=(se,ie,oe="")=>{let pe=`aData[indexA${ie}][componentA${ie}]`,de=`bData[indexB${ie}][componentB${ie}]`;return`
            let outputIndices${ie} = ${V.offsetToIndices(`global_idx * 4u + ${ie}u`)};
            let offsetA${ie} = ${Q.broadcastedIndicesToOffset(`outputIndices${ie}`,V)};
            let offsetB${ie} = ${X.broadcastedIndicesToOffset(`outputIndices${ie}`,V)};
            let indexA${ie} = offsetA${ie} / 4u;
            let indexB${ie} = offsetB${ie} / 4u;
            let componentA${ie} = offsetA${ie} % 4u;
            let componentB${ie} = offsetB${ie} % 4u;
            ${se}[${ie}] = ${oe}(${H(pe,de)});
          `};G===9?re=`
            var data = vec4<u32>(0);
            ${J("data",0,"u32")}
            ${J("data",1,"u32")}
            ${J("data",2,"u32")}
            ${J("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:re=`
            ${J("outputData[global_idx]",0)}
            ${J("outputData[global_idx]",1)}
            ${J("outputData[global_idx]",2)}
            ${J("outputData[global_idx]",3)}
          `}return`
        ${d.registerUniform("vec_size","u32").declareVariables(Q,X,V)}

        ${Z??""}

        ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${re}
      }`},sf=(d,m,g,w,$,I,D=g.dataType)=>{let F=g.dims.map(Q=>Number(Q)??1),U=w.dims.map(Q=>Number(Q)??1),j=!E$1.areEqual(F,U),G=F,Z=E$1.size(F),H=!1,q=!1,V=[j];if(j){let Q=tt.calcShape(F,U,!1);if(!Q)throw new Error("Can't perform binary op on the given tensors");G=Q.slice(),Z=E$1.size(G);let X=E$1.size(F)===1,re=E$1.size(U)===1,J=F.length>0&&F[F.length-1]%4===0,se=U.length>0&&U[U.length-1]%4===0;V.push(X),V.push(re),V.push(J),V.push(se);let ie=1;for(let oe=1;oe<G.length;oe++){let pe=F[F.length-oe],de=U[U.length-oe];if(pe===de)ie*=pe;else break}ie%4===0?(q=!0,H=!0):(X||re||J||se)&&(H=!0)}else H=!0;return V.push(H),{name:d,shaderCache:{hint:m+V.map(Q=>Q.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:Q=>af(Q,F,U,G,H,j,q,$,g.dataType,w.dataType,D,I),getRunData:()=>({outputs:[{dims:G,dataType:D}],dispatchGroup:{x:Math.ceil(Z/64/4)},programUniforms:[{type:12,data:Math.ceil(E$1.size(G)/4)},...W(F,U,G)]})}},at=(d,m,g,w,$,I)=>{d.compute(sf(m,$??"",d.inputs[0],d.inputs[1],g,w,I))},Cu=d=>{at(d,"Add",(m,g)=>`${m}+${g}`)},Iu=d=>{at(d,"Div",(m,g)=>`${m}/${g}`)},Au=d=>{at(d,"Equal",{scalar:(m,g)=>`u32(${m}==${g})`,vector:(m,g)=>`vec4<u32>(${m}==${g})`},void 0,void 0,9)},Eu=d=>{at(d,"Mul",(m,g)=>`${m}*${g}`)},ku=d=>{let m=P("input",d.inputs[0].dataType,d.inputs[0].dims).type.value;at(d,"Pow",{scalar:(g,w)=>`pow_custom(${g},${w})`,vector:(g,w)=>`pow_vector_custom(${g},${w})`},`
    fn pow_custom(a : ${m}, b : ${m}) -> ${m} {
      if (b == ${m}(0.0)) {
        return ${m}(1.0);
      } else if (a < ${m}(0.0) && f32(b) != floor(f32(b))) {
        return ${m}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${m}(1.0), round(f32(abs(b) % ${m}(2.0))) != 1.0) * ${m}(${m==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${m}>, b : vec4<${m}>) -> vec4<${m}> {
      // TODO: implement vectorized pow
      return vec4<${m}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Pu=d=>{at(d,"Sub",(m,g)=>`${m}-${g}`)},Ou=d=>{at(d,"Greater",{scalar:(m,g)=>`u32(${m}>${g})`,vector:(m,g)=>`vec4<u32>(${m}>${g})`},void 0,void 0,9)},zu=d=>{at(d,"Less",{scalar:(m,g)=>`u32(${m}<${g})`,vector:(m,g)=>`vec4<u32>(${m}<${g})`},void 0,void 0,9)},Du=d=>{at(d,"GreaterOrEqual",{scalar:(m,g)=>`u32(${m}>=${g})`,vector:(m,g)=>`vec4<u32>(${m}>=${g})`},void 0,void 0,9)},Bu=d=>{at(d,"LessOrEqual",{scalar:(m,g)=>`u32(${m}<=${g})`,vector:(m,g)=>`vec4<u32>(${m}<=${g})`},void 0,void 0,9)}}),lf,df,cf,pf,Ru,Uu,Nu=L$1(()=>{ee(),ae(),Se(),ue(),lf=(d,m)=>{if(!d||d.length<1)throw new Error("too few inputs");let g=0,w=d[g],$=w.dataType,I=w.dims.length;d.forEach((D,F)=>{if(F!==g){if(D.dataType!==$)throw new Error("input tensors should be one type");if(D.dims.length!==I)throw new Error("input tensors should have the same shape");D.dims.forEach((U,j)=>{if(j!==m&&U!==w.dims[j])throw new Error("non concat dimensions must match")})}})},df=(d,m)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${d}u>(${m});
    for (var i: u32 = 0u; i < ${d}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${d}u;
  }`,cf=(d,m)=>{let g=d.length,w=[];for(let $=0;$<g;++$){let I=m.setByOffset("global_idx",d[$].getByIndices("indices"));g===1?w.push(I):$===0?w.push(`if (inputIndex == ${$}u) { ${I} }`):$===g-1?w.push(`else { ${I} }`):w.push(`else if (inputIndex == ${$}) { ${I} }`)}return w.join(`
`)},pf=(d,m,g,w)=>{let $=E$1.size(g),I=new Array(d.length),D=new Array(d.length),F=0,U=[],j=[],G=[{type:12,data:$}];for(let Q=0;Q<d.length;++Q)F+=d[Q].dims[m],I[Q]=F,j.push(d[Q].dims.length),D[Q]=P(`input${Q}`,w,j[Q]),U.push("rank"),G.push({type:12,data:I[Q]});for(let Q=0;Q<d.length;++Q)G.push(...W(d[Q].dims));G.push(...W(g));let Z=N$1("output",w,g.length),H=Z.indicesGet("indices",m),q=Array.from(Array(I.length).keys()).map(Q=>`uniforms.sizeInConcatAxis${Q}`).join(","),V=Q=>`

  ${(()=>{Q.registerUniform("outputSize","u32");for(let X=0;X<d.length;X++)Q.registerUniform(`sizeInConcatAxis${X}`,"u32");return Q.declareVariables(...D,Z)})()}

  ${df(I.length,q)}

  ${Q.mainStart()}
    ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${Z.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${H});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${I.length}u>(${q});
      ${H} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${cf(D,Z)}
  }`;return{name:"Concat",shaderCache:{hint:`${m}`,inputDependencies:U},getRunData:()=>({outputs:[{dims:g,dataType:w}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:G}),getShaderSource:V}},Ru=(d,m)=>{let g=d.inputs,w=g[0].dims,$=E$1.normalizeAxis(m.axis,w.length);lf(g,$);let I=w.slice();I[$]=g.reduce((F,U)=>F+(U.dims.length>$?U.dims[$]:0),0);let D=g.filter(F=>E$1.size(F.dims)>0);d.compute(pf(D,$,I,g[0].dataType),{inputs:D})},Uu=d=>te({axis:d.axis})}),Ke,Ze,Qe,en,Tt=L$1(()=>{ee(),ae(),Ke=(d,m,g="f32")=>{switch(d.activation){case"Relu":return`value = max(value, ${m}(0.0));`;case"Sigmoid":return`value = (${m}(1.0) / (${m}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${m}(${g}(uniforms.clip_min)), ${m}(${g}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${m}(0.0), min(${m}(1.0), ${g}(uniforms.alpha) * value + ${g}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${g}(uniforms.alpha) * value, value, value >= ${m}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${d.activation}`)}},Ze=(d,m)=>{d.activation==="Clip"?m.push({type:1,data:d.clipMax},{type:1,data:d.clipMin}):d.activation==="HardSigmoid"?m.push({type:1,data:d.alpha},{type:1,data:d.beta}):d.activation==="LeakyRelu"&&m.push({type:1,data:d.alpha})},Qe=(d,m)=>{d.activation==="Clip"?m.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):d.activation==="HardSigmoid"?m.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):d.activation==="LeakyRelu"&&m.push({name:"alpha",type:"f32"})},en=d=>{let m=d?.activation||"";if(m==="HardSigmoid"){let[g,w]=d?.activation_params||[.2,.5];return{activation:m,alpha:g,beta:w}}else if(m==="Clip"){let[g,w]=d?.activation_params||[qa,ja];return{activation:m,clipMax:w,clipMin:g}}else if(m==="LeakyRelu"){let[g]=d?.activation_params||[.01];return{activation:m,alpha:g}}return{activation:m}}}),Ae,Vu,tn=L$1(()=>{Ae=(d,m)=>{switch(d){case 1:return m;case 2:return`vec2<${m}>`;case 3:return`vec3<${m}>`;case 4:return`vec4<${m}>`;default:throw new Error(`${d}-component is not supported.`)}},Vu=d=>`
      ${d?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Lu,Wu=L$1(()=>{Lu=d=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${d}.x), i32(${d}.y), i32(${d}.z), 1));
}
`}),ir,rn,nn=L$1(()=>{ee(),ae(),ue(),Tt(),ir=(d,m,g,w,$)=>{let I=w-g;return`
      ${Array.from({length:g}).map((D,F)=>`
      if (${K(m.shape,F,m.rank)} != 1) {
        ${m.indicesSet(d,F,K($,F+I,w))}
      } else {
        ${m.indicesSet(d,F,0)}
      }`).join("")}
`},rn=(d,m,g,w,$=!1,I)=>{let D=d[0].dims,F=d[1].dims,U=D[D.length-2],j=F[F.length-1],G=D[D.length-1],Z=he(j),H=he(G),q=he(U),V=E$1.size(g)/Z/q,Q=d.length>2,X=w?w.slice(0,-2):g.slice(0,-2),re=[E$1.size(X),U,j],J=[{type:12,data:V},{type:12,data:U},{type:12,data:j},{type:12,data:G}];Ze(m,J),J.push(...W(X,D,F)),Q&&J.push(...W(d[2].dims)),J.push(...W(re));let se=ie=>{let oe=Kr("batch_dims",d[0].dataType,X.length),pe=P("a",d[0].dataType,D.length,H),de=P("b",d[1].dataType,F.length,Z),ge=N$1("output",d[0].dataType,re.length,Z),ce=ve(ge.type.tensor),Ie=Ke(m,ge.type.value,ce),fe=[pe,de],Te="";if(Q){let Ce=$?Z:1;fe.push(P("bias",d[2].dataType,d[2].dims.length,Ce)),Te=`${$?`value += bias[col / ${Ce}];`:`value += ${ge.type.value}(bias[row + i]);`}`}let ut=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Qe(m,ut);let ze=()=>{let Ce=`var a_data: ${pe.type.value};`;for(let Fe=0;Fe<H;Fe++)Ce+=`
              let b_data${Fe} = b[(b_offset + (k + ${Fe}) * uniforms.N + col) / ${Z}];`;for(let Fe=0;Fe<q;Fe++){Ce+=`a_data = a[(a_offset + (row + ${Fe}) * uniforms.K + k) / ${H}];`;for(let Et=0;Et<H;Et++)Ce+=`
            values[${Fe}] = fma(${de.type.value}(a_data${H===1?"":`[${Et}]`}), b_data${Et}, values[${Fe}]);
`}return Ce};return`
  ${ie.registerUniforms(ut).registerInternalVariables(oe).declareVariables(...fe,ge)}
  ${ie.mainStart()}
    ${ie.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${Z})) * ${Z};
    var index1 = global_idx / (uniforms.N / ${Z});
    let stride1 = uniforms.M / ${q};
    let row = (index1 % stride1) * ${q};
    let batch = index1 / stride1;

    ${g.length===2?"":`let batch_indices = ${oe.offsetToIndices("batch")};`}

    var a_indices: ${pe.type.indices};
    ${ir("a_indices",pe,pe.rank-2,oe.rank,"batch_indices")}
    ${pe.indicesSet("a_indices",pe.rank-2,0)}
    ${pe.indicesSet("a_indices",pe.rank-1,0)}
    let a_offset = ${pe.indicesToOffset("a_indices")};

    var b_indices: ${de.type.indices};
    ${ir("b_indices",de,de.rank-2,oe.rank,"batch_indices")}
    ${de.indicesSet("b_indices",de.rank-2,0)}
    ${de.indicesSet("b_indices",de.rank-1,0)}
    let b_offset = ${de.indicesToOffset("b_indices")};
    var values: array<${ge.type.value}, ${q}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${H}) {
      ${ze()}
    }
    for (var i = 0u; i < ${q}u; i++) {
      var value = values[i];
      ${Te}
      ${Ie}
      let cur_indices = ${ge.type.indices}(batch, row + i, col);
      let offset = ${ge.indicesToOffset("cur_indices")};
      ${ge.setByOffset(`offset / ${Z}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${m.activation};${Z};${H};${q};${$}`,inputDependencies:Q?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:I?I(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:J}),getShaderSource:se}}}),mf,ff,wo,Gu,hf,vo,gf,ar,on=L$1(()=>{ee(),ae(),ue(),Tt(),nn(),tn(),mf=(d,m)=>d?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${m?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${m?", batchIndices":""});
        `,ff=(d,m)=>d?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${m===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${m===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${m===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,wo=(d,m,g="f32",w,$=!1,I=32,D=!1,F=32)=>{let U=m[1]*d[1],j=m[0]*d[0],G=$?U:I,Z=$?I:U,H=G/m[0],q=I/m[1];if(!(($&&H===4&&d[1]===4||!$&&(H===3||H===4))&&G%m[0]===0&&I%m[1]===0&&d[0]===4))throw new Error(`If transposeA ${$} is true, innerElementSize ${H} and workPerThread[1] ${d[1]} must be 4.
      Otherwise, innerElementSize ${H} must be 3 or 4.
  tileAWidth ${G} must be divisible by workgroupSize[0]${m[0]}. tileInner ${I} must be divisible by workgroupSize[1] ${m[1]}. colPerThread ${d[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${H}<${g}>, ${G/H}>, ${Z}>;
var<workgroup> mm_Bsub: array<array<vec4<${g}>, ${j/d[0]}>, ${I}>;

const rowPerThread = ${d[1]};
const colPerThread = ${d[0]};
const innerElementSize = ${H};
const tileInner = ${I};

@compute @workgroup_size(${m[0]}, ${m[1]}, ${m[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${D?"0":"i32(globalId.z)"};
  ${w?`let batchIndices = ${w.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${U};

  let num_tiles = ${D?`${Math.ceil(F/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${D?`i32(globalId.z) * ${F}`:"0"};

  var acc: array<vec4<${g}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${q};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${mf($,w)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${q}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${w?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${H===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${ff($,H)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Gu=(d,m)=>d?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${m?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${m?", batchIndices":""});
            `,hf=d=>d?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",vo=(d,m,g="f32",w,$=!1,I=32,D=!1,F=32,U=!1)=>{let j=d[1]*m[1],G=d[0]*m[0],Z=$?j:I,H=$?I:j;if(!(H%m[1]===0&&Z%m[0]===0&&I%m[1]===0))throw new Error(`tileAHight ${H} must be divisible by workgroupSize[1]${m[1]}, tileAWidth ${Z} must be divisible by workgroupSize[0]${m[0]}, tileInner ${I} must be divisible by workgroupSize[1]${m[1]}`);let q=H/m[1],V=Z/m[0],Q=I/m[1],X=U?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${j};
    let globalColStart = i32(workgroupId.x) * ${G};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${H}; inputRow = inputRow + ${m[1]}) {
        for (var inputCol = localCol; inputCol < ${Z}; inputCol = inputCol + ${m[0]}) {
          ${Gu($,w)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${I}; inputRow = inputRow + ${m[1]}) {
            for (var inputCol = localCol; inputCol < ${G}; inputCol = inputCol + ${m[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${w?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${g}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${m[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${$?`mm_Asub[k][localRow + innerRow * ${m[1]}];`:`mm_Asub[localRow + innerRow * ${m[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${m[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${m[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${j};

let tileRowA = i32(localId.y) * ${q};
let tileColA = i32(localId.x) * ${V};
let tileRowB = i32(localId.y) * ${Q};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${q}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${V}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Gu($,w)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${Q}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${w?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${g}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${hf($)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${g}, ${Z}>, ${H}>;
  var<workgroup> mm_Bsub : array<array<${g}, ${G}>, ${I}>;
  const rowPerThread = ${d[1]};
  const colPerThread = ${d[0]};
  const tileInner = ${I};

@compute @workgroup_size(${m[0]}, ${m[1]}, ${m[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${D?"0":"i32(globalId.z)"};
    ${w?`let batchIndices = ${w.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${D?`${Math.ceil(F/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${D?`i32(globalId.z) * ${F}`:"0"};

    var acc : array<array<${g}, colPerThread>, rowPerThread>;
    ${X}
  }
`},gf=(d,m,g,w,$=!1)=>{let[I,D,F,U]=w,j=ve(w[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Ae(d,j)} {
      var value = ${Ae(d,j)}(0.0);
      let col = colIn * ${d};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${D.type.indices};
        ${ir("aIndices",D,D.rank-2,I.rank,"batchIndices")}
        ${D.indicesSet("aIndices",D.rank-2,"u32(row)")}
        ${D.indicesSet("aIndices",D.rank-1,"u32(colIn)")}
        value = ${D.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Ae(d,j)} {
      var value = ${Ae(d,j)}(0.0);
      let col = colIn * ${d};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${F.type.indices};
        ${ir("bIndices",F,F.rank-2,I.rank,"batchIndices")}
        ${F.indicesSet("bIndices",F.rank-2,"u32(row)")}
        ${F.indicesSet("bIndices",F.rank-1,"u32(colIn)")}
        value = ${F.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Ae(d,j)}) {
      let col = colIn * ${d};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${m?`value = value + ${$?"bias[colIn]":`${Ae(d,j)}(bias[row])`};`:""}
        ${g}
        ${U.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},ar=(d,m,g,w,$=!1,I)=>{let D=d[0].dims,F=d[1].dims,U=D.slice(0,-2),j=F.slice(0,-2),G=w?w.slice(0,-2):g.slice(0,-2),Z=E$1.size(G),H=D[D.length-2],q=D[D.length-1],V=F[F.length-1],Q=q%4===0&&V%4===0,X=H<=8?[4,1,1]:[4,4,1],re=[8,8,1],J=[Math.ceil(V/re[0]/X[0]),Math.ceil(H/re[1]/X[1]),Math.ceil(Z/re[2]/X[2])],se=Q?4:1,ie=[...U,H,q/se],oe=ie.length,pe=[...j,q,V/se],de=pe.length,ge=[Z,H,V/se],ce=[{type:6,data:H},{type:6,data:V},{type:6,data:q}];Ze(m,ce),ce.push(...W(G,ie,pe));let Ie=["rank","rank"],fe=d.length>2;fe&&(ce.push(...W(d[2].dims)),Ie.push("rank")),ce.push(...W(ge));let Te=ut=>{let ze=G.length,Ce=Kr("batchDims",d[0].dataType,ze,1),Fe=ve(d[0].dataType),Et=P("a",d[0].dataType,oe,se),bt=P("b",d[1].dataType,de,se),ht=N$1("result",d[0].dataType,ge.length,se),Zt=[Et,bt];if(fe){let dt=$?se:1;Zt.push(P("bias",d[2].dataType,d[2].dims.length,dt))}let Ye=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Qe(m,Ye);let _t=ve(ht.type.tensor),Vt=Ke(m,ht.type.value,_t),Lt=gf(se,fe,Vt,[Ce,Et,bt,ht],$);return`
  ${ut.registerUniforms(Ye).registerInternalVariables(Ce).declareVariables(...Zt,ht)}
  ${Lt}
  ${Q?wo(X,re,Fe,Ce):vo(X,re,Fe,Ce)}
                   `};return{name:"MatMul",shaderCache:{hint:`${X};${m.activation};${Q};${$}`,inputDependencies:Ie},getRunData:()=>({outputs:[{dims:I?I(g):g,dataType:d[0].dataType}],dispatchGroup:{x:J[0],y:J[1],z:J[2]},programUniforms:ce}),getShaderSource:Te}}}),yf,Hu,Fu=L$1(()=>{ee(),et(),ue(),Tt(),tn(),Wu(),on(),yf=(d,m,g,w,$=!1,I,D=4,F=4,U=4,j="f32")=>{let G=ce=>{switch(ce){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${j}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${ce} is not supported.`)}},Z=ce=>{switch(ce){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${ce} is not supported.`)}},H=d?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,q=d?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,V=d?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",Q=d?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",X=d?"row":"col",re=d?"col":"row",J=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${d?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${X} / outWidth;
    let outCol = ${X} % outWidth;

    let WRow = ${re} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${re} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${re} % inChannels;
    var resData = ${Ae(D,j)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${V} && xCol >= 0 && xCol < ${Q}) {
      ${H}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${G(D)}
    }
    return resData;`,se=d?m&&w?`
    let col = colIn * ${D};
    ${J}`:`
    let col = colIn * ${D};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${J}
    }
    return ${Ae(D,j)}(0.0);`:w&&g?`
    let col = colIn * ${D};
    ${J}`:`
    let col = colIn * ${D};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${J}
    }
    return ${Ae(D,j)}(0.0);`,ie=d?w&&g?Z(F):`
    let col = colIn * ${F};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${Z(F)}
    }
    return ${Ae(F,j)}(0.0);`:`
    let col = colIn * ${F};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${Z(F)}
    }
    return ${Ae(F,j)}(0.0);`,oe=Ae(U,j),pe=Ae(d?D:F,j),de=Ae(d?F:D,j),ge=Ke(I,oe,j);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${pe} {
      ${d?se:ie}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${de} {
      ${d?ie:se}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${oe}) {
      let col = colIn * ${U};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${d?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${q}
      ${Vu($)}
      ${ge}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Hu=(d,m,g,w,$,I,D,F,U)=>{let j=m.format==="NHWC",G=j?d[0].dims[3]:d[0].dims[1],Z=g[0],H=j?g[2]:g[3],q=j?g[1]:g[2],V=j?g[3]:g[1],Q=j&&(G%4===0||G%3===0)&&V%4===0,X=j?V:H*q,re=j?H*q:V,J=[8,8,1],se=w<=8?[4,1,1]:[4,4,1],ie=[Math.ceil(X/J[0]/se[0]),Math.ceil(re/J[1]/se[1]),Math.ceil(Z/J[2]/se[2])];le("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${ie}`);let oe=Q?j&&G%4!==0?3:4:1,pe=J[1]*se[1],de=J[0]*se[0],ge=Math.max(J[0]*oe,J[1]),ce=w%pe===0,Ie=$%de===0,fe=I%ge===0,Te=Q?[oe,4,4]:[1,1,1],ut=[{type:6,data:w},{type:6,data:$},{type:6,data:I},{type:6,data:[m.pads[0],m.pads[1]]},{type:6,data:m.strides},{type:6,data:m.dilations}];Ze(m,ut),ut.push(...W(d[0].dims,d[1].dims));let ze=["rank","rank"];D&&(ut.push(...W(d[2].dims)),ze.push("rank")),ut.push(...W(g));let Ce=Fe=>{let Et=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Qe(m,Et);let bt=Q?4:1,ht=ve(d[0].dataType),Zt=`
      fn setOutputAtIndex(flatIndex : i32, value : ${Q?`vec4<${ht}>`:ht}) {
        result[flatIndex] = ${Q?`vec4<${ht}>`:ht}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${Q?`vec4<${ht}>`:ht}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${Q?"/ 4":""}, value);
      }`,Ye=P("x",d[0].dataType,d[0].dims.length,oe===3?1:oe),_t=P("w",d[1].dataType,d[1].dims.length,bt),Vt=[Ye,_t],Lt=N$1("result",d[0].dataType,g.length,bt);if(D){let dt=P("bias",d[2].dataType,d[2].dims.length,bt);Vt.push(dt),Zt+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${Q?`vec4<${ht}>`:ht} {
          return bias[coords.${j?"w":"y"}${Q?"/ 4":""}];
        }`}return`
        ${Lu("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Fe.registerUniforms(Et).declareVariables(...Vt,Lt)}
        ${Zt}
        ${yf(j,ce,Ie,fe,D,m,Te[0],Te[1],Te[2],ht)}
        ${Q?wo(se,J,ht,void 0,!j,ge):vo(se,J,ht,void 0,!j,ge,!1,void 0,F)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${m.cacheKey};${oe};${Q};${ce};${Ie};${fe};${pe};${de};${ge}`,inputDependencies:ze},getRunData:()=>({outputs:[{dims:U?U(g):g,dataType:d[0].dataType}],dispatchGroup:{x:ie[0],y:ie[1],z:ie[2]},programUniforms:ut}),getShaderSource:Ce}}}),bf,qu,an,_f,ju,wf,Ku,Zu,Qu=L$1(()=>{ee(),et(),ae(),ue(),Tt(),tn(),bf=d=>{let m=1;for(let g=0;g<d.length;g++)m*=d[g];return m},qu=d=>typeof d=="number"?[d,d,d]:d,an=(d,m)=>m<=1?d:d+(d-1)*(m-1),_f=(d,m,g,w=1)=>{let $=an(m,w);return Math.floor((d[0]*(g-1)-g+$)/2)},ju=(d,m,g,w,$)=>{$==null&&($=_f(d,m[0],w[0]));let I=[0,0,0,g];for(let D=0;D<3;D++)d[D]+2*$>=m[D]&&(I[D]=Math.trunc((d[D]-m[D]+2*$)/w[D]+1));return I},wf=(d,m,g,w,$,I,D,F,U,j)=>{let G,Z,H,q;if(d==="VALID"&&(d=0),typeof d=="number"){G={top:d,bottom:d,left:d,right:d,front:d,back:d};let V=ju([m,g,w,1],[F,U,j],1,[$,I,D],d);Z=V[0],H=V[1],q=V[2]}else if(Array.isArray(d)){if(!d.every((Q,X,re)=>Q===re[0]))throw Error(`Unsupported padding parameter: ${d}`);G={top:d[0],bottom:d[1],left:d[2],right:d[3],front:d[4],back:d[5]};let V=ju([m,g,w,1],[F,U,j],1,[$,I,D],d[0]);Z=V[0],H=V[1],q=V[2]}else if(d==="SAME_UPPER"){Z=Math.ceil(m/$),H=Math.ceil(g/I),q=Math.ceil(w/D);let V=(Z-1)*$+F-m,Q=(H-1)*I+U-g,X=(q-1)*D+j-w,re=Math.floor(V/2),J=V-re,se=Math.floor(Q/2),ie=Q-se,oe=Math.floor(X/2),pe=X-oe;G={top:se,bottom:ie,left:oe,right:pe,front:re,back:J}}else throw Error(`Unknown padding parameter: ${d}`);return{padInfo:G,outDepth:Z,outHeight:H,outWidth:q}},Ku=(d,m,g,w,$,I=!1,D="channelsLast")=>{let F,U,j,G,Z;if(D==="channelsLast")[F,U,j,G,Z]=d;else if(D==="channelsFirst")[F,Z,U,j,G]=d;else throw new Error(`Unknown dataFormat ${D}`);let[H,,q,V,Q]=m,[X,re,J]=qu(g),[se,ie,oe]=qu(w),pe=an(q,se),de=an(V,ie),ge=an(Q,oe),{padInfo:ce,outDepth:Ie,outHeight:fe,outWidth:Te}=wf($,U,j,G,X,re,J,pe,de,ge),ut=I?H*Z:H,ze=[0,0,0,0,0];return D==="channelsFirst"?ze=[F,ut,Ie,fe,Te]:D==="channelsLast"&&(ze=[F,Ie,fe,Te,ut]),{batchSize:F,dataFormat:D,inDepth:U,inHeight:j,inWidth:G,inChannels:Z,outDepth:Ie,outHeight:fe,outWidth:Te,outChannels:ut,padInfo:ce,strideDepth:X,strideHeight:re,strideWidth:J,filterDepth:q,filterHeight:V,filterWidth:Q,effectiveFilterDepth:pe,effectiveFilterHeight:de,effectiveFilterWidth:ge,dilationDepth:se,dilationHeight:ie,dilationWidth:oe,inShape:d,outShape:ze,filterShape:m}},Zu=(d,m,g,w,$,I)=>{let D=I==="channelsLast";D?d[0].dims[3]:d[0].dims[1];let F=[64,1,1],U={x:g.map((X,re)=>re)},j=[Math.ceil(bf(U.x.map(X=>g[X]))/F[0]),1,1];le("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${j}`);let G=1,Z=E$1.size(g),H=[{type:12,data:Z},{type:12,data:w},{type:12,data:$},{type:12,data:m.strides},{type:12,data:m.dilations}];Ze(m,H),H.push(...W(d[0].dims,d[1].dims));let q=["rank","rank"],V=d.length===3;V&&(H.push(...W(d[2].dims)),q.push("rank")),H.push(...W(g));let Q=X=>{let re=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:w.length},{name:"pads",type:"u32",length:$.length},{name:"strides",type:"u32",length:m.strides.length},{name:"dilations",type:"u32",length:m.dilations.length}];Qe(m,re);let J=1,se=ve(d[0].dataType),ie=P("x",d[0].dataType,d[0].dims.length,G),oe=P("W",d[1].dataType,d[1].dims.length,J),pe=[ie,oe],de=N$1("result",d[0].dataType,g.length,J),ge="";if(V){let fe=P("bias",d[2].dataType,d[2].dims.length,J);pe.push(fe),ge+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${se} {
          return bias[${D?K("coords",4,5):K("coords",1,5)}];
        }`}let ce=Ae(G,se),Ie=Ke(m,ce,se);return`
            ${ge}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${ie.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${oe.getByIndices("aIndices")};
            }
          ${X.registerUniforms(re).declareVariables(...pe,de)}
          ${X.mainStart()}
          ${X.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${de.offsetToIndices("global_idx")};
              let batch = ${K("coords",0,ie.rank)};
              let d2 = ${D?K("coords",ie.rank-1,ie.rank):K("coords",1,ie.rank)};
              let xFRCCorner = vec3<u32>(${D?K("coords",1,ie.rank):K("coords",2,ie.rank)},
              ${D?K("coords",2,ie.rank):K("coords",3,ie.rank)},
              ${D?K("coords",3,ie.rank):K("coords",4,ie.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${D?K("uniforms.x_shape",1,ie.rank):K("uniforms.x_shape",2,ie.rank)};
              let xShapeZ = ${D?K("uniforms.x_shape",2,ie.rank):K("uniforms.x_shape",3,ie.rank)};
              let xShapeW = ${D?K("uniforms.x_shape",3,ie.rank):K("uniforms.x_shape",4,ie.rank)};
              let xShapeU = ${D?K("uniforms.x_shape",4,ie.rank):K("uniforms.x_shape",1,ie.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${D?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${D?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${D?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${D?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${V?"value = value + getBiasByOutputCoords(coords)":""};
              ${Ie}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${m.cacheKey};${D};${G};${V}`,inputDependencies:q},getRunData:()=>({outputs:[{dims:g,dataType:d[0].dataType}],dispatchGroup:{x:j[0],y:j[1],z:j[2]},programUniforms:H}),getShaderSource:Q}}}),Yu,Xu,Ju=L$1(()=>{ee(),ae(),ue(),Tt(),Yu=(d,m,g,w)=>{let $=d.length>2,I=$?"value += b[output_channel];":"",D=d[0].dims,F=d[1].dims,U=m.format==="NHWC",j=U?g[3]:g[1],G=j/m.group,Z=U&&G>=4?he(j):1,H=E$1.size(g)/Z,q=[{type:12,data:H},{type:12,data:m.dilations},{type:12,data:[m.strides[0],m.strides[1]]},{type:12,data:[m.pads[0],m.pads[1]]},{type:12,data:G}];Ze(m,q),q.push(...W(D,[F[0],F[1],F[2],F[3]/Z]));let V=$?["rank","rank","rank"]:["rank","rank"];q.push(...W([g[0],g[1],g[2],g[3]/Z]));let Q=X=>{let re=N$1("output",d[0].dataType,g.length,Z),J=ve(re.type.tensor),se=Ke(m,re.type.value,J),ie=P("x",d[0].dataType,D.length),oe=P("w",d[1].dataType,F.length,Z),pe=[ie,oe];$&&pe.push(P("b",d[2].dataType,d[2].dims,Z));let de=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:m.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Qe(m,de);let ge=U?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${ie.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${oe.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${ie.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${oe.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${X.registerUniforms(de).declareVariables(...pe,re)}

  ${X.mainStart()}
    ${X.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${re.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${U?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${U?1:2}], outputIndices[${U?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${Z} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${U?2:1}];

    var value: ${re.type.value} = ${re.type.value}(0);
    ${ge}
    ${I}
    ${se}
    ${re.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${m.cacheKey}_${Z}`,inputDependencies:V},getRunData:()=>({outputs:[{dims:w?w(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:q}),getShaderSource:Q}},Xu=(d,m,g,w)=>{let $=d.length>2,I=he(g[3]),D=he(g[2]),F=E$1.size(g)/I/D,U=[d[0].dims[0],d[0].dims[1],d[0].dims[2],d[0].dims[3]/I],j=[d[1].dims[0],d[1].dims[1],d[1].dims[2],d[1].dims[3]/I],G=[g[0],g[1],g[2],g[3]/I],Z=[{type:12,data:F},{type:6,data:[m.strides[0],m.strides[1]]},{type:6,data:[m.pads[0],m.pads[1]]}];Ze(m,Z),Z.push(...W(U,j,G));let H=(D-1)*m.strides[1]+j[1],q=V=>{let Q=N$1("output",d[0].dataType,G.length,I),X=ve(Q.type.tensor),re=Ke(m,Q.type.value,X),J=P("x",d[0].dataType,U.length,I),se=P("w",d[1].dataType,j.length,I),ie=[J,se];$&&ie.push(P("b",d[2].dataType,d[2].dims,I));let oe=$?"value += b[output_channel];":"",pe=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Qe(m,pe),`
  ${V.registerUniforms(pe).declareVariables(...ie,Q)}
  ${V.mainStart()}
    ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${D}u;
    let col = (index1 % width1) * ${D}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${J.type.value}, ${H}>;
    var values: array<${Q.type.value}, ${D}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${j[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${H}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${J.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${J.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${j[1]}; w_width++) {
          let w_val = ${se.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${D}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${D}u; i++) {
      var value = values[i];
      ${oe}
      ${re}
      ${Q.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${m.cacheKey};${I};${D};${H};${j[0]};${j[1]}`,inputDependencies:$?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:w?w(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(F/64)},programUniforms:Z}),getShaderSource:q}}}),vf,$o,$f,xo,So,el,xf,Sf,To,tl=L$1(()=>{ae(),Fu(),Qu(),on(),Ju(),Tt(),nn(),ct(),vf=(d,m,g,w,$,I)=>{let D=d[0],F=d.slice(I?1:2,I?3:4),U=F.length,j=m[0],G=m.slice(2).map((H,q)=>H+(H-1)*(g[q]-1)),Z=F.map((H,q)=>H+w[q]+w[q+U]).map((H,q)=>Math.floor((H-G[q]+$[q])/$[q]));return Z.splice(0,0,D),Z.splice(I?3:1,0,j),Z},$o=[2,3,1,0],$f=(d,m)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length>5)throw new Error("greater than 5D is not supported");if(d[0].dims.length!==d[1].dims.length)throw new Error("filter does not have same dimension as input");let g=d[0].dims[m.format==="NHWC"?d[0].dims.length-1:1],w=d[1].dims[1]*m.group;if(g!==w)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(d.length===3&&(d[2].dims.length!==1||d[1].dims[0]!==d[2].dims[0]))throw new Error("invalid bias");let $=d[0].dims.length-2;if(m.dilations.length!==$)throw new Error(`dilations should be ${$}D`);if(m.strides.length!==$)throw new Error(`strides should be ${$}D`);if(m.pads.length!==$*2)throw new Error(`pads should be ${$*2}D`);if(m.kernelShape.length!==0&&m.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape")},xo=(d,m)=>{let g=d.kernelShape.slice();g.length<m[1].dims.length-2&&g.push(...Array(m[1].dims.length-2-g.length).fill(0));for(let I=2;I<m[1].dims.length;++I)g[I-2]===0&&(g[I-2]=m[1].dims[I]);let w=d.pads.slice();Dt.adjustPadsBasedOnAutoPad(m[0].dims,d.strides,d.dilations,g,w,d.format==="NHWC",d.autoPad);let $=Object.assign({},d);return Object.assign($,{kernelShape:g,pads:w}),$},So=d=>{let m=en(d),g=d.format,w=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][d.auto_pad],$=d.dilations,I=d.group,D=d.kernel_shape,F=d.pads,U=d.strides,j=d.w_is_const();return{autoPad:w,format:g,dilations:$,group:I,kernelShape:D,pads:F,strides:U,wIsConst:j,...m,cacheKey:`${d.format};${m.activation};`}},el=(d,m,g,w)=>{let $=g.format==="NHWC",I=vf(m[0].dims,m[1].dims,g.dilations,g.pads,g.strides,$);if(g.group!==1){let pe=[m[0]];if($){let de=d.kernelCustomData.wT??d.compute(Pe(m[1],$o),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=de),pe.push(de)}else pe.push(m[1]);m.length===3&&pe.push(m[2]),!d.adapterInfo.isArchitecture("ampere")&&$&&m[1].dims[0]===g.group&&m[1].dims[1]===1&&g.dilations[0]===1&&g.dilations[1]===1?d.compute(Xu(pe,g,I,w),{inputs:pe}):d.compute(Yu(pe,g,I,w),{inputs:pe});return}let D=m.length===3,F=m[0].dims[$?1:2],U=m[0].dims[$?2:3],j=m[0].dims[$?3:1],G=m[1].dims[2],Z=m[1].dims[3],H=I[$?1:2],q=I[$?2:3],V=I[$?3:1],Q=$&&G===F&&Z===U&&g.pads[0]===0&&g.pads[1]===0;if(Q||G===1&&Z===1&&g.dilations[0]===1&&g.dilations[1]===1&&g.strides[0]===1&&g.strides[1]===1&&g.pads[0]===0&&g.pads[1]===0){let pe=I[0],de,ge,ce,Ie=[];if($){let ut=d.kernelCustomData.wT??d.compute(Pe(m[1],$o),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];if(g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=ut),Q){let ze=F*U*j;de=m[0].reshape([1,pe,ze]),ge=ut.reshape([1,ze,V]),ce=[1,pe,V]}else de=m[0].reshape([pe,F*U,j]),ge=ut.reshape([1,j,V]),ce=[pe,H*q,V];Ie.push(de),Ie.push(ge)}else de=m[0].reshape([pe,j,F*U]),ge=m[1].reshape([1,V,j]),ce=[pe,V,H*q],Ie.push(ge),Ie.push(de);D&&Ie.push(m[2]);let fe=ce[2],Te=Ie[0].dims[Ie[0].dims.length-1];fe<8&&Te<8?d.compute(rn(Ie,g,I,ce,$,w),{inputs:Ie}):d.compute(ar(Ie,g,I,ce,$,w),{inputs:Ie});return}let X=!0,re=d.kernelCustomData.wT??d.compute(Pe(m[1],$o),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=re);let J=[m[0],re];D&&J.push(m[2]);let se=$?H*q:V,ie=$?V:H*q,oe=G*Z*j;d.compute(Hu(J,g,I,se,ie,oe,D,X,w),{inputs:J})},xf=(d,m)=>{let g=m.format==="NHWC",w=[d.inputs[0].reshape(g?[d.inputs[0].dims[0],1,d.inputs[0].dims[1],d.inputs[0].dims[2]]:[d.inputs[0].dims[0],d.inputs[0].dims[1],1,d.inputs[0].dims[2]]),d.inputs[1].reshape([d.inputs[1].dims[0],d.inputs[1].dims[1],1,d.inputs[1].dims[2]])];d.inputs.length===3&&w.push(d.inputs[2]);let $=[0,m.pads[0],0,m.pads[1]],I=[1].concat(m.strides),D=[1].concat(m.dilations),F=[1].concat(m.kernelShape),U=xo({...m,pads:$,strides:I,dilations:D,kernelShape:F},w);el(d,w,U,j=>g?[j[0],j[2],j[3]]:[j[0],j[1],j[3]])},Sf=(d,m,g)=>{let w=g.format==="NHWC"?"channelsLast":"channelsFirst",$=xo(g,m),I=g.autoPad==="NOTSET"?g.pads:g.autoPad,D=Ku(m[0].dims,m[1].dims,g.strides,g.dilations,I,!1,w);d.compute(Zu(m,$,D.outShape,[D.filterDepth,D.filterHeight,D.filterWidth],[D.padInfo.front,D.padInfo.top,D.padInfo.left],w))},To=(d,m)=>{if($f(d.inputs,m),d.inputs[0].dims.length===3)xf(d,m);else if(d.inputs[0].dims.length===5)Sf(d,d.inputs,m);else{let g=xo(m,d.inputs);el(d,d.inputs,g)}}}),rl,nl=L$1(()=>{ee(),et(),ae(),ue(),rl=(d,m,g)=>{let w=d.length>2,$=m.outputShape,I=m.format==="NHWC",D=m.group,F=d[1].dims,U=F[2]/D,j=F[3],G=I?he(U):1,Z=I&&j===1&&U>=4,H=Z?Math.floor(U/4)*4:Math.floor(U/G)*G,q=U-H,V=I?he(j):1,Q=I?j===1?G:V:1,X=E$1.size($)/V,re=[Math.ceil(X/64),1,1];le("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${re}`);let J=["rank","rank"],se=[m.strides[0],m.strides[1]],ie=[m.kernelShape[I?1:2],m.kernelShape[I?2:3]],oe=[m.dilations[0],m.dilations[1]],pe=[ie[0]+(m.dilations[0]<=1?0:(m.kernelShape[I?1:2]-1)*(m.dilations[0]-1)),ie[1]+(m.dilations[1]<=1?0:(m.kernelShape[I?2:3]-1)*(m.dilations[1]-1))],de=[pe[0]-1-Math.floor((m.pads[0]+m.pads[2])/2),pe[1]-1-Math.floor((m.pads[1]+m.pads[3])/2)],ge=[{type:12,data:X},{type:12,data:se},{type:12,data:ie},{type:12,data:oe},{type:12,data:pe},{type:6,data:de},{type:12,data:H},{type:12,data:U},{type:12,data:j},...W(d[0].dims,d[1].dims)];w&&(ge.push(...W(d[2].dims)),J.push("rank")),ge.push(...W($));let ce=Ie=>{let fe=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:se.length},{name:"filter_dims",type:"u32",length:ie.length},{name:"dilations",type:"u32",length:ie.length},{name:"effective_filter_dims",type:"u32",length:pe.length},{name:"pads",type:"i32",length:de.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],Te=ve(d[0].dataType),ut=I?1:2,ze=I?2:3,Ce=I?3:1,Fe=P("W",d[1].dataType,d[1].dims.length,Q),Et=P("Dy",d[0].dataType,d[0].dims.length,G),bt=[Et,Fe];w&&bt.push(P("bias",d[2].dataType,[$[Ce]].length,V));let ht=N$1("result",d[0].dataType,$.length,V),Zt=()=>{let Vt="";if(Z)G===4?Vt+=`
        let xValue = ${Et.getByOffset("x_offset")};
        let wValue = ${Fe.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:G===2?Vt+=`
          dotProd = dotProd + dot(vec4<${Te}>(${Et.getByOffset("x_offset")}, ${Et.getByOffset("x_offset + 1u")}), vec4<${Te}>(${Fe.getByOffset("w_offset")}, ${Fe.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:G===1&&(Vt+=`
          dotProd = dotProd + dot(vec4<${Te}>(${Et.getByOffset("x_offset")}, ${Et.getByOffset("x_offset + 1u")}, ${Et.getByOffset("x_offset + 2u")}, ${Et.getByOffset("x_offset + 3u")}), vec4<${Te}>(${Fe.getByOffset("w_offset")}, ${Fe.getByOffset("w_offset + 1u")}, ${Fe.getByOffset("w_offset + 2u")}, ${Fe.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(Vt+=`
                  let xValue = ${I?Et.getByOffset(`${Et.indicesToOffset(`${Et.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${G}`):Et.get("batch","inputChannel","idyR","idyC")};
        `,G===1)Vt+=`
          let w_offset = ${Fe.indicesToOffset(`${Fe.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Fe.getByOffset(`w_offset / ${Q}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let Lt=0;Lt<G;Lt++)Vt+=`
            let wValue${Lt} = ${Fe.getByOffset(`${Fe.indicesToOffset(`${Fe.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${Lt}, wOutChannel)`)} / ${Q}`)};
            dotProd = dotProd + xValue[${Lt}] * wValue${Lt};`;return Vt},Ye=()=>{if(q===0)return"";if(!Z)throw new Error(`packInputAs4 ${Z} is not true.`);let Vt="";if(G===1){Vt+="dotProd = dotProd";for(let Lt=0;Lt<q;Lt++)Vt+=`
            + ${Et.getByOffset(`x_offset + ${Lt}`)} * ${Fe.getByOffset(`w_offset + ${Lt}`)}`;Vt+=";"}else if(G===2){if(q!==2)throw new Error(`Invalid inputChannelsRemainder ${q}.`);Vt+=`
          let xValue = ${Et.getByOffset("x_offset")};
          let wValue = ${Fe.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return Vt},_t=`
            let outputIndices = ${ht.offsetToIndices(`global_idx * ${V}`)};
            let batch = ${ht.indicesGet("outputIndices",0)};
            let d1 = ${ht.indicesGet("outputIndices",Ce)};
            let r = ${ht.indicesGet("outputIndices",ut)};
            let c = ${ht.indicesGet("outputIndices",ze)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ht.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${Te}(dyRCorner) + ${Te}(wR)) / ${Te}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${Te}(uniforms.Dy_shape[${ut}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${Te}(dyCCorner) + ${Te}(wC)) / ${Te}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${Te}(uniforms.Dy_shape[${ze}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${Z?`
                var x_offset = ${Et.indicesToOffset(`${Et.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${G};
                var w_offset = ${Fe.indicesToOffset(`${Fe.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${Q};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${Z?4:G}) {
                  ${Zt()}
                  inputChannel = inputChannel + ${Z?4:G};
                }
                ${Ye()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${w?` + bias[d1 / ${V}]`:""};
            ${ht.setByOffset("global_idx","value")};
          `;return`
    ${Ie.registerUniforms(fe).declareVariables(...bt,ht)}
      ${Ie.mainStart()}
      ${Ie.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${_t}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${m.cacheKey};${G}${Q}${V}${Z}${q}`,inputDependencies:J},getRunData:()=>({dispatchGroup:{x:re[0],y:re[1],z:re[2]},outputs:[{dims:g?g($):$,dataType:d[0].dataType}],programUniforms:ge}),getShaderSource:ce}}}),Tf,Cf,If,ol,il,Af,al,Ef,sl,ul=L$1(()=>{nl(),Tt(),ct(),Tf=(d,m,g,w,$,I)=>(d-1)*m+g+(w-1)*$+1-I,Cf=(d,m,g,w,$)=>{let I=Math.floor(d/2);m==="SAME_UPPER"?(g[w]=I,g[$]=d-I):m==="SAME_LOWER"&&(g[w]=d-I,g[$]=I)},If=(d,m,g,w,$,I,D,F,U,j)=>{let G=d.length-2,Z=j.length===0;U.length<G&&U.push(...Array(G-U.length).fill(0));let H=d[0],q=m[F?3:1]*$;for(let V=0,Q=d.length-G-(F?1:0);V<G;++V,++Q){let X=d[Q],re=Z?X*D[V]:j[V],J=Tf(X,D[V],I[V],m[Q],g[V],re);Cf(J,w,I,V,V+G),Z&&j.push(D[V]*(X-1)+U[V]+(m[Q]-1)*g[V]+1-I[V]-I[V+G])}j.splice(0,0,H),j.splice(F?3:1,0,q)},ol=(d,m)=>{let g=d.kernelShape.slice();if(d.kernelShape.length===0||d.kernelShape.reduce((Z,H)=>Z*H,1)===0){g.length=0;for(let Z=2;Z<m[1].dims.length;++Z)g.push(m[1].dims[Z])}let w=d.format==="NHWC";g.splice(0,0,m[1].dims[0]),g.splice(w?3:1,0,m[1].dims[1]);let $=d.pads.slice(),I=d.outputShape.slice(),D=d.outputPadding.slice(),F=m[0].dims,U=d.dilations.slice();if(U.reduce((Z,H)=>Z+H,0)===0){let Z=m[0].dims.length-2;U=new Array(Z).fill(1)}let j=d.strides.slice();if(j.reduce((Z,H)=>Z+H,0)===0){let Z=m[0].dims.length-2;j=new Array(Z).fill(1)}If(F,g,U,d.autoPad,d.group,$,j,w,D,I);let G=Object.assign({},d);return Object.assign(G,{kernelShape:g,pads:$,outputPadding:D,outputShape:I,dilations:U,strides:j}),G},il=d=>{let m=en(d),g=d.format,w=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof d.autoPad>"u"?0:d.autoPad],$=d.dilations,I=d.group,D=d.kernelShape,F=d.pads,U=d.strides,j=d.wIsConst(),G=d.outputPadding,Z=d.outputShape;return{autoPad:w,format:g,dilations:$,group:I,kernelShape:D,outputPadding:G,outputShape:Z,pads:F,strides:U,wIsConst:j,...m,cacheKey:`${d.format};${m.activation};`}},Af=(d,m)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length!==4&&d[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(d[0].dims.length!==d[1].dims.length)throw new Error("filter does not have same dimension as input");let g=d[0].dims[m.format==="NHWC"?d[0].dims.length-1:1],w=d[1].dims[0];if(g!==w)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let $=d[1].dims[1]*m.group;if(d.length===3&&(d[2].dims.length!==1||d[2].dims[0]!==$))throw new Error("invalid bias");let I=d[0].dims.length-2;if(m.dilations.reduce((D,F)=>D+F,0)>0&&m.dilations.length!==I)throw new Error(`dilations should be ${I}D`);if(m.strides.reduce((D,F)=>D+F,0)>0&&m.strides.length!==I)throw new Error(`strides should be ${I}D`);if(m.pads.reduce((D,F)=>D+F,0)>0&&m.pads.length!==I*2)throw new Error(`pads should be ${I*2}D`);if(m.outputPadding.length!==I&&m.outputPadding.length!==0)throw new Error(`output_padding should be ${I}D`);if(m.kernelShape.reduce((D,F)=>D+F,0)>0&&m.kernelShape.length!==0&&m.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape");if(m.outputShape.length!==0&&m.outputShape.length!==d[0].dims.length-2)throw new Error("invalid output shape")},al=(d,m,g,w)=>{let $=d.kernelCustomData.wT??d.compute(Pe(m[1],[2,3,0,1]),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=$);let I=[m[0],$];m.length===3&&I.push(m[2]),d.compute(rl(I,g,w),{inputs:I})},Ef=(d,m)=>{let g=m.format==="NHWC",w=[d.inputs[0].reshape(g?[d.inputs[0].dims[0],1,d.inputs[0].dims[1],d.inputs[0].dims[2]]:[d.inputs[0].dims[0],d.inputs[0].dims[1],1,d.inputs[0].dims[2]]),d.inputs[1].reshape([d.inputs[1].dims[0],d.inputs[1].dims[1],1,d.inputs[1].dims[2]])];d.inputs.length===3&&w.push(d.inputs[2]);let $=m.kernelShape;($.length===0||$[0]===0)&&($=[d.inputs[1].dims[2]]);let I=m.dilations;(I.length===0||I[0]===0)&&(I=[1]);let D=m.strides;(D.length===0||D[0]===0)&&(D=[1]);let F=m.pads;F.length===0&&(F=[0,0]),F=[0,F[0],0,F[1]],D=[1].concat(D),I=[1].concat(I),$=[1].concat($);let U=m.outputPadding;U=[0].concat(U);let j=ol({...m,pads:F,strides:D,dilations:I,kernelShape:$,outputPadding:U},w);al(d,w,j,G=>g?[G[0],G[2],G[3]]:[G[0],G[1],G[3]])},sl=(d,m)=>{if(Af(d.inputs,m),d.inputs[0].dims.length===3)Ef(d,m);else{let g=ol(m,d.inputs);al(d,d.inputs,g)}}}),kf,ll,dl,cl=L$1(()=>{ee(),ae(),Se(),ue(),kf=(d,m,g,w)=>{let $=E$1.size(m),I=m.length,D=P("input",d,I),F=N$1("output",d,I),U=g.dataType===6?g.getInt32Array()[0]:Number(g.getBigInt64Array()[0]),j=E$1.normalizeAxis(U,I),G=Z=>{let H=` i32(${D.indicesGet("inputIndices","uniforms.axis")}) `,q=K("uniforms.input_shape","uniforms.axis",I),V=w.reverse?H+(w.exclusive?" + 1":""):"0",Q=w.reverse?q:H+(w.exclusive?"":" + 1");return`
                ${Z.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(D,F)}
                ${Z.mainStart()}
                  ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${F.offsetToIndices("global_idx")};
                  var sum = ${F.type.value}(0);
                  let first : i32 = ${V};
                  let last : i32 = ${Q};
                  for (var i : i32 = first; i < last; i++) {
                    ${D.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${D.getByIndices("inputIndices")};
                  }
                  ${F.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:w.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:m,dataType:d}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:[{type:12,data:$},{type:12,data:j},...W(m,m)]}),getShaderSource:G}},ll=(d,m)=>{let g=d.inputs[0].dims,w=d.inputs[0].dataType,$=d.inputs[1];d.compute(kf(w,g,$,m),{inputs:[0]})},dl=d=>{let m=d.exclusive===1,g=d.reverse===1;return te({exclusive:m,reverse:g})}}),Pf,Of,zf,pl,ml,fl=L$1(()=>{ee(),ae(),Se(),ue(),Pf=d=>{if(!d||d.length!==1)throw new Error("DepthToSpace requires 1 input.");if(d[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},Of=(d,m,g,w)=>{let $=[];$.push(`fn perm(i: ${w.type.indices}) -> ${g.type.indices} {
    var a: ${g.type.indices};`);for(let I=0;I<m;++I)$.push(g.indicesSet("a",d[I],`i[${I}]`));return $.push("return a;}"),$.join(`
`)},zf=(d,m)=>{let g,w,$,I,D,F,U=m.format==="NHWC",j=m.blocksize,G=m.mode==="DCR";U?([g,w,$,I]=d.dims,D=G?[g,w,$,j,j,I/j**2]:[g,w,$,I/j**2,j,j],F=G?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([g,w,$,I]=[d.dims[0],d.dims[2],d.dims[3],d.dims[1]],D=G?[g,j,j,I/j**2,w,$]:[g,I/j**2,j,j,w,$],F=G?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let Z=d.reshape(D),H=Z.dims.length,q=d.dataType,V=P("a",q,H),Q=N$1("output",q,H),X=re=>`
  ${re.registerUniform("output_size","u32").declareVariables(V,Q)}

  ${Of(F,H,V,Q)}

  ${re.mainStart()}
    ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${Q.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${Q.setByOffset("global_idx",V.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${d.dims};${m.blocksize};${m.mode}`,inputDependencies:["rank"]},getRunData:re=>{let J=U?[g,w*j,$*j,I/j**2]:[g,I/j**2,w*j,$*j],se=E$1.size(J),ie=Z.dims,oe=E$1.sortBasedOnPerm(ie,F);return{outputs:[{dims:J,dataType:re[0].dataType}],dispatchGroup:{x:Math.ceil(se/64)},programUniforms:[{type:12,data:se},...W(ie,oe)]}},getShaderSource:X}},pl=(d,m)=>{Pf(d.inputs),d.compute(zf(d.inputs[0],m))},ml=d=>te({blocksize:d.blocksize,mode:d.mode,format:d.format})}),Co,sn,hl,Df,Bf,Io,Ao,gl,Mf,yl,bl,_l=L$1(()=>{ee(),ae(),Se(),ue(),Co="[a-zA-Z]|\\.\\.\\.",sn="("+Co+")+",hl="^"+sn+"$",Df="("+sn+",)*"+sn,Bf="^"+Df+"$",Io=class{constructor(d=-1){this.symbolToIndices=new Map,this.inputIndex=d}addSymbol(d,m){let g=this.symbolToIndices.get(d);g===void 0?g=[m]:g.push(m),this.symbolToIndices.set(d,g)}},Ao=class{constructor(d,m){this.equation=m,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[g,w]=m.includes("->")?m.split("->",2):[m,""];if(!g.match(RegExp(Bf)))throw new Error("Invalid LHS term");if(g.split(",").forEach(($,I)=>{let D=d[I].dims.slice();if(!$.match(RegExp(hl)))throw new Error("Invalid LHS term");let F=this.processTerm($,!0,D,I);this.lhs.push(F)}),w==="")w+=[...this.symbolToInfo.entries()].filter(([$,I])=>I.count===1||$==="...").map(([$])=>$).join("");else if(!w.match(RegExp(sn)))throw new Error("Invalid RHS");w.match(RegExp(Co,"g"))?.forEach($=>{if($==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let I=this.symbolToInfo.get($);if(I===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(I.dimValue)}}),this.rhs=this.processTerm(w,!1,this.outputDims)}addSymbol(d,m,g){let w=this.symbolToInfo.get(d);if(w!==void 0){if(w.dimValue!==m&&w.count!==1)throw new Error("Dimension mismatch");w.count++,w.inputIndices.push(g)}else w={count:1,dimValue:m,inputIndices:[g]};this.symbolToInfo.set(d,w)}processTerm(d,m,g,w=-1){let $=g.length,I=!1,D=[],F=0;if(!d.match(RegExp(hl))&&!m&&d!=="")throw new Error("Invalid LHS term");let U=d.match(RegExp(Co,"g")),j=new Io(w);return U?.forEach((G,Z)=>{if(G==="..."){if(I)throw new Error("Only one ellipsis is allowed per input term");I=!0;let H=$-U.length+1;if(H<0)throw new Error("Ellipsis out of bounds");if(D=g.slice(F,F+H),this.hasEllipsis){if(this.ellipsisDims.length!==D.length||this.ellipsisDims.toString()!==D.toString())throw new Error("Ellipsis dimensions mismatch")}else if(m)this.hasEllipsis=!0,this.ellipsisDims=D;else throw new Error("Ellipsis must be specified in the LHS");for(let q=0;q<D.length;q++){let V=String.fromCharCode(48+q);j.addSymbol(V,Z+q),this.addSymbol(V,g[F++],w)}}else j.addSymbol(G,Z+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(G,g[F++],w)}),j}},gl=d=>d+"_max",Mf=(d,m,g,w)=>{let $=d.map(j=>j.length).map((j,G)=>P(`input${G}`,m,j)),I=E$1.size(w),D=N$1("output",m,w.length),F=[...g.symbolToInfo.keys()].filter(j=>!g.rhs.symbolToIndices.has(j)),U=j=>{let G=[],Z="var prod = 1.0;",H="var sum = 0.0;",q="sum += prod;",V=[],Q=[],X=[],re=[],J=g.symbolToInfo.size===g.rhs.symbolToIndices.size;g.symbolToInfo.forEach((ie,oe)=>{if(g.rhs.symbolToIndices.has(oe)){let pe=g.rhs.symbolToIndices.get(oe)?.[0];pe!==void 0&&g.lhs.forEach((de,ge)=>{if(ie.inputIndices.includes(ge)){let ce=de.symbolToIndices.get(oe);if(ce===void 0)throw new Error("Invalid symbol error");ce.forEach(Ie=>{G.push(`${$[ge].indicesSet(`input${ge}Indices`,Ie,D.indicesGet("outputIndices",pe))}`)})}})}else g.lhs.forEach((pe,de)=>{if(ie.inputIndices.includes(de)){let ge=pe.symbolToIndices.get(oe);if(ge===void 0)throw new Error("Invalid symbol error");ge.forEach(ce=>{V.push(`${$[de].indicesSet(`input${de}Indices`,ce,`${oe}`)}`)}),re.push(`prod *= ${$[de].getByIndices(`input${de}Indices`)};`)}}),Q.push(`for(var ${oe}: u32 = 0; ${oe} < uniforms.${gl(oe)}; ${oe}++) {`),X.push("}")});let se=J?[...G,`let sum = ${$.map((ie,oe)=>ie.getByIndices(`input${oe}Indices`)).join(" * ")};`]:[...G,H,...Q,...V,Z,...re,q,...X];return`
            ${j.registerUniforms(F.map(ie=>({name:`${gl(ie)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...$,D)}

            ${j.mainStart()}
            ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${D.offsetToIndices("global_idx")};
            ${$.map((ie,oe)=>`var input${oe}Indices: ${$[oe].type.indices};`).join(`
`)}
            ${se.join(`
`)};
            ${D.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:g.equation,inputDependencies:d.map(()=>"rank")},getRunData:()=>{let j=F.filter(Z=>g.symbolToInfo.has(Z)).map(Z=>({type:12,data:g.symbolToInfo.get(Z)?.dimValue||0}));j.push({type:12,data:I});let G=d.map((Z,H)=>[...W(Z)]).reduce((Z,H)=>Z.concat(H),j);return G.push(...W(w)),{outputs:[{dims:w,dataType:m}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:G}},getShaderSource:U}},yl=(d,m)=>{let g=new Ao(d.inputs,m.equation),w=g.outputDims,$=d.inputs.map((I,D)=>I.dims);d.compute(Mf($,d.inputs[0].dataType,g,w))},bl=d=>{let m=d.equation.replace(/\s+/g,"");return te({equation:m})}}),Rf,wl,Uf,Nf,vl,$l=L$1(()=>{ee(),ae(),ue(),Rf=d=>{if(!d||d.length!==2)throw new Error("Expand requires 2 input.");let m=d[0].dims,g=Array.from(d[1].getBigInt64Array(),Number),w=g.length<m.length?0:g.length-m.length,$=m.length<g.length?0:m.length-g.length;for(;w<g.length&&$<m.length;++w,++$)if(g[w]!==m[$]&&g[w]!==1&&m[$]!==1)throw new Error("Expand requires shape to be broadcastable to input")},wl=(d,m)=>{let g=d.length-m.length,w=[];for(let $=0;$<g;++$)w.push(d[$]);for(let $=0;$<m.length;++$)w.push(m[$]===1?d[$+g]:m[$]);return w},Uf=(d,m)=>d.length>m.length?wl(d,m):wl(m,d),Nf=d=>{let m=d[0].dims,g=Array.from(d[1].getBigInt64Array(),Number),w=Uf(m,g),$=d[0].dataType,I=$===9||E$1.size(m)===1,D=$===9||m.length>0&&m[m.length-1]%4===0?4:1,F=I||w.length>0&&w[w.length-1]%4===0?4:1,U=Math.ceil(E$1.size(w)/F),j=Z=>{let H=P("input",$,m.length,D),q=N$1("output",$,w.length,F),V;if($===9){let Q=(X,re,J="")=>`
          let outputIndices${re} = ${q.offsetToIndices(`outputOffset + ${re}u`)};
          let offset${re} = ${H.broadcastedIndicesToOffset(`outputIndices${re}`,q)};
          let index${re} = offset${re} / 4u;
          let component${re} = offset${re} % 4u;
          ${X}[${re}] = ${J}(${H.getByOffset(`index${re}`)}[component${re}]);
        `;V=`
        let outputOffset = global_idx * ${F};
        var data = vec4<u32>(0);
        ${Q("data",0,"u32")}
        ${Q("data",1,"u32")}
        ${Q("data",2,"u32")}
        ${Q("data",3,"u32")}
        ${q.setByOffset("global_idx","data")}
      }`}else V=`
        let outputIndices = ${q.offsetToIndices(`global_idx * ${F}`)};
        let inputOffset = ${H.broadcastedIndicesToOffset("outputIndices",q)};
        let data = ${q.type.value}(${H.getByOffset(`inputOffset / ${D}`)});
        ${q.setByOffset("global_idx","data")}
      }`;return`
    ${Z.registerUniform("vec_size","u32").declareVariables(H,q)}
    ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${V}`},G=[{type:12,data:U},...W(m,w)];return{name:"Expand",shaderCache:{hint:`${w.length};${D}${F}`,inputDependencies:["rank"]},getShaderSource:j,getRunData:()=>({outputs:[{dims:w,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:G})}},vl=d=>{Rf(d.inputs),d.compute(Nf(d.inputs),{inputs:[0]})}}),Vf,xl,Sl=L$1(()=>{ee(),ae(),ue(),Jr(),Vf=d=>{let m=d[0].dataType,g=E$1.size(d[0].dims),w=E$1.size(d[1].dims),$=w%4===0,I=D=>{let F=P("x",m,[1],4),U=P("bias",m,[1],4),j=N$1("y",m,[1],4),G=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],Z=q=>`
      let bias${q}_offset: u32 = (global_idx * 4 + ${q}) % uniforms.bias_size;
      let bias${q} = ${U.getByOffset(`bias${q}_offset / 4`)}[bias${q}_offset % 4];`,H=$?`
      let bias = ${U.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${Z(0)}${Z(1)}${Z(2)}${Z(3)}
      let bias = ${F.type.value}(bias0, bias1, bias2, bias3);`;return`${D.registerUniforms(G).declareVariables(F,U,j)}

    ${bo(ke(m))}

    ${D.mainStart(Bt)}
      ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${F.getByOffset("global_idx")};
      ${H}
      let x_in = x + bias;
      ${j.setByOffset("global_idx",_o("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${$}`,inputDependencies:["type","type"]},getShaderSource:I,getRunData:D=>({outputs:[{dims:D[0].dims,dataType:D[0].dataType}],programUniforms:[{type:12,data:Math.ceil(g/4)},{type:12,data:w}],dispatchGroup:{x:Math.ceil(g/Bt/4)}})}},xl=d=>{d.inputs.length<2||E$1.size(d.inputs[1].dims)===0?_u(d):d.compute(Vf(d.inputs))}}),Lf,Wf,Tl,Cl,Il=L$1(()=>{ee(),ae(),Se(),ue(),Lf=d=>{if(!d||d.length!==2)throw new Error("Gather requires 2 inputs.")},Wf=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g.length,I=E$1.normalizeAxis(m.axis,$),D=g.slice(0);D.splice(I,1,...w);let F=g[I],U=d[0].dataType===9?4:1,j=Math.ceil(E$1.size(D)/U),G=[{type:12,data:j},{type:6,data:F},{type:12,data:I},...W(d[0].dims,d[1].dims,D)],Z=H=>{let q=P("data",d[0].dataType,d[0].dims.length,U),V=P("inputIndices",d[1].dataType,d[1].dims.length),Q=N$1("output",d[0].dataType,D.length,U),X=J=>{let se=w.length,ie=`var indicesIndices${J}  = ${V.type.indices}(0);`;for(let oe=0;oe<se;oe++)ie+=`${se>1?`indicesIndices${J}[${oe}]`:`indicesIndices${J}`} = ${D.length>1?`outputIndices${J}[uniforms.axis + ${oe}]`:`outputIndices${J}`};`;ie+=`
          var idx${J} = ${V.getByIndices(`indicesIndices${J}`)};
          if (idx${J} < 0) {
            idx${J} = idx${J} + uniforms.axisDimLimit;
          }
          var dataIndices${J} : ${q.type.indices};
        `;for(let oe=0,pe=0;oe<$;oe++)oe===I?(ie+=`${$>1?`dataIndices${J}[${oe}]`:`dataIndices${J}`} = u32(idx${J});`,pe+=se):(ie+=`${$>1?`dataIndices${J}[${oe}]`:`dataIndices${J}`} = ${D.length>1?`outputIndices${J}[${pe}]`:`outputIndices${J}`};`,pe++);return ie},re;if(d[0].dataType===9){let J=(se,ie,oe="")=>`
          let outputIndices${ie} = ${Q.offsetToIndices(`outputOffset + ${ie}u`)};
          ${X(ie)};
          let offset${ie} = ${q.indicesToOffset(`dataIndices${ie}`)};
          let index${ie} = offset${ie} / 4u;
          let component${ie} = offset${ie} % 4u;
          ${se}[${ie}] = ${oe}(${q.getByOffset(`index${ie}`)}[component${ie}]);
        `;re=`
        let outputOffset = global_idx * ${U};
        var value = vec4<u32>(0);
        ${J("value",0,"u32")}
        ${J("value",1,"u32")}
        ${J("value",2,"u32")}
        ${J("value",3,"u32")}
        ${Q.setByOffset("global_idx","value")}
      `}else re=`
      let outputIndices = ${Q.offsetToIndices("global_idx")};
      ${X("")};
      let value = ${q.getByIndices("dataIndices")};
      ${Q.setByOffset("global_idx","value")};
      `;return`
      ${H.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(q,V,Q)}
      ${H.mainStart()}
        ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${re}
      }`};return{name:"Gather",shaderCache:{hint:m.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:D,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:G}),getShaderSource:Z}},Tl=d=>te({axis:d.axis}),Cl=(d,m)=>{let g=d.inputs;Lf(g),d.compute(Wf(d.inputs,m))}}),Gf,Al,El,kl=L$1(()=>{ee(),ae(),ue(),Gf=(d,m,g,w,$,I,D,F,U)=>{let j=[{type:12,data:I},{type:12,data:w},{type:12,data:$},{type:12,data:g},{type:12,data:D},{type:12,data:F},{type:12,data:U}],G=[I];j.push(...W(m.dims,G));let Z=H=>{let q=P("indices_data",m.dataType,m.dims.length),V=N$1("input_slice_offsets_data",12,1,1),Q=[q,V],X=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:$.length},{name:"sizes_from_slice_dims_data",type:"u32",length:g.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${H.registerUniforms(X).declareVariables(...Q)}
  ${H.mainStart()}
    ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${$.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${g.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return d.compute({name:"computeSliceOffsets",shaderCache:{hint:`${$.length}_${g.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:G,dataType:d.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:j}),getShaderSource:Z},{inputs:[m],outputs:[-1]})[0]},Al=(d,m)=>{let g=d.inputs,w=g[0].dims,$=g[0].dataType,I=g[1].dims,D=I[I.length-1],F=E$1.sizeToDimension(I,I.length-1),U=E$1.sizeFromDimension(w,m.batchDims+D),j=E$1.sizeToDimension(w,m.batchDims),G=E$1.sizeFromDimension(w,m.batchDims),Z=F/j,H=new Array(D),q=U;for(let ie=0;ie<D;++ie)H[D-1-ie]=q,q*=w[m.batchDims+D-1-ie];let V=Gf(d,g[1],H,m.batchDims,w,F,Z,G,D),Q=m.batchDims+D;if(Q>w.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let X=I.slice(0,-1).concat(w.slice(Q)),re=E$1.size(X),J=[{type:12,data:re},{type:12,data:U},...W(g[0].dims,V.dims,X)],se=ie=>{let oe=P("data",g[0].dataType,g[0].dims.length),pe=P("slice_offsets",12,V.dims.length),de=N$1("output",g[0].dataType,X.length);return`
          ${ie.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(oe,pe,de)}
            ${ie.mainStart()}
            ${ie.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};d.compute({name:"GatherND",shaderCache:{hint:m.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:X,dataType:$}],dispatchGroup:{x:Math.ceil(re/64)},programUniforms:J}),getShaderSource:se},{inputs:[g[0],V]})},El=d=>({batchDims:d.batch_dims,cacheKey:""})}),Hf,Ff,Pl,Ol,zl=L$1(()=>{ee(),ae(),Se(),ue(),Hf=(d,m)=>{if(d.length<3||d.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let g=E$1.normalizeAxis(m.quantizeAxis,d[0].dims.length),w=m.blockSize,$=d[0],I=d[2],D=d.length===4?d[3]:void 0;if(I.dims.length!==$.dims.length||!$.dims.map((F,U)=>U===g?Math.ceil(F/w)===I.dims[U]:F===I.dims[U]).reduce((F,U)=>F&&U,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(D){if(D.dataType!==$.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(D.dims.length!==I.dims.length||!D.dims.map((F,U)=>F===I.dims[U]).reduce((F,U)=>F&&U,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},Ff=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g.length,I=E$1.normalizeAxis(m.gatherAxis,$),D=E$1.normalizeAxis(m.quantizeAxis,$),F=g.slice(0);F.splice(I,1,...w);let U=E$1.size(F),j=d[2].dataType,G=d[0].dataType===22,Z=[{type:12,data:U},{type:12,data:D},{type:12,data:I},{type:12,data:m.blockSize},...W(...d.map((q,V)=>q.dims),F)],H=q=>{let V=P("data",d[0].dataType,d[0].dims.length),Q=P("inputIndices",d[1].dataType,d[1].dims.length),X=P("scales",d[2].dataType,d[2].dims.length),re=d.length>3?P("zeroPoint",d[3].dataType,d[3].dims.length):void 0,J=N$1("output",j,F.length),se=[V,Q,X];re&&se.push(re);let ie=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${q.registerUniforms(ie).declareVariables(...se,J)}
        ${q.mainStart()}
        let output_indices = ${J.offsetToIndices("global_idx")};
        var indices_indices = ${Q.type.indices}(0);
        ${w.length>1?`
          for (var i: u32 = 0; i < ${w.length}; i++) {
            let index = ${J.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${Q.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${J.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${V.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${J.indicesGet("output_indices","i")};
          ${V.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${Q.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${g[I]};
        }
        ${V.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${F.length}; i++) {
          let index = ${J.indicesGet("output_indices",`i + ${w.length} - 1`)};
          ${V.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${V.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${V.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${G?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${X.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${X.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${X.getByIndices("scale_indices")};
        ${re?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${re.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${re.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${G?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${ke(j)}(quantized_data - zero_point) * scale;
        ${J.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${m.cacheKey};${d.filter((q,V)=>V!==1).map(q=>q.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:d.length},(q,V)=>"rank")},getRunData:()=>({outputs:[{dims:F,dataType:j}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:Z}),getShaderSource:H}},Pl=(d,m)=>{let g=d.inputs;Hf(g,m),d.compute(Ff(d.inputs,m))},Ol=d=>te({blockSize:d.blockSize,gatherAxis:d.gatherAxis,quantizeAxis:d.quantizeAxis})}),qf,jf,Dl,Bl,Ml=L$1(()=>{ee(),ae(),Se(),ue(),qf=d=>{if(!d||d.length!==2)throw new Error("GatherElements requires 2 inputs.");if(d[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(d[0].dims.length!==d[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},jf=(d,m)=>{let g=d[0].dims,w=d[0].dataType,$=g.length,I=d[1].dims,D=d[1].dataType,F=E$1.normalizeAxis(m.axis,$),U=g[F],j=I.slice(0),G=E$1.size(j),Z=P("input",w,$),H=P("indicesInput",D,I.length),q=N$1("output",w,j.length),V=[{type:12,data:G},{type:6,data:U},{type:12,data:F}];return V.push(...W(g,I,j)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:j,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(G/64)},programUniforms:V}),getShaderSource:Q=>`
      ${Q.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(Z,H,q)}
      ${Q.mainStart()}
      ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${q.offsetToIndices("global_idx")};

      var idx = ${H.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${Z.type.indices}(outputIndices);
      ${Z.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${Z.getByIndices("inputIndices")};

      ${q.setByOffset("global_idx","value")};
  }`}},Dl=d=>te({axis:d.axis}),Bl=(d,m)=>{let g=d.inputs;qf(g),d.compute(jf(d.inputs,m))}}),Kf,Zf,Rl,Ul,Nl=L$1(()=>{ee(),ae(),ue(),Kf=d=>{if(!d)throw new Error("Input is missing");if(d.length<2||d.length>3)throw new Error("Invaid input number.");if(d.length===3&&d[2].dims.length>2)throw new Error("Invalid input shape of C");if(d[0].dataType!==d[1].dataType||d.length===3&&d[0].dataType!==d[2].dataType)throw new Error("Input types are mismatched")},Zf=(d,m)=>{let g=d[0].dims.slice(),w=d[1].dims.slice(),[$,I,D]=Vr.getShapeOfGemmResult(g,m.transA,w,m.transB,d.length===3?d[2].dims:void 0),F=[$,I];if(!F)throw new Error("Can't use gemm on the given tensors");let U=16,j=Math.ceil(I/U),G=Math.ceil($/U),Z=!0,H=E$1.size(F),q=[{type:12,data:Z?j:H},{type:12,data:$},{type:12,data:I},{type:12,data:D},{type:1,data:m.alpha},{type:1,data:m.beta}],V=["type","type"];d.length===3&&(q.push(...W(d[2].dims)),V.push("rank")),q.push(...W(F));let Q=re=>{let J="";m.transA&&m.transB?J="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":m.transA&&!m.transB?J="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!m.transA&&m.transB?J="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!m.transA&&!m.transB&&(J="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let se=m.alpha===1?"":"value *= uniforms.alpha;",ie=P("a",d[0].dataType,d[0].dims),oe=P("b",d[1].dataType,d[1].dims),pe=ie.type.value,de=null,ge=[ie,oe];d.length===3&&(de=P("c",d[2].dataType,d[2].dims.length),ge.push(de));let ce=N$1("output",d[0].dataType,F.length);ge.push(ce);let Ie=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${re.registerUniforms(Ie).declareVariables(...ge)}

  ${re.mainStart()}
    ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${pe}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${J}
    }

    ${se}
    ${de!=null?`let cOffset = ${de.broadcastedIndicesToOffset("vec2(m, n)",ce)}; value += ${pe}(uniforms.beta) * ${de.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},X=re=>{let J=P("a",d[0].dataType,d[0].dims),se=P("b",d[1].dataType,d[1].dims),ie=null,oe=[J,se];d.length===3&&(ie=P("c",d[2].dataType,d[2].dims.length),oe.push(ie));let pe=N$1("output",d[0].dataType,F.length);oe.push(pe);let de=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],ge="",ce="";m.transA&&m.transB?(ce=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${J.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,ge="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):m.transA&&!m.transB?(ce=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${J.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,ge="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!m.transA&&m.transB?(ce=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${J.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,ge="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!m.transA&&!m.transB&&(ce=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${J.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,ge="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let Ie=m.alpha===1?"":"value *= uniforms.alpha;";return`
  ${re.registerUniforms(de).declareVariables(...oe)}
  var<workgroup> tile_a: array<array<${J.type.storage}, ${U}>, ${U}>;
  var<workgroup> tile_b: array<array<${se.type.storage}, ${U}>, ${U}>;
  ${re.mainStart([U,U,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${U};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${U};
    let num_tiles = (uniforms.K - 1) / ${U} + 1;
    var k_start = 0u;
    var value = ${pe.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${ce}
      k_start = k_start + ${U};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${U}; k++) {
        ${ge}
      }
      workgroupBarrier();
    }

    ${Ie}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${ie!=null?`let cOffset = ${ie.broadcastedIndicesToOffset("vec2(m, n)",pe)}; value += ${pe.type.value}(uniforms.beta) * ${ie.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return Z?{name:"GemmShared",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:V},getRunData:()=>({outputs:[{dims:F,dataType:d[0].dataType}],dispatchGroup:{x:j*G},programUniforms:q}),getShaderSource:X}:{name:"Gemm",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:V},getRunData:()=>({outputs:[{dims:F,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:q}),getShaderSource:Q}},Rl=d=>{let m=d.transA,g=d.transB,w=d.alpha,$=d.beta;return{transA:m,transB:g,alpha:w,beta:$,cacheKey:`${d.transA};${d.transB};${d.alpha===1}`}},Ul=(d,m)=>{Kf(d.inputs),d.compute(Zf(d.inputs,m))}}),pt,Ct,Ft,qt,Qf,Yf,Xf,Jf,eh,th,rh,nh,Vl,Ll,Wl=L$1(()=>{ee(),ae(),Se(),ue(),[pt,Ct,Ft,qt]=[0,1,2,3],Qf=d=>{if(d[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(d[0].dims.length!==d[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(d[0].dims.length-2!==d[1].dims[d[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${d[0].dims.length-2}`);if(d[0].dims[0]!==d[1].dims[0])throw new Error("grid batch size must match input batch size")},Yf=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,Xf=d=>`
  fn gs_bicubic_interpolate(p: mat4x4<${d}>, x: f32, y: f32) -> ${d} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${d}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Jf=d=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${d.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,eh=d=>`
  ${d.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,th=(d,m,g)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${m} {
     var pixel = ${m}(0);
     var indices = vec4<u32>(0);
     indices[${pt}] = batch;
     indices[${Ct}] = channel;`+(()=>{switch(g.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Ft}] = u32(r);
            indices[${qt}] = u32(c);
          } else {
            return ${m}(0);
          }
        `;case"border":return`
          indices[${Ft}] = u32(clamp(r, 0, H - 1));
          indices[${qt}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Ft}] = gs_reflect(r, border[1], border[3]);
          indices[${qt}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${g.paddingMode} is not supported`)}})()+`
    return ${d.getByIndices("indices")};
  }
`,rh=(d,m,g)=>(()=>{switch(g.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${pt}], indices[${Ct}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${pt}], indices[${Ct}], border);

          let dx2 = ${m}(f32(x2) - x);
          let dx1 = ${m}(x - f32(x1));
          let dy2 = ${m}(f32(y2) - y);
          let dy1 = ${m}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${m}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${pt}], indices[${Ct}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${g.mode} is not supported`)}})()+`${d.setByOffset("global_idx","result")}`,nh=(d,m)=>{let g=P("x",d[0].dataType,d[0].dims.length),w=[d[1].dims[0],d[1].dims[1],d[1].dims[2]],$=P("grid",d[1].dataType,w.length,2),I=[d[0].dims[0],d[0].dims[1],d[1].dims[1],d[1].dims[2]];m.format==="NHWC"&&(I=[d[0].dims[0],d[1].dims[1],d[1].dims[2],d[0].dims[3]],[pt,Ct,Ft,qt]=[0,3,1,2]);let D=N$1("output",d[0].dataType,I.length),F=g.type.value,U=E$1.size(I),j=[{type:12,data:U},...W(d[0].dims,w,I)],G=Z=>`
  ${Z.registerUniform("output_size","u32").declareVariables(g,$,D)}
  ${Yf}
  ${Xf(F)}
  ${Jf(m)}
  ${eh(m)}
  ${th(g,F,m)}

  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Ft}]);
      let W_in = i32(uniforms.x_shape[${qt}]);

      ${m.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${D.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${pt}], indices[${Ft}], indices[${qt}]);
      let nxy = ${$.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${rh(D,F,m)}
  }`;return{name:"GridSample",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:["type","type"]},getRunData:Z=>{let H=E$1.size(I);return{outputs:[{dims:I,dataType:Z[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:j}},getShaderSource:G}},Vl=(d,m)=>{Qf(d.inputs),d.compute(nh(d.inputs,m))},Ll=d=>te({alignCorners:d.align_corners,mode:d.mode,paddingMode:d.padding_mode,format:d.format})}),Re,ah,Hl,Gl,sh,sr,Fl,Eo=L$1(()=>{ee(),ae(),Se(),qr(),Yr(),ue(),ct(),Re=(d,m)=>d.length>m&&d[m].dims.length>0?d[m]:void 0,ah=(d,m)=>{let g=d[0],w=Re(d,1),$=Re(d,2),I=Re(d,3),D=Re(d,4),F=Re(d,5),U=Re(d,6),j=Re(d,7);if(g.dims.length!==3&&g.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let G=g.dims[0],Z=g.dims[1],H=g.dims.length===3?g.dims[2]:m.numHeads*g.dims[4],q=Z,V=0,Q=0,X=Math.floor(H/m.numHeads);if(U&&j&&E$1.size(U.dims)&&E$1.size(j.dims)){if(U.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(U.dims[0]!==G||U.dims[1]!==m.numHeads||U.dims[3]!==X)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(j.dims[0]!==G||j.dims[1]!==m.numHeads||j.dims[3]!==X)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(U.dims[2]!==j.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(j.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');V=U.dims[2],Q=U.dims[2]}else if(U&&E$1.size(U.dims)||j&&E$1.size(j.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let re;if(w&&E$1.size(w.dims)>0){if(g.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(w.dims.length<3||w.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(g.dims[0]!==w.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(w.dims.length===3){if(w.dims[2]!==g.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');re=2,q=w.dims[1]}else if(w.dims.length===5){if(w.dims[2]!==m.numHeads||w.dims[3]!==2||w.dims[4]!==X)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if($)throw new Error('Expect "value" be none when "key" has packed kv format.');re=5,q=w.dims[1]}else{if(w.dims[1]!==m.numHeads||w.dims[3]!==X)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');re=0,q=w.dims[2]}}else{if(g.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(g.dims[2]!==m.numHeads||g.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');re=3}if(I&&E$1.size(I.dims)>0){if(I.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(w&&w.dims.length===5&&w.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let J=V+q,se=0;if(D&&E$1.size(D.dims)>0){se=8;let de=D.dims;throw de.length===1?de[0]===G?se=1:de[0]===3*G+2&&(se=3):de.length===2&&de[0]===G&&de[1]===J&&(se=5),se===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let ie=!1,oe=H;if($&&E$1.size($.dims)>0){if($.dims.length!==3&&$.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(g.dims[0]!==$.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if($.dims.length===3){if(q!==$.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');oe=$.dims[2]}else{if(q!==$.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');oe=$.dims[1]*$.dims[3],ie=!0}}let pe=!1;if(D&&E$1.size(D.dims)>0)throw new Error("Key padding mask is not supported");if(F&&E$1.size(F.dims)>0){if(F.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(F.dims[0]!==G||F.dims[1]!==m.numHeads||F.dims[2]!==Z||F.dims[3]!==J)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:G,sequenceLength:Z,pastSequenceLength:V,kvSequenceLength:q,totalSequenceLength:J,maxSequenceLength:Q,inputHiddenSize:0,hiddenSize:H,vHiddenSize:oe,headSize:X,vHeadSize:Math.floor(oe/m.numHeads),numHeads:m.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:m.maskFilterValue,maskType:se,scale:m.scale,broadcastResPosBias:pe,passPastInKv:ie,qkvFormat:re}},Hl=d=>te({...d}),Gl=te({perm:[0,2,1,3]}),sh=(d,m,g,w,$,I,D)=>{let F=[w,$,I],U=E$1.size(F),j=[{type:12,data:U},{type:12,data:D},{type:12,data:I}],G=Z=>{let H=N$1("qkv_with_bias",m.dataType,F),q=P("qkv",m.dataType,F),V=P("bias",g.dataType,F),Q=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${Z.registerUniforms(Q).declareVariables(q,V,H)}
  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return d.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:F,dataType:m.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:j}),getShaderSource:G},{inputs:[m,g],outputs:[-1]})[0]},sr=(d,m,g,w,$,I,D,F)=>{let U=I;if(D&&E$1.size(D.dims)>0){if(w===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return U=sh(d,I,D,m,w,g*$,F),U=U.reshape([m,w,g,$]),g===1||w===1?U:d.compute(Pe(U,Gl.perm),{inputs:[U],outputs:[-1]})[0]}else return I.dims.length===3&&(U=I.reshape([m,w,g,$])),g===1||w===1?U:d.compute(Pe(U,Gl.perm),{inputs:[U],outputs:[-1]})[0]},Fl=(d,m)=>{let g=ah(d.inputs,m),w=d.inputs[0],$=Re(d.inputs,1),I=Re(d.inputs,2),D=Re(d.inputs,3),F=Re(d.inputs,4),U=Re(d.inputs,5),j=Re(d.inputs,6),G=Re(d.inputs,7);if(w.dims.length===5)throw new Error("Packed QKV is not implemented");if($?.dims.length===5)throw new Error("Packed KV is not implemented");let Z=$&&I&&$.dims.length===4&&I.dims.length===4,H=sr(d,g.batchSize,g.numHeads,g.sequenceLength,g.headSize,w,D,0);if(Z)return Ht(d,H,$,I,F,void 0,j,G,U,g);if(!$||!I)throw new Error("key and value must be provided");let q=sr(d,g.batchSize,g.numHeads,g.kvSequenceLength,g.headSize,$,D,g.hiddenSize),V=sr(d,g.batchSize,g.numHeads,g.kvSequenceLength,g.vHeadSize,I,D,2*g.hiddenSize);Ht(d,H,q,V,F,void 0,j,G,U,g)}}),uh,lh,dh,ch,ko,ql,jl,Po=L$1(()=>{ee(),ae(),Se(),ue(),uh=d=>{if(!d||d.length<1)throw new Error("too few inputs")},lh=(d,m)=>{let g=[],w=m.numOutputs;return d[1].dims[0]>0&&(d[1].getBigInt64Array().forEach($=>g.push(Number($))),w=g.length),te({numOutputs:w,axis:m.axis,splitSizes:g})},dh=d=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${d}u; i += 1u ) {
    if (index < ${K("uniforms.size_in_split_axis","i",d)}) {
        return i;
    }
    }
    return ${d}u;
}`,ch=d=>{let m=d.length,g=[];for(let w=0;w<m;++w){let $=d[w].setByIndices("indices","input[global_idx]");m===1?g.push($):w===0?g.push(`if (output_number == ${w}u) { ${$} }`):w===m-1?g.push(`else { ${$} }`):g.push(`else if (output_number == ${w}) { ${$} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${d[0].type.indices}, global_idx: u32) {
        ${g.join(`
`)}
      }`},ko=(d,m)=>{let g=d[0].dims,w=E$1.size(g),$=d[0].dataType,I=E$1.normalizeAxis(m.axis,g.length),D=new Array(m.numOutputs),F=P("input",$,g.length),U=new Array(m.numOutputs),j=[],G=[],Z=0,H=[{type:12,data:w}];for(let V=0;V<m.numOutputs;V++){Z+=m.splitSizes[V],U[V]=Z;let Q=g.slice();Q[I]=m.splitSizes[V],G.push(Q),D[V]=N$1(`output${V}`,$,Q.length),j.push({dims:G[V],dataType:d[0].dataType})}H.push({type:12,data:U},...W(g,...G));let q=V=>`
  ${V.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",U.length).declareVariables(F,...D)}
  ${dh(U.length)}
  ${ch(D)}

  ${V.mainStart()}
    ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${F.offsetToIndices("global_idx")};
    var index = ${F.indicesGet("indices",I)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${K("uniforms.size_in_split_axis","output_number - 1u",U.length)};
      ${F.indicesSet("indices",I,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:m.cacheKey,inputDependencies:["rank"]},getShaderSource:q,getRunData:()=>({outputs:j,dispatchGroup:{x:Math.ceil(w/64)},programUniforms:H})}},ql=(d,m)=>{uh(d.inputs);let g=d.inputs.length===1?m:lh(d.inputs,m);d.compute(ko(d.inputs,g),{inputs:[0]})},jl=d=>{let m=d.axis,g=d.splitSizes,w=d.numOutputs<0?g.length:d.numOutputs;if(w!==g.length)throw new Error("numOutputs and splitSizes length must be equal");return te({axis:m,numOutputs:w,splitSizes:g})}}),ph,un,Kl,Oo=L$1(()=>{ee(),ae(),Se(),ue(),ph=(d,m)=>{let[g,w,$,I]=d,{numHeads:D,rotaryEmbeddingDim:F}=m;if(g.dims.length!==3&&g.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${g.dims.length}`);if(!E$1.areEqual(w.dims,[])&&!E$1.areEqual(w.dims,[1])&&w.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${w.dims.length}`);if($.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${$.dims.length}`);if(I.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${I.dims.length}`);if(!E$1.areEqual($.dims,I.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(F>0&&D===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let U=g.dims[0],j=g.dims[g.dims.length-2],G=$.dims[0],Z=E$1.sizeFromDimension(g.dims,1)/j,H=F===0?$.dims[1]*2:Z/D;if(F>H)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(w.dims.length===2){if(U!==w.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${w.dims[0]}`);if(j!==w.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${w.dims[1]}`)}if(H/2!==$.dims[1]&&F/2!==$.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${$.dims[1]}`);if(j>G)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},un=(d,m)=>{let{interleaved:g,numHeads:w,rotaryEmbeddingDim:$,scale:I}=m,D=d[0].dims[0],F=E$1.sizeFromDimension(d[0].dims,1),U=d[0].dims[d[0].dims.length-2],j=F/U,G=d[2].dims[1],Z=$===0?G*2:j/w,H=new Array(D,U,j/Z,Z-G),q=E$1.computeStrides(H),V=[{type:1,data:I},{type:12,data:H},{type:12,data:q},...d[0].dims.length===3?new Array({type:12,data:[F,j,Z,1]}):[],...d[0].dims.length===4?new Array({type:12,data:[F,Z,U*Z,1]}):[],...W(d[0].dims,d[1].dims,d[2].dims,d[3].dims,d[0].dims)],Q=X=>{let re=P("input",d[0].dataType,d[0].dims.length),J=P("position_ids",d[1].dataType,d[1].dims.length),se=P("cos_cache",d[2].dataType,d[2].dims.length),ie=P("sin_cache",d[3].dataType,d[3].dims.length),oe=N$1("output",d[0].dataType,d[0].dims.length);return X.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:H.length},{name:"global_strides",type:"u32",length:q.length},{name:"input_output_strides",type:"u32",length:q.length}]),`
        ${X.declareVariables(re,J,se,ie,oe)}

        ${X.mainStart(Bt)}
          let half_rotary_emb_dim = uniforms.${se.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${X.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${J.broadcastedIndicesToOffset("bsnh.xy",N$1("",J.type.tensor,2))};
            let position_id =
                u32(${J.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${g});
            let j = i + select(half_rotary_emb_dim, 1, ${g});
            let re = ${re.getByOffset("i")} * ${se.get("position_id","bsnh[3]")} -
                ${re.getByOffset("j")} * ${ie.get("position_id","bsnh[3]")};
            ${oe.setByOffset("i","re")}
            let im = ${re.getByOffset("i")} * ${ie.get("position_id","bsnh[3]")} +
                ${re.getByOffset("j")} * ${se.get("position_id","bsnh[3]")};
            ${oe.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${oe.setByOffset("k",re.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:te({interleaved:g}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:Q,getRunData:()=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(E$1.size(H)/Bt)},programUniforms:V})}},Kl=(d,m)=>{ph(d.inputs,m),d.compute(un(d.inputs,m))}}),mh,fh,Zl,hh,Ql,Yl=L$1(()=>{Se(),ee(),Yr(),Eo(),Po(),ct(),Oo(),ue(),mh=(d,m)=>{if(m.doRotary&&d.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let g=d[0],w=d[1],$=d[2],I=d[3],D=d[4];if(m.doRotary!==0&&d.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(m.localWindowSize!==-1)throw new Error("Local attention is not supported");if(m.softcap!==0)throw new Error("Softcap is not supported");if(m.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(m.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(g.dims.length!==3&&g.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let F=!1,U=g.dims[0],j=g.dims[1],G=g.dims.length===3?F?g.dims[2]/3:g.dims[2]:m.numHeads*g.dims[4],Z=j,H=0,q=!w||w.dims.length===0,V=Math.floor(q?G/(m.numHeads+2*m.kvNumHeads):G/m.numHeads);q&&(G=V*m.numHeads);let Q=I&&I.dims.length!==0,X=D&&D.dims.length!==0;if(Q&&I.dims.length===4&&I.dims[0]===U&&I.dims[1]!==m.kvNumHeads&&I.dims[2]===m.kvNumHeads&&I.dims[3]===V)throw new Error("BSNH pastKey/pastValue is not supported");if(Q&&X){if(I.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(D.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');H=I.dims[2]}else if(Q||X)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let re=1;if(w&&w.dims.length>0){if(g.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(w.dims.length<3||w.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(g.dims[0]!==w.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(w.dims.length===3){if(g.dims[2]%w.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');Z=w.dims[1]}else if(w.dims.length===5){if(w.dims[2]!==m.numHeads||w.dims[3]!==2||w.dims[4]!==V)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if($)throw new Error('Expect "value" be none when "key" has packed kv format.');Z=w.dims[1]}else{if(w.dims[1]!==m.numHeads||w.dims[3]!==V)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');Z=w.dims[2]}}else{if(g.dims.length!==3&&g.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(g.dims.length===5&&(g.dims[2]!==m.numHeads||g.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');re=3}let J=0,se=!1,ie=m.kvNumHeads?V*m.kvNumHeads:G;if($&&$.dims.length>0){if($.dims.length!==3&&$.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(g.dims[0]!==$.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if($.dims.length===3){if(Z!==$.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');ie=$.dims[2]}else{if(Z!==$.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');ie=$.dims[1]*$.dims[3],se=!0}}let oe=d.length>4?d[5]:void 0;if(oe&&oe.dims.length!==1&&oe.dims[0]!==U)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:U,sequenceLength:j,pastSequenceLength:H,kvSequenceLength:Z,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:G,vHiddenSize:ie,headSize:V,vHeadSize:Math.floor(ie/m.kvNumHeads),numHeads:m.numHeads,kvNumHeads:m.kvNumHeads,nReps:m.numHeads/m.kvNumHeads,pastPresentShareBuffer:!1,maskType:J,scale:m.scale,broadcastResPosBias:!1,passPastInKv:se,qkvFormat:re}},fh=te({perm:[0,2,1,3]}),Zl=(d,m,g)=>{let w=m,$=g.kvNumHeads;return m.dims.length===3&&g.kvSequenceLength!==0&&(w=m.reshape([g.batchSize,g.kvSequenceLength,$,g.headSize]),w=d.compute(Pe(w,fh.perm),{inputs:[w],outputs:[-1]})[0]),w},hh=(d,m,g,w)=>{let $=7,I=["type","type"],D=[d*m],F=d*m,U=[{type:12,data:F},{type:12,data:m},{type:12,data:d}],j=G=>{let Z=P("seq_lens",g.dataType,g.dims),H=P("total_seq_lens",w.dataType,w.dims),q=N$1("pos_ids",$,D),V=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${G.registerUniforms(V).declareVariables(Z,H,q)}
  ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${H.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${Z.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${q.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${q.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${q.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${d};${m}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:D,dataType:$}],dispatchGroup:{x:Math.ceil(F/64)},programUniforms:U}),getShaderSource:j}},Ql=(d,m)=>{let g=mh(d.inputs,m);if(d.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(d.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let w=d.inputs[0],$=d.inputs[1]&&d.inputs[1].dims.length>0?d.inputs[1]:void 0,I=d.inputs[2]&&d.inputs[2].dims.length>0?d.inputs[2]:void 0,D=d.inputs[3]&&d.inputs[3].dims.length!==0?d.inputs[3]:void 0,F=d.inputs[4]&&d.inputs[4].dims.length!==0?d.inputs[4]:void 0,U=d.inputs.length>4?d.inputs[5]:void 0,j=d.inputs.length>5?d.inputs[6]:void 0,G=g.kvNumHeads?g.kvNumHeads:g.numHeads,Z=te({axis:2,numOutputs:3,splitSizes:[g.numHeads*g.headSize,G*g.headSize,G*g.headSize]}),[H,q,V]=!$&&!I?d.compute(ko([w],Z),{inputs:[w],outputs:[-1,-1,-1]}):[w,$,I],Q,X;if(m.doRotary){let ie=d.compute(hh(g.batchSize,g.sequenceLength,U,j),{inputs:[U,j],outputs:[-1]})[0],oe=d.inputs[7],pe=d.inputs[8],de=te({interleaved:m.rotaryInterleaved!==0,numHeads:g.numHeads,rotaryEmbeddingDim:0,scale:m.scale}),ge=[H,ie,oe,pe],ce=[-1];Q=d.compute(un(ge,de),{inputs:ge,outputs:ce})[0],ge.splice(0,1,q);let Ie=te({interleaved:m.rotaryInterleaved!==0,numHeads:g.kvNumHeads,rotaryEmbeddingDim:0,scale:m.scale});X=d.compute(un(ge,Ie),{inputs:ge,outputs:ce})[0]}let re=sr(d,g.batchSize,g.numHeads,g.sequenceLength,g.headSize,m.doRotary?Q:H,void 0,0),J=Zl(d,m.doRotary?X:q,g),se=Zl(d,V,g);Ht(d,re,J,se,void 0,void 0,D,F,void 0,g,U,j)}}),Xl,gh,yh,Jl,ed=L$1(()=>{ee(),ae(),ct(),ue(),Xl=(d,m,g,w,$,I,D,F)=>{let U=he(I),j=U===1?"f32":`vec${U}f`,G=U===1?"vec2f":`mat2x${U}f`,Z=$*D,H=64;Z===1&&(H=256);let q=[$,D,I/U],V=[$,D,2],Q=["rank","type","type"],X=[];X.push(...W(q,V));let re=J=>{let se=P("x",m.dataType,3,U),ie=P("scale",g.dataType,g.dims),oe=P("bias",w.dataType,w.dims),pe=N$1("output",1,3,2),de=[se,ie,oe,pe];return`
  var<workgroup> workgroup_shared : array<${G}, ${H}>;
  const workgroup_size = ${H}u;
  ${J.declareVariables(...de)}
  ${J.mainStart(H)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${j}(0);
    var squared_sum = ${j}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${j}(${se.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${G}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${je("workgroup_shared[0][0]",U)} / f32(hight * ${U});
      let squared_sum_final = ${je("workgroup_shared[0][1]",U)} / f32(hight * ${U});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${F}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return d.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${U};${F};${H}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:V,dataType:1}],dispatchGroup:{x:Z},programUniforms:X}),getShaderSource:re},{inputs:[m,g,w],outputs:[-1]})[0]},gh=(d,m,g)=>{let w=m[0].dims,$=w,I=2,D=w[0],F=w[1],U=E$1.sizeFromDimension(w,I),j=he(U),G=E$1.size($)/j,Z=Xl(d,m[0],m[1],m[2],D,U,F,g.epsilon),H=[D,F,U/j],q=[D,F],V=["type","none"],Q=X=>{let re=P("x",m[0].dataType,H.length,j),J=P("scale_shift",1,q.length,2),se=N$1("output",m[0].dataType,H.length,j),ie=[re,J,se];return`
  ${X.registerUniform("output_size","u32").declareVariables(...ie)}
  ${X.mainStart()}
  ${X.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${se.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${J.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${re.getByOffset("global_idx")} * ${se.type.value}(scale_shift.x) + ${se.type.value}(scale_shift.y);
      ${se.setByOffset("global_idx","value")};
  }`};d.compute({name:"InstanceNormalization",shaderCache:{hint:`${j}`,inputDependencies:V},getRunData:()=>({outputs:[{dims:$,dataType:m[0].dataType}],dispatchGroup:{x:Math.ceil(G/64)},programUniforms:[{type:12,data:G},...W(H,q,H)]}),getShaderSource:Q},{inputs:[m[0],Z]})},yh=(d,m,g)=>{let w=m[0].dims,$=w,I=w[0],D=w[w.length-1],F=E$1.sizeFromDimension(w,1)/D,U=he(D),j=E$1.size($)/U,G=[{type:12,data:F},{type:12,data:Math.floor(D/U)}],Z=["type","type"],H=!1,q=[0,w.length-1];for(let re=0;re<w.length-2;re++)H=H||w[re+1]!==1,q.push(re+1);H=H&&w[w.length-1]!==1;let V=H?d.compute(Pe(d.inputs[0],q),{inputs:[d.inputs[0]],outputs:[-1]})[0]:d.inputs[0].reshape(Array.from({length:w.length},(re,J)=>w[q[J]])),Q=Xl(d,V,m[1],m[2],I,F,D,g.epsilon),X=re=>{let J=ve(m[0].dataType),se=U===1?"vec2f":`mat${U}x2f`,ie=de=>{let ge=de===0?"x":"y",ce=U===1?"f32":`vec${U}f`;switch(U){case 1:return`${J}(${ce}(scale.${ge}))`;case 2:return`vec2<${J}>(${ce}(scale[0].${ge}, scale[1].${ge}))`;case 4:return`vec4<${J}>(${ce}(scale[0].${ge}, scale[1].${ge}, scale[2].${ge}, scale[3].${ge}))`;default:throw new Error(`Not supported compoents ${U}`)}},oe=P("input",m[0].dataType,m[0].dims,U),pe=N$1("output",m[0].dataType,$,U);return`
  @group(0) @binding(0) var<storage, read> input : array<${oe.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${se}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${pe.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${re.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${ie(0)}, ${ie(1)});
  }`};d.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${U}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:$,dataType:m[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:G}),getShaderSource:X},{inputs:[m[0],Q]})},Jl=(d,m)=>{m.format==="NHWC"?yh(d,d.inputs,m):gh(d,d.inputs,m)}}),bh,_h,td,rd=L$1(()=>{ee(),ae(),ue(),bh=d=>{if(!d||d.length<2)throw new Error("layerNorm requires at least 2 inputs.")},_h=(d,m,g)=>{let w=m.simplified,$=d[0].dims,I=d[1],D=!w&&d[2],F=$,U=E$1.normalizeAxis(m.axis,$.length),j=E$1.sizeToDimension($,U),G=E$1.sizeFromDimension($,U),Z=E$1.size(I.dims),H=D?E$1.size(D.dims):0;if(Z!==G||D&&H!==G)throw new Error(`Size of X.shape()[axis:] == ${G}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${Z} and bias size of ${H}`);let q=[];for(let oe=0;oe<$.length;++oe)oe<U?q.push($[oe]):q.push(1);let V=he(G),Q=["type","type"],X=[{type:12,data:j},{type:1,data:G},{type:12,data:Math.floor(G/V)},{type:1,data:m.epsilon}];D&&Q.push("type");let re=g>1,J=g>2,se=oe=>{let pe=ve(d[0].dataType),de=[P("x",d[0].dataType,d[0].dims,V),P("scale",I.dataType,I.dims,V)];D&&de.push(P("bias",D.dataType,D.dims,V)),de.push(N$1("output",d[0].dataType,F,V)),re&&de.push(N$1("mean_data_output",1,q)),J&&de.push(N$1("inv_std_output",1,q));let ge=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${oe.registerUniforms(ge).declareVariables(...de)}
  ${oe.mainStart()}
    ${oe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${fo("f32",V)};
    var mean_square_vector = ${fo("f32",V)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Mt(pe,V,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${je("mean_vector",V)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${je("mean_square_vector",V)} / uniforms.norm_size ${w?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Mt(pe,V,"x[j + offset]")};
      let f32scale = ${Mt(pe,V,"scale[j]")};
      output[j + offset] = ${de[0].type.value}((f32input ${w?"":"- mean"}) * inv_std_dev * f32scale
        ${D?`+ ${Mt(pe,V,"bias[j]")}`:""}
      );
    }

    ${re?"mean_data_output[global_idx] = mean":""};
    ${J?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},ie=[{dims:F,dataType:d[0].dataType}];return re&&ie.push({dims:q,dataType:1}),J&&ie.push({dims:q,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${V};${g};${w}`,inputDependencies:Q},getRunData:()=>({outputs:ie,dispatchGroup:{x:Math.ceil(j/64)},programUniforms:X}),getShaderSource:se}},td=(d,m)=>{bh(d.inputs),d.compute(_h(d.inputs,m,d.outputCount))}}),wh,nd,od=L$1(()=>{ae(),nn(),on(),wh=d=>{if(!d||d.length!==2)throw new Error("MatMul requires 2 inputs.");if(d[0].dims[d[0].dims.length-1]!==d[1].dims[d[1].dims.length-2])throw new Error("shared dimension does not match.")},nd=d=>{wh(d.inputs);let m=tt.calcShape(d.inputs[0].dims,d.inputs[1].dims,!0);if(!m)throw new Error("Can't use matmul on the given tensors");let g=m[m.length-1],w=d.inputs[0].dims[d.inputs[0].dims.length-1];if(g<8&&w<8)d.compute(rn(d.inputs,{activation:""},m));else{let $=m[m.length-2],I=E$1.size(d.inputs[0].dims.slice(0,-2)),D=E$1.size(d.inputs[1].dims.slice(0,-2));if(I!==1&&$===1&&D===1){let F=d.inputs[0].reshape([1,I,w]),U=d.inputs[1].reshape([1,w,g]),j=[1,I,g],G=[F,U];d.compute(ar(G,{activation:""},m,j),{inputs:G})}else d.compute(ar(d.inputs,{activation:""},m))}}}),vh,$h,xh,id,ad,sd=L$1(()=>{ee(),ae(),Se(),ue(),vh=(d,m)=>{if(d.length<3||d.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let g=d[0],w=g.dims.length;if(g.dims[w-1]!==m.k)throw new Error("The last dim of input shape does not match the k value");let $=Math.floor((m.k+m.blockSize-1)/m.blockSize),I=m.blockSize/8*m.bits,D=d[1];if(!E$1.areEqual(D.dims,[m.n,$,I]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let F=d[2].dims;if(E$1.size(F)!==m.n*$)throw new Error("scales input size error.");if(d.length===4){let U=d[3].dims,j=m.n*(m.bits===8?$:Math.floor(($*m.bits+7)/8));if(E$1.size(U)!==j)throw new Error("zeroPoints input size error.")}},$h=(d,m)=>{let g=d[0].dims,w=g.length,$=g[w-2],I=m.k,D=m.n,F=g.slice(0,w-2),U=E$1.size(F),j=d[1].dims[2]/4,G=d[0].dataType,Z=he(m.k),H=he(j),q=he(D),V=F.concat([$,D]),Q=$>1&&D/q%2===0?2:1,X=E$1.size(V)/q/Q,re=64,J=[],se=[U,$,I/Z],ie=E$1.convertShape(d[1].dims).slice();ie.splice(-1,1,j/H),J.push(...W(se)),J.push(...W(ie)),J.push(...W(d[2].dims)),d.length===4&&J.push(...W(E$1.convertShape(d[3].dims)));let oe=[U,$,D/q];J.push(...W(oe));let pe=de=>{let ge=se.length,ce=P("a",d[0].dataType,ge,Z),Ie=P("b",12,ie.length,H),fe=P("scales",d[2].dataType,d[2].dims.length),Te=[ce,Ie,fe],ut=d.length===4?P("zero_points",12,d[3].dims.length):void 0;ut&&Te.push(ut);let ze=oe.length,Ce=N$1("output",d[0].dataType,ze,q),Fe=ve(d[0].dataType),Et=(()=>{switch(Z){case 1:return`array<${Fe}, 8>`;case 2:return`mat4x2<${Fe}>`;case 4:return`mat2x4<${Fe}>`;default:throw new Error(`${Z}-component is not supported.`)}})(),bt=()=>{let Ye=`
          // reuse a data
            var input_offset = ${ce.indicesToOffset(`${ce.type.indices}(batch, row, word_offset)`)};
            var a_data: ${Et};
            for (var j: u32 = 0; j < ${8/Z}; j++) {
              a_data[j] = ${ce.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let _t=0;_t<q*Q;_t++)Ye+=`
            b_value = ${H===1?`b${_t}_data`:`b${_t}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${Et}(${Array.from({length:4},(Vt,Lt)=>`${Fe}(b_value_lower[${Lt}]), ${Fe}(b_value_upper[${Lt}])`).join(", ")});
            b_dequantized_values = ${Z===1?`${Et}(${Array.from({length:8},(Vt,Lt)=>`(b_quantized_values[${Lt}] - ${ut?`zero_point${_t}`:"zero_point"}) * scale${_t}`).join(", ")});`:`(b_quantized_values - ${Et}(${Array(8).fill(`${ut?`zero_point${_t}`:"zero_point"}`).join(",")})) * scale${_t};`};
            workgroup_shared[local_id.x * ${Q} + ${Math.floor(_t/q)}]${q>1?`[${_t%q}]`:""} += ${Array.from({length:8/Z},(Vt,Lt)=>`${Z===1?`a_data[${Lt}] * b_dequantized_values[${Lt}]`:`dot(a_data[${Lt}], b_dequantized_values[${Lt}])`}`).join(" + ")};
          `;return Ye},ht=()=>{let Ye=`
            var col_index = col * ${q};
            ${ut?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Fe}(8);`}
            `;for(let _t=0;_t<q*Q;_t++)Ye+=`
            let scale${_t} = ${fe.getByOffset("col_index * nBlocksPerCol + block")};
            ${ut?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${ut.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${_t} = ${Fe}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return Ye},Zt=()=>{let Ye=`col_index = col * ${q};`;for(let _t=0;_t<q*Q;_t++)Ye+=`
            let b${_t}_data = ${Ie.getByIndices(`${Ie.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return Ye+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${Et};
            var b_dequantized_values: ${Et};`,Ye};return`
        var<workgroup> workgroup_shared: array<${Ce.type.value}, ${Q*re}>;
        ${de.declareVariables(...Te,Ce)}
        ${de.mainStart([re,1,1])}
          let output_indices = ${Ce.offsetToIndices(`(global_idx / ${re}) * ${Q}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${re}) {
            //process one block
            var word_offset: u32 = block * ${m.blockSize/Z};
            ${ht()}
            for (var word: u32 = 0; word < ${j}; word += ${H}) {
              ${Zt()}
              for (var i: u32 = 0; i < ${H}; i++) {
                ${bt()}
                word_offset += ${8/Z};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${Q}) {
            var output_value: ${Ce.type.value} = ${Ce.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${re}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${Q};
            }
            ${Ce.setByIndices(`${Ce.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${m.blockSize};${m.bits};${Z};${H};${q};${Q};${re}`,inputDependencies:Array(d.length).fill("rank")},getRunData:()=>({outputs:[{dims:V,dataType:G}],dispatchGroup:{x:X},programUniforms:J}),getShaderSource:pe}},xh=(d,m)=>{let g=d[0].dims,w=g.length,$=g[w-2],I=m.k,D=m.n,F=g.slice(0,w-2),U=E$1.size(F),j=d[1].dims[2]/4,G=d[0].dataType,Z=he(m.k),H=he(j),q=F.concat([$,D]),V=128,Q=D%8===0?8:D%4===0?4:1,X=V/Q,re=X*H*8,J=re/Z,se=re/m.blockSize,ie=E$1.size(q)/Q,oe=[],pe=[U,$,I/Z],de=E$1.convertShape(d[1].dims).slice();de.splice(-1,1,j/H),oe.push(...W(pe)),oe.push(...W(de)),oe.push(...W(d[2].dims)),d.length===4&&oe.push(...W(E$1.convertShape(d[3].dims)));let ge=[U,$,D];oe.push(...W(ge));let ce=Ie=>{let fe=pe.length,Te=P("a",d[0].dataType,fe,Z),ut=P("b",12,de.length,H),ze=P("scales",d[2].dataType,d[2].dims.length),Ce=[Te,ut,ze],Fe=d.length===4?P("zero_points",12,d[3].dims.length):void 0;Fe&&Ce.push(Fe);let Et=ge.length,bt=N$1("output",d[0].dataType,Et),ht=ve(d[0].dataType),Zt=()=>{switch(Z){case 1:return`
          let a_data0 = vec4<${ht}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ht}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ht}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ht}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${Z}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${Te.type.value}, ${J}>;
        var<workgroup> inter_results: array<array<${bt.type.value}, ${X}>, ${Q}>;
        ${Ie.declareVariables(...Ce,bt)}
        ${Ie.mainStart([X,Q,1])}
          let output_indices = ${bt.offsetToIndices(`workgroup_index * ${Q}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${se} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${J};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${J}; a_offset += ${V})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${Te.getByIndices(`${Te.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${Te.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${se} + local_id.x;
            ${Fe?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Fe.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ht}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ht}(8);`}
            let scale = ${ze.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${ut.getByIndices(`${ut.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${m.blockSize/Z};
            for (var i: u32 = 0; i < ${H}; i++) {
              ${Zt()}
              let b_value = ${H===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ht}>(${Array.from({length:4},(Ye,_t)=>`${ht}(b_value_lower[${_t}]), ${ht}(b_value_upper[${_t}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ht}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(Ye,_t)=>`${`dot(a_data${_t}, b_dequantized_values[${_t}])`}`).join(" + ")};
              word_offset += ${8/Z};
            }
            workgroupBarrier();
          }

          if (local_idx < ${Q}) {
            var output_value: ${bt.type.value} = ${bt.type.value}(0);
            for (var b = 0u; b < ${X}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${bt.setByIndices(`${bt.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${m.blockSize};${Z};${H};${X};${Q}`,inputDependencies:Array(d.length).fill("rank")},getRunData:()=>({outputs:[{dims:q,dataType:G}],dispatchGroup:{x:ie},programUniforms:oe}),getShaderSource:ce}},id=(d,m)=>{vh(d.inputs,m),m.blockSize===32&&d.adapterInfo.isVendor("intel")&&d.adapterInfo.isArchitecture("gen-12lp")?d.compute(xh(d.inputs,m)):d.compute($h(d.inputs,m))},ad=d=>te(d)}),Sh,Th,Ch,Ih,Ah,Eh,kh,Ph,ud,ld=L$1(()=>{ee(),ae(),ue(),Sh=d=>{if(!d||d.length<1)throw new Error("Too few inputs");if(d[0].dataType!==1&&d[0].dataType!==10)throw new Error("Input type must be float or float16.");if(d.length>=2){let m=d[0].dims.length*2===d[1].dims[0];if(d.length===4&&(m=d[3].dims[0]*2===d[1].dims[0]),!m)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Th=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
            k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${K("uniforms.x_shape",$,m)})) {
              break;
            }
            offset += k * i32(${K("uniforms.x_strides",$,m)});
        `;return`
          value = ${d.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${w}
            value = x[offset];
          }
      `},Ch=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${K("uniforms.x_shape",$,m)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${K("uniforms.x_shape",$,m)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${K("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Ih=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${K("uniforms.x_shape",$,m)})) {
                  k = i32(${K("uniforms.x_shape",$,m)}) - 1;
                }
                offset += k * i32(${K("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Ah=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
                if (k < 0)  {
                  k += i32(${K("uniforms.x_shape",$,m)}]);
                }
                if (k >= i32(${K("uniforms.x_shape",$,m)})) {
                  k -= i32(${K("uniforms.x_shape",$,m)});
                }
                offset += k * i32(${K("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Eh=(d,m,g)=>{switch(g.mode){case 0:return Th(d,m,g.pads.length);case 1:return Ch(d,m,g.pads.length);case 2:return Ih(d,m,g.pads.length);case 3:return Ah(d,m,g.pads.length);default:throw new Error("Invalid mode")}},kh=(d,m)=>{let g=E$1.padShape(d[0].dims.slice(),m.pads),w=d[0].dims,$=E$1.size(g),I=[{type:12,data:$},{type:6,data:m.pads}],D=d.length>=3&&d[2].data;m.mode===0&&I.push({type:D?d[2].dataType:1,data:m.value}),I.push(...W(d[0].dims,g));let F=["rank"],U=j=>{let G=N$1("output",d[0].dataType,g.length),Z=P("x",d[0].dataType,w.length),H=Z.type.value,q=Eh(G,w.length,m),V=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:m.pads.length}];return m.mode===0&&V.push({name:"constant_value",type:D?H:"f32"}),`
            ${j.registerUniforms(V).declareVariables(Z,G)}
            ${j.mainStart()}
            ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${G.offsetToIndices("global_idx")};

            var value = ${H}(0);
            ${q}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${m.mode}${D}`,inputDependencies:F},getRunData:()=>({outputs:[{dims:g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(E$1.size(g)/64)},programUniforms:I}),getShaderSource:U}},Ph=(d,m)=>{if(d.length>1){let g=d[1].getBigInt64Array(),w=d.length>=3&&d[2].data?d[2].dataType===10?d[2].getUint16Array()[0]:d[2].getFloat32Array()[0]:0,$=d[0].dims.length,I=new Int32Array(2*$).fill(0);if(d.length>=4){let F=d[3].getBigInt64Array();for(let U=0;U<F.length;U++)I[Number(F[U])]=Number(g[U]),I[Number(F[U])+$]=Number(g[U+F.length])}else g.forEach((F,U)=>I[Number(U)]=Number(F));let D=[];return I.forEach(F=>D.push(F)),{mode:m.mode,value:w,pads:D}}else return m},ud=(d,m)=>{Sh(d.inputs);let g=Ph(d.inputs,m);d.compute(kh(d.inputs,g),{inputs:[0]})}}),ln,dd,cd,pd,md,Oh,zh,fd,hd,gd,yd,bd,_d,wd,vd,$d,xd,Sd,Td,Cd=L$1(()=>{Ve(),ee(),ae(),ue(),ln=d=>{if(we.webgpu.validateInputContent&&(!d||d.length!==1))throw new Error("Pool ops requires 1 input.")},dd=(d,m,g)=>{let w=m.format==="NHWC",$=d.dims.slice();w&&$.splice(1,0,$.pop());let I=Object.hasOwnProperty.call(m,"dilations"),D=m.kernelShape.slice(),F=m.strides.slice(),U=I?m.dilations.slice():[],j=m.pads.slice();Dt.adjustPoolAttributes(g,$,D,F,U,j);let G=Dt.computePoolOutputShape(g,$,F,U,D,j,m.autoPad),Z=Object.assign({},m);I?Object.assign(Z,{kernelShape:D,strides:F,pads:j,dilations:U,cacheKey:m.cacheKey}):Object.assign(Z,{kernelShape:D,strides:F,pads:j,cacheKey:m.cacheKey});let H=G.slice();return H.push(H.splice(1,1)[0]),[Z,w?H:G]},cd=(d,m)=>{let g=m.format==="NHWC",w=E$1.size(d),$=E$1.size(m.kernelShape),I=[{type:12,data:w},{type:12,data:$}],D=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(m.kernelShape.length<=2){let F=m.kernelShape[m.kernelShape.length-1],U=m.strides[m.strides.length-1],j=m.pads[m.pads.length/2-1],G=m.pads[m.pads.length-1],Z=!!(j+G);I.push({type:12,data:F},{type:12,data:U},{type:12,data:j},{type:12,data:G}),D.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let H=!1;if(m.kernelShape.length===2){let q=m.kernelShape[m.kernelShape.length-2],V=m.strides[m.strides.length-2],Q=m.pads[m.pads.length/2-2],X=m.pads[m.pads.length-2];H=!!(Q+X),I.push({type:12,data:q},{type:12,data:V},{type:12,data:Q},{type:12,data:X}),D.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[I,D,!0,Z,H]}else{if(g)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let F=E$1.computeStrides(m.kernelShape);I.push({type:12,data:F},{type:12,data:m.pads},{type:12,data:m.strides}),D.push({name:"kernelStrides",type:"u32",length:F.length},{name:"pads",type:"u32",length:m.pads.length},{name:"strides",type:"u32",length:m.strides.length});let U=m.pads.reduce((j,G)=>j+G);return[I,D,!!U,!1,!1]}},pd=(d,m,g,w,$,I,D,F,U,j,G,Z)=>{let H=$.format==="NHWC",q=m.type.value,V=N$1("output",m.type.tensor,w);if($.kernelShape.length<=2){let Q="",X="",re="",J=g-(H?2:1);if(G?Q=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${J}] = indices[${J}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${J}] < 0 || xIndices[${J}]
                      >= uniforms.x_shape[${J}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${m.indicesToOffset("xIndices")}];
                  ${I}
                }`:Q=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${J}] = indices[${J}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${m.indicesToOffset("xIndices")}];
                  ${I}
                }`,$.kernelShape.length===2){let se=g-(H?3:2);Z?X=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${se}] = indices[${se}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${se}] < 0 || xIndices[${se}] >= uniforms.x_shape[${se}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:X=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${se}] = indices[${se}] * uniforms.sh - uniforms.phStart + j;
                `,re=`
              }
            `}return`
            ${d.registerUniforms(U).declareVariables(m,V)}

            ${d.mainStart()}
              ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${V.offsetToIndices("global_idx")};
              var xIndices = ${V.offsetToIndices("global_idx")};

              var value = ${q}(${F});
              var pad = 0;
              ${X}
              ${Q}
              ${re}
              ${D}

              output[global_idx] = value;
            }`}else{if(H)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let Q=$.kernelShape.length,X=$.pads.length,re="";return j?re=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${m.indicesToOffset("xIndices")}];
                ${I}
              }`:re=`
              }
              let x_val = x[${m.indicesToOffset("xIndices")}];
              ${I}
            `,`
            ${d.registerUniforms(U).declareVariables(m,V)}

            ${d.mainStart()}
              ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${V.offsetToIndices("global_idx")};
              var xIndices = ${V.offsetToIndices("global_idx")};

              var offsets: array<u32, ${Q}>;

              var value = ${q}(${F});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${Q-1}u; j++) {
                  offsets[j] = offset / ${K("uniforms.kernelStrides","j",Q)};
                  offset -= offsets[j] * ${K("uniforms.kernelStrides","j",Q)};
                }
                offsets[${Q-1}] = offset;

                isPad = false;
                for (var j = ${g-Q}u; j < ${g}u; j++) {
                  xIndices[j] = indices[j] * ${K("uniforms.strides",`j - ${g-Q}u`,Q)}
                    + offsets[j - ${g-Q}u] - ${K("uniforms.pads","j - 2u",X)};
                  ${re}
              }
              ${D}

              output[global_idx] = value;
            }`}},md=d=>`${d.format};${d.ceilMode};${d.autoPad};${d.kernelShape.length}`,Oh=d=>`${md(d)};${d.countIncludePad}`,zh=d=>`${md(d)};${d.storageOrder};${d.dilations}`,fd=d=>({format:d.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][d.auto_pad],ceilMode:d.ceil_mode,kernelShape:d.kernel_shape,strides:d.strides,pads:d.pads}),hd=(d,m,g,w)=>{let[$,I]=dd(m,w,g),D=P("x",m.dataType,m.dims.length),F=D.type.value,U="value += x_val;",j="";$.countIncludePad?j+=`value /= ${F}(uniforms.kernelSize);`:j+=`value /= ${F}(i32(uniforms.kernelSize) - pad);`;let[G,Z,H,q,V]=cd(I,$);G.push(...W(m.dims,I));let Q=["rank"];return{name:d,shaderCache:{hint:`${w.cacheKey};${H};${q};${V}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:I,dataType:m.dataType}],dispatchGroup:{x:Math.ceil(E$1.size(I)/64)},programUniforms:G}),getShaderSource:X=>pd(X,D,m.dims.length,I.length,$,U,j,0,Z,H,q,V)}},gd=d=>{let m=d.count_include_pad!==0,g=fd(d);if(g.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let w={countIncludePad:m,...g,cacheKey:""};return{...w,cacheKey:Oh(w)}},yd=(d,m)=>{ln(d.inputs),d.compute(hd("AveragePool",d.inputs[0],!1,m))},bd={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},_d=d=>{let m=d.format;return{format:m,...bd,cacheKey:m}},wd=(d,m)=>{ln(d.inputs),d.compute(hd("GlobalAveragePool",d.inputs[0],!0,m))},vd=(d,m,g,w)=>{let[$,I]=dd(m,w,g),D=`
      value = max(x_val, value);
    `,F="",U=P("x",m.dataType,m.dims.length),j=["rank"],[G,Z,H,q,V]=cd(I,$);return G.push(...W(m.dims,I)),{name:d,shaderCache:{hint:`${w.cacheKey};${H};${q};${V}`,inputDependencies:j},getRunData:()=>({outputs:[{dims:I,dataType:m.dataType}],dispatchGroup:{x:Math.ceil(E$1.size(I)/64)},programUniforms:G}),getShaderSource:Q=>pd(Q,U,m.dims.length,I.length,$,D,F,m.dataType===10?-65504:-1e5,Z,H,q,V)}},$d=(d,m)=>{ln(d.inputs),d.compute(vd("MaxPool",d.inputs[0],!1,m))},xd=d=>{let m=d.storage_order,g=d.dilations,w=fd(d);if(m!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(w.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let $={storageOrder:m,dilations:g,...w,cacheKey:""};return{...$,cacheKey:zh($)}},Sd=d=>{let m=d.format;return{format:m,...bd,cacheKey:m}},Td=(d,m)=>{ln(d.inputs),d.compute(vd("GlobalMaxPool",d.inputs[0],!0,m))}}),Bh,Mh,Id,Ad,Ed=L$1(()=>{ee(),ae(),Se(),ue(),Bh=(d,m)=>{if(d.length<2||d.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(d.length===3&&d[1].dims===d[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(d.length===3&&d[0].dataType!==d[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(d[0].dataType===6&&d.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(d[1].dims.length!==0&&d[1].dims.length!==1&&d[1].dims.length!==d[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(d.length>2){if(d[0].dataType!==d[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(d[1].dims.length!==d[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!d[1].dims.map((g,w)=>g===d[2].dims[w]).reduce((g,w)=>g&&w,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(m.blockSize>0){if(d[1].dims.length===0||d[1].dims.length===1&&d[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!d[1].dims.map(($,I)=>I===m.axis||$===d[0].dims[I]).reduce(($,I)=>$&&I,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(d[1].dims.length!==d[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let g=d[0].dims[m.axis],w=d[1].dims[m.axis];if(m.blockSize<Math.ceil(g/w)||m.blockSize>Math.ceil(g/(w-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Mh=(d,m)=>{let g=E$1.normalizeAxis(m.axis,d[0].dims.length),w=d[0].dataType,$=w===3,I=d[0].dims,D=d[1].dataType,F=E$1.size(I),U=w===3||w===2,j=U?[Math.ceil(E$1.size(d[0].dims)/4)]:d[0].dims,G=d[1].dims,Z=d.length>2?d[2]:void 0,H=Z?U?[Math.ceil(E$1.size(Z.dims)/4)]:Z.dims:void 0,q=G.length===0||G.length===1&&G[0]===1,V=q===!1&&G.length===1,Q=he(F),X=q&&(!U||Q===4),re=X?Q:1,J=X&&!U?Q:1,se=P("input",U?12:w,j.length,J),ie=P("scale",D,G.length),oe=Z?P("zero_point",U?12:w,H.length):void 0,pe=N$1("output",D,I.length,re),de=[se,ie];oe&&de.push(oe);let ge=[j,G];Z&&ge.push(H);let ce=[{type:12,data:F/re},{type:12,data:g},{type:12,data:m.blockSize},...W(...ge,I)],Ie=fe=>{let Te=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${fe.registerUniforms(Te).declareVariables(...de,pe)}
      ${fe.mainStart()}
          ${fe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${pe.offsetToIndices("global_idx")};

          // Set input x
          ${U?`
            let input = ${se.getByOffset("global_idx / 4")};
            let x_vec = ${$?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${re===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${se.getByOffset("global_idx")};`};

          // Set scale input
          ${q?`let scale_value= ${ie.getByOffset("0")}`:V?`
            let scale_index = ${pe.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${ie.getByOffset("scale_index")};`:`
            var scale_indices: ${ie.type.indices} = output_indices;
            let index = ${ie.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${ie.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${ie.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${oe?q?U?`
                let zero_point_input = ${oe.getByOffset("0")};
                let zero_point_vec =  ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${oe.getByOffset("0")}`:V?U?`
                let zero_point_index = ${pe.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${oe.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${pe.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${oe.getByOffset("zero_point_index")};`:U?`
                let zero_point_offset = ${ie.indicesToOffset("scale_indices")};
                let zero_point_input = ${oe.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${oe.getByIndices("scale_indices")};`:`let zero_point_value = ${U?$?"i32":"u32":se.type.value}(0);`};
      // Compute and write output
      ${pe.setByOffset("global_idx",`${pe.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:m.cacheKey,inputDependencies:oe?["rank","rank","rank"]:["rank","rank"]},getShaderSource:Ie,getRunData:()=>({outputs:[{dims:I,dataType:D}],dispatchGroup:{x:Math.ceil(F/re/64),y:1,z:1},programUniforms:ce})}},Id=(d,m)=>{Bh(d.inputs,m),d.compute(Mh(d.inputs,m))},Ad=d=>te({axis:d.axis,blockSize:d.blockSize})}),Rh,Uh,kd,Pd=L$1(()=>{Ve(),ee(),ue(),Rh=(d,m,g)=>{let w=d===m,$=d<m&&g<0,I=d>m&&g>0;if(w||$||I)throw new Error("Range these inputs' contents are invalid.")},Uh=(d,m,g,w)=>{let $=Math.abs(Math.ceil((m-d)/g)),I=[$],D=$,F=[{type:12,data:D},{type:w,data:d},{type:w,data:g},...W(I)],U=j=>{let G=N$1("output",w,I.length),Z=G.type.value,H=[{name:"outputSize",type:"u32"},{name:"start",type:Z},{name:"delta",type:Z}];return`
        ${j.registerUniforms(H).declareVariables(G)}
        ${j.mainStart()}
        ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${Z}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${w}`},getShaderSource:U,getRunData:()=>({outputs:[{dims:I,dataType:w}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:F})}},kd=d=>{let m=0,g=0,w=0;d.inputs[0].dataType===6?(m=d.inputs[0].getInt32Array()[0],g=d.inputs[1].getInt32Array()[0],w=d.inputs[2].getInt32Array()[0]):d.inputs[0].dataType===1&&(m=d.inputs[0].getFloat32Array()[0],g=d.inputs[1].getFloat32Array()[0],w=d.inputs[2].getFloat32Array()[0]),we.webgpu.validateInputContent&&Rh(m,g,w),d.compute(Uh(m,g,w,d.inputs[0].dataType),{inputs:[]})}}),Nh,Vh,Od,zd,Dd=L$1(()=>{ee(),ae(),Se(),ue(),Nh=(d,m,g,w)=>{if(d!=="none"&&w!=="i32"&&w!=="u32"&&w!=="f32")throw new Error(`Input ${w} is not supported with reduction ${d}.`);let $=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,I=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${m}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(d){case"none":return`${m}=${g};`;case"add":return w==="i32"||w==="u32"?`atomicAdd(&${m}, bitcast<${w}>(${g}));`:`
              ${$}bitcast<${w}>(oldValue) + (${g})${I}`;case"max":return w==="i32"||w==="u32"?`atomicMax(&${m}, bitcast<${w}>(${g}));`:`
                ${$}max(bitcast<f32>(oldValue), (${g}))${I}`;case"min":return w==="i32"||w==="u32"?`atomicMin(&${m}, bitcast<${w}>(${g}));`:`${$}min(bitcast<${w}>(oldValue), (${g}))${I}`;case"mul":return`${$}(bitcast<${w}>(oldValue) * (${g}))${I}`;default:throw new Error(`Reduction ${d} is not supported.`)}},Vh=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g,I=1,D=Math.ceil(E$1.sizeToDimension(w,w.length-1)/I),F=w[w.length-1],U=E$1.sizeFromDimension(g,F),j=[{type:12,data:D},{type:12,data:F},{type:12,data:U},...W(d[1].dims,d[2].dims,$)],G=Z=>{let H=P("indices",d[1].dataType,d[1].dims.length),q=P("updates",d[2].dataType,d[2].dims.length,I),V=m.reduction!=="none"&&m.reduction!==""?as("output",d[0].dataType,$.length):N$1("output",d[0].dataType,$.length,I);return`
      ${Z.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(H,q,V)}
      ${Z.mainStart()}
        ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${d[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${Nh(m.reduction,"output[data_offset + i]","value",V.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${m.cacheKey}_${m.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:$,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:j}),getShaderSource:G}},Od=d=>te({reduction:d.reduction}),zd=(d,m)=>{d.compute(Vh(d.inputs,m),{inputs:[d.inputs[1],d.inputs[2]],outputs:[]})}}),Lh,Wh,Gh,Bd,Hh,Fh,qh,jh,Kh,Zh,Qh,Yh,Md,Xh,Jh,eg,tg,rg,Rd,Ud,Nd=L$1(()=>{ee(),ae(),Se(),ue(),Lh=(d,m)=>{if(d.every(g=>g>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),d.length>0){if(m.mode==="linear"){if(!(d.length===2||d.length===3||d.length===4&&d[0]===1&&d[1]===1||d.length===4&&d[0]===1&&d[3]===1||d.length===5&&d[0]===1&&d[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(m.mode==="cubic"&&!(d.length===2||d.length===4&&d[0]===1&&d[1]===1||d.length===4&&d[0]===1&&d[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Wh=(d,m,g)=>{m.every($=>$>=0&&$<g||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let w=new Array(g).fill(1);return m.forEach(($,I)=>w[$]=d[I]),w},Gh=(d,m,g,w,$,I)=>{let[D,F,U]=g>10?[1,2,3]:[-1,d.length>1?1:-1,-1],j=d[0].dims.length;if(D>0&&d.length>D&&d[D].dims.length>0)d[D].getFloat32Array().forEach(G=>I.push(G));else if(m.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(F>0&&d.length>F&&d[F].dims.length===1&&d[F].dims[0]>0){if(d[F].getFloat32Array().forEach(G=>w.push(G)),w.length!==0&&w.length!==j&&g>=18&&w.length!==m.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Lh(w,m),m.axes.length>0&&Wh(w,m.axes,j).forEach((G,Z)=>w[Z]=G)}if(U>0&&d.length>U&&d[U].dims.length===1&&d[U].dims[0]>0&&(d[U].getBigInt64Array().forEach(G=>$.push(Number(G))),$.length!==0&&$.length!==j&&g>=18&&$.length!==m.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(m.axes.length>0){if(w.length!==0&&w.length!==m.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if($.length!==0&&$.length!==m.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof w<"u"&&typeof $<"u"&&w.length>0&&$.length>j)throw new Error("Resize requires only of scales or sizes to be specified")},Bd=(d,m,g,w)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${d}) * (${m});
  let whole = ${w}(big / (${g}));
  let fract = ${w}(big % (${g})) / ${w}(${g});
  return whole + fract;
`,Hh=(d,m)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${m} { `+(()=>{switch(d){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${m}(xResized) / ${m}(xScale);
          } else {
            ${Bd("xResized","lengthOriginal","lengthResized",m)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${m}(xResized) + 0.5) / ${m}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${m}(xResized) + 0.5) / ${m}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Bd("xResized","lengthOriginal - 1","lengthResized - 1",m)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${m}(roiStart) * ${m}(lengthOriginal - 1) +
                        (${m}(xResized) * ${m}(roiEnd - roiStart) * ${m}(lengthOriginal - 1)) /
                        ${m}(lengthResized - 1);
                  } else {
                    return 0.5 * ${m}(roiStart + roiEnd) * ${m}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${m}xScale * ${m}(lengthResized);
                  const adjustment = ${m}(lengthResized) / outputWidth;
                  const center = ${m}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${m}(xResized) + 0.5) / ${m}(xScale)) - 0.5;`;case"half_pixel":return`return ((${m}(xResized) + 0.5) / ${m}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${d} is not supported`)}})()+"}",Fh=(d,m,g)=>`fn getNearestPixelFromOriginal(xOriginal: ${g}, isDownSample: bool) -> ${g} {`+(()=>{switch(d){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(m<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${d} is not supported`)}})()+"}",qh=(d,m,g)=>{let w=new Array(g).fill(0).concat(new Array(g).fill(1)),$=d.length===0?w:d.slice();return m.length>0?(m.forEach((I,D)=>{w[I]=$[D],w[D+g]=$[m.length+D]}),w):$},jh=(d,m,g,w)=>{let $=[];if(g.length>0)if(w.length>0){if(d.forEach(I=>$.push(I)),Math.max(...w)>d.length)throw new Error("axes is out of bound");w.forEach((I,D)=>$[I]=g[D])}else g.forEach(I=>$.push(I));else{if(m.length===0)throw new Error("Resize requires either scales or sizes.");$=d.map((I,D)=>Math.round(I*m[D]))}return $},Kh=(d,m,g)=>{let w=(()=>{switch(g.keepAspectRatioPolicy){case"not_larger":return g.axes.length>0?Math.min(...g.axes.map(I=>m[I]),Number.MAX_VALUE):Math.min(...m,Number.MAX_VALUE);case"not_smaller":return g.axes.length>0?Math.max(...g.axes.map(I=>m[I]),Number.MIN_VALUE):Math.max(...m,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${g.keepAspectRatioPolicy} is not supported`)}})();m.fill(1,0,m.length);let $=d.slice();return g.axes.length>0?(g.axes.forEach(I=>m[I]=w),g.axes.forEach(I=>$[I]=Math.round(d[I]*m[I]))):(m.fill(w,0,m.length),$.forEach((I,D)=>$[D]=Math.round(I*m[D]))),$},Zh=(d,m,g,w,$)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${d.type.indices}) -> array<${d.type.value}, ${g.length}> {
      var original_indices: array<${d.type.value}, ${g.length}>;
      for (var i:u32 = 0; i < ${g.length}; i++) {
        var output_index = ${d.indicesGet("output_indices","i")};
        var scale = ${K("uniforms.scales","i",w)};
        var roi_low = ${K("uniforms.roi","i",$)};
        var roi_hi = ${K("uniforms.roi",`i + ${m.length}`,$)};
        if (scale == 1.0) {
          original_indices[i] = ${d.type.value}(output_index);
        } else {
          var input_shape_i = ${K("uniforms.input_shape","i",m.length)};
          var output_shape_i = ${K("uniforms.output_shape","i",g.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Qh=(d,m,g,w,$,I,D)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${m.type.indices}) -> ${d.type.indices} {
      var input_indices: ${d.type.indices};
      for (var i:u32 = 0; i < ${w.length}; i++) {
        var output_index = ${m.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${K("uniforms.scales","i",$)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${K("uniforms.roi","i",I)};
          var roi_hi = ${K("uniforms.roi",`i + ${g.length}`,I)};
          var input_shape_i = ${K("uniforms.input_shape","i",g.length)};
          var output_shape_i = ${K("uniforms.output_shape","i",w.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${D} || (original_idx >= 0 && original_idx < ${m.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${m.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${d.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,Yh=(d,m)=>`
    fn checkInputIndices(input_indices: ${d.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${m.length}; i++) {
        var input_index = ${d.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${K("uniforms.input_shape","i",m.length)}) {
          return false;
        }
      }
      return true;
    }`,Md=(d,m,g,w)=>d.rank>w?`
    ${d.indicesSet("input_indices",m,"channel")};
    ${d.indicesSet("input_indices",g,"batch")};
`:"",Xh=(d,m,g,w,$)=>{let[I,D,F,U]=g.length===2?[-1,0,1,-1]:[0,2,3,1],j=d.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${j} {
      var input_indices: ${d.type.indices};
      ${d.indicesSet("input_indices",D,`max(0, min(row, ${g[D]} - 1))`)};
      ${d.indicesSet("input_indices",F,`max(0, min(col, ${g[F]} - 1))`)};
      ${Md(d,U,I,2)}
      return ${d.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${m.type.indices}) -> ${j} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${j} = originalIndices[${D}];
      var col:${j} = originalIndices[${F}];
      ${w?`if (row < 0 || row > (${g[D]} - 1) || col < 0 || col > (${g[F]} - 1)) {
        return ${$};
      }`:""};
      row = max(0, min(row, ${g[D]} - 1));
      col = max(0, min(col, ${g[F]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${g.length>2?`u32(originalIndices[${U}])`:"0"};
      var batch: u32 =  ${g.length>2?`u32(originalIndices[${I}])`:"0"};
      var x11: ${j} = getInputValue(batch, channel, row1, col1);
      var x12: ${j} = getInputValue(batch, channel, row1, col2);
      var x21: ${j} = getInputValue(batch, channel, row2, col1);
      var x22: ${j} = getInputValue(batch, channel, row2, col2);
      var dx1: ${j} = abs(row - ${j}(row1));
      var dx2: ${j} = abs(${j}(row2) - row);
      var dy1: ${j} = abs(col - ${j}(col1));
      var dy2: ${j} = abs(${j}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Jh=(d,m,g,w,$,I,D,F,U,j)=>{let G=g.length===2,[Z,H]=G?[0,1]:[2,3],q=d.type.value,V=Q=>{let X=Q===Z?"row":"col";return`
      fn ${X}CubicInterpolation(input_indices: ${d.type.indices}, output_indices: ${m.type.indices}) -> ${q} {
        var output_index = ${m.indicesGet("output_indices",Q)};
        var originalIdx: ${q} = getOriginalCoordinateFromResizedCoordinate(output_index, ${$[Q]},
        ${w[Q]}, ${g[Q]}, ${I[Q]}, ${I[Q]} + ${g.length});
        var fractOriginalIdx: ${q} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${F} && (originalIdx < 0 || originalIdx > (${g[Q]} - 1))) {
          return ${U};
        }
        var data: array<${q}, 4> = array<${q}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${X}: ${q} = originalIdx + ${q}(i);
          if (${X} < 0 || ${X} >= ${g[Q]}) {
            ${j?`coefs[i + 1] = 0.0;
                        continue;`:F?`return ${U};`:`${X} = max(0, min(${X}, ${g[Q]} - 1));`};
          }
        var input_indices_copy: ${d.type.indices} = input_indices;
          ${d.indicesSet("input_indices_copy",Q,`u32(${X})`)};
          data[i + 1] = ${Q===Z?d.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${V(Z)};
    ${V(H)};
  fn getCubicInterpolationCoefs(s: ${q}) -> array<${q}, 4> {
    var absS = abs(s);
    var coeffs: array<${q}, 4> = array<${q}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${q} = 1.0 - absS;
    var twoMinusAbsS: ${q} = 2.0 - absS;
    var onePlusAbsS: ${q} = 1.0 + absS;
    coeffs[0] = ((${D} * onePlusAbsS - 5 * ${D}) * onePlusAbsS + 8 * ${D}) * onePlusAbsS - 4 * ${D};
    coeffs[1] = ((${D} + 2) * absS - (${D} + 3)) * absS * absS + 1;
    coeffs[2] = ((${D} + 2) * oneMinusAbsS - (${D} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${D} * twoMinusAbsS - 5 * ${D}) * twoMinusAbsS + 8 * ${D}) * twoMinusAbsS - 4 * ${D};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${q}, 4>, coefs: array<${q}, 4>) -> ${q} {
    var coefsSum: ${q} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${m.type.indices}) -> ${q} {
    var input_indices: ${d.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},eg=(d,m,g,w,$)=>{let[I,D,F,U,j]=g.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],G=d.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${G} {
      var input_indices: ${d.type.indices};
      ${d.indicesSet("input_indices",D,`max(0, min(depth, ${g[D]} - 1))`)};
      ${d.indicesSet("input_indices",F,`max(0, min(height, ${g[F]} - 1))`)};
      ${d.indicesSet("input_indices",U,`max(0, min(width, ${g[U]} - 1))`)};
      ${Md(d,j,I,3)}
      return ${d.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${m.type.indices}) -> ${G} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${G} = originalIndices[${D}];
      var height:${G} = originalIndices[${F}];
      var width:${G} = originalIndices[${U}];
      ${w?`if (depth < 0 || depth > (${g[D]} - 1) || height < 0 || height > (${g[F]} - 1) || width < 0 || (width > ${g[U]} - 1)) {
      return ${$};
        }`:""};

    depth = max(0, min(depth, ${g[D]} - 1));
      height = max(0, min(height, ${g[F]} - 1));
      width = max(0, min(width, ${g[U]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${g.length>3?`u32(originalIndices[${j}])`:"0"};
      var batch: u32 =  ${g.length>3?`u32(originalIndices[${I}])`:"0"};

      var x111: ${G} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${G} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${G} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${G} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${G} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${G} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${G} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${G} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${G} = abs(depth - ${G}(depth1));
      var dx2: ${G} = abs(${G}(depth2) - depth);
      var dy1: ${G} = abs(height - ${G}(height1));
      var dy2: ${G} = abs(${G}(height2) - height);
      var dz1: ${G} = abs(width - ${G}(width1));
      var dz2: ${G} = abs(${G}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},tg=(d,m,g,w,$,I)=>{let D=d.dims,F=qh(I,m.axes,D.length),U=jh(D,w,$,m.axes),j=w.slice();w.length===0&&(j=D.map((J,se)=>J===0?1:U[se]/J),m.keepAspectRatioPolicy!=="stretch"&&(U=Kh(D,j,m)));let G=N$1("output",d.dataType,U.length),Z=P("input",d.dataType,D.length),H=E$1.size(U),q=D.length===U.length&&D.every((J,se)=>J===U[se]),V=m.coordinateTransformMode==="tf_crop_and_resize",Q=m.extrapolationValue,X=Z.type.value,re=J=>`
      ${q?"":`
      ${Hh(m.coordinateTransformMode,X)};
      ${(()=>{switch(m.mode){case"nearest":return`
              ${Yh(Z,D)};
              ${Fh(m.nearestMode,g,X)};
              ${Qh(Z,G,D,U,j.length,F.length,V)};
              `;case"linear":return`
              ${Zh(G,D,U,j.length,F.length)};
              ${(()=>{if(D.length===2||D.length===4)return`${Xh(Z,G,D,V,Q)}`;if(D.length===3||D.length===5)return`${eg(Z,G,D,V,Q)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(D.length===2||D.length===4)return`${Jh(Z,G,D,U,j,F,m.cubicCoeffA,V,m.extrapolationValue,m.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${J.registerUniform("output_size","u32").registerUniform("scales","f32",j.length).registerUniform("roi","f32",F.length).declareVariables(Z,G)}
      ${J.mainStart()}
        ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${q?"output[global_idx] = input[global_idx];":`
        let output_indices = ${G.offsetToIndices("global_idx")};
        var input_indices: ${Z.type.indices};
        ${(()=>{switch(m.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${Z.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${m.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${D.length===2||D.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${m.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${m.cacheKey}|${g}|${j.length>0?m.mode==="cubic"?j:j.length:""}|${$.length>0?$:""}|${F.length>0?F:""}|${q}|${m.mode==="nearest"?D.length:D}`,inputDependencies:["rank"]},getShaderSource:re,getRunData:()=>({outputs:[{dims:U,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:[{type:12,data:H},{type:1,data:j},{type:1,data:F},...W(D,U)]})}},rg=d=>{let m=d.customDataBuffer;return new Uint32Array(m,m.byteOffset,1)[0]},Rd=(d,m)=>{let g=[],w=[],$=[],I=rg(d);if(m.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Gh(d.inputs,m,I,g,w,$),d.compute(tg(d.inputs[0],m,I,g,w,$),{inputs:[0]})},Ud=d=>{let m=d.antialias,g=d.axes,w=d.coordinateTransformMode,$=d.cubicCoeffA,I=d.excludeOutside!==0,D=d.extrapolationValue,F=d.keepAspectRatioPolicy,U=d.mode,j=d.nearestMode===""?"simple":d.nearestMode;return te({antialias:m,axes:g,coordinateTransformMode:w,cubicCoeffA:$,excludeOutside:I,extrapolationValue:D,keepAspectRatioPolicy:F,mode:U,nearestMode:j})}}),ng,og,Vd,Ld=L$1(()=>{ee(),ae(),ue(),ng=d=>{if(!d||d.length<3)throw new Error("layerNorm requires at least 3 inputs.");let m=d[0],g=d[1],w=d[2];if(m.dataType!==g.dataType||m.dataType!==w.dataType)throw new Error("All inputs must have the same data type");if(m.dims.length!==3&&m.dims.length!==2)throw new Error("Input must be 2D or 3D");if(g.dims.length!==3&&g.dims.length!==2)throw new Error("Skip must be 2D or 3D");let $=m.dims[m.dims.length-1],I=m.dims[m.dims.length-2];if(g.dims[g.dims.length-1]!==$)throw new Error("Skip must have the same hidden size as input");if(g.dims[g.dims.length-2]!==I)throw new Error("Skip must have the same sequence length as input");if(w.dims.length!==1)throw new Error("Gamma must be 1D");if(w.dims[w.dims.length-1]!==$)throw new Error("Gamma must have the same hidden size as input");if(d.length>3){let D=d[3];if(D.dims.length!==1)throw new Error("Beta must be 1D");if(D.dims[D.dims.length-1]!==$)throw new Error("Beta must have the same hidden size as input")}if(d.length>4){let D=d[4];if(D.dims.length!==1)throw new Error("Bias must be 1D");if(D.dims[D.dims.length-1]!==$)throw new Error("Bias must have the same hidden size as input")}},og=(d,m,g,w)=>{let $=m.simplified,I=d[0].dims,D=E$1.size(I),F=I,U=D,j=I.slice(-1)[0],G=w?I.slice(0,-1).concat(1):[],Z=!$&&d.length>3,H=d.length>4,q=w&&g>1,V=w&&g>2,Q=g>3,X=64,re=he(j),J=[{type:12,data:U},{type:12,data:re},{type:12,data:j},{type:1,data:m.epsilon}],se=oe=>{let pe=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],de=[P("x",d[0].dataType,d[0].dims,re),P("skip",d[1].dataType,d[1].dims,re),P("gamma",d[2].dataType,d[2].dims,re)];Z&&de.push(P("beta",d[3].dataType,d[3].dims,re)),H&&de.push(P("bias",d[4].dataType,d[4].dims,re)),de.push(N$1("output",d[0].dataType,F,re)),q&&de.push(N$1("mean_output",1,G)),V&&de.push(N$1("inv_std_output",1,G)),Q&&de.push(N$1("input_skip_bias_sum",d[0].dataType,F,re));let ge=ve(d[0].dataType),ce=ve(1,re);return`

      ${oe.registerUniforms(pe).declareVariables(...de)}
      var<workgroup> sum_shared : array<${ce}, ${X}>;
      var<workgroup> sum_squared_shared : array<${ce}, ${X}>;

      ${oe.mainStart([X,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${X};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${X};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${X-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${H?"bias[offset1d + i]":ge+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${Q?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Mt(ge,re,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${X};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${je("sum",re)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${je("square_sum",re)} / f32(uniforms.hidden_size) ${$?"":"- mean * mean"} + uniforms.epsilon);
        ${q?"mean_output[global_idx] = mean;":""}
        ${V?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${$?"":`- ${ge}(mean)`}) *
            ${ge}(inv_std_dev) * gamma[offset1d + i]
            ${Z?"+ beta[offset1d + i]":""};
        }
      }`},ie=[{dims:F,dataType:d[0].dataType}];return g>1&&ie.push({dims:G,dataType:1}),g>2&&ie.push({dims:G,dataType:1}),g>3&&ie.push({dims:I,dataType:d[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${re};${q};${V};${Q}`,inputDependencies:d.map((oe,pe)=>"type")},getShaderSource:se,getRunData:()=>({outputs:ie,dispatchGroup:{x:Math.ceil(U/j)},programUniforms:J})}},Vd=(d,m)=>{ng(d.inputs);let g=[0];d.outputCount>1&&g.push(-3),d.outputCount>2&&g.push(-3),d.outputCount>3&&g.push(3),d.compute(og(d.inputs,m,d.outputCount,!1),{outputs:g})}}),ig,dn,ag,Wd,sg,ug,Gd,Hd,Fd=L$1(()=>{ee(),ae(),Se(),ue(),ig=(d,m)=>{if(!d||d.length<1)throw new Error("too few inputs");if(m.axes.length!==0){if(m.axes.length!==m.starts.length||m.axes.length!==m.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(m.starts.length!==m.ends.length)throw new Error("starts and ends must have the same length");d.slice(1).forEach((g,w)=>{if(d[w+1].dataType!==6&&d[w+1].dataType!==7)throw new Error(`Input ${w} must be an array of int32 or int64`)})},dn=(d,m)=>{let g=[];if(d.length>m)if(d[m].dataType===7)d[m].getBigInt64Array().forEach(w=>g.push(Number(w)));else if(d[m].dataType===6)d[m].getInt32Array().forEach(w=>g.push(Number(w)));else throw new Error(`Input ${m} must be an array of int32 or int64`);return g},ag=(d,m)=>{if(d.length>1){let g=dn(d,1),w=dn(d,2),$=dn(d,3);return $.length===0&&($=[...Array(d[0].dims.length).keys()]),te({starts:g,ends:w,axes:$})}else return m},Wd=(d,m,g,w,$)=>{let I=d;return d<0&&(I+=g[w[m]]),$[m]<0?Math.max(0,Math.min(I,g[w[m]]-1)):Math.max(0,Math.min(I,g[w[m]]))},sg=(d,m,g)=>`fn calculateInputIndices(output_indices: ${m.type.indices}) -> ${d.type.indices} {
          var input_indices: ${d.type.indices};
          var carry = 0u;
          for (var i = ${g.length-1}; i >= 0; i--) {
            let input_shape_i = ${K("uniforms.input_shape","i",g.length)};
            let steps_i = ${K("uniforms.steps","i",g.length)};
            let signs_i = ${K("uniforms.signs","i",g.length)};
            let starts_i = ${K("uniforms.starts","i",g.length)};
            var output_index = ${m.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${d.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,ug=(d,m)=>{let g=d[0].dims,w=E$1.size(g),$=m.axes.length>0?E$1.normalizeAxes(m.axes,g.length):[...Array(g.length).keys()],I=dn(d,4);I.forEach(re=>re!==0||(()=>{throw new Error("step cannot be 0")})),I.length===0&&(I=Array($.length).fill(1));let D=m.starts.map((re,J)=>Wd(re,J,g,$,I)),F=m.ends.map((re,J)=>Wd(re,J,g,$,I));if($.length!==D.length||$.length!==F.length)throw new Error("start, ends and axes should have the same number of elements");if($.length!==g.length)for(let re=0;re<g.length;++re)$.includes(re)||(D.splice(re,0,0),F.splice(re,0,g[re]),I.splice(re,0,1));let U=I.map(re=>Math.sign(re));I.forEach((re,J,se)=>{if(re<0){let ie=(F[J]-D[J])/re,oe=D[J],pe=oe+ie*I[J];D[J]=pe,F[J]=oe,se[J]=-re}});let j=g.slice(0);$.forEach((re,J)=>{j[re]=Math.ceil((F[re]-D[re])/I[re])});let G={dims:j,dataType:d[0].dataType},Z=N$1("output",d[0].dataType,j.length),H=P("input",d[0].dataType,d[0].dims.length),q=E$1.size(j),V=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:D.length},{name:"signs",type:"i32",length:U.length},{name:"steps",type:"u32",length:I.length}],Q=[{type:12,data:q},{type:12,data:D},{type:6,data:U},{type:12,data:I},...W(d[0].dims,j)],X=re=>`
      ${re.registerUniforms(V).declareVariables(H,Z)}
        ${sg(H,Z,g)}
        ${re.mainStart()}
          ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${Z.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${Z.setByOffset("global_idx",H.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${U.length}_${D.length}_${I.length}`,inputDependencies:["rank"]},getShaderSource:X,getRunData:()=>({outputs:[G],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:Q})}},Gd=(d,m)=>{ig(d.inputs,m);let g=ag(d.inputs,m);d.compute(ug(d.inputs,g),{inputs:[0]})},Hd=d=>{let m=d.starts,g=d.ends,w=d.axes;return te({starts:m,ends:g,axes:w})}}),lg,dg,qd,jd,Kd=L$1(()=>{ee(),ae(),Se(),ct(),ue(),lg=d=>{if(!d||d.length!==1)throw new Error("Softmax op requires 1 input.")},dg=(d,m)=>{let g=d.inputs[0],w=g.dims,$=E$1.size(w),I=w.length,D=E$1.normalizeAxis(m.axis,I),F=D<w.length-1,U,j=[];F?(j=Array.from({length:I},(de,ge)=>ge),j[D]=I-1,j[I-1]=D,U=d.compute(Pe(g,j),{inputs:[g],outputs:[-1]})[0]):U=g;let G=U.dims,Z=G[I-1],H=$/Z,q=he(Z),V=Z/q,Q=64;H===1&&(Q=256);let X=(de,ge)=>ge===4?`max(max(${de}.x, ${de}.y), max(${de}.z, ${de}.w))`:ge===2?`max(${de}.x, ${de}.y)`:ge===3?`max(max(${de}.x, ${de}.y), ${de}.z)`:de,re=P("x",U.dataType,U.dims,q),J=N$1("result",U.dataType,U.dims,q),se=re.type.value,ie=ve(U.dataType)==="f32"?`var threadMax = ${se}(-3.402823e+38f);`:`var threadMax = ${se}(-65504.0h);`,oe=de=>`
      var<workgroup> rowMaxShared : ${se};
      var<workgroup> rowSumShared : ${se};
      var<workgroup> threadShared : array<${se}, ${Q}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${se} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${se}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${de.registerUniform("packedCols","i32").declareVariables(re,J)}
      ${de.mainStart(Q)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${Q};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${ie}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${se}(${X("threadShared[0]",q)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${se}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${se}(${je("threadShared[0]",q)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${se}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,pe=d.compute({name:"Softmax",shaderCache:{hint:`${q};${Q}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:G,dataType:U.dataType}],dispatchGroup:{x:H},programUniforms:[{type:6,data:V}]}),getShaderSource:oe},{inputs:[U],outputs:[F?-1:0]})[0];F&&d.compute(Pe(pe,j),{inputs:[pe]})},qd=(d,m)=>{lg(d.inputs),dg(d,m)},jd=d=>te({axis:d.axis})}),Zd,cg,pg,mg,Qd,Yd=L$1(()=>{ee(),ae(),ue(),Zd=d=>Array.from(d.getBigInt64Array(),Number),cg=d=>{if(!d||d.length!==2)throw new Error("Tile requires 2 inputs.");if(d[0].dataType!==1&&d[0].dataType!==10&&d[0].dataType!==6&&d[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(d[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(d[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(Zd(d[1]).length!==d[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},pg=(d,m)=>{let g=[];for(let w=0;w<d.length;++w)g.push(d[w]*m[w]);return g},mg=(d,m)=>{let g=d[0].dims,w=m??Zd(d[1]),$=pg(g,w),I=E$1.size($),D=d[0].dataType,F=P("input",D,g.length),U=N$1("output",D,$.length),j=G=>`
      const inputShape = ${F.indices(...g)};
      ${G.registerUniform("output_size","u32").declareVariables(F,U)}
      ${G.mainStart()}
      ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${U.offsetToIndices("global_idx")};
      var input_indices: ${F.type.indices};
      for (var i = 0; i < ${g.length}; i++) {
        let input_dim_i = ${F.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${U.indicesGet("output_indices","i")}  % input_dim_i;

        ${F.indicesSet("input_indices","i","input_dim_value")}
      }
      ${U.setByOffset("global_idx",F.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${w}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:$,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...W(d[0].dims,$)]}),getShaderSource:j}},Qd=d=>{cg(d.inputs),d.compute(mg(d.inputs),{inputs:[0]})}}),fg,hg,Xd,Jd=L$1(()=>{ee(),ae(),ue(),fg=(d,m,g,w,$)=>{let I=N$1("output_data",$,g.length,4),D=P("a_data",m[1].dataType,m[1].dims.length,4),F=P("b_data",m[2].dataType,m[2].dims.length,4),U=P("c_data",m[0].dataType,m[0].dims.length,4),j,G=(Z,H,q)=>`select(${H}, ${Z}, ${q})`;if(!w)j=I.setByOffset("global_idx",G(D.getByOffset("global_idx"),F.getByOffset("global_idx"),U.getByOffset("global_idx")));else{let Z=(H,q,V="")=>{let Q=`a_data[index_a${q}][component_a${q}]`,X=`b_data[index_b${q}][component_b${q}]`,re=`bool(c_data[index_c${q}] & (0xffu << (component_c${q} * 8)))`;return`
            let output_indices${q} = ${I.offsetToIndices(`global_idx * 4u + ${q}u`)};
            let offset_a${q} = ${D.broadcastedIndicesToOffset(`output_indices${q}`,I)};
            let offset_b${q} = ${F.broadcastedIndicesToOffset(`output_indices${q}`,I)};
            let offset_c${q} = ${U.broadcastedIndicesToOffset(`output_indices${q}`,I)};
            let index_a${q} = offset_a${q} / 4u;
            let index_b${q} = offset_b${q} / 4u;
            let index_c${q} = offset_c${q} / 4u;
            let component_a${q} = offset_a${q} % 4u;
            let component_b${q} = offset_b${q} % 4u;
            let component_c${q} = offset_c${q} % 4u;
            ${H}[${q}] = ${V}(${G(Q,X,re)});
          `};$===9?j=`
            var data = vec4<u32>(0);
            ${Z("data",0,"u32")}
            ${Z("data",1,"u32")}
            ${Z("data",2,"u32")}
            ${Z("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:j=`
            ${Z("output_data[global_idx]",0)}
            ${Z("output_data[global_idx]",1)}
            ${Z("output_data[global_idx]",2)}
            ${Z("output_data[global_idx]",3)}
          `}return`
        ${d.registerUniform("vec_size","u32").declareVariables(U,D,F,I)}
        ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${j}
      }`},hg=d=>{let m=d[1].dims,g=d[2].dims,w=d[0].dims,$=d[1].dataType,I=!(E$1.areEqual(m,g)&&E$1.areEqual(g,w)),D=m,F=E$1.size(m);if(I){let j=tt.calcShape(tt.calcShape(m,g,!1),w,!1);if(!j)throw new Error("Can't perform where op on the given tensors");D=j,F=E$1.size(D)}let U=Math.ceil(F/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:j=>fg(j,d,D,I,$),getRunData:()=>({outputs:[{dims:D,dataType:$}],dispatchGroup:{x:Math.ceil(F/64/4)},programUniforms:[{type:12,data:U},...W(w,m,g,D)]})}},Xd=d=>{d.compute(hg(d.inputs))}}),ec,tc=L$1(()=>{Bs(),Yr(),Us(),Vs(),Tu(),Mu(),Nu(),tl(),ul(),cl(),fl(),_l(),$l(),Sl(),Il(),kl(),zl(),Ml(),Nl(),Wl(),Yl(),ed(),rd(),od(),sd(),Eo(),ld(),Cd(),Ed(),Pd(),Dd(),Zr(),Nd(),Oo(),Ld(),Fd(),Kd(),Po(),Yd(),ct(),Jr(),Jd(),ec=new Map([["Abs",[Ls]],["Acos",[Ws]],["Acosh",[Gs]],["Add",[Cu]],["ArgMax",[Ds,go]],["ArgMin",[zs,go]],["Asin",[Hs]],["Asinh",[Fs]],["Atan",[qs]],["Atanh",[js]],["Attention",[Ms]],["AveragePool",[yd,gd]],["BatchNormalization",[Rs]],["BiasAdd",[Ns]],["BiasSplitGelu",[Su]],["Cast",[Zs,Ks]],["Ceil",[Ys]],["Clip",[Qs]],["Concat",[Ru,Uu]],["Conv",[To,So]],["ConvTranspose",[sl,il]],["Cos",[Xs]],["Cosh",[Js]],["CumSum",[ll,dl]],["DepthToSpace",[pl,ml]],["DequantizeLinear",[Id,Ad]],["Div",[Iu]],["Einsum",[yl,bl]],["Elu",[eu,or]],["Equal",[Au]],["Erf",[tu]],["Exp",[ru]],["Expand",[vl]],["FastGelu",[xl]],["Floor",[nu]],["FusedConv",[To,So]],["Gather",[Cl,Tl]],["GatherElements",[Bl,Dl]],["GatherBlockQuantized",[Pl,Ol]],["GatherND",[Al,El]],["Gelu",[ou]],["Gemm",[Ul,Rl]],["GlobalAveragePool",[wd,_d]],["GlobalMaxPool",[Td,Sd]],["Greater",[Ou]],["GreaterOrEqual",[Du]],["GridSample",[Vl,Ll]],["GroupQueryAttention",[Ql]],["HardSigmoid",[pu,cu]],["InstanceNormalization",[Jl]],["LayerNormalization",[td]],["LeakyRelu",[iu,or]],["Less",[zu]],["LessOrEqual",[Bu]],["Log",[vu]],["MatMul",[nd]],["MatMulNBits",[id,ad]],["MaxPool",[$d,xd]],["Mul",[Eu]],["MultiHeadAttention",[Fl,Hl]],["Neg",[su]],["Not",[au]],["Pad",[ud]],["Pow",[ku]],["QuickGelu",[$u,or]],["Range",[kd]],["Reciprocal",[uu]],["ReduceMin",[Is]],["ReduceMean",[$s]],["ReduceMax",[Cs]],["ReduceSum",[Es]],["ReduceProd",[As]],["ReduceL1",[xs]],["ReduceL2",[Ss]],["ReduceLogSum",[Ps]],["ReduceLogSumExp",[Ts]],["ReduceSumSquare",[ks]],["Relu",[lu]],["Resize",[Rd,Ud]],["RotaryEmbedding",[Kl]],["ScatterND",[zd,Od]],["Sigmoid",[du]],["Sin",[mu]],["Sinh",[fu]],["Slice",[Gd,Hd]],["SkipLayerNormalization",[Vd]],["Split",[ql,jl]],["Sqrt",[hu]],["Softmax",[qd,jd]],["Sub",[Pu]],["Tan",[gu]],["Tanh",[bu]],["ThresholdedRelu",[wu,or]],["Tile",[Qd]],["Transpose",[ls,ds]],["Where",[Xd]]])}),cn,rc=L$1(()=>{Ve(),et(),ue(),cn=class{constructor(d){this.backend=d,this.repo=new Map,this.attributesBound=!1}getArtifact(d){return this.repo.get(d)}setArtifact(d,m){this.repo.set(d,m)}run(d,m,g,w,$){Ne(d.programInfo.name);let I=this.backend.device,D=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let F=[];for(let j of m)F.push({binding:F.length,resource:{buffer:j.buffer}});for(let j of g)F.push({binding:F.length,resource:{buffer:j.buffer}});$&&F.push({binding:F.length,resource:$});let U=I.createBindGroup({layout:d.computePipeline.getBindGroupLayout(0),entries:F,label:d.programInfo.name});if(this.backend.sessionStatus==="capturing"){let j={kernelId:this.backend.currentKernelId,computePipeline:d.computePipeline,bindGroup:U,dispatchGroup:w};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(j)}D.setPipeline(d.computePipeline),D.setBindGroup(0,U),D.dispatchWorkgroups(...w),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Me(d.programInfo.name)}dispose(){}build(d,m){Ne(d.name);let g=this.backend.device,w=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(j=>{g.features.has(j.feature)&&w.push(`enable ${j.extension};`)});let $=ss(m,this.backend.device.limits),I=d.getShaderSource($),D=`${w.join(`
`)}
${$.additionalImplementations}
${I}`,F=g.createShaderModule({code:D,label:d.name});le("verbose",()=>`[WebGPU] ${d.name} shader code: ${D}`);let U=g.createComputePipeline({compute:{module:F,entryPoint:"main"},layout:"auto",label:d.name});return Me(d.name),{programInfo:d,computePipeline:U,uniformVariablesInfo:$.variablesInfo}}normalizeDispatchGroupSize(d){let m=typeof d=="number"?d:d.x,g=typeof d=="number"?1:d.y||1,w=typeof d=="number"?1:d.z||1,$=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(m<=$&&g<=$&&w<=$)return[m,g,w];let I=m*g*w,D=Math.ceil(Math.sqrt(I));if(D>$){if(D=Math.ceil(Math.cbrt(I)),D>$)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[D,D,D]}else return[D,D,1]}}}),nc={};Wt(nc,{WebGpuBackend:()=>Do});var gg,yg,zo,Do,oc=L$1(()=>{Ve(),ee(),et(),no(),is(),tc(),rc(),gg=(d,m)=>{if(m.length!==d.length)throw new Error(`inputDependencies length ${m.length} is not equal to inputTensors length ${d.length}.`);let g=[];for(let w=0;w<d.length;++w){let $=d[w].dataType;switch(m[w]){case"none":{g.push("");break}case"type":{g.push(`${$}`);break}case"rank":{let I=d[w].dims.length;g.push(`${$};${I}`);break}case"dims":{let I=d[w].dims.join(",");g.push(`${$};${I}`);break}default:throw new Error(`unsupported input dependency: ${m[w]}`)}}return g.join("|")},yg=(d,m,g)=>{let w=d.name;return d.shaderCache?.hint&&(w+="["+d.shaderCache.hint+"]"),w+=":"+g+`:${gg(m,d.shaderCache?.inputDependencies??new Array(m.length).fill("dims"))}`,w},zo=class{constructor(d){d&&(this.architecture=d.architecture,this.vendor=d.vendor)}isArchitecture(d){return this.architecture===d}isVendor(d){return this.vendor===d}},Do=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let d=this.kernelCustomData.get(this.currentKernelId);return d||(d={},this.kernelCustomData.set(this.currentKernelId,d)),d}async initialize(d,m){this.env=d;let g=[],w={requiredLimits:{maxComputeWorkgroupStorageSize:m.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:m.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:m.limits.maxStorageBufferBindingSize,maxBufferSize:m.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:m.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:m.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:m.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:m.limits.maxComputeWorkgroupSizeZ},requiredFeatures:g},$=I=>m.features.has(I)&&g.push(I)&&!0;$("chromium-experimental-timestamp-query-inside-passes")||$("timestamp-query"),$("shader-f16"),$("subgroups"),this.device=await m.requestDevice(w),this.adapterInfo=new zo(m.info||await m.requestAdapterInfo()),this.gpuDataManager=os(this),this.programManager=new cn(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Nr(d.logLevel,!!d.debug),this.device.onuncapturederror=I=>{I.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${I.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:m,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let d=this.getCommandEncoder(),m={};this.queryType==="at-passes"&&(m.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=d.beginComputePass(m)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Ne(),this.endComputePass();let d;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),d=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(d,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,d,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&d.mapAsync(GPUMapMode.READ).then(()=>{let m=new BigUint64Array(d.getMappedRange()),g=this.pendingQueries.get(d);for(let w=0;w<m.length/2;w++){let $=g[w],I=$.kernelId,D=this.kernels.get(I),F=D.kernelType,U=D.kernelName,j=$.programName,G=$.inputTensorViews,Z=$.outputTensorViews,H=m[w*2],q=m[w*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=H);let V=Number(H-this.queryTimeBase),Q=Number(q-this.queryTimeBase);if(!Number.isSafeInteger(V)||!Number.isSafeInteger(Q))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:G.map(X=>({dims:X.dims,dataType:Je(X.dataType)})),outputsMetadata:Z.map(X=>({dims:X.dims,dataType:Je(X.dataType)})),kernelId:I,kernelType:F,kernelName:U,programName:j,startTime:V,endTime:Q});else{let X="";G.forEach((J,se)=>{X+=`input[${se}]: [${J.dims}] | ${Je(J.dataType)}, `});let re="";Z.forEach((J,se)=>{re+=`output[${se}]: [${J.dims}] | ${Je(J.dataType)}, `}),console.log(`[profiling] kernel "${I}|${F}|${U}|${j}" ${X}${re}start time: ${V} ns, execution time: ${Q-V} ns`)}$r("GPU",`${j}::${H}::${q}`)}d.unmap(),this.pendingQueries.delete(d)}),Me()}run(d,m,g,w,$,I){Ne(d.name);let D=[];for(let J=0;J<m.length;++J){let se=m[J].data;if(se===0)continue;let ie=this.gpuDataManager.get(se);if(!ie)throw new Error(`no GPU data for input: ${se}`);D.push(ie)}let{outputs:F,dispatchGroup:U,programUniforms:j}=d.getRunData(m),G=g.length===0?F.map((J,se)=>se):g;if(G.length!==F.length)throw new Error(`Output size ${G.length} must be equal to ${F.length}.`);let Z=[],H=[];for(let J=0;J<F.length;++J){if(!Number.isInteger(G[J])||G[J]<-3||G[J]>=I)throw new Error(`Invalid output index: ${G[J]}`);if(G[J]===-3)continue;let se=G[J]===-1,ie=G[J]===-2,oe=se||ie?$(F[J].dataType,F[J].dims):w(G[J],F[J].dataType,F[J].dims);if(Z.push(oe),oe.data===0)continue;let pe=this.gpuDataManager.get(oe.data);if(!pe)throw new Error(`no GPU data for output: ${oe.data}`);if(se&&this.temporaryData.push(pe),ie){let de=this.kernelPersistentData.get(this.currentKernelId);de||(de=[],this.kernelPersistentData.set(this.currentKernelId,de)),de.push(pe)}H.push(pe)}if(D.length!==m.length||H.length!==Z.length){if(H.length===0)return Me(d.name),Z;throw new Error(`Program ${d.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let q;if(j){let J=0,se=[];j.forEach(de=>{let ge=typeof de.data=="number"?[de.data]:de.data;if(ge.length===0)return;let ce=de.type===10?2:4,Ie,fe;de.type===10?(fe=ge.length>4?16:ge.length>2?8:ge.length*ce,Ie=ge.length>4?16:ce*ge.length):(fe=ge.length<=2?ge.length*ce:16,Ie=16),J=Math.ceil(J/fe)*fe,se.push(J);let Te=de.type===10?8:4;J+=ge.length>4?Math.ceil(ge.length/Te)*Ie:ge.length*ce});let ie=16;J=Math.ceil(J/ie)*ie;let oe=new ArrayBuffer(J);j.forEach((de,ge)=>{let ce=se[ge],Ie=typeof de.data=="number"?[de.data]:de.data;if(de.type===6)new Int32Array(oe,ce,Ie.length).set(Ie);else if(de.type===12)new Uint32Array(oe,ce,Ie.length).set(Ie);else if(de.type===10)new Uint16Array(oe,ce,Ie.length).set(Ie);else if(de.type===1)new Float32Array(oe,ce,Ie.length).set(Ie);else throw new Error(`Unsupported uniform type: ${Je(de.type)}`)});let pe=this.gpuDataManager.create(J,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(pe.buffer,0,oe,0,J),this.gpuDataManager.release(pe.id),q={offset:0,size:J,buffer:pe.buffer}}let V=this.programManager.normalizeDispatchGroupSize(U),Q=V[1]===1&&V[2]===1,X=yg(d,m,Q),re=this.programManager.getArtifact(X);if(re||(re=this.programManager.build(d,V),this.programManager.setArtifact(X,re),le("info",()=>`[artifact] key: ${X}, programName: ${d.name}`)),j&&re.uniformVariablesInfo){if(j.length!==re.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${re.uniformVariablesInfo.length}, got ${j.length} in program "${re.programInfo.name}".`);for(let J=0;J<j.length;J++){let se=j[J],ie=se.type,oe=typeof se.data=="number"?1:se.data.length,[pe,de]=re.uniformVariablesInfo[J];if(ie!==pe||oe!==de)throw new Error(`Uniform variable ${J} mismatch: expect type ${pe} with size ${de}, got type ${ie} with size ${oe} in program "${re.programInfo.name}".`)}}if(le("info",()=>`[ProgramManager] run "${d.name}" (key=${X}) with ${V[0]}x${V[1]}x${V[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let J={kernelId:this.currentKernelId,programName:re.programInfo.name,inputTensorViews:m,outputTensorViews:Z};this.pendingKernels.push(J),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(J)}return this.programManager.run(re,D,H,V,q),Me(d.name),Z}upload(d,m){this.gpuDataManager.upload(d,m)}memcpy(d,m){this.gpuDataManager.memcpy(d,m)}async download(d,m){await this.gpuDataManager.download(d,m)}alloc(d){return this.gpuDataManager.create(d).id}free(d){return this.gpuDataManager.release(d)}createKernel(d,m,g,w){let $=ec.get(d);if(!$)throw new Error(`kernel not implemented: ${d}`);let I={kernelType:d,kernelName:w,kernelEntry:$[0],attributes:[$[1],g]};this.kernels.set(m,I)}releaseKernel(d){let m=this.kernelPersistentData.get(d);if(m){for(let g of m)this.gpuDataManager.release(g.id);this.kernelPersistentData.delete(d)}this.kernelCustomData.delete(d),this.kernels.delete(d)}computeKernel(d,m,g){let w=this.kernels.get(d);if(!w)throw new Error(`kernel not created: ${d}`);let $=w.kernelType,I=w.kernelName,D=w.kernelEntry,F=w.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${$}] ${I}" is not allowed to be called recursively`);this.currentKernelId=d,F[0]&&(F[1]=F[0](F[1]),F[0]=void 0),le("info",()=>`[WebGPU] Start to run kernel "[${$}] ${I}"...`);let U=this.env.debug;this.temporaryData=[];try{return U&&this.device.pushErrorScope("validation"),D(m,F[1]),0}catch(j){return g.push(Promise.resolve(`[WebGPU] Kernel "[${$}] ${I}" failed. ${j}`)),1}finally{U&&g.push(this.device.popErrorScope().then(j=>j?`GPU validation error for kernel "[${$}] ${I}": ${j.message}`:null));for(let j of this.temporaryData)this.gpuDataManager.release(j.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(d,m,g,w){let $=this.sessionExternalDataMapping.get(d);$||($=new Map,this.sessionExternalDataMapping.set(d,$));let I=$.get(m),D=this.gpuDataManager.registerExternalBuffer(g,w,I);return $.set(m,[D,g]),D}unregisterBuffers(d){let m=this.sessionExternalDataMapping.get(d);m&&(m.forEach(g=>this.gpuDataManager.unregisterExternalBuffer(g[0])),this.sessionExternalDataMapping.delete(d))}getBuffer(d){let m=this.gpuDataManager.get(d);if(!m)throw new Error(`no GPU data for buffer: ${d}`);return m.buffer}createDownloader(d,m,g){return async()=>{let w=await lo(this,d,m);return Lr(w.buffer,g)}}writeTimestamp(d){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,d)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){le("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){le("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){le("info","replay"),this.sessionStatus="replaying";let d=this.capturedCommandList.get(this.currentSessionId),m=this.capturedPendingKernels.get(this.currentSessionId),g=d.length;this.pendingKernels=[];for(let w=0;w<g;w++){let $=this.getComputePassEncoder(),I=d[w];this.writeTimestamp(this.pendingDispatchNumber*2),$.setPipeline(I.computePipeline),$.setBindGroup(0,I.bindGroup),$.dispatchWorkgroups(...I.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(m[w]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(d){this.unregisterBuffers(d),this.capturedCommandList.has(d)&&this.capturedCommandList.delete(d),this.capturedPendingKernels.has(d)&&this.capturedPendingKernels.delete(d),this.gpuDataManager.onReleaseSession(d)}onRunStart(d){this.currentSessionId=d,this.setQueryType()}}}),ic={};Wt(ic,{init:()=>bg});var ur,Bo,bg,ac=L$1(()=>{ee(),et(),ae(),es(),ur=class tp{constructor(m,g,w,$){this.module=m,this.dataType=g,this.data=w,this.dims=$}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,m)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,m)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,m)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,m)}reshape(m){if(E$1.size(m)!==E$1.size(this.dims))throw new Error("Invalid new shape");return new tp(this.module,this.dataType,this.data,m)}},Bo=class{constructor(d,m,g){this.module=d,this.backend=m,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=m.adapterInfo;let w=d.PTR_SIZE,$=g/d.PTR_SIZE,I=w===4?"i32":"i64";this.opKernelContext=Number(d.getValue(w*$++,I));let D=Number(d.getValue(w*$++,I));this.outputCount=Number(d.getValue(w*$++,I)),this.customDataOffset=Number(d.getValue(w*$++,"*")),this.customDataSize=Number(d.getValue(w*$++,I));let F=[];for(let U=0;U<D;U++){let j=Number(d.getValue(w*$++,I)),G=Number(d.getValue(w*$++,"*")),Z=Number(d.getValue(w*$++,I)),H=[];for(let q=0;q<Z;q++)H.push(Number(d.getValue(w*$++,I)));F.push(new ur(d,j,G,H))}this.inputs=F}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(d,m){let g=m?.inputs?.map(D=>typeof D=="number"?this.inputs[D]:D)??this.inputs,w=m?.outputs??[],$=(D,F,U)=>new ur(this.module,F,this.output(D,U),U),I=(D,F)=>{let U=St(D,F);if(!U)throw new Error(`Unsupported data type: ${D}`);let j=U>0?this.backend.gpuDataManager.create(U).id:0;return new ur(this.module,D,j,F)};return this.backend.run(d,g,w,$,I,this.outputCount)}output(d,m){let g=this.module.stackSave();try{let w=this.module.PTR_SIZE,$=w===4?"i32":"i64",I=this.module.stackAlloc((1+m.length)*w);this.module.setValue(I,m.length,$);for(let D=0;D<m.length;D++)this.module.setValue(I+w*(D+1),m[D],$);return this.module._JsepOutput(this.opKernelContext,d,I)}catch(w){throw new Error(`Failed to generate kernel's output[${d}] with dims [${m}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${w}`)}finally{this.module.stackRestore(g)}}},bg=async(d,m,g,w)=>{let $=m.jsepInit;if(!$)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(d==="webgpu"){let I=(oc(),Xt(nc)).WebGpuBackend,D=new I;await D.initialize(g,w),$("webgpu",[D,F=>D.alloc(Number(F)),F=>D.free(F),(F,U,j,G=!1)=>{if(G)le("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(F)}, dst=${Number(U)}, size=${Number(j)}`),D.memcpy(Number(F),Number(U));else{le("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(F)}, gpuDataId=${Number(U)}, size=${Number(j)}`);let Z=m.HEAPU8.subarray(Number(F>>>0),Number(F>>>0)+Number(j));D.upload(Number(U),Z)}},async(F,U,j)=>{le("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${F}, dataOffset=${U}, size=${j}`),await D.download(Number(F),()=>m.HEAPU8.subarray(Number(U)>>>0,Number(U+j)>>>0))},(F,U,j)=>D.createKernel(F,Number(U),j,m.UTF8ToString(m._JsepGetNodeName(Number(U)))),F=>D.releaseKernel(F),(F,U,j,G)=>{le("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${j}, kernel=${F}, contextDataOffset=${U}`);let Z=new Bo(m,D,Number(U));return D.computeKernel(Number(F),Z,G)},()=>D.captureBegin(),()=>D.captureEnd(),()=>D.replay()])}else{let I=new Fr(g);$("webnn",[I,()=>I.reserveTensorId(),D=>I.releaseTensorId(D),async(D,F,U,j,G)=>I.ensureTensor(D,F,U,j,G),(D,F)=>{I.uploadTensor(D,F)},async(D,F)=>I.downloadTensor(D,F),(D,F)=>I.registerMLContext(D,F),!!g.trace])}}}),_g,Ir,Ar,Rt,wg,sc,er,Er,kr,uc,Pr,Or,zr,Zn=L$1(()=>{Ve(),La(),Ga(),ee(),$t(),Br(),to$1(),_g=(d,m)=>{_e()._OrtInit(d,m)!==0&&ye("Can't initialize onnxruntime.")},Ir=async d=>{_g(d.wasm.numThreads,rr(d.logLevel))},Ar=async(d,m)=>{_e().asyncInit?.();let g=d.webgpu.adapter;if(m==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(g){if(typeof g.limits!="object"||typeof g.features!="object"||typeof g.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let w=d.webgpu.powerPreference;if(w!==void 0&&w!=="low-power"&&w!=="high-performance")throw new Error(`Invalid powerPreference setting: "${w}"`);let $=d.webgpu.forceFallbackAdapter;if($!==void 0&&typeof $!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${$}"`);if(g=await navigator.gpu.requestAdapter({powerPreference:w,forceFallbackAdapter:$}),!g)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(m==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let w=(ac(),Xt(ic)).init;m==="webgpu"&&await w("webgpu",_e(),d,g),m==="webnn"&&await w("webnn",_e(),d)}},Rt=new Map,wg=d=>{let m=_e(),g=m.stackSave();try{let w=m.PTR_SIZE,$=m.stackAlloc(2*w);m._OrtGetInputOutputCount(d,$,$+w)!==0&&ye("Can't get session input/output count.");let I=w===4?"i32":"i64";return[Number(m.getValue($,I)),Number(m.getValue($+w,I))]}finally{m.stackRestore(g)}},sc=(d,m)=>{let g=_e(),w=g.stackSave(),$=0;try{let I=g.PTR_SIZE,D=g.stackAlloc(2*I);g._OrtGetInputOutputMetadata(d,m,D,D+I)!==0&&ye("Can't get session input/output metadata.");let F=Number(g.getValue(D,"*"));$=Number(g.getValue(D+I,"*"));let U=g.HEAP32[$/4];if(U===0)return[F,0];let j=g.HEAPU32[$/4+1],G=[];for(let Z=0;Z<j;Z++){let H=Number(g.getValue($+8+Z*I,"*"));G.push(H!==0?g.UTF8ToString(H):Number(g.getValue($+8+(Z+j)*I,"*")))}return[F,U,G]}finally{g.stackRestore(w),$!==0&&g._OrtFree($)}},er=d=>{let m=_e(),g=m._malloc(d.byteLength);if(g===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${d.byteLength}.`);return m.HEAPU8.set(d,g),[g,d.byteLength]},Er=async(d,m)=>{let g,w,$=_e();Array.isArray(d)?[g,w]=d:d.buffer===$.HEAPU8.buffer?[g,w]=[d.byteOffset,d.byteLength]:[g,w]=er(d);let I=0,D=0,F=0,U=[],j=[],G=[];try{if([D,U]=await Wa(m),m?.externalData&&$.mountExternalData){let ie=[];for(let oe of m.externalData){let pe=typeof oe=="string"?oe:oe.path;ie.push(nr(typeof oe=="string"?oe:oe.data).then(de=>{$.mountExternalData(pe,de)}))}await Promise.all(ie)}for(let ie of m?.executionProviders??[])if((typeof ie=="string"?ie:ie.name)==="webnn"){if($.shouldTransferToMLTensor=!1,typeof ie!="string"){let oe=ie,pe=oe?.context,de=oe?.gpuDevice,ge=oe?.deviceType,ce=oe?.powerPreference;pe?$.currentContext=pe:de?$.currentContext=await $.webnnCreateMLContext(de):$.currentContext=await $.webnnCreateMLContext({deviceType:ge,powerPreference:ce})}else $.currentContext=await $.webnnCreateMLContext();break}I=await $._OrtCreateSession(g,w,D),$.webgpuOnCreateSession?.(I),I===0&&ye("Can't create a session."),$.jsepOnCreateSession?.(),$.currentContext&&($.webnnRegisterMLContext(I,$.currentContext),$.currentContext=void 0,$.shouldTransferToMLTensor=!0);let[Z,H]=wg(I),q=!!m?.enableGraphCapture,V=[],Q=[],X=[],re=[],J=[];for(let ie=0;ie<Z;ie++){let[oe,pe,de]=sc(I,ie);oe===0&&ye("Can't get an input name."),j.push(oe);let ge=$.UTF8ToString(oe);V.push(ge),X.push(pe===0?{name:ge,isTensor:!1}:{name:ge,isTensor:!0,type:Je(pe),shape:de})}for(let ie=0;ie<H;ie++){let[oe,pe,de]=sc(I,ie+Z);oe===0&&ye("Can't get an output name."),G.push(oe);let ge=$.UTF8ToString(oe);Q.push(ge),re.push(pe===0?{name:ge,isTensor:!1}:{name:ge,isTensor:!0,type:Je(pe),shape:de});{if(q&&m?.preferredOutputLocation===void 0){J.push("gpu-buffer");continue}let ce=typeof m?.preferredOutputLocation=="string"?m.preferredOutputLocation:m?.preferredOutputLocation?.[ge]??"cpu",Ie=$.webnnIsGraphOutput;if(ce==="cpu"&&Ie&&Ie(I,ge)){J.push("ml-tensor-cpu-output");continue}if(ce!=="cpu"&&ce!=="cpu-pinned"&&ce!=="gpu-buffer"&&ce!=="ml-tensor")throw new Error(`Not supported preferred output location: ${ce}.`);if(q&&ce!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${ce}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);J.push(ce)}}let se=null;return J.some(ie=>ie==="gpu-buffer"||ie==="ml-tensor"||ie==="ml-tensor-cpu-output")&&(F=$._OrtCreateBinding(I),F===0&&ye("Can't create IO binding."),se={handle:F,outputPreferredLocations:J,outputPreferredLocationsEncoded:J.map(ie=>ie==="ml-tensor-cpu-output"?"ml-tensor":ie).map(ie=>eo(ie))}),Rt.set(I,[I,j,G,se,q,!1]),[I,V,Q,X,re]}catch(Z){throw j.forEach(H=>$._OrtFree(H)),G.forEach(H=>$._OrtFree(H)),F!==0&&$._OrtReleaseBinding(F)!==0&&ye("Can't release IO binding."),I!==0&&$._OrtReleaseSession(I)!==0&&ye("Can't release session."),Z}finally{$._free(g),D!==0&&$._OrtReleaseSessionOptions(D)!==0&&ye("Can't release session options."),U.forEach(Z=>$._free(Z)),$.unmountExternalData?.()}},kr=d=>{let m=_e(),g=Rt.get(d);if(!g)throw new Error(`cannot release session. invalid session id: ${d}`);let[w,$,I,D,F]=g;D&&(F&&m._OrtClearBoundOutputs(D.handle)!==0&&ye("Can't clear bound outputs."),m._OrtReleaseBinding(D.handle)!==0&&ye("Can't release IO binding.")),m.jsepOnReleaseSession?.(d),m.webnnOnReleaseSession?.(d),m.webgpuOnReleaseSession?.(d),$.forEach(U=>m._OrtFree(U)),I.forEach(U=>m._OrtFree(U)),m._OrtReleaseSession(w)!==0&&ye("Can't release session."),Rt.delete(d)},uc=async(d,m,g,w,$,I,D=!1)=>{if(!d){m.push(0);return}let F=_e(),U=F.PTR_SIZE,j=d[0],G=d[1],Z=d[3],H=Z,q,V;if(j==="string"&&(Z==="gpu-buffer"||Z==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(D&&Z!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${I} when enableGraphCapture is true.`);if(Z==="gpu-buffer"){let re=d[2].gpuBuffer;V=St(xt(j),G);{let J=F.jsepRegisterBuffer;if(!J)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');q=J(w,I,re,V)}}else if(Z==="ml-tensor"){let re=d[2].mlTensor;V=St(xt(j),G);let J=F.webnnRegisterMLTensor;if(!J)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');q=J(w,re,xt(j),G)}else{let re=d[2];if(Array.isArray(re)){V=U*re.length,q=F._malloc(V),g.push(q);for(let J=0;J<re.length;J++){if(typeof re[J]!="string")throw new TypeError(`tensor data at index ${J} is not a string`);F.setValue(q+J*U,We(re[J],g),"*")}}else{let J=F.webnnIsGraphInput,se=F.webnnIsGraphOutput;if(j!=="string"&&J&&se){let ie=F.UTF8ToString($);if(J(w,ie)||se(w,ie)){let oe=xt(j);V=St(oe,G),H="ml-tensor";let pe=F.webnnCreateTemporaryTensor,de=F.webnnUploadTensor;if(!pe||!de)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ge=await pe(w,oe,G);de(ge,new Uint8Array(re.buffer,re.byteOffset,re.byteLength)),q=ge}else V=re.byteLength,q=F._malloc(V),g.push(q),F.HEAPU8.set(new Uint8Array(re.buffer,re.byteOffset,V),q)}else V=re.byteLength,q=F._malloc(V),g.push(q),F.HEAPU8.set(new Uint8Array(re.buffer,re.byteOffset,V),q)}}let Q=F.stackSave(),X=F.stackAlloc(4*G.length);try{G.forEach((J,se)=>F.setValue(X+se*U,J,U===4?"i32":"i64"));let re=F._OrtCreateTensor(xt(j),q,V,X,G.length,eo(H));re===0&&ye(`Can't create tensor for input/output. session=${w}, index=${I}.`),m.push(re)}finally{F.stackRestore(Q)}},Pr=async(d,m,g,w,$,I)=>{let D=_e(),F=D.PTR_SIZE,U=Rt.get(d);if(!U)throw new Error(`cannot run inference. invalid session id: ${d}`);let j=U[0],G=U[1],Z=U[2],H=U[3],q=U[4],V=U[5],Q=m.length,X=w.length,re=0,J=[],se=[],ie=[],oe=[],pe=D.stackSave(),de=D.stackAlloc(Q*F),ge=D.stackAlloc(Q*F),ce=D.stackAlloc(X*F),Ie=D.stackAlloc(X*F);try{[re,J]=Va(I),wt("wasm prepareInputOutputTensor");for(let ze=0;ze<Q;ze++)await uc(g[ze],se,oe,d,G[m[ze]],m[ze],q);for(let ze=0;ze<X;ze++)await uc($[ze],ie,oe,d,Z[w[ze]],Q+w[ze],q);vt("wasm prepareInputOutputTensor");for(let ze=0;ze<Q;ze++)D.setValue(de+ze*F,se[ze],"*"),D.setValue(ge+ze*F,G[m[ze]],"*");for(let ze=0;ze<X;ze++)D.setValue(ce+ze*F,ie[ze],"*"),D.setValue(Ie+ze*F,Z[w[ze]],"*");if(H&&!V){let{handle:ze,outputPreferredLocations:Ce,outputPreferredLocationsEncoded:Fe}=H;if(G.length!==Q)throw new Error(`input count from feeds (${Q}) is expected to be always equal to model's input count (${G.length}).`);wt("wasm bindInputsOutputs");for(let Et=0;Et<Q;Et++){let bt=m[Et];await D._OrtBindInput(ze,G[bt],se[Et])!==0&&ye(`Can't bind input[${Et}] for session=${d}.`)}for(let Et=0;Et<X;Et++){let bt=w[Et];$[Et]?.[3]?D._OrtBindOutput(ze,Z[bt],ie[Et],0)!==0&&ye(`Can't bind pre-allocated output[${Et}] for session=${d}.`):D._OrtBindOutput(ze,Z[bt],0,Fe[bt])!==0&&ye(`Can't bind output[${Et}] to ${Ce[Et]} for session=${d}.`)}vt("wasm bindInputsOutputs"),Rt.set(d,[j,G,Z,H,q,!0])}D.jsepOnRunStart?.(j),D.webnnOnRunStart?.(j);let fe;H?fe=await D._OrtRunWithBinding(j,H.handle,X,ce,re):fe=await D._OrtRun(j,ge,de,Q,Ie,X,ce,re),fe!==0&&ye("failed to call OrtRun().");let Te=[],ut=[];wt("wasm ProcessOutputTensor");for(let ze=0;ze<X;ze++){let Ce=Number(D.getValue(ce+ze*F,"*"));if(Ce===ie[ze]){Te.push($[ze]);continue}let Fe=D.stackSave(),Et=D.stackAlloc(4*F),bt=!1,ht,Zt=0;try{D._OrtGetTensorData(Ce,Et,Et+F,Et+2*F,Et+3*F)!==0&&ye(`Can't access output tensor data on index ${ze}.`);let Ye=F===4?"i32":"i64",_t=Number(D.getValue(Et,Ye));Zt=D.getValue(Et+F,"*");let Vt=D.getValue(Et+F*2,"*"),Lt=Number(D.getValue(Et+F*3,Ye)),dt=[];for(let fr=0;fr<Lt;fr++)dt.push(Number(D.getValue(Vt+fr*F,Ye)));D._OrtFree(Vt)!==0&&ye("Can't free memory for tensor dims.");let It=dt.reduce((fr,pr)=>fr*pr,1);ht=Je(_t);let dr=H?.outputPreferredLocations[w[ze]];if(ht==="string"){if(dr==="gpu-buffer"||dr==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let fr=[];for(let pr=0;pr<It;pr++){let Nt=D.getValue(Zt+pr*F,"*"),$e=D.getValue(Zt+(pr+1)*F,"*"),At=pr===It-1?void 0:$e-Nt;fr.push(D.UTF8ToString(Nt,At))}Te.push([ht,dt,fr,"cpu"])}else if(dr==="gpu-buffer"&&It>0){let fr=D.jsepGetBuffer;if(!fr)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let pr=fr(Zt),Nt=St(_t,It);if(Nt===void 0||!Rr(ht))throw new Error(`Unsupported data type: ${ht}`);bt=!0,Te.push([ht,dt,{gpuBuffer:pr,download:D.jsepCreateDownloader(pr,Nt,ht),dispose:()=>{D._OrtReleaseTensor(Ce)!==0&&ye("Can't release tensor.")}},"gpu-buffer"])}else if(dr==="ml-tensor"&&It>0){let fr=D.webnnEnsureTensor,pr=D.webnnIsGraphInputOutputTypeSupported;if(!fr||!pr)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(St(_t,It)===void 0||!Ur(ht))throw new Error(`Unsupported data type: ${ht}`);if(!pr(d,ht,!1))throw new Error(`preferredLocation "ml-tensor" for ${ht} output is not supported by current WebNN Context.`);let Nt=await fr(d,Zt,_t,dt,!1);bt=!0,Te.push([ht,dt,{mlTensor:Nt,download:D.webnnCreateMLTensorDownloader(Zt,ht),dispose:()=>{D.webnnReleaseTensorId(Zt),D._OrtReleaseTensor(Ce)}},"ml-tensor"])}else if(dr==="ml-tensor-cpu-output"&&It>0){let fr=D.webnnCreateMLTensorDownloader(Zt,ht)(),pr=Te.length;bt=!0,ut.push((async()=>{let Nt=[pr,await fr];return D.webnnReleaseTensorId(Zt),D._OrtReleaseTensor(Ce),Nt})()),Te.push([ht,dt,[],"cpu"])}else{let fr=Gt(ht),pr=new fr(It);new Uint8Array(pr.buffer,pr.byteOffset,pr.byteLength).set(D.HEAPU8.subarray(Zt,Zt+pr.byteLength)),Te.push([ht,dt,pr,"cpu"])}}finally{D.stackRestore(Fe),ht==="string"&&Zt&&D._free(Zt),bt||D._OrtReleaseTensor(Ce)}}H&&!q&&(D._OrtClearBoundOutputs(H.handle)!==0&&ye("Can't clear bound outputs."),Rt.set(d,[j,G,Z,H,q,!1]));for(let[ze,Ce]of await Promise.all(ut))Te[ze][2]=Ce;return vt("wasm ProcessOutputTensor"),Te}finally{D.webnnOnRunEnd?.(j),D.stackRestore(pe),se.forEach(fe=>D._OrtReleaseTensor(fe)),ie.forEach(fe=>D._OrtReleaseTensor(fe)),oe.forEach(fe=>D._free(fe)),re!==0&&D._OrtReleaseRunOptions(re),J.forEach(fe=>D._free(fe))}},Or=d=>{let m=_e(),g=Rt.get(d);if(!g)throw new Error("invalid session id");let w=g[0],$=m._OrtEndProfiling(w);$===0&&ye("Can't get an profile file name."),m._OrtFree($)},zr=d=>{let m=[];for(let g of d){let w=g[2];!Array.isArray(w)&&"buffer"in w&&m.push(w.buffer)}return m}}),Ut,He,lr,mn,fn,pn,Mo,Ro,jt,Kt,$g,lc,dc,cc,pc,mc,fc,hc,Uo=L$1(()=>{Ve(),Zn(),$t(),Tr(),Ut=()=>!!we.wasm.proxy&&typeof document<"u",lr=!1,mn=!1,fn=!1,Ro=new Map,jt=(d,m)=>{let g=Ro.get(d);g?g.push(m):Ro.set(d,[m])},Kt=()=>{if(lr||!mn||fn||!He)throw new Error("worker not ready")},$g=d=>{switch(d.data.type){case"init-wasm":lr=!1,d.data.err?(fn=!0,Mo[1](d.data.err)):(mn=!0,Mo[0]()),pn&&(URL.revokeObjectURL(pn),pn=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let m=Ro.get(d.data.type);d.data.err?m.shift()[1](d.data.err):m.shift()[0](d.data.out);break}}},lc=async()=>{if(!mn){if(lr)throw new Error("multiple calls to 'initWasm()' detected.");if(fn)throw new Error("previous call to 'initWasm()' failed.");if(lr=!0,Ut())return new Promise((d,m)=>{He?.terminate(),Ra().then(([g,w])=>{try{He=w,He.onerror=I=>m(I),He.onmessage=$g,Mo=[d,m];let $={type:"init-wasm",in:we};!$.in.wasm.wasmPaths&&(g||Yn)&&($.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.jsep-CLmJQkb_.wasm",import.meta.url).href}),He.postMessage($),pn=g}catch($){m($)}},m)});try{await Cr(we.wasm),await Ir(we),mn=!0}catch(d){throw fn=!0,d}finally{lr=!1}}},dc=async d=>{if(Ut())return Kt(),new Promise((m,g)=>{jt("init-ep",[m,g]);let w={type:"init-ep",in:{epName:d,env:we}};He.postMessage(w)});await Ar(we,d)},cc=async d=>Ut()?(Kt(),new Promise((m,g)=>{jt("copy-from",[m,g]);let w={type:"copy-from",in:{buffer:d}};He.postMessage(w,[d.buffer])})):er(d),pc=async(d,m)=>{if(Ut()){if(m?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Kt(),new Promise((g,w)=>{jt("create",[g,w]);let $={type:"create",in:{model:d,options:{...m}}},I=[];d instanceof Uint8Array&&I.push(d.buffer),He.postMessage($,I)})}else return Er(d,m)},mc=async d=>{if(Ut())return Kt(),new Promise((m,g)=>{jt("release",[m,g]);let w={type:"release",in:d};He.postMessage(w)});kr(d)},fc=async(d,m,g,w,$,I)=>{if(Ut()){if(g.some(D=>D[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if($.some(D=>D))throw new Error("pre-allocated output tensor is not supported for proxy.");return Kt(),new Promise((D,F)=>{jt("run",[D,F]);let U=g,j={type:"run",in:{sessionId:d,inputIndices:m,inputs:U,outputIndices:w,options:I}};He.postMessage(j,zr(U))})}else return Pr(d,m,g,w,$,I)},hc=async d=>{if(Ut())return Kt(),new Promise((m,g)=>{jt("end-profiling",[m,g]);let w={type:"end-profiling",in:d};He.postMessage(w)});Or(d)}}),gc,xg,hn,yc=L$1(()=>{Ve(),Uo(),ee(),Sr(),to$1(),gc=(d,m)=>{switch(d.location){case"cpu":return[d.type,d.dims,d.data,"cpu"];case"gpu-buffer":return[d.type,d.dims,{gpuBuffer:d.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[d.type,d.dims,{mlTensor:d.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${d.location} for ${m()}`)}},xg=d=>{switch(d[3]){case"cpu":return new qe(d[0],d[2],d[1]);case"gpu-buffer":{let m=d[0];if(!Rr(m))throw new Error(`not supported data type: ${m} for deserializing GPU tensor`);let{gpuBuffer:g,download:w,dispose:$}=d[2];return qe.fromGpuBuffer(g,{dataType:m,dims:d[1],download:w,dispose:$})}case"ml-tensor":{let m=d[0];if(!Ur(m))throw new Error(`not supported data type: ${m} for deserializing MLTensor tensor`);let{mlTensor:g,download:w,dispose:$}=d[2];return qe.fromMLTensor(g,{dataType:m,dims:d[1],download:w,dispose:$})}default:throw new Error(`invalid data location: ${d[3]}`)}},hn=class{async fetchModelAndCopyToWasmMemory(d){return cc(await nr(d))}async loadModel(d,m){Ne();let g;typeof d=="string"?g=await this.fetchModelAndCopyToWasmMemory(d):g=d,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await pc(g,m),Me()}async dispose(){return mc(this.sessionId)}async run(d,m,g){Ne();let w=[],$=[];Object.entries(d).forEach(Z=>{let H=Z[0],q=Z[1],V=this.inputNames.indexOf(H);if(V===-1)throw new Error(`invalid input '${H}'`);w.push(q),$.push(V)});let I=[],D=[];Object.entries(m).forEach(Z=>{let H=Z[0],q=Z[1],V=this.outputNames.indexOf(H);if(V===-1)throw new Error(`invalid output '${H}'`);I.push(q),D.push(V)});let F=w.map((Z,H)=>gc(Z,()=>`input "${this.inputNames[$[H]]}"`)),U=I.map((Z,H)=>Z?gc(Z,()=>`output "${this.outputNames[D[H]]}"`):null),j=await fc(this.sessionId,$,F,D,U,g),G={};for(let Z=0;Z<j.length;Z++)G[this.outputNames[D[Z]]]=I[Z]??xg(j[Z]);return Me(),G}startProfiling(){}endProfiling(){hc(this.sessionId)}}}),_c={};Wt(_c,{OnnxruntimeWebAssemblyBackend:()=>gn,initializeFlags:()=>bc,wasmBackend:()=>Sg});var bc,gn,Sg,wc=L$1(()=>{Ve(),Uo(),yc(),bc=()=>{(typeof we.wasm.initTimeout!="number"||we.wasm.initTimeout<0)&&(we.wasm.initTimeout=0);let d=we.wasm.simd;if(typeof d!="boolean"&&d!==void 0&&d!=="fixed"&&d!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${d}". Reset it to \`false\` and ignore SIMD feature checking.`),we.wasm.simd=!1),typeof we.wasm.proxy!="boolean"&&(we.wasm.proxy=!1),typeof we.wasm.trace!="boolean"&&(we.wasm.trace=!1),typeof we.wasm.numThreads!="number"||!Number.isInteger(we.wasm.numThreads)||we.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)we.wasm.numThreads=1;else{let m=typeof navigator>"u"?Wn("node:os").cpus().length:navigator.hardwareConcurrency;we.wasm.numThreads=Math.min(4,Math.ceil((m||1)/2))}},gn=class{async init(d){bc(),await lc(),await dc(d)}async createInferenceSessionHandler(d,m){let g=new hn;return await g.loadModel(d,m),g}},Sg=new gn});Ve();Ve();Ve();var Sa="1.23.0";{let d=(wc(),Xt(_c)).wasmBackend;Pt("webgpu",d,5),Pt("webnn",d,5),Pt("cpu",d,10),Pt("wasm",d,10)}Object.defineProperty(we.versions,"web",{value:Sa,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function getAugmentedNamespace(d){if(d.__esModule)return d;var m=d.default;if(typeof m=="function"){var g=function w(){return this instanceof w?Reflect.construct(m,arguments,this.constructor):m.apply(this,arguments)};g.prototype=m.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(d).forEach((function(w){var $=Object.getOwnPropertyDescriptor(d,w);Object.defineProperty(g,w,$.get?$:{enumerable:!0,get:function(){return d[w]}})})),g}typeof self>"u"&&typeof commonjsGlobal=="object"&&(commonjsGlobal.self=commonjsGlobal);var global$1=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0;m<64;++m)lookup[m]=d[m],revLookup[d.charCodeAt(m)]=m;revLookup[45]=62,revLookup[95]=63}function toByteArray(d){var m,g,w,$,I,D;inited||init();var F=d.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");I=d[F-2]==="="?2:d[F-1]==="="?1:0,D=new Arr(3*F/4-I),w=I>0?F-4:F;var U=0;for(m=0,g=0;m<w;m+=4,g+=3)$=revLookup[d.charCodeAt(m)]<<18|revLookup[d.charCodeAt(m+1)]<<12|revLookup[d.charCodeAt(m+2)]<<6|revLookup[d.charCodeAt(m+3)],D[U++]=$>>16&255,D[U++]=$>>8&255,D[U++]=255&$;return I===2?($=revLookup[d.charCodeAt(m)]<<2|revLookup[d.charCodeAt(m+1)]>>4,D[U++]=255&$):I===1&&($=revLookup[d.charCodeAt(m)]<<10|revLookup[d.charCodeAt(m+1)]<<4|revLookup[d.charCodeAt(m+2)]>>2,D[U++]=$>>8&255,D[U++]=255&$),D}function tripletToBase64(d){return lookup[d>>18&63]+lookup[d>>12&63]+lookup[d>>6&63]+lookup[63&d]}function encodeChunk(d,m,g){for(var w,$=[],I=m;I<g;I+=3)w=(d[I]<<16)+(d[I+1]<<8)+d[I+2],$.push(tripletToBase64(w));return $.join("")}function fromByteArray(d){var m;inited||init();for(var g=d.length,w=g%3,$="",I=[],D=16383,F=0,U=g-w;F<U;F+=D)I.push(encodeChunk(d,F,F+D>U?U:F+D));return w===1?(m=d[g-1],$+=lookup[m>>2],$+=lookup[m<<4&63],$+="=="):w===2&&(m=(d[g-2]<<8)+d[g-1],$+=lookup[m>>10],$+=lookup[m>>4&63],$+=lookup[m<<2&63],$+="="),I.push($),I.join("")}function read(d,m,g,w,$){var I,D,F=8*$-w-1,U=(1<<F)-1,j=U>>1,G=-7,Z=g?$-1:0,H=g?-1:1,q=d[m+Z];for(Z+=H,I=q&(1<<-G)-1,q>>=-G,G+=F;G>0;I=256*I+d[m+Z],Z+=H,G-=8);for(D=I&(1<<-G)-1,I>>=-G,G+=w;G>0;D=256*D+d[m+Z],Z+=H,G-=8);if(I===0)I=1-j;else{if(I===U)return D?NaN:1/0*(q?-1:1);D+=Math.pow(2,w),I-=j}return(q?-1:1)*D*Math.pow(2,I-w)}function write(d,m,g,w,$,I){var D,F,U,j=8*I-$-1,G=(1<<j)-1,Z=G>>1,H=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=w?0:I-1,V=w?1:-1,Q=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(F=isNaN(m)?1:0,D=G):(D=Math.floor(Math.log(m)/Math.LN2),m*(U=Math.pow(2,-D))<1&&(D--,U*=2),(m+=D+Z>=1?H/U:H*Math.pow(2,1-Z))*U>=2&&(D++,U/=2),D+Z>=G?(F=0,D=G):D+Z>=1?(F=(m*U-1)*Math.pow(2,$),D+=Z):(F=m*Math.pow(2,Z-1)*Math.pow(2,$),D=0));$>=8;d[g+q]=255&F,q+=V,F/=256,$-=8);for(D=D<<$|F,j+=$;j>0;d[g+q]=255&D,q+=V,D/=256,j-=8);d[g+q-V]|=128*Q}var toString={}.toString,isArray=Array.isArray||function(d){return toString.call(d)=="[object Array]"},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(d,m){if(kMaxLength()<m)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(d=new Uint8Array(m)).__proto__=Buffer.prototype:(d===null&&(d=new Buffer(m)),d.length=m),d}function Buffer(d,m,g){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(d,m,g);if(typeof d=="number"){if(typeof m=="string")throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,d)}return from(this,d,m,g)}function from(d,m,g,w){if(typeof m=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&m instanceof ArrayBuffer?fromArrayBuffer(d,m,g,w):typeof m=="string"?fromString(d,m,g):fromObject(d,m)}function assertSize(d){if(typeof d!="number")throw new TypeError('"size" argument must be a number');if(d<0)throw new RangeError('"size" argument must not be negative')}function alloc(d,m,g,w){return assertSize(m),m<=0?createBuffer(d,m):g!==void 0?typeof w=="string"?createBuffer(d,m).fill(g,w):createBuffer(d,m).fill(g):createBuffer(d,m)}function allocUnsafe(d,m){if(assertSize(m),d=createBuffer(d,m<0?0:0|checked(m)),!Buffer.TYPED_ARRAY_SUPPORT)for(var g=0;g<m;++g)d[g]=0;return d}function fromString(d,m,g){if(typeof g=="string"&&g!==""||(g="utf8"),!Buffer.isEncoding(g))throw new TypeError('"encoding" must be a valid string encoding');var w=0|byteLength(m,g),$=(d=createBuffer(d,w)).write(m,g);return $!==w&&(d=d.slice(0,$)),d}function fromArrayLike(d,m){var g=m.length<0?0:0|checked(m.length);d=createBuffer(d,g);for(var w=0;w<g;w+=1)d[w]=255&m[w];return d}function fromArrayBuffer(d,m,g,w){if(m.byteLength,g<0||m.byteLength<g)throw new RangeError("'offset' is out of bounds");if(m.byteLength<g+(w||0))throw new RangeError("'length' is out of bounds");return m=g===void 0&&w===void 0?new Uint8Array(m):w===void 0?new Uint8Array(m,g):new Uint8Array(m,g,w),Buffer.TYPED_ARRAY_SUPPORT?(d=m).__proto__=Buffer.prototype:d=fromArrayLike(d,m),d}function fromObject(d,m){if(internalIsBuffer(m)){var g=0|checked(m.length);return(d=createBuffer(d,g)).length===0||m.copy(d,0,0,g),d}if(m){if(typeof ArrayBuffer<"u"&&m.buffer instanceof ArrayBuffer||"length"in m)return typeof m.length!="number"||isnan(m.length)?createBuffer(d,0):fromArrayLike(d,m);if(m.type==="Buffer"&&isArray(m.data))return fromArrayLike(d,m.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(d){if(d>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|d}function internalIsBuffer(d){return!(d==null||!d._isBuffer)}function byteLength(d,m){if(internalIsBuffer(d))return d.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(d)||d instanceof ArrayBuffer))return d.byteLength;typeof d!="string"&&(d=""+d);var g=d.length;if(g===0)return 0;for(var w=!1;;)switch(m){case"ascii":case"latin1":case"binary":return g;case"utf8":case"utf-8":case void 0:return utf8ToBytes(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*g;case"hex":return g>>>1;case"base64":return base64ToBytes(d).length;default:if(w)return utf8ToBytes(d).length;m=(""+m).toLowerCase(),w=!0}}function slowToString(d,m,g){var w=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((g===void 0||g>this.length)&&(g=this.length),g<=0)||(g>>>=0)<=(m>>>=0))return"";for(d||(d="utf8");;)switch(d){case"hex":return hexSlice(this,m,g);case"utf8":case"utf-8":return utf8Slice(this,m,g);case"ascii":return asciiSlice(this,m,g);case"latin1":case"binary":return latin1Slice(this,m,g);case"base64":return base64Slice(this,m,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,m,g);default:if(w)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),w=!0}}function swap(d,m,g){var w=d[m];d[m]=d[g],d[g]=w}function bidirectionalIndexOf(d,m,g,w,$){if(d.length===0)return-1;if(typeof g=="string"?(w=g,g=0):g>2147483647?g=2147483647:g<-2147483648&&(g=-2147483648),g=+g,isNaN(g)&&(g=$?0:d.length-1),g<0&&(g=d.length+g),g>=d.length){if($)return-1;g=d.length-1}else if(g<0){if(!$)return-1;g=0}if(typeof m=="string"&&(m=Buffer.from(m,w)),internalIsBuffer(m))return m.length===0?-1:arrayIndexOf(d,m,g,w,$);if(typeof m=="number")return m&=255,Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?$?Uint8Array.prototype.indexOf.call(d,m,g):Uint8Array.prototype.lastIndexOf.call(d,m,g):arrayIndexOf(d,[m],g,w,$);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(d,m,g,w,$){var I,D=1,F=d.length,U=m.length;if(w!==void 0&&((w=String(w).toLowerCase())==="ucs2"||w==="ucs-2"||w==="utf16le"||w==="utf-16le")){if(d.length<2||m.length<2)return-1;D=2,F/=2,U/=2,g/=2}function j(q,V){return D===1?q[V]:q.readUInt16BE(V*D)}if($){var G=-1;for(I=g;I<F;I++)if(j(d,I)===j(m,G===-1?0:I-G)){if(G===-1&&(G=I),I-G+1===U)return G*D}else G!==-1&&(I-=I-G),G=-1}else for(g+U>F&&(g=F-U),I=g;I>=0;I--){for(var Z=!0,H=0;H<U;H++)if(j(d,I+H)!==j(m,H)){Z=!1;break}if(Z)return I}return-1}function hexWrite(d,m,g,w){g=Number(g)||0;var $=d.length-g;w?(w=Number(w))>$&&(w=$):w=$;var I=m.length;if(I%2!=0)throw new TypeError("Invalid hex string");w>I/2&&(w=I/2);for(var D=0;D<w;++D){var F=parseInt(m.substr(2*D,2),16);if(isNaN(F))return D;d[g+D]=F}return D}function utf8Write(d,m,g,w){return blitBuffer(utf8ToBytes(m,d.length-g),d,g,w)}function asciiWrite(d,m,g,w){return blitBuffer(asciiToBytes(m),d,g,w)}function latin1Write(d,m,g,w){return asciiWrite(d,m,g,w)}function base64Write(d,m,g,w){return blitBuffer(base64ToBytes(m),d,g,w)}function ucs2Write(d,m,g,w){return blitBuffer(utf16leToBytes(m,d.length-g),d,g,w)}function base64Slice(d,m,g){return m===0&&g===d.length?fromByteArray(d):fromByteArray(d.slice(m,g))}function utf8Slice(d,m,g){g=Math.min(d.length,g);for(var w=[],$=m;$<g;){var I,D,F,U,j=d[$],G=null,Z=j>239?4:j>223?3:j>191?2:1;if($+Z<=g)switch(Z){case 1:j<128&&(G=j);break;case 2:(192&(I=d[$+1]))==128&&(U=(31&j)<<6|63&I)>127&&(G=U);break;case 3:I=d[$+1],D=d[$+2],(192&I)==128&&(192&D)==128&&(U=(15&j)<<12|(63&I)<<6|63&D)>2047&&(U<55296||U>57343)&&(G=U);break;case 4:I=d[$+1],D=d[$+2],F=d[$+3],(192&I)==128&&(192&D)==128&&(192&F)==128&&(U=(15&j)<<18|(63&I)<<12|(63&D)<<6|63&F)>65535&&U<1114112&&(G=U)}G===null?(G=65533,Z=1):G>65535&&(G-=65536,w.push(G>>>10&1023|55296),G=56320|1023&G),w.push(G),$+=Z}return decodeCodePointsArray(w)}Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT===void 0||global$1.TYPED_ARRAY_SUPPORT,kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(d){return d.__proto__=Buffer.prototype,d},Buffer.from=function(d,m,g){return from(null,d,m,g)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&Buffer[Symbol.species]),Buffer.alloc=function(d,m,g){return alloc(null,d,m,g)},Buffer.allocUnsafe=function(d){return allocUnsafe(null,d)},Buffer.allocUnsafeSlow=function(d){return allocUnsafe(null,d)},Buffer.isBuffer=isBuffer,Buffer.compare=function(d,m){if(!internalIsBuffer(d)||!internalIsBuffer(m))throw new TypeError("Arguments must be Buffers");if(d===m)return 0;for(var g=d.length,w=m.length,$=0,I=Math.min(g,w);$<I;++$)if(d[$]!==m[$]){g=d[$],w=m[$];break}return g<w?-1:w<g?1:0},Buffer.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(d,m){if(!isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return Buffer.alloc(0);var g;if(m===void 0)for(m=0,g=0;g<d.length;++g)m+=d[g].length;var w=Buffer.allocUnsafe(m),$=0;for(g=0;g<d.length;++g){var I=d[g];if(!internalIsBuffer(I))throw new TypeError('"list" argument must be an Array of Buffers');I.copy(w,$),$+=I.length}return w},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var d=this.length;if(d%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var m=0;m<d;m+=2)swap(this,m,m+1);return this},Buffer.prototype.swap32=function(){var d=this.length;if(d%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var m=0;m<d;m+=4)swap(this,m,m+3),swap(this,m+1,m+2);return this},Buffer.prototype.swap64=function(){var d=this.length;if(d%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var m=0;m<d;m+=8)swap(this,m,m+7),swap(this,m+1,m+6),swap(this,m+2,m+5),swap(this,m+3,m+4);return this},Buffer.prototype.toString=function(){var d=0|this.length;return d===0?"":arguments.length===0?utf8Slice(this,0,d):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(d){if(!internalIsBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d||Buffer.compare(this,d)===0},Buffer.prototype.inspect=function(){var d="",m=INSPECT_MAX_BYTES;return this.length>0&&(d=this.toString("hex",0,m).match(/.{2}/g).join(" "),this.length>m&&(d+=" ... ")),"<Buffer "+d+">"},Buffer.prototype.compare=function(d,m,g,w,$){if(!internalIsBuffer(d))throw new TypeError("Argument must be a Buffer");if(m===void 0&&(m=0),g===void 0&&(g=d?d.length:0),w===void 0&&(w=0),$===void 0&&($=this.length),m<0||g>d.length||w<0||$>this.length)throw new RangeError("out of range index");if(w>=$&&m>=g)return 0;if(w>=$)return-1;if(m>=g)return 1;if(this===d)return 0;for(var I=($>>>=0)-(w>>>=0),D=(g>>>=0)-(m>>>=0),F=Math.min(I,D),U=this.slice(w,$),j=d.slice(m,g),G=0;G<F;++G)if(U[G]!==j[G]){I=U[G],D=j[G];break}return I<D?-1:D<I?1:0},Buffer.prototype.includes=function(d,m,g){return this.indexOf(d,m,g)!==-1},Buffer.prototype.indexOf=function(d,m,g){return bidirectionalIndexOf(this,d,m,g,!0)},Buffer.prototype.lastIndexOf=function(d,m,g){return bidirectionalIndexOf(this,d,m,g,!1)},Buffer.prototype.write=function(d,m,g,w){if(m===void 0)w="utf8",g=this.length,m=0;else if(g===void 0&&typeof m=="string")w=m,g=this.length,m=0;else{if(!isFinite(m))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");m|=0,isFinite(g)?(g|=0,w===void 0&&(w="utf8")):(w=g,g=void 0)}var $=this.length-m;if((g===void 0||g>$)&&(g=$),d.length>0&&(g<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");w||(w="utf8");for(var I=!1;;)switch(w){case"hex":return hexWrite(this,d,m,g);case"utf8":case"utf-8":return utf8Write(this,d,m,g);case"ascii":return asciiWrite(this,d,m,g);case"latin1":case"binary":return latin1Write(this,d,m,g);case"base64":return base64Write(this,d,m,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,d,m,g);default:if(I)throw new TypeError("Unknown encoding: "+w);w=(""+w).toLowerCase(),I=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(d){var m=d.length;if(m<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,d);for(var g="",w=0;w<m;)g+=String.fromCharCode.apply(String,d.slice(w,w+=MAX_ARGUMENTS_LENGTH));return g}function asciiSlice(d,m,g){var w="";g=Math.min(d.length,g);for(var $=m;$<g;++$)w+=String.fromCharCode(127&d[$]);return w}function latin1Slice(d,m,g){var w="";g=Math.min(d.length,g);for(var $=m;$<g;++$)w+=String.fromCharCode(d[$]);return w}function hexSlice(d,m,g){var w=d.length;(!m||m<0)&&(m=0),(!g||g<0||g>w)&&(g=w);for(var $="",I=m;I<g;++I)$+=toHex(d[I]);return $}function utf16leSlice(d,m,g){for(var w=d.slice(m,g),$="",I=0;I<w.length;I+=2)$+=String.fromCharCode(w[I]+256*w[I+1]);return $}function checkOffset(d,m,g){if(d%1!=0||d<0)throw new RangeError("offset is not uint");if(d+m>g)throw new RangeError("Trying to access beyond buffer length")}function checkInt(d,m,g,w,$,I){if(!internalIsBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>$||m<I)throw new RangeError('"value" argument is out of bounds');if(g+w>d.length)throw new RangeError("Index out of range")}function objectWriteUInt16(d,m,g,w){m<0&&(m=65535+m+1);for(var $=0,I=Math.min(d.length-g,2);$<I;++$)d[g+$]=(m&255<<8*(w?$:1-$))>>>8*(w?$:1-$)}function objectWriteUInt32(d,m,g,w){m<0&&(m=4294967295+m+1);for(var $=0,I=Math.min(d.length-g,4);$<I;++$)d[g+$]=m>>>8*(w?$:3-$)&255}function checkIEEE754(d,m,g,w,$,I){if(g+w>d.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("Index out of range")}function writeFloat(d,m,g,w,$){return $||checkIEEE754(d,m,g,4),write(d,m,g,w,23,4),g+4}function writeDouble(d,m,g,w,$){return $||checkIEEE754(d,m,g,8),write(d,m,g,w,52,8),g+8}Buffer.prototype.slice=function(d,m){var g,w=this.length;if((d=~~d)<0?(d+=w)<0&&(d=0):d>w&&(d=w),(m=m===void 0?w:~~m)<0?(m+=w)<0&&(m=0):m>w&&(m=w),m<d&&(m=d),Buffer.TYPED_ARRAY_SUPPORT)(g=this.subarray(d,m)).__proto__=Buffer.prototype;else{var $=m-d;g=new Buffer($,void 0);for(var I=0;I<$;++I)g[I]=this[I+d]}return g},Buffer.prototype.readUIntLE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d],$=1,I=0;++I<m&&($*=256);)w+=this[d+I]*$;return w},Buffer.prototype.readUIntBE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d+--m],$=1;m>0&&($*=256);)w+=this[d+--m]*$;return w},Buffer.prototype.readUInt8=function(d,m){return m||checkOffset(d,1,this.length),this[d]},Buffer.prototype.readUInt16LE=function(d,m){return m||checkOffset(d,2,this.length),this[d]|this[d+1]<<8},Buffer.prototype.readUInt16BE=function(d,m){return m||checkOffset(d,2,this.length),this[d]<<8|this[d+1]},Buffer.prototype.readUInt32LE=function(d,m){return m||checkOffset(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+16777216*this[d+3]},Buffer.prototype.readUInt32BE=function(d,m){return m||checkOffset(d,4,this.length),16777216*this[d]+(this[d+1]<<16|this[d+2]<<8|this[d+3])},Buffer.prototype.readIntLE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d],$=1,I=0;++I<m&&($*=256);)w+=this[d+I]*$;return w>=($*=128)&&(w-=Math.pow(2,8*m)),w},Buffer.prototype.readIntBE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=m,$=1,I=this[d+--w];w>0&&($*=256);)I+=this[d+--w]*$;return I>=($*=128)&&(I-=Math.pow(2,8*m)),I},Buffer.prototype.readInt8=function(d,m){return m||checkOffset(d,1,this.length),128&this[d]?-1*(255-this[d]+1):this[d]},Buffer.prototype.readInt16LE=function(d,m){m||checkOffset(d,2,this.length);var g=this[d]|this[d+1]<<8;return 32768&g?4294901760|g:g},Buffer.prototype.readInt16BE=function(d,m){m||checkOffset(d,2,this.length);var g=this[d+1]|this[d]<<8;return 32768&g?4294901760|g:g},Buffer.prototype.readInt32LE=function(d,m){return m||checkOffset(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},Buffer.prototype.readInt32BE=function(d,m){return m||checkOffset(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},Buffer.prototype.readFloatLE=function(d,m){return m||checkOffset(d,4,this.length),read(this,d,!0,23,4)},Buffer.prototype.readFloatBE=function(d,m){return m||checkOffset(d,4,this.length),read(this,d,!1,23,4)},Buffer.prototype.readDoubleLE=function(d,m){return m||checkOffset(d,8,this.length),read(this,d,!0,52,8)},Buffer.prototype.readDoubleBE=function(d,m){return m||checkOffset(d,8,this.length),read(this,d,!1,52,8)},Buffer.prototype.writeUIntLE=function(d,m,g,w){d=+d,m|=0,g|=0,w||checkInt(this,d,m,g,Math.pow(2,8*g)-1,0);var $=1,I=0;for(this[m]=255&d;++I<g&&($*=256);)this[m+I]=d/$&255;return m+g},Buffer.prototype.writeUIntBE=function(d,m,g,w){d=+d,m|=0,g|=0,w||checkInt(this,d,m,g,Math.pow(2,8*g)-1,0);var $=g-1,I=1;for(this[m+$]=255&d;--$>=0&&(I*=256);)this[m+$]=d/I&255;return m+g},Buffer.prototype.writeUInt8=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),this[m]=255&d,m+1},Buffer.prototype.writeUInt16LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8):objectWriteUInt16(this,d,m,!0),m+2},Buffer.prototype.writeUInt16BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>8,this[m+1]=255&d):objectWriteUInt16(this,d,m,!1),m+2},Buffer.prototype.writeUInt32LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m+3]=d>>>24,this[m+2]=d>>>16,this[m+1]=d>>>8,this[m]=255&d):objectWriteUInt32(this,d,m,!0),m+4},Buffer.prototype.writeUInt32BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>24,this[m+1]=d>>>16,this[m+2]=d>>>8,this[m+3]=255&d):objectWriteUInt32(this,d,m,!1),m+4},Buffer.prototype.writeIntLE=function(d,m,g,w){if(d=+d,m|=0,!w){var $=Math.pow(2,8*g-1);checkInt(this,d,m,g,$-1,-$)}var I=0,D=1,F=0;for(this[m]=255&d;++I<g&&(D*=256);)d<0&&F===0&&this[m+I-1]!==0&&(F=1),this[m+I]=(d/D|0)-F&255;return m+g},Buffer.prototype.writeIntBE=function(d,m,g,w){if(d=+d,m|=0,!w){var $=Math.pow(2,8*g-1);checkInt(this,d,m,g,$-1,-$)}var I=g-1,D=1,F=0;for(this[m+I]=255&d;--I>=0&&(D*=256);)d<0&&F===0&&this[m+I+1]!==0&&(F=1),this[m+I]=(d/D|0)-F&255;return m+g},Buffer.prototype.writeInt8=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),d<0&&(d=255+d+1),this[m]=255&d,m+1},Buffer.prototype.writeInt16LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8):objectWriteUInt16(this,d,m,!0),m+2},Buffer.prototype.writeInt16BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>8,this[m+1]=255&d):objectWriteUInt16(this,d,m,!1),m+2},Buffer.prototype.writeInt32LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8,this[m+2]=d>>>16,this[m+3]=d>>>24):objectWriteUInt32(this,d,m,!0),m+4},Buffer.prototype.writeInt32BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>24,this[m+1]=d>>>16,this[m+2]=d>>>8,this[m+3]=255&d):objectWriteUInt32(this,d,m,!1),m+4},Buffer.prototype.writeFloatLE=function(d,m,g){return writeFloat(this,d,m,!0,g)},Buffer.prototype.writeFloatBE=function(d,m,g){return writeFloat(this,d,m,!1,g)},Buffer.prototype.writeDoubleLE=function(d,m,g){return writeDouble(this,d,m,!0,g)},Buffer.prototype.writeDoubleBE=function(d,m,g){return writeDouble(this,d,m,!1,g)},Buffer.prototype.copy=function(d,m,g,w){if(g||(g=0),w||w===0||(w=this.length),m>=d.length&&(m=d.length),m||(m=0),w>0&&w<g&&(w=g),w===g||d.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("sourceStart out of bounds");if(w<0)throw new RangeError("sourceEnd out of bounds");w>this.length&&(w=this.length),d.length-m<w-g&&(w=d.length-m+g);var $,I=w-g;if(this===d&&g<m&&m<w)for($=I-1;$>=0;--$)d[$+m]=this[$+g];else if(I<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for($=0;$<I;++$)d[$+m]=this[$+g];else Uint8Array.prototype.set.call(d,this.subarray(g,g+I),m);return I},Buffer.prototype.fill=function(d,m,g,w){if(typeof d=="string"){if(typeof m=="string"?(w=m,m=0,g=this.length):typeof g=="string"&&(w=g,g=this.length),d.length===1){var $=d.charCodeAt(0);$<256&&(d=$)}if(w!==void 0&&typeof w!="string")throw new TypeError("encoding must be a string");if(typeof w=="string"&&!Buffer.isEncoding(w))throw new TypeError("Unknown encoding: "+w)}else typeof d=="number"&&(d&=255);if(m<0||this.length<m||this.length<g)throw new RangeError("Out of range index");if(g<=m)return this;var I;if(m>>>=0,g=g===void 0?this.length:g>>>0,d||(d=0),typeof d=="number")for(I=m;I<g;++I)this[I]=d;else{var D=internalIsBuffer(d)?d:utf8ToBytes(new Buffer(d,w).toString()),F=D.length;for(I=0;I<g-m;++I)this[I+m]=D[I%F]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g,HeaderTypes;function base64clean(d){if((d=stringtrim(d).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;d.length%4!=0;)d+="=";return d}function stringtrim(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function toHex(d){return d<16?"0"+d.toString(16):d.toString(16)}function utf8ToBytes(d,m){var g;m=m||1/0;for(var w=d.length,$=null,I=[],D=0;D<w;++D){if((g=d.charCodeAt(D))>55295&&g<57344){if(!$){if(g>56319){(m-=3)>-1&&I.push(239,191,189);continue}if(D+1===w){(m-=3)>-1&&I.push(239,191,189);continue}$=g;continue}if(g<56320){(m-=3)>-1&&I.push(239,191,189),$=g;continue}g=65536+($-55296<<10|g-56320)}else $&&(m-=3)>-1&&I.push(239,191,189);if($=null,g<128){if((m-=1)<0)break;I.push(g)}else if(g<2048){if((m-=2)<0)break;I.push(g>>6|192,63&g|128)}else if(g<65536){if((m-=3)<0)break;I.push(g>>12|224,g>>6&63|128,63&g|128)}else{if(!(g<1114112))throw new Error("Invalid code point");if((m-=4)<0)break;I.push(g>>18|240,g>>12&63|128,g>>6&63|128,63&g|128)}}return I}function asciiToBytes(d){for(var m=[],g=0;g<d.length;++g)m.push(255&d.charCodeAt(g));return m}function utf16leToBytes(d,m){for(var g,w,$,I=[],D=0;D<d.length&&!((m-=2)<0);++D)w=(g=d.charCodeAt(D))>>8,$=g%256,I.push($),I.push(w);return I}function base64ToBytes(d){return toByteArray(base64clean(d))}function blitBuffer(d,m,g,w){for(var $=0;$<w&&!($+g>=m.length||$>=d.length);++$)m[$+g]=d[$];return $}function isnan(d){return d!=d}function isBuffer(d){return d!=null&&(!!d._isBuffer||isFastBuffer(d)||isSlowBuffer(d))}function isFastBuffer(d){return!!d.constructor&&typeof d.constructor.isBuffer=="function"&&d.constructor.isBuffer(d)}function isSlowBuffer(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&isFastBuffer(d.slice(0,0))}(function(d){d[d.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",d[d.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",d[d.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",d[d.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",d[d.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"})(HeaderTypes||(HeaderTypes={}));var HeaderTypes$1=HeaderTypes,BmpCompression;function maskColor(d,m,g,w){const $=1+~d&d,I=1+~m&m,D=1+~g&g,F=1+~w&w,U=d/$+1,j=m/I+1,G=g/D+1,Z=w/F+1;return{shiftRed:H=>(H&d)/$*256/U,shiftGreen:H=>(H&m)/I*256/j,shiftBlue:H=>(H&g)/D*256/G,shiftAlpha:w!==0?H=>(H&w)/F*256/Z:()=>255}}(function(d){d[d.NONE=0]="NONE",d[d.BI_RLE8=1]="BI_RLE8",d[d.BI_RLE4=2]="BI_RLE4",d[d.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",d[d.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"})(BmpCompression||(BmpCompression={}));class BmpDecoder{flag;fileSize;reserved1;reserved2;offset;headerSize;width;height;planes;bitPP;compression;rawSize;hr;vr;colors;importantColors;palette;data;maskRed;maskGreen;maskBlue;maskAlpha;toRGBA;pos;bottomUp;buffer;locRed;locGreen;locBlue;locAlpha;shiftRed;shiftGreen;shiftBlue;shiftAlpha;constructor(m,{toRGBA:g}={toRGBA:!1}){if(this.buffer=m,this.toRGBA=!!g,this.pos=0,this.bottomUp=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),this.flag!=="BM")throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.reserved2=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in HeaderTypes$1))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.height=this.height>2147483647?this.height-4294967296:this.height,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),this.bitPP===32?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):this.bitPP===16&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>HeaderTypes$1.BITMAP_INFO_HEADER||this.compression===BmpCompression.BI_BIT_FIELDS||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>HeaderTypes$1.BITMAP_V2_INFO_HEADER||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>HeaderTypes$1.BITMAP_V3_INFO_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V4_HEADER-HeaderTypes$1.BITMAP_V3_INFO_HEADER),this.headerSize>HeaderTypes$1.BITMAP_V4_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V5_HEADER-HeaderTypes$1.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const g=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(g);for(let w=0;w<g;w++){const $=this.buffer.readUInt8(this.pos++),I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),F=this.buffer.readUInt8(this.pos++);this.palette[w]={red:D,green:I,blue:$,quad:F}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const m=maskColor(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=m.shiftRed,this.shiftGreen=m.shiftGreen,this.shiftBlue=m.shiftBlue,this.shiftAlpha=m.shiftAlpha}parseRGBA(){switch(this.data=Buffer.alloc(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const m=Math.ceil(this.width/8),g=m%4,w=g!==0?4-g:0;this.scanImage(w,m,(($,I)=>{const D=this.buffer.readUInt8(this.pos++),F=I*this.width*4+8*$*4;for(let U=0;U<8&&8*$+U<this.width;U++){const j=this.palette[D>>7-U&1];this.data[F+U*this.locAlpha]=0,this.data[F+4*U+this.locBlue]=j.blue,this.data[F+4*U+this.locGreen]=j.green,this.data[F+4*U+this.locRed]=j.red}}))}bit4(){if(this.compression===BmpCompression.BI_RLE4){this.data.fill(0);let m=!1,g=this.bottomUp?this.height-1:0,w=0;for(;w<this.data.length;){const $=this.buffer.readUInt8(this.pos++),I=this.buffer.readUInt8(this.pos++);if($===0){if(I===0){g+=this.bottomUp?-1:1,w=g*this.width*4,m=!1;continue}if(I===1)break;if(I===2){const D=this.buffer.readUInt8(this.pos++),F=this.buffer.readUInt8(this.pos++);g+=this.bottomUp?-F:F,w+=F*this.width*4+4*D}else{let D=this.buffer.readUInt8(this.pos++);for(let F=0;F<I;F++)w=this.setPixelData(w,m?15&D:(240&D)>>4),1&F&&F+1<I&&(D=this.buffer.readUInt8(this.pos++)),m=!m;(I+1>>1&1)==1&&this.pos++}}else for(let D=0;D<$;D++)w=this.setPixelData(w,m?15&I:(240&I)>>4),m=!m}}else{const m=Math.ceil(this.width/2),g=m%4,w=g!==0?4-g:0;this.scanImage(w,m,(($,I)=>{const D=this.buffer.readUInt8(this.pos++),F=I*this.width*4+2*$*4,U=D>>4;let j=this.palette[U];if(this.data[F]=0,this.data[F+1]=j.blue,this.data[F+2]=j.green,this.data[F+3]=j.red,2*$+1>=this.width)return!1;const G=15&D;j=this.palette[G],this.data[F+4]=0,this.data[F+4+1]=j.blue,this.data[F+4+2]=j.green,this.data[F+4+3]=j.red}))}}bit8(){if(this.compression===BmpCompression.BI_RLE8){this.data.fill(0);let m=this.bottomUp?this.height-1:0,g=0;for(;g<this.data.length;){const w=this.buffer.readUInt8(this.pos++),$=this.buffer.readUInt8(this.pos++);if(w===0){if($===0){m+=this.bottomUp?-1:1,g=m*this.width*4;continue}if($===1)break;if($===2){const I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++);m+=this.bottomUp?-D:D,g+=D*this.width*4+4*I}else{for(let I=0;I<$;I++){const D=this.buffer.readUInt8(this.pos++);g=this.setPixelData(g,D)}!0&$&&this.pos++}}else for(let I=0;I<w;I++)g=this.setPixelData(g,$)}}else{const m=this.width%4,g=m!==0?4-m:0;this.scanImage(g,this.width,((w,$)=>{const I=this.buffer.readUInt8(this.pos++),D=$*this.width*4+4*w;if(I<this.palette.length){const F=this.palette[I];this.data[D]=0,this.data[D+1]=F.blue,this.data[D+2]=F.green,this.data[D+3]=F.red}else this.data[D]=0,this.data[D+1]=255,this.data[D+2]=255,this.data[D+3]=255}))}}bit16(){const m=this.width%2*2;this.scanImage(m,this.width,((g,w)=>{const $=w*this.width*4+4*g,I=this.buffer.readUInt16LE(this.pos);this.pos+=2,this.data[$+this.locRed]=this.shiftRed(I),this.data[$+this.locGreen]=this.shiftGreen(I),this.data[$+this.locBlue]=this.shiftBlue(I),this.data[$+this.locAlpha]=this.shiftAlpha(I)}))}bit24(){const m=this.width%4;this.scanImage(m,this.width,((g,w)=>{const $=w*this.width*4+4*g,I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),F=this.buffer.readUInt8(this.pos++);this.data[$+this.locRed]=F,this.data[$+this.locGreen]=D,this.data[$+this.locBlue]=I,this.data[$+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((m,g)=>{const w=g*this.width*4+4*m,$=this.readUInt32LE();this.data[w+this.locRed]=this.shiftRed($),this.data[w+this.locGreen]=this.shiftGreen($),this.data[w+this.locBlue]=this.shiftBlue($),this.data[w+this.locAlpha]=this.shiftAlpha($)}))}scanImage(m=0,g=this.width,w){for(let $=this.height-1;$>=0;$--){const I=this.bottomUp?$:this.height-1-$;for(let D=0;D<g;D++)if(w.call(this,D,I)===!1)return;this.pos+=m}}readUInt32LE(){const m=this.buffer.readUInt32LE(this.pos);return this.pos+=4,m}setPixelData(m,g){const{blue:w,green:$,red:I}=this.palette[g];return this.data[m+this.locAlpha]=0,this.data[m+1+this.locBlue]=w,this.data[m+2+this.locGreen]=$,this.data[m+3+this.locRed]=I,m+4}}function createInteger(d){return d.reduce(((m,g)=>m<<1|g),0)}function createColor(d){return d.quad<<24|d.red<<16|d.green<<8|d.blue}class BmpEncoder{fileSize;reserved1;reserved2;offset;width;flag;height;planes;bitPP;compress;hr;vr;colors;importantColors;rawSize;headerSize;data;palette;extraBytes;buffer;bytesInColor;pos;constructor(m){switch(this.buffer=m.data,this.width=m.width,this.height=m.height,this.headerSize=HeaderTypes$1.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=m.bitPP||24,this.offset=54,this.reserved1=m.reserved1||0,this.reserved2=m.reserved2||0,this.planes=1,this.compress=0,this.hr=m.hr||0,this.vr=m.vr||0,this.importantColors=m.importantColors||0,this.colors=Math.min(2**(this.bitPP-1||1),m.colors||1/0),this.palette=m.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const g=this.width*this.bitPP/32,w=Math.ceil(g);this.extraBytes=4*(w-g),this.rawSize=this.height*w*4+2,this.fileSize=this.rawSize+this.offset,this.data=Buffer.alloc(this.fileSize,1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data.write(this.flag,this.pos,2),this.pos+=2,this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.data.writeUInt16LE(this.planes,this.pos),this.pos+=2,this.data.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&this.colors===2?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let m=[];this.writeImage(((g,w,$)=>{let I=w;I++;const D=this.buffer[I++],F=this.buffer[I++],U=.2126*this.buffer[I++]+.7152*F+.0722*D;return m.push(U>127?0:1),($+1)%8==0?(this.data[g-1]=createInteger(m),m=[]):$===this.width-1&&m.length>0&&(this.data[g-1]=createInteger(m)<<4,m=[]),I}))}bit4(){const m=this.initColors(4);let g=[];this.writeImage(((w,$,I)=>{let D=$;const F=createColor({quad:this.buffer[D++],blue:this.buffer[D++],green:this.buffer[D++],red:this.buffer[D++]}),U=m.findIndex((j=>j===F));return U!==-1?g.push(U):g.push(0),(I+1)%2==0&&(this.data[w]=g[0]<<4|g[1],g=[]),D}))}bit8(){const m=this.initColors(8);this.writeImage(((g,w)=>{let $=w;const I=createColor({quad:this.buffer[$++],blue:this.buffer[$++],green:this.buffer[$++],red:this.buffer[$++]}),D=m.findIndex((F=>F===I));return this.data[g]=D!==-1?D:0,$}))}bit16(){this.writeImage(((m,g)=>{let w=g+1;const $=this.buffer[w++]/8,I=this.buffer[w++]/8,D=this.buffer[w++]/8<<10|I<<5|$;return this.data[m]=255&D,this.data[m+1]=(65280&D)>>8,w}))}bit24(){this.writeImage(((m,g)=>{let w=g+1;return this.data[m]=this.buffer[w++],this.data[m+1]=this.buffer[w++],this.data[m+2]=this.buffer[w++],w}))}bit32(){this.writeImage(((m,g)=>{let w=g;return this.data[m+3]=this.buffer[w++],this.data[m]=this.buffer[w++],this.data[m+1]=this.buffer[w++],this.data[m+2]=this.buffer[w++],w}))}writeImage(m){const g=this.extraBytes+this.width*this.bytesInColor;let w=0;for(let $=0;$<this.height;$++)for(let I=0;I<this.width;I++){const D=Math.floor(this.pos+(this.height-1-$)*g+I*this.bytesInColor);w=m.call(this,D,w,I,$)}}initColors(m){const g=[];if(!this.palette.length)throw new Error(`To encode ${m}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let w=0;w<this.colors;w++){const $=createColor(this.palette[w]);this.writeUInt32LE($),g.push($)}return g}writeUInt32LE(m){this.data.writeUInt32LE(m,this.pos),this.pos+=4}}function decode$2(d,m){return new BmpDecoder(d,m)}function encode$2(d){return new BmpEncoder(d)}function _typeof(d){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},_typeof(d)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(d,m){if(m=m||{},(d=d||"")instanceof tinycolor)return d;if(!(this instanceof tinycolor))return new tinycolor(d,m);var g=inputToRGB(d);this._originalInput=d,this._r=g.r,this._g=g.g,this._b=g.b,this._a=g.a,this._roundA=Math.round(100*this._a)/100,this._format=m.format||g.format,this._gradientType=m.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=g.ok}function inputToRGB(d){var m={r:0,g:0,b:0},g=1,w=null,$=null,I=null,D=!1,F=!1;return typeof d=="string"&&(d=stringInputToObject(d)),_typeof(d)=="object"&&(isValidCSSUnit(d.r)&&isValidCSSUnit(d.g)&&isValidCSSUnit(d.b)?(m=rgbToRgb(d.r,d.g,d.b),D=!0,F=String(d.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(d.h)&&isValidCSSUnit(d.s)&&isValidCSSUnit(d.v)?(w=convertToPercentage(d.s),$=convertToPercentage(d.v),m=hsvToRgb(d.h,w,$),D=!0,F="hsv"):isValidCSSUnit(d.h)&&isValidCSSUnit(d.s)&&isValidCSSUnit(d.l)&&(w=convertToPercentage(d.s),I=convertToPercentage(d.l),m=hslToRgb(d.h,w,I),D=!0,F="hsl"),d.hasOwnProperty("a")&&(g=d.a)),g=boundAlpha(g),{ok:D,format:d.format||F,r:Math.min(255,Math.max(m.r,0)),g:Math.min(255,Math.max(m.g,0)),b:Math.min(255,Math.max(m.b,0)),a:g}}function rgbToRgb(d,m,g){return{r:255*bound01(d,255),g:255*bound01(m,255),b:255*bound01(g,255)}}function rgbToHsl(d,m,g){d=bound01(d,255),m=bound01(m,255),g=bound01(g,255);var w,$,I=Math.max(d,m,g),D=Math.min(d,m,g),F=(I+D)/2;if(I==D)w=$=0;else{var U=I-D;switch($=F>.5?U/(2-I-D):U/(I+D),I){case d:w=(m-g)/U+(m<g?6:0);break;case m:w=(g-d)/U+2;break;case g:w=(d-m)/U+4}w/=6}return{h:w,s:$,l:F}}function hslToRgb(d,m,g){var w,$,I;function D(j,G,Z){return Z<0&&(Z+=1),Z>1&&(Z-=1),Z<1/6?j+6*(G-j)*Z:Z<.5?G:Z<2/3?j+(G-j)*(2/3-Z)*6:j}if(d=bound01(d,360),m=bound01(m,100),g=bound01(g,100),m===0)w=$=I=g;else{var F=g<.5?g*(1+m):g+m-g*m,U=2*g-F;w=D(U,F,d+1/3),$=D(U,F,d),I=D(U,F,d-1/3)}return{r:255*w,g:255*$,b:255*I}}function rgbToHsv(d,m,g){d=bound01(d,255),m=bound01(m,255),g=bound01(g,255);var w,$,I=Math.max(d,m,g),D=Math.min(d,m,g),F=I,U=I-D;if($=I===0?0:U/I,I==D)w=0;else{switch(I){case d:w=(m-g)/U+(m<g?6:0);break;case m:w=(g-d)/U+2;break;case g:w=(d-m)/U+4}w/=6}return{h:w,s:$,v:F}}function hsvToRgb(d,m,g){d=6*bound01(d,360),m=bound01(m,100),g=bound01(g,100);var w=Math.floor(d),$=d-w,I=g*(1-m),D=g*(1-$*m),F=g*(1-(1-$)*m),U=w%6;return{r:255*[g,D,I,I,F,g][U],g:255*[F,g,g,D,I,I][U],b:255*[I,I,F,g,g,D][U]}}function rgbToHex(d,m,g,w){var $=[pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16))];return w&&$[0].charAt(0)==$[0].charAt(1)&&$[1].charAt(0)==$[1].charAt(1)&&$[2].charAt(0)==$[2].charAt(1)?$[0].charAt(0)+$[1].charAt(0)+$[2].charAt(0):$.join("")}function rgbaToHex(d,m,g,w,$){var I=[pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16)),pad2(convertDecimalToHex(w))];return $&&I[0].charAt(0)==I[0].charAt(1)&&I[1].charAt(0)==I[1].charAt(1)&&I[2].charAt(0)==I[2].charAt(1)&&I[3].charAt(0)==I[3].charAt(1)?I[0].charAt(0)+I[1].charAt(0)+I[2].charAt(0)+I[3].charAt(0):I.join("")}function rgbaToArgbHex(d,m,g,w){return[pad2(convertDecimalToHex(w)),pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16))].join("")}function _desaturate(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.s-=m/100,g.s=clamp01(g.s),tinycolor(g)}function _saturate(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.s+=m/100,g.s=clamp01(g.s),tinycolor(g)}function _greyscale(d){return tinycolor(d).desaturate(100)}function _lighten(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.l+=m/100,g.l=clamp01(g.l),tinycolor(g)}function _brighten(d,m){m=m===0?0:m||10;var g=tinycolor(d).toRgb();return g.r=Math.max(0,Math.min(255,g.r-Math.round(-m/100*255))),g.g=Math.max(0,Math.min(255,g.g-Math.round(-m/100*255))),g.b=Math.max(0,Math.min(255,g.b-Math.round(-m/100*255))),tinycolor(g)}function _darken(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.l-=m/100,g.l=clamp01(g.l),tinycolor(g)}function _spin(d,m){var g=tinycolor(d).toHsl(),w=(g.h+m)%360;return g.h=w<0?360+w:w,tinycolor(g)}function _complement(d){var m=tinycolor(d).toHsl();return m.h=(m.h+180)%360,tinycolor(m)}function polyad(d,m){if(isNaN(m)||m<=0)throw new Error("Argument to polyad must be a positive number");for(var g=tinycolor(d).toHsl(),w=[tinycolor(d)],$=360/m,I=1;I<m;I++)w.push(tinycolor({h:(g.h+I*$)%360,s:g.s,l:g.l}));return w}function _splitcomplement(d){var m=tinycolor(d).toHsl(),g=m.h;return[tinycolor(d),tinycolor({h:(g+72)%360,s:m.s,l:m.l}),tinycolor({h:(g+216)%360,s:m.s,l:m.l})]}function _analogous(d,m,g){m=m||6,g=g||30;var w=tinycolor(d).toHsl(),$=360/g,I=[tinycolor(d)];for(w.h=(w.h-($*m>>1)+720)%360;--m;)w.h=(w.h+$)%360,I.push(tinycolor(w));return I}function _monochromatic(d,m){m=m||6;for(var g=tinycolor(d).toHsv(),w=g.h,$=g.s,I=g.v,D=[],F=1/m;m--;)D.push(tinycolor({h:w,s:$,v:I})),I=(I+F)%1;return D}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var d=this.toRgb();return(299*d.r+587*d.g+114*d.b)/1e3},getLuminance:function(){var d,m,g,w=this.toRgb();return d=w.r/255,m=w.g/255,g=w.b/255,.2126*(d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4))+.7152*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))+.0722*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))},setAlpha:function(d){return this._a=boundAlpha(d),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var d=rgbToHsv(this._r,this._g,this._b);return{h:360*d.h,s:d.s,v:d.v,a:this._a}},toHsvString:function(){var d=rgbToHsv(this._r,this._g,this._b),m=Math.round(360*d.h),g=Math.round(100*d.s),w=Math.round(100*d.v);return this._a==1?"hsv("+m+", "+g+"%, "+w+"%)":"hsva("+m+", "+g+"%, "+w+"%, "+this._roundA+")"},toHsl:function(){var d=rgbToHsl(this._r,this._g,this._b);return{h:360*d.h,s:d.s,l:d.l,a:this._a}},toHslString:function(){var d=rgbToHsl(this._r,this._g,this._b),m=Math.round(360*d.h),g=Math.round(100*d.s),w=Math.round(100*d.l);return this._a==1?"hsl("+m+", "+g+"%, "+w+"%)":"hsla("+m+", "+g+"%, "+w+"%, "+this._roundA+")"},toHex:function(d){return rgbToHex(this._r,this._g,this._b,d)},toHexString:function(d){return"#"+this.toHex(d)},toHex8:function(d){return rgbaToHex(this._r,this._g,this._b,this._a,d)},toHex8String:function(d){return"#"+this.toHex8(d)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*bound01(this._r,255))+"%",g:Math.round(100*bound01(this._g,255))+"%",b:Math.round(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%)":"rgba("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(d){var m="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),g=m,w=this._gradientType?"GradientType = 1, ":"";if(d){var $=tinycolor(d);g="#"+rgbaToArgbHex($._r,$._g,$._b,$._a)}return"progid:DXImageTransform.Microsoft.gradient("+w+"startColorstr="+m+",endColorstr="+g+")"},toString:function(d){var m=!!d;d=d||this._format;var g=!1,w=this._a<1&&this._a>=0;return m||!w||d!=="hex"&&d!=="hex6"&&d!=="hex3"&&d!=="hex4"&&d!=="hex8"&&d!=="name"?(d==="rgb"&&(g=this.toRgbString()),d==="prgb"&&(g=this.toPercentageRgbString()),d!=="hex"&&d!=="hex6"||(g=this.toHexString()),d==="hex3"&&(g=this.toHexString(!0)),d==="hex4"&&(g=this.toHex8String(!0)),d==="hex8"&&(g=this.toHex8String()),d==="name"&&(g=this.toName()),d==="hsl"&&(g=this.toHslString()),d==="hsv"&&(g=this.toHsvString()),g||this.toHexString()):d==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return tinycolor(this.toString())},_applyModification:function(d,m){var g=d.apply(null,[this].concat([].slice.call(m)));return this._r=g._r,this._g=g._g,this._b=g._b,this.setAlpha(g._a),this},lighten:function(){return this._applyModification(_lighten,arguments)},brighten:function(){return this._applyModification(_brighten,arguments)},darken:function(){return this._applyModification(_darken,arguments)},desaturate:function(){return this._applyModification(_desaturate,arguments)},saturate:function(){return this._applyModification(_saturate,arguments)},greyscale:function(){return this._applyModification(_greyscale,arguments)},spin:function(){return this._applyModification(_spin,arguments)},_applyCombination:function(d,m){return d.apply(null,[this].concat([].slice.call(m)))},analogous:function(){return this._applyCombination(_analogous,arguments)},complement:function(){return this._applyCombination(_complement,arguments)},monochromatic:function(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(_splitcomplement,arguments)},triad:function(){return this._applyCombination(polyad,[3])},tetrad:function(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(d,m){if(_typeof(d)=="object"){var g={};for(var w in d)d.hasOwnProperty(w)&&(g[w]=w==="a"?d[w]:convertToPercentage(d[w]));d=g}return tinycolor(d,m)},tinycolor.equals=function(d,m){return!(!d||!m)&&tinycolor(d).toRgbString()==tinycolor(m).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},tinycolor.mix=function(d,m,g){g=g===0?0:g||50;var w=tinycolor(d).toRgb(),$=tinycolor(m).toRgb(),I=g/100;return tinycolor({r:($.r-w.r)*I+w.r,g:($.g-w.g)*I+w.g,b:($.b-w.b)*I+w.b,a:($.a-w.a)*I+w.a})},tinycolor.readability=function(d,m){var g=tinycolor(d),w=tinycolor(m);return(Math.max(g.getLuminance(),w.getLuminance())+.05)/(Math.min(g.getLuminance(),w.getLuminance())+.05)},tinycolor.isReadable=function(d,m,g){var w,$,I=tinycolor.readability(d,m);switch($=!1,(w=validateWCAG2Parms(g)).level+w.size){case"AAsmall":case"AAAlarge":$=I>=4.5;break;case"AAlarge":$=I>=3;break;case"AAAsmall":$=I>=7}return $},tinycolor.mostReadable=function(d,m,g){var w,$,I,D,F=null,U=0;$=(g=g||{}).includeFallbackColors,I=g.level,D=g.size;for(var j=0;j<m.length;j++)(w=tinycolor.readability(d,m[j]))>U&&(U=w,F=tinycolor(m[j]));return tinycolor.isReadable(d,F,{level:I,size:D})||!$?F:(g.includeFallbackColors=!1,tinycolor.mostReadable(d,["#fff","#000"],g))};var names$1=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names$1);function flip(d){var m={};for(var g in d)d.hasOwnProperty(g)&&(m[d[g]]=g);return m}function boundAlpha(d){return d=parseFloat(d),(isNaN(d)||d<0||d>1)&&(d=1),d}function bound01(d,m){isOnePointZero(d)&&(d="100%");var g=isPercentage(d);return d=Math.min(m,Math.max(0,parseFloat(d))),g&&(d=parseInt(d*m,10)/100),Math.abs(d-m)<1e-6?1:d%m/parseFloat(m)}function clamp01(d){return Math.min(1,Math.max(0,d))}function parseIntFromHex(d){return parseInt(d,16)}function isOnePointZero(d){return typeof d=="string"&&d.indexOf(".")!=-1&&parseFloat(d)===1}function isPercentage(d){return typeof d=="string"&&d.indexOf("%")!=-1}function pad2(d){return d.length==1?"0"+d:""+d}function convertToPercentage(d){return d<=1&&(d=100*d+"%"),d}function convertDecimalToHex(d){return Math.round(255*parseFloat(d)).toString(16)}function convertHexToDecimal(d){return parseIntFromHex(d)/255}var matchers=(CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",{CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}),CSS_UNIT,PERMISSIVE_MATCH3,PERMISSIVE_MATCH4;function isValidCSSUnit(d){return!!matchers.CSS_UNIT.exec(d)}function stringInputToObject(d){d=d.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var m,g=!1;if(names$1[d])d=names$1[d],g=!0;else if(d=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(m=matchers.rgb.exec(d))?{r:m[1],g:m[2],b:m[3]}:(m=matchers.rgba.exec(d))?{r:m[1],g:m[2],b:m[3],a:m[4]}:(m=matchers.hsl.exec(d))?{h:m[1],s:m[2],l:m[3]}:(m=matchers.hsla.exec(d))?{h:m[1],s:m[2],l:m[3],a:m[4]}:(m=matchers.hsv.exec(d))?{h:m[1],s:m[2],v:m[3]}:(m=matchers.hsva.exec(d))?{h:m[1],s:m[2],v:m[3],a:m[4]}:(m=matchers.hex8.exec(d))?{r:parseIntFromHex(m[1]),g:parseIntFromHex(m[2]),b:parseIntFromHex(m[3]),a:convertHexToDecimal(m[4]),format:g?"name":"hex8"}:(m=matchers.hex6.exec(d))?{r:parseIntFromHex(m[1]),g:parseIntFromHex(m[2]),b:parseIntFromHex(m[3]),format:g?"name":"hex"}:(m=matchers.hex4.exec(d))?{r:parseIntFromHex(m[1]+""+m[1]),g:parseIntFromHex(m[2]+""+m[2]),b:parseIntFromHex(m[3]+""+m[3]),a:convertHexToDecimal(m[4]+""+m[4]),format:g?"name":"hex8"}:!!(m=matchers.hex3.exec(d))&&{r:parseIntFromHex(m[1]+""+m[1]),g:parseIntFromHex(m[2]+""+m[2]),b:parseIntFromHex(m[3]+""+m[3]),format:g?"name":"hex"}}function validateWCAG2Parms(d){var m,g;return(m=((d=d||{level:"AA",size:"small"}).level||"AA").toUpperCase())!=="AA"&&m!=="AAA"&&(m="AA"),(g=(d.size||"small").toLowerCase())!=="small"&&g!=="large"&&(g="small"),{level:m,size:g}}function clone(d){const m={width:d.bitmap.width,height:d.bitmap.height,data:Buffer.from(d.bitmap.data)};return new d.constructor(m)}function scan(d,m,g,w,$,I){let D,F,U,j,G;if(typeof m=="function")G=m,D=0,F=0,U=d.bitmap.width,j=d.bitmap.height;else{if(D=m,typeof g!="number")throw new Error("y must be a number");if(F=g,typeof w!="number")throw new Error("w must be a number");if(U=w,typeof $!="number")throw new Error("h must be a number");if(j=$,typeof I!="function")throw new Error("cb must be a function");G=I}D=Math.round(D),F=Math.round(F),U=Math.round(U),j=Math.round(j);const Z=G.bind(d);for(let H=F;H<F+j;H++)for(let q=D;q<D+U;q++)Z(q,H,d.bitmap.width*H+q<<2);return d}function*scanIterator(d,m,g,w,$){m=Math.round(m),g=Math.round(g),w=Math.round(w),$=Math.round($);for(let I=g;I<g+$;I++)for(let D=m;D<m+w;D++){const F=d.bitmap.width*I+D<<2;yield{x:D,y:I,idx:F,image:d}}}function intToRGBA$1(d){if(typeof d!="number")throw new Error("i must be a number");const m={r:0,g:0,b:0,a:0};return m.r=Math.floor(d/Math.pow(256,3)),m.g=Math.floor((d-m.r*Math.pow(256,3))/Math.pow(256,2)),m.b=Math.floor((d-m.r*Math.pow(256,3)-m.g*Math.pow(256,2))/Math.pow(256,1)),m.a=Math.floor((d-m.r*Math.pow(256,3)-m.g*Math.pow(256,2)-m.b*Math.pow(256,1))/Math.pow(256,0)),m}function colorDiff(d,m){const g=D=>Math.pow(D,2),{max:w}=Math,$="a"in d?d.a:255,I="a"in m?m.a:255;return(w(g(d.r-m.r),g(d.r-m.r-$+I))+w(g(d.g-m.g),g(d.g-m.g-$+I))+w(g(d.b-m.b),g(d.b-m.b-$+I)))/195075}function limit255(d){return d=Math.max(d,0),d=Math.min(d,255)}function cssColorToHex(d){return typeof d=="number"?d:parseInt(tinycolor(d).toHex8(),16)}function encode$1(d,m={}){return scan({bitmap:d},0,0,d.width,d.height,(function(g,w,$){const I=d.data[$+0],D=d.data[$+1],F=d.data[$+2],U=d.data[$+3];d.data[$+0]=U,d.data[$+1]=F,d.data[$+2]=D,d.data[$+3]=I})),encode$2({...d,...m}).data}function decode$1(d,m){const g=decode$2(d,m);return scan({bitmap:g},0,0,g.width,g.height,(function(w,$,I){const D=g.data[I+1],F=g.data[I+2],U=g.data[I+3];g.data[I+0]=U,g.data[I+1]=F,g.data[I+2]=D,g.data[I+3]=255})),g}function msBmp(){return{mime:"image/x-ms-bmp",encode:encode$1,decode:decode$1}}function bmp(){return{mime:"image/bmp",encode:encode$1,decode:decode$1}}var omggif={},GifReader_1,GifWriter_1;function GifWriter(d,m,g,w){var $=0,I=(w=w===void 0?{}:w).loop===void 0?null:w.loop,D=w.palette===void 0?null:w.palette;if(m<=0||g<=0||m>65535||g>65535)throw new Error("Width/Height invalid.");function F(Q){var X=Q.length;if(X<2||X>256||X&X-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return X}d[$++]=71,d[$++]=73,d[$++]=70,d[$++]=56,d[$++]=57,d[$++]=97;var U=0,j=0;if(D!==null){for(var G=F(D);G>>=1;)++U;if(G=1<<U,--U,w.background!==void 0){if((j=w.background)>=G)throw new Error("Background index out of range.");if(j===0)throw new Error("Background index explicitly passed as 0.")}}if(d[$++]=255&m,d[$++]=m>>8&255,d[$++]=255&g,d[$++]=g>>8&255,d[$++]=(D!==null?128:0)|U,d[$++]=j,d[$++]=0,D!==null)for(var Z=0,H=D.length;Z<H;++Z){var q=D[Z];d[$++]=q>>16&255,d[$++]=q>>8&255,d[$++]=255&q}if(I!==null){if(I<0||I>65535)throw new Error("Loop count invalid.");d[$++]=33,d[$++]=255,d[$++]=11,d[$++]=78,d[$++]=69,d[$++]=84,d[$++]=83,d[$++]=67,d[$++]=65,d[$++]=80,d[$++]=69,d[$++]=50,d[$++]=46,d[$++]=48,d[$++]=3,d[$++]=1,d[$++]=255&I,d[$++]=I>>8&255,d[$++]=0}var V=!1;this.addFrame=function(Q,X,re,J,se,ie){if(V===!0&&(--$,V=!1),ie=ie===void 0?{}:ie,Q<0||X<0||Q>65535||X>65535)throw new Error("x/y invalid.");if(re<=0||J<=0||re>65535||J>65535)throw new Error("Width/Height invalid.");if(se.length<re*J)throw new Error("Not enough pixels for the frame size.");var oe=!0,pe=ie.palette;if(pe==null&&(oe=!1,pe=D),pe==null)throw new Error("Must supply either a local or global palette.");for(var de=F(pe),ge=0;de>>=1;)++ge;de=1<<ge;var ce=ie.delay===void 0?0:ie.delay,Ie=ie.disposal===void 0?0:ie.disposal;if(Ie<0||Ie>3)throw new Error("Disposal out of range.");var fe=!1,Te=0;if(ie.transparent!==void 0&&ie.transparent!==null&&(fe=!0,(Te=ie.transparent)<0||Te>=de))throw new Error("Transparent color index.");if((Ie!==0||fe||ce!==0)&&(d[$++]=33,d[$++]=249,d[$++]=4,d[$++]=Ie<<2|(fe===!0?1:0),d[$++]=255&ce,d[$++]=ce>>8&255,d[$++]=Te,d[$++]=0),d[$++]=44,d[$++]=255&Q,d[$++]=Q>>8&255,d[$++]=255&X,d[$++]=X>>8&255,d[$++]=255&re,d[$++]=re>>8&255,d[$++]=255&J,d[$++]=J>>8&255,d[$++]=oe===!0?128|ge-1:0,oe===!0)for(var ut=0,ze=pe.length;ut<ze;++ut){var Ce=pe[ut];d[$++]=Ce>>16&255,d[$++]=Ce>>8&255,d[$++]=255&Ce}return $=GifWriterOutputLZWCodeStream(d,$,ge<2?2:ge,se)},this.end=function(){return V===!1&&(d[$++]=59,V=!0),$},this.getOutputBuffer=function(){return d},this.setOutputBuffer=function(Q){d=Q},this.getOutputBufferPosition=function(){return $},this.setOutputBufferPosition=function(Q){$=Q}}function GifWriterOutputLZWCodeStream(d,m,g,w){d[m++]=g;var $=m++,I=1<<g,D=I-1,F=I+1,U=F+1,j=g+1,G=0,Z=0;function H(oe){for(;G>=oe;)d[m++]=255&Z,Z>>=8,G-=8,m===$+256&&(d[$]=255,$=m++)}function q(oe){Z|=oe<<G,G+=j,H(8)}var V=w[0]&D,Q={};q(I);for(var X=1,re=w.length;X<re;++X){var J=w[X]&D,se=V<<8|J,ie=Q[se];if(ie===void 0){for(Z|=V<<G,G+=j;G>=8;)d[m++]=255&Z,Z>>=8,G-=8,m===$+256&&(d[$]=255,$=m++);U===4096?(q(I),U=F+1,j=g+1,Q={}):(U>=1<<j&&++j,Q[se]=U++),V=J}else V=ie}return q(V),q(F),H(1),$+1===m?d[$]=0:(d[$]=m-$-1,d[m++]=0),m}function GifReader(d){var m=0;if(d[m++]!==71||d[m++]!==73||d[m++]!==70||d[m++]!==56||(d[m++]+1&253)!=56||d[m++]!==97)throw new Error("Invalid GIF 87a/89a header.");var g=d[m++]|d[m++]<<8,w=d[m++]|d[m++]<<8,$=d[m++],I=$>>7,D=1<<(7&$)+1;d[m++],d[m++];var F=null,U=null;I&&(F=m,U=D,m+=3*D);var j=!0,G=[],Z=0,H=null,q=0,V=null;for(this.width=g,this.height=w;j&&m<d.length;)switch(d[m++]){case 33:switch(d[m++]){case 255:if(d[m]!==11||d[m+1]==78&&d[m+2]==69&&d[m+3]==84&&d[m+4]==83&&d[m+5]==67&&d[m+6]==65&&d[m+7]==80&&d[m+8]==69&&d[m+9]==50&&d[m+10]==46&&d[m+11]==48&&d[m+12]==3&&d[m+13]==1&&d[m+16]==0)m+=14,V=d[m++]|d[m++]<<8,m++;else for(m+=12;;){if(!((fe=d[m++])>=0))throw Error("Invalid block size");if(fe===0)break;m+=fe}break;case 249:if(d[m++]!==4||d[m+4]!==0)throw new Error("Invalid graphics extension block.");var Q=d[m++];Z=d[m++]|d[m++]<<8,H=d[m++],1&Q||(H=null),q=Q>>2&7,m++;break;case 254:for(;;){if(!((fe=d[m++])>=0))throw Error("Invalid block size");if(fe===0)break;m+=fe}break;default:throw new Error("Unknown graphic control label: 0x"+d[m-1].toString(16))}break;case 44:var X=d[m++]|d[m++]<<8,re=d[m++]|d[m++]<<8,J=d[m++]|d[m++]<<8,se=d[m++]|d[m++]<<8,ie=d[m++],oe=ie>>6&1,pe=1<<(7&ie)+1,de=F,ge=U,ce=!1;ie>>7&&(ce=!0,de=m,ge=pe,m+=3*pe);var Ie=m;for(m++;;){var fe;if(!((fe=d[m++])>=0))throw Error("Invalid block size");if(fe===0)break;m+=fe}G.push({x:X,y:re,width:J,height:se,has_local_palette:ce,palette_offset:de,palette_size:ge,data_offset:Ie,data_length:m-Ie,transparent_index:H,interlaced:!!oe,delay:Z,disposal:q});break;case 59:j=!1;break;default:throw new Error("Unknown gif block: 0x"+d[m-1].toString(16))}this.numFrames=function(){return G.length},this.loopCount=function(){return V},this.frameInfo=function(Te){if(Te<0||Te>=G.length)throw new Error("Frame index out of range.");return G[Te]},this.decodeAndBlitFrameBGRA=function(Te,ut){var ze=this.frameInfo(Te),Ce=ze.width*ze.height,Fe=new Uint8Array(Ce);GifReaderLZWOutputIndexStream(d,ze.data_offset,Fe,Ce);var Et=ze.palette_offset,bt=ze.transparent_index;bt===null&&(bt=256);var ht=ze.width,Zt=g-ht,Ye=ht,_t=4*(ze.y*g+ze.x),Vt=4*((ze.y+ze.height)*g+ze.x),Lt=_t,dt=4*Zt;ze.interlaced===!0&&(dt+=4*g*7);for(var It=8,dr=0,fr=Fe.length;dr<fr;++dr){var pr=Fe[dr];if(Ye===0&&(Ye=ht,(Lt+=dt)>=Vt&&(dt=4*Zt+4*g*(It-1),Lt=_t+(ht+Zt)*(It<<1),It>>=1)),pr===bt)Lt+=4;else{var Nt=d[Et+3*pr],$e=d[Et+3*pr+1],At=d[Et+3*pr+2];ut[Lt++]=At,ut[Lt++]=$e,ut[Lt++]=Nt,ut[Lt++]=255}--Ye}},this.decodeAndBlitFrameRGBA=function(Te,ut){var ze=this.frameInfo(Te),Ce=ze.width*ze.height,Fe=new Uint8Array(Ce);GifReaderLZWOutputIndexStream(d,ze.data_offset,Fe,Ce);var Et=ze.palette_offset,bt=ze.transparent_index;bt===null&&(bt=256);var ht=ze.width,Zt=g-ht,Ye=ht,_t=4*(ze.y*g+ze.x),Vt=4*((ze.y+ze.height)*g+ze.x),Lt=_t,dt=4*Zt;ze.interlaced===!0&&(dt+=4*g*7);for(var It=8,dr=0,fr=Fe.length;dr<fr;++dr){var pr=Fe[dr];if(Ye===0&&(Ye=ht,(Lt+=dt)>=Vt&&(dt=4*Zt+4*g*(It-1),Lt=_t+(ht+Zt)*(It<<1),It>>=1)),pr===bt)Lt+=4;else{var Nt=d[Et+3*pr],$e=d[Et+3*pr+1],At=d[Et+3*pr+2];ut[Lt++]=Nt,ut[Lt++]=$e,ut[Lt++]=At,ut[Lt++]=255}--Ye}}}function GifReaderLZWOutputIndexStream(d,m,g,w){for(var $=d[m++],I=1<<$,D=I+1,F=D+1,U=$+1,j=(1<<U)-1,G=0,Z=0,H=0,q=d[m++],V=new Int32Array(4096),Q=null;;){for(;G<16&&q!==0;)Z|=d[m++]<<G,G+=8,q===1?q=d[m++]:--q;if(G<U)break;var X=Z&j;if(Z>>=U,G-=U,X!==I){if(X===D)break;for(var re=X<F?X:Q,J=0,se=re;se>I;)se=V[se]>>8,++J;var ie=se;if(H+J+(re!==X?1:0)>w)return void console.log("Warning, gif stream longer than expected.");g[H++]=ie;var oe=H+=J;for(re!==X&&(g[H++]=ie),se=re;J--;)se=V[se],g[--oe]=255&se,se>>=8;Q!==null&&F<4096&&(V[F++]=Q<<8|ie,F>=j+1&&U<12&&(++U,j=j<<1|1)),Q=X}else F=D+1,j=(1<<(U=$+1))-1,Q=null}return H!==w&&console.log("Warning, gif stream shorter than expected."),g}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch{}let BitmapImage$2=class ns{constructor(...m){if(m.length===0)throw new Error("constructor requires parameters");const g=m[0];if(g!==null&&typeof g=="object")if(g instanceof ns){const w=g.bitmap;this.bitmap={width:w.width,height:w.height,data:new Buffer(w.width*w.height*4)},w.data.copy(this.bitmap.data)}else{if(!(g.width&&g.height&&g.data))throw new Error("unrecognized constructor parameters");this.bitmap=g}else{if(typeof g!="number"||typeof m[1]!="number")throw new Error("unrecognized constructor parameters");{const w=g,$=m[1],I=m[2];this.bitmap={width:w,height:$},Buffer.isBuffer(I)?this.bitmap.data=I:(this.bitmap.data=new Buffer(w*$*4),typeof I=="number"&&this.fillRGBA(I))}}}blit(m,g,w,$,I,D,F){if($+D>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(g+D>m.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(I+F>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(w+F>m.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const U=this.bitmap.data,j=m.bitmap.data,G=4*this.bitmap.width,Z=4*m.bitmap.width,H=4*D;let q=I*G+4*$,V=w*Z+4*g;for(;--F>=0;)U.copy(j,V,q,q+H),q+=G,V+=Z;return this}fillRGBA(m){const g=this.bitmap.data,w=4*this.bitmap.height;let $=0;for(;$<w;)g.writeUInt32BE(m,$),$+=4;for(;$<g.length;)g.copy(g,$,0,w),$+=w;return this}getRGBA(m,g){const w=4*(g*this.bitmap.width+m);return this.bitmap.data.readUInt32BE(w)}getRGBASet(){const m=new Set,g=this.bitmap.data;for(let w=0;w<g.length;w+=4)m.add(g.readUInt32BE(w,!0));return m}greyscale(){const m=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,((g,w,$)=>{const I=Math.round(.299*m[$]+.587*m[$+1]+.114*m[$+2]);m[$]=I,m[$+1]=I,m[$+2]=I})),this}reframe(m,g,w,$,I){const D=m<0?0:m,F=g<0?0:g,U=w+D>this.bitmap.width?this.bitmap.width-D:w,j=$+F>this.bitmap.height?this.bitmap.height-F:$,G=m<0?-m:0,Z=g<0?-g:0;let H;if(I===void 0){if(D!==m||F!=g||U!==w||j!==$)throw new GifError("fillRGBA required for this reframing");H=new ns(w,$)}else H=new ns(w,$,I);return this.blit(H,G,Z,D,F,U,j),this.bitmap=H.bitmap,this}scale(m){if(m===1)return;if(!Number.isInteger(m)||m<1)throw new Error("the scale must be an integer >= 1");const g=this.bitmap.width,w=this.bitmap.height,$=g*m*4,I=this.bitmap.data,D=new Buffer(w*$*m);let F,U=0,j=0;for(let G=0;G<w;++G){F=j;for(let Z=0;Z<g;++Z){const H=I.readUInt32BE(U,!0);for(let q=0;q<m;++q)D.writeUInt32BE(H,j),j+=4;U+=4}for(let Z=1;Z<m;++Z)D.copy(D,j,F,j),j+=$,F+=$}return this.bitmap={width:g*m,height:w*m,data:D},this}scanAllCoords(m){const g=this.bitmap.width,w=this.bitmap.data.length;let $=0,I=0;for(let D=0;D<w;D+=4)m($,I,D),++$===g&&($=0,++I)}scanAllIndexes(m){const g=this.bitmap.data.length;for(let w=0;w<g;w+=4)m(w)}};var bitmapimage=BitmapImage$2,gif$1={};let Gif$1=class{constructor(d,m,g){this.width=g.width,this.height=g.height,this.loops=g.loops,this.usesTransparency=g.usesTransparency,this.colorScope=g.colorScope,this.frames=m,this.buffer=d}};Gif$1.GlobalColorsPreferred=0,Gif$1.GlobalColorsOnly=1,Gif$1.LocalColorsOnly=2;let GifError$2=class extends Error{constructor(d){super(d),d instanceof Error&&(this.stack="Gif"+d.stack)}};gif$1.Gif=Gif$1,gif$1.GifError=GifError$2;var gifcodec={},gifutil={},_polyfillNode_fs={},_polyfillNode_fs$1=Object.freeze({__proto__:null,default:_polyfillNode_fs}),require$$0=getAugmentedNamespace(_polyfillNode_fs$1),__defProp$3=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp$3=(d,m,g)=>m in d?__defProp$3(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__markAsModule=d=>__defProp$3(d,"__esModule",{value:!0}),__export$1=(d,m)=>{for(var g in m)__defProp$3(d,g,{get:m[g],enumerable:!0})},__reExport=(d,m,g,w)=>{if(m&&typeof m=="object"||typeof m=="function")for(let $ of __getOwnPropNames(m))!__hasOwnProp.call(d,$)&&g&&__defProp$3(d,$,{get:()=>m[$],enumerable:!(w=__getOwnPropDesc(m,$))||w.enumerable});return d},__toCommonJS=(d=>(m,g)=>d&&d.get(m)||(g=__reExport(__markAsModule({}),m,1),d&&d.set(m,g),g))(typeof WeakMap<"u"?new WeakMap:0),__publicField$3=(d,m,g)=>(__defNormalProp$3(d,typeof m!="symbol"?m+"":m,g),g),src_exports={};__export$1(src_exports,{applyPalette:()=>applyPalette,applyPaletteSync:()=>applyPaletteSync$1,buildPalette:()=>buildPalette,buildPaletteSync:()=>buildPaletteSync$1,constants:()=>constants_exports$1,conversion:()=>conversion_exports$1,distance:()=>distance_exports$1,image:()=>image_exports$1,palette:()=>palette_exports$1,quality:()=>quality_exports$1,utils:()=>utils_exports$1});var constants_exports$1={};__export$1(constants_exports$1,{bt709:()=>bt709_exports$1});var bt709_exports$1={};__export$1(bt709_exports$1,{Y:()=>Y$1,x:()=>x$2,y:()=>y$2});var Y$1=(d=>(d[d.RED=.2126]="RED",d[d.GREEN=.7152]="GREEN",d[d.BLUE=.0722]="BLUE",d[d.WHITE=1]="WHITE",d))(Y$1||{}),x$2=(d=>(d[d.RED=.64]="RED",d[d.GREEN=.3]="GREEN",d[d.BLUE=.15]="BLUE",d[d.WHITE=.3127]="WHITE",d))(x$2||{}),y$2=(d=>(d[d.RED=.33]="RED",d[d.GREEN=.6]="GREEN",d[d.BLUE=.06]="BLUE",d[d.WHITE=.329]="WHITE",d))(y$2||{}),conversion_exports$1={};function correctGamma$1(d){return d>.04045?((d+.055)/1.055)**2.4:d/12.92}function rgb2xyz$1(d,m,g){return{x:.4124*(d=correctGamma$1(d/255))+.3576*(m=correctGamma$1(m/255))+.1805*(g=correctGamma$1(g/255)),y:.2126*d+.7152*m+.0722*g,z:.0193*d+.1192*m+.9505*g}}__export$1(conversion_exports$1,{lab2rgb:()=>lab2rgb$1,lab2xyz:()=>lab2xyz$1,rgb2hsl:()=>rgb2hsl$1,rgb2lab:()=>rgb2lab$1,rgb2xyz:()=>rgb2xyz$1,xyz2lab:()=>xyz2lab$1,xyz2rgb:()=>xyz2rgb$1});var arithmetic_exports$1={};function degrees2radians$1(d){return d*(Math.PI/180)}function max3$1(d,m,g){let w=d;return w<m&&(w=m),w<g&&(w=g),w}function min3$1(d,m,g){let w=d;return w>m&&(w=m),w>g&&(w=g),w}function intInRange$1(d,m,g){return d>g&&(d=g),d<m&&(d=m),0|d}function inRange0to255Rounded$1(d){return(d=Math.round(d))>255?d=255:d<0&&(d=0),d}function inRange0to255$1(d){return d>255?d=255:d<0&&(d=0),d}function stableSort$1(d,m){const g=typeof d[0];let w;if(g==="number"||g==="string"){const $=Object.create(null);for(let I=0,D=d.length;I<D;I++){const F=d[I];$[F]||$[F]===0||($[F]=I)}w=d.sort(((I,D)=>m(I,D)||$[I]-$[D]))}else{const $=d.slice(0);w=d.sort(((I,D)=>m(I,D)||$.indexOf(I)-$.indexOf(D)))}return w}function rgb2hsl$1(d,m,g){const w=min3$1(d,m,g),$=max3$1(d,m,g),I=$-w,D=(w+$)/510;let F=0;D>0&&D<1&&(F=I/(D<.5?$+w:510-$-w));let U=0;return I>0&&(U=$===d?(m-g)/I:$===m?2+(g-d)/I:4+(d-m)/I,U*=60,U<0&&(U+=360)),{h:U,s:F,l:D}}__export$1(arithmetic_exports$1,{degrees2radians:()=>degrees2radians$1,inRange0to255:()=>inRange0to255$1,inRange0to255Rounded:()=>inRange0to255Rounded$1,intInRange:()=>intInRange$1,max3:()=>max3$1,min3:()=>min3$1,stableSort:()=>stableSort$1});var refX$1=.95047,refY$1=1,refZ$1=1.08883;function pivot$1(d){return d>.008856?d**(1/3):7.787*d+16/116}function xyz2lab$1(d,m,g){if(d=pivot$1(d/refX$1),m=pivot$1(m/refY$1),g=pivot$1(g/refZ$1),116*m-16<0)throw new Error("xxx");return{L:Math.max(0,116*m-16),a:500*(d-m),b:200*(m-g)}}function rgb2lab$1(d,m,g){const w=rgb2xyz$1(d,m,g);return xyz2lab$1(w.x,w.y,w.z)}var refX2$1=.95047,refY2$1=1,refZ2$1=1.08883;function pivot2$1(d){return d>.206893034?d**3:(d-16/116)/7.787}function lab2xyz$1(d,m,g){const w=(d+16)/116,$=w-g/200;return{x:refX2$1*pivot2$1(m/500+w),y:refY2$1*pivot2$1(w),z:refZ2$1*pivot2$1($)}}function correctGamma2$1(d){return d>.0031308?1.055*d**(1/2.4)-.055:12.92*d}function xyz2rgb$1(d,m,g){const w=correctGamma2$1(3.2406*d+-1.5372*m+-.4986*g),$=correctGamma2$1(-.9689*d+1.8758*m+.0415*g),I=correctGamma2$1(.0557*d+-.204*m+1.057*g);return{r:inRange0to255Rounded$1(255*w),g:inRange0to255Rounded$1(255*$),b:inRange0to255Rounded$1(255*I)}}function lab2rgb$1(d,m,g){const w=lab2xyz$1(d,m,g);return xyz2rgb$1(w.x,w.y,w.z)}var distance_exports$1={};__export$1(distance_exports$1,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator$1,AbstractEuclidean:()=>AbstractEuclidean$1,AbstractManhattan:()=>AbstractManhattan$1,CIE94GraphicArts:()=>CIE94GraphicArts$1,CIE94Textiles:()=>CIE94Textiles$1,CIEDE2000:()=>CIEDE2000$1,CMetric:()=>CMetric$1,Euclidean:()=>Euclidean$1,EuclideanBT709:()=>EuclideanBT709$1,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha$1,Manhattan:()=>Manhattan$1,ManhattanBT709:()=>ManhattanBT709$1,ManhattanNommyde:()=>ManhattanNommyde$1,PNGQuant:()=>PNGQuant$1});var AbstractDistanceCalculator$1=class{constructor(){__publicField$3(this,"_maxDistance"),__publicField$3(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(d,m,g,w){this._whitePoint={r:d>0?255/d:0,g:m>0?255/m:0,b:g>0?255/g:0,a:w>0?255/w:0},this._maxDistance=this.calculateRaw(d,m,g,w,0,0,0,0)}calculateNormalized(d,m){return this.calculateRaw(d.r,d.g,d.b,d.a,m.r,m.g,m.b,m.a)/this._maxDistance}},AbstractCIE94$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab$1(inRange0to255$1(d*this._whitePoint.r),inRange0to255$1(m*this._whitePoint.g),inRange0to255$1(g*this._whitePoint.b)),j=rgb2lab$1(inRange0to255$1($*this._whitePoint.r),inRange0to255$1(I*this._whitePoint.g),inRange0to255$1(D*this._whitePoint.b)),G=U.L-j.L,Z=U.a-j.a,H=U.b-j.b,q=Math.sqrt(U.a*U.a+U.b*U.b),V=q-Math.sqrt(j.a*j.a+j.b*j.b);let Q=Z*Z+H*H-V*V;Q=Q<0?0:Math.sqrt(Q);const X=(F-w)*this._whitePoint.a*this._kA;return Math.sqrt((G/this._Kl)**2+(V/(1+this._K1*q))**2+(Q/(1+this._K2*q))**2+X**2)}},CIE94Textiles$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000$1=class extends AbstractDistanceCalculator$1{_setDefaults(){}static _calculatehp(d,m){const g=Math.atan2(d,m);return g>=0?g:g+_CIEDE2000$1._deg360InRad}static _calculateRT(d,m){const g=m**7,w=2*Math.sqrt(g/(g+_CIEDE2000$1._pow25to7)),$=_CIEDE2000$1._deg30InRad*Math.exp(-(((d-_CIEDE2000$1._deg275InRad)/_CIEDE2000$1._deg25InRad)**2));return-Math.sin(2*$)*w}static _calculateT(d){return 1-.17*Math.cos(d-_CIEDE2000$1._deg30InRad)+.24*Math.cos(2*d)+.32*Math.cos(3*d+_CIEDE2000$1._deg6InRad)-.2*Math.cos(4*d-_CIEDE2000$1._deg63InRad)}static _calculate_ahp(d,m,g,w){const $=g+w;return d===0?$:m<=_CIEDE2000$1._deg180InRad?$/2:$<_CIEDE2000$1._deg360InRad?($+_CIEDE2000$1._deg360InRad)/2:($-_CIEDE2000$1._deg360InRad)/2}static _calculate_dHp(d,m,g,w){let $;return $=d===0?0:m<=_CIEDE2000$1._deg180InRad?g-w:g<=w?g-w+_CIEDE2000$1._deg360InRad:g-w-_CIEDE2000$1._deg360InRad,2*Math.sqrt(d)*Math.sin($/2)}calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab$1(inRange0to255$1(d*this._whitePoint.r),inRange0to255$1(m*this._whitePoint.g),inRange0to255$1(g*this._whitePoint.b)),j=rgb2lab$1(inRange0to255$1($*this._whitePoint.r),inRange0to255$1(I*this._whitePoint.g),inRange0to255$1(D*this._whitePoint.b)),G=(F-w)*this._whitePoint.a*_CIEDE2000$1._kA,Z=this.calculateRawInLab(U,j);return Math.sqrt(Z+G*G)}calculateRawInLab(d,m){const g=d.L,w=d.a,$=d.b,I=m.L,D=m.a,F=m.b,U=((Math.sqrt(w*w+$*$)+Math.sqrt(D*D+F*F))/2)**7,j=.5*(1-Math.sqrt(U/(U+_CIEDE2000$1._pow25to7))),G=(1+j)*w,Z=(1+j)*D,H=Math.sqrt(G*G+$*$),q=Math.sqrt(Z*Z+F*F),V=H*q,Q=_CIEDE2000$1._calculatehp($,G),X=_CIEDE2000$1._calculatehp(F,Z),re=Math.abs(Q-X),J=I-g,se=q-H,ie=_CIEDE2000$1._calculate_dHp(V,re,X,Q),oe=_CIEDE2000$1._calculate_ahp(V,re,Q,X),pe=(H+q)/2,de=((g+I)/2-50)**2,ge=se/(1+.045*pe),ce=ie/(1+.015*_CIEDE2000$1._calculateT(oe)*pe);return(J/(1+.015*de/Math.sqrt(20+de)))**2+ge**2+ce**2+_CIEDE2000$1._calculateRT(oe,pe)*ge*ce}},CIEDE2000$1=_CIEDE2000$1;__publicField$3(CIEDE2000$1,"_kA",25/255),__publicField$3(CIEDE2000$1,"_pow25to7",25**7),__publicField$3(CIEDE2000$1,"_deg360InRad",degrees2radians$1(360)),__publicField$3(CIEDE2000$1,"_deg180InRad",degrees2radians$1(180)),__publicField$3(CIEDE2000$1,"_deg30InRad",degrees2radians$1(30)),__publicField$3(CIEDE2000$1,"_deg6InRad",degrees2radians$1(6)),__publicField$3(CIEDE2000$1,"_deg63InRad",degrees2radians$1(63)),__publicField$3(CIEDE2000$1,"_deg275InRad",degrees2radians$1(275)),__publicField$3(CIEDE2000$1,"_deg25InRad",degrees2radians$1(25));var CMetric$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=(d+$)/2*this._whitePoint.r,j=(d-$)*this._whitePoint.r,G=(m-I)*this._whitePoint.g,Z=(g-D)*this._whitePoint.b,H=((512+U)*j*j>>8)+4*G*G+((767-U)*Z*Z>>8),q=(F-w)*this._whitePoint.a;return Math.sqrt(H+q*q)}_setDefaults(){}},AbstractEuclidean$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=$-d,j=I-m,G=D-g,Z=F-w;return Math.sqrt(this._kR*U*U+this._kG*j*j+this._kB*G*G+this._kA*Z*Z)}},Euclidean$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){let U=$-d,j=I-m,G=D-g,Z=F-w;return U<0&&(U=0-U),j<0&&(j=0-j),G<0&&(G=0-G),Z<0&&(Z=0-Z),this._kR*U+this._kG*j+this._kB*G+this._kA*Z}},Manhattan$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=(F-w)*this._whitePoint.a;return this._colordifferenceCh(d*this._whitePoint.r,$*this._whitePoint.r,U)+this._colordifferenceCh(m*this._whitePoint.g,I*this._whitePoint.g,U)+this._colordifferenceCh(g*this._whitePoint.b,D*this._whitePoint.b,U)}_colordifferenceCh(d,m,g){const w=d-m,$=w+g;return w*w+$*$}_setDefaults(){}},palette_exports$1={};__export$1(palette_exports$1,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer$1,ColorHistogram:()=>ColorHistogram$1,NeuQuant:()=>NeuQuant$1,NeuQuantFloat:()=>NeuQuantFloat$1,RGBQuant:()=>RGBQuant$1,WuColorCube:()=>WuColorCube$1,WuQuant:()=>WuQuant$1});var AbstractPaletteQuantizer$1=class{quantizeSync(){for(const d of this.quantize())if(d.palette)return d.palette;throw new Error("unreachable")}},Point$1=class{constructor(){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),__publicField$3(this,"uint32"),__publicField$3(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(d){const m=new Point$1;return m.r=0|d[0],m.g=0|d[1],m.b=0|d[2],m.a=0|d[3],m._loadUINT32(),m._loadQuadruplet(),m}static createByRGBA(d,m,g,w){const $=new Point$1;return $.r=0|d,$.g=0|m,$.b=0|g,$.a=0|w,$._loadUINT32(),$._loadQuadruplet(),$}static createByUint32(d){const m=new Point$1;return m.uint32=d>>>0,m._loadRGBA(),m._loadQuadruplet(),m}from(d){this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this.uint32=d.uint32,this.rgba[0]=d.r,this.rgba[1]=d.g,this.rgba[2]=d.b,this.rgba[3]=d.a}getLuminosity(d){let m=this.r,g=this.g,w=this.b;return d&&(m=Math.min(255,255-this.a+this.a*m/255),g=Math.min(255,255-this.a+this.a*g/255),w=Math.min(255,255-this.a+this.a*w/255)),.2126*m+.7152*g+.0722*w}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer$1=class{constructor(){__publicField$3(this,"_pointArray"),__publicField$3(this,"_width"),__publicField$3(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(d){this._width=d}setHeight(d){this._height=d}getPointArray(){return this._pointArray}clone(){const d=new PointContainer$1;d._width=this._width,d._height=this._height;for(let m=0,g=this._pointArray.length;m<g;m++)d._pointArray[m]=Point$1.createByUint32(0|this._pointArray[m].uint32);return d}toUint32Array(){const d=this._pointArray.length,m=new Uint32Array(d);for(let g=0;g<d;g++)m[g]=this._pointArray[g].uint32;return m}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(d){const m=d.naturalWidth,g=d.naturalHeight,w=document.createElement("canvas");return w.width=m,w.height=g,w.getContext("2d").drawImage(d,0,0,m,g,0,0,m,g),PointContainer$1.fromHTMLCanvasElement(w)}static fromHTMLCanvasElement(d){const m=d.width,g=d.height,w=d.getContext("2d").getImageData(0,0,m,g);return PointContainer$1.fromImageData(w)}static fromImageData(d){const m=d.width,g=d.height;return PointContainer$1.fromUint8Array(d.data,m,g)}static fromUint8Array(d,m,g){switch(Object.prototype.toString.call(d)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:d=new Uint8Array(d)}const w=new Uint32Array(d.buffer);return PointContainer$1.fromUint32Array(w,m,g)}static fromUint32Array(d,m,g){const w=new PointContainer$1;w._width=m,w._height=g;for(let $=0,I=d.length;$<I;$++)w._pointArray[$]=Point$1.createByUint32(0|d[$]);return w}static fromBuffer(d,m,g){const w=new Uint32Array(d.buffer,d.byteOffset,d.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer$1.fromUint32Array(w,m,g)}},hueGroups$1=10;function hueGroup$1(d,m){const g=360/m;for(let w=1,$=g-g/2;w<m;w++,$+=g)if(d>=$&&d<$+g)return w;return 0}var Palette$1=class{constructor(){__publicField$3(this,"_pointContainer"),__publicField$3(this,"_pointArray",[]),__publicField$3(this,"_i32idx",{}),this._pointContainer=new PointContainer$1,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(d){this._pointArray.push(d),this._pointContainer.setWidth(this._pointArray.length)}has(d){for(let m=this._pointArray.length-1;m>=0;m--)if(d.uint32===this._pointArray[m].uint32)return!0;return!1}getNearestColor(d,m){return this._pointArray[0|this._getNearestIndex(d,m)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(d){return typeof this._i32idx[d]=="number"?this._i32idx[d]:-1}_getNearestIndex(d,m){let g=this._nearestPointFromCache(""+m.uint32);if(g>=0)return g;let w=Number.MAX_VALUE;g=0;for(let $=0,I=this._pointArray.length;$<I;$++){const D=this._pointArray[$],F=d.calculateRaw(m.r,m.g,m.b,m.a,D.r,D.g,D.b,D.a);F<w&&(w=F,g=$)}return this._i32idx[m.uint32]=g,g}sort(){this._i32idx={},this._pointArray.sort(((d,m)=>{const g=rgb2hsl$1(d.r,d.g,d.b),w=rgb2hsl$1(m.r,m.g,m.b),$=d.r===d.g&&d.g===d.b?0:1+hueGroup$1(g.h,hueGroups$1),I=(m.r===m.g&&m.g===m.b?0:1+hueGroup$1(w.h,hueGroups$1))-$;if(I)return-I;const D=d.getLuminosity(!0),F=m.getLuminosity(!0);if(F-D!=0)return F-D;const U=(100*w.s|0)-(100*g.s|0);return U?-U:0}))}},utils_exports$1={};__export$1(utils_exports$1,{HueStatistics:()=>HueStatistics$1,Palette:()=>Palette$1,Point:()=>Point$1,PointContainer:()=>PointContainer$1,ProgressTracker:()=>ProgressTracker$1,arithmetic:()=>arithmetic_exports$1});var HueGroup$1=class{constructor(){__publicField$3(this,"num",0),__publicField$3(this,"cols",[])}},HueStatistics$1=class{constructor(d,m){__publicField$3(this,"_numGroups"),__publicField$3(this,"_minCols"),__publicField$3(this,"_stats"),__publicField$3(this,"_groupsFull"),this._numGroups=d,this._minCols=m,this._stats=[];for(let g=0;g<=d;g++)this._stats[g]=new HueGroup$1;this._groupsFull=0}check(d){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const m=255&d,g=d>>>8&255,w=d>>>16&255,$=m===g&&g===w?0:1+hueGroup$1(rgb2hsl$1(m,g,w).h,this._numGroups),I=this._stats[$],D=this._minCols;I.num++,I.num>D||(I.num===D&&this._groupsFull++,I.num<=D&&this._stats[$].cols.push(d))}injectIntoDictionary(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d[g]?d[g]++:d[g]=1}))}injectIntoArray(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d.indexOf(g)===-1&&d.push(g)}))}},_ProgressTracker$1=class{constructor(d,m){__publicField$3(this,"progress"),__publicField$3(this,"_step"),__publicField$3(this,"_range"),__publicField$3(this,"_last"),__publicField$3(this,"_progressRange"),this._range=d,this._progressRange=m,this._step=Math.max(1,this._range/(_ProgressTracker$1.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(d){return d-this._last>=this._step&&(this._last=d,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker$1=_ProgressTracker$1;__publicField$3(ProgressTracker$1,"steps",100);var networkBiasShift$1=3,Neuron$1=class{constructor(d){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift$1,this.g>>networkBiasShift$1,this.b>>networkBiasShift$1,this.a>>networkBiasShift$1)}subtract(d,m,g,w){this.r-=0|d,this.g-=0|m,this.b-=0|g,this.a-=0|w}},_NeuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new Neuron$1((d<<networkBiasShift$1+8)/this._networkSize|0),this._freq[d]=_NeuQuant$1._initialBias/this._networkSize|0,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuant$1._minpicturebytes&&(d=1);const g=30+(d-1)/3|0,w=m/d|0;let $,I=w/_NeuQuant$1._nCycles|0,D=_NeuQuant$1._initAlpha,F=(this._networkSize>>3)*_NeuQuant$1._radiusBias,U=F>>_NeuQuant$1._radiusBiasShift;U<=1&&(U=0);for(let G=0;G<U;G++)this._radPower[G]=D*((U*U-G*G)*_NeuQuant$1._radBias/(U*U))>>>0;$=m<_NeuQuant$1._minpicturebytes?1:m%_NeuQuant$1._prime1!=0?_NeuQuant$1._prime1:m%_NeuQuant$1._prime2!=0?_NeuQuant$1._prime2:m%_NeuQuant$1._prime3!=0?_NeuQuant$1._prime3:_NeuQuant$1._prime4;const j=new ProgressTracker$1(w,99);for(let G=0,Z=0;G<w;){j.shouldNotify(G)&&(yield{progress:j.progress});const H=this._pointArray[Z],q=H.b<<networkBiasShift$1,V=H.g<<networkBiasShift$1,Q=H.r<<networkBiasShift$1,X=H.a<<networkBiasShift$1,re=this._contest(q,V,Q,X);if(this._alterSingle(D,re,q,V,Q,X),U!==0&&this._alterNeighbour(U,re,q,V,Q,X),Z+=$,Z>=m&&(Z-=m),G++,I===0&&(I=1),G%I==0){D-=D/g|0,F-=F/_NeuQuant$1._radiusDecrease|0,U=F>>_NeuQuant$1._radiusBiasShift,U<=1&&(U=0);for(let J=0;J<U;J++)this._radPower[J]=D*((U*U-J*J)*_NeuQuant$1._radBias/(U*U))>>>0}}}_buildPalette(){const d=new Palette$1;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,j=m-1,G=1;for(;U<F||j>D;){const Z=this._radPower[G++]/_NeuQuant$1._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}if(j>D){const H=this._network[j--];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuant$1._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift$1;let I=2147483647,D=I,F=-1,U=F;for(let j=0;j<this._networkSize;j++){const G=this._network[j],Z=this._distance.calculateNormalized(G,{r:g,g:m,b:d,a:w})*$|0;Z<I&&(I=Z,F=j);const H=Z-(this._bias[j]>>_NeuQuant$1._initialBiasShift-networkBiasShift$1);H<D&&(D=H,U=j);const q=this._freq[j]>>_NeuQuant$1._betaShift;this._freq[j]-=q,this._bias[j]+=q<<_NeuQuant$1._gammaShift}return this._freq[F]+=_NeuQuant$1._beta,this._bias[F]-=_NeuQuant$1._betaGamma,U}},NeuQuant$1=_NeuQuant$1;__publicField$3(NeuQuant$1,"_prime1",499),__publicField$3(NeuQuant$1,"_prime2",491),__publicField$3(NeuQuant$1,"_prime3",487),__publicField$3(NeuQuant$1,"_prime4",503),__publicField$3(NeuQuant$1,"_minpicturebytes",_NeuQuant$1._prime4),__publicField$3(NeuQuant$1,"_nCycles",100),__publicField$3(NeuQuant$1,"_initialBiasShift",16),__publicField$3(NeuQuant$1,"_initialBias",1<<_NeuQuant$1._initialBiasShift),__publicField$3(NeuQuant$1,"_gammaShift",10),__publicField$3(NeuQuant$1,"_betaShift",10),__publicField$3(NeuQuant$1,"_beta",_NeuQuant$1._initialBias>>_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_betaGamma",_NeuQuant$1._initialBias<<_NeuQuant$1._gammaShift-_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_radiusBiasShift",6),__publicField$3(NeuQuant$1,"_radiusBias",1<<_NeuQuant$1._radiusBiasShift),__publicField$3(NeuQuant$1,"_radiusDecrease",30),__publicField$3(NeuQuant$1,"_alphaBiasShift",10),__publicField$3(NeuQuant$1,"_initAlpha",1<<_NeuQuant$1._alphaBiasShift),__publicField$3(NeuQuant$1,"_radBiasShift",8),__publicField$3(NeuQuant$1,"_radBias",1<<_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBiasShift",_NeuQuant$1._alphaBiasShift+_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBias",1<<_NeuQuant$1._alphaRadBiasShift);var networkBiasShift2$1=3,NeuronFloat$1=class{constructor(d){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift2$1,this.g>>networkBiasShift2$1,this.b>>networkBiasShift2$1,this.a>>networkBiasShift2$1)}subtract(d,m,g,w){this.r-=d,this.g-=m,this.b-=g,this.a-=w}},_NeuQuantFloat$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new NeuronFloat$1((d<<networkBiasShift2$1+8)/this._networkSize),this._freq[d]=_NeuQuantFloat$1._initialBias/this._networkSize,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuantFloat$1._minpicturebytes&&(d=1);const g=30+(d-1)/3,w=m/d;let $,I=w/_NeuQuantFloat$1._nCycles|0,D=_NeuQuantFloat$1._initAlpha,F=(this._networkSize>>3)*_NeuQuantFloat$1._radiusBias,U=F>>_NeuQuantFloat$1._radiusBiasShift;U<=1&&(U=0);for(let G=0;G<U;G++)this._radPower[G]=D*((U*U-G*G)*_NeuQuantFloat$1._radBias/(U*U));$=m<_NeuQuantFloat$1._minpicturebytes?1:m%_NeuQuantFloat$1._prime1!=0?_NeuQuantFloat$1._prime1:m%_NeuQuantFloat$1._prime2!=0?_NeuQuantFloat$1._prime2:m%_NeuQuantFloat$1._prime3!=0?_NeuQuantFloat$1._prime3:_NeuQuantFloat$1._prime4;const j=new ProgressTracker$1(w,99);for(let G=0,Z=0;G<w;){j.shouldNotify(G)&&(yield{progress:j.progress});const H=this._pointArray[Z],q=H.b<<networkBiasShift2$1,V=H.g<<networkBiasShift2$1,Q=H.r<<networkBiasShift2$1,X=H.a<<networkBiasShift2$1,re=this._contest(q,V,Q,X);if(this._alterSingle(D,re,q,V,Q,X),U!==0&&this._alterNeighbour(U,re,q,V,Q,X),Z+=$,Z>=m&&(Z-=m),G++,I===0&&(I=1),G%I==0){D-=D/g,F-=F/_NeuQuantFloat$1._radiusDecrease,U=F>>_NeuQuantFloat$1._radiusBiasShift,U<=1&&(U=0);for(let J=0;J<U;J++)this._radPower[J]=D*((U*U-J*J)*_NeuQuantFloat$1._radBias/(U*U))}}}_buildPalette(){const d=new Palette$1;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,j=m-1,G=1;for(;U<F||j>D;){const Z=this._radPower[G++]/_NeuQuantFloat$1._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}if(j>D){const H=this._network[j--];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuantFloat$1._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift2$1;let I=2147483647,D=I,F=-1,U=F;for(let j=0;j<this._networkSize;j++){const G=this._network[j],Z=this._distance.calculateNormalized(G,{r:g,g:m,b:d,a:w})*$;Z<I&&(I=Z,F=j);const H=Z-(this._bias[j]>>_NeuQuantFloat$1._initialBiasShift-networkBiasShift2$1);H<D&&(D=H,U=j);const q=this._freq[j]>>_NeuQuantFloat$1._betaShift;this._freq[j]-=q,this._bias[j]+=q<<_NeuQuantFloat$1._gammaShift}return this._freq[F]+=_NeuQuantFloat$1._beta,this._bias[F]-=_NeuQuantFloat$1._betaGamma,U}},NeuQuantFloat$1=_NeuQuantFloat$1;__publicField$3(NeuQuantFloat$1,"_prime1",499),__publicField$3(NeuQuantFloat$1,"_prime2",491),__publicField$3(NeuQuantFloat$1,"_prime3",487),__publicField$3(NeuQuantFloat$1,"_prime4",503),__publicField$3(NeuQuantFloat$1,"_minpicturebytes",_NeuQuantFloat$1._prime4),__publicField$3(NeuQuantFloat$1,"_nCycles",100),__publicField$3(NeuQuantFloat$1,"_initialBiasShift",16),__publicField$3(NeuQuantFloat$1,"_initialBias",1<<_NeuQuantFloat$1._initialBiasShift),__publicField$3(NeuQuantFloat$1,"_gammaShift",10),__publicField$3(NeuQuantFloat$1,"_betaShift",10),__publicField$3(NeuQuantFloat$1,"_beta",_NeuQuantFloat$1._initialBias>>_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_betaGamma",_NeuQuantFloat$1._initialBias<<_NeuQuantFloat$1._gammaShift-_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_radiusBiasShift",6),__publicField$3(NeuQuantFloat$1,"_radiusBias",1<<_NeuQuantFloat$1._radiusBiasShift),__publicField$3(NeuQuantFloat$1,"_radiusDecrease",30),__publicField$3(NeuQuantFloat$1,"_alphaBiasShift",10),__publicField$3(NeuQuantFloat$1,"_initAlpha",1<<_NeuQuantFloat$1._alphaBiasShift),__publicField$3(NeuQuantFloat$1,"_radBiasShift",8),__publicField$3(NeuQuantFloat$1,"_radBias",1<<_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBiasShift",_NeuQuantFloat$1._alphaBiasShift+_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBias",1<<_NeuQuantFloat$1._alphaRadBiasShift);var _ColorHistogram$1=class{constructor(d,m){__publicField$3(this,"_method"),__publicField$3(this,"_hueStats"),__publicField$3(this,"_histogram"),__publicField$3(this,"_initColors"),__publicField$3(this,"_minHueCols"),this._method=d,this._minHueCols=m<<2,this._initColors=m<<2,this._hueStats=new HueStatistics$1(_ColorHistogram$1._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(d){switch(this._method){case 1:this._colorStats1D(d);break;case 2:this._colorStats2D(d)}}getImportanceSortedColorsIDXI32(){const d=stableSort$1(Object.keys(this._histogram),((g,w)=>this._histogram[w]-this._histogram[g]));if(d.length===0)return[];let m;switch(this._method){case 1:const g=Math.min(d.length,this._initColors),w=d[g-1],$=this._histogram[w];m=d.slice(0,g);let I=g;const D=d.length;for(;I<D&&this._histogram[d[I]]===$;)m.push(d[I++]);this._hueStats.injectIntoArray(m);break;case 2:m=d;break;default:throw new Error("Incorrect method")}return m.map((g=>+g))}_colorStats1D(d){const m=this._histogram,g=d.getPointArray(),w=g.length;for(let $=0;$<w;$++){const I=g[$].uint32;this._hueStats.check(I),I in m?m[I]++:m[I]=1}}_colorStats2D(d){const m=d.getWidth(),g=d.getHeight(),w=d.getPointArray(),$=_ColorHistogram$1._boxSize[0],I=_ColorHistogram$1._boxSize[1],D=$*I,F=this._makeBoxes(m,g,$,I),U=this._histogram;F.forEach((j=>{let G=Math.round(j.w*j.h/D)*_ColorHistogram$1._boxPixels;G<2&&(G=2);const Z={};this._iterateBox(j,m,(H=>{const q=w[H].uint32;this._hueStats.check(q),q in U?U[q]++:q in Z?++Z[q]>=G&&(U[q]=Z[q]):Z[q]=1}))})),this._hueStats.injectIntoDictionary(U)}_iterateBox(d,m,g){const w=d,$=w.y*m+w.x,I=(w.y+w.h-1)*m+(w.x+w.w-1),D=m-w.w+1;let F=0,U=$;do g.call(this,U),U+=++F%w.w==0?D:1;while(U<=I)}_makeBoxes(d,m,g,w){const $=d%g,I=m%w,D=d-$,F=m-I,U=[];for(let j=0;j<m;j+=w)for(let G=0;G<d;G+=g)U.push({x:G,y:j,w:G===D?$:g,h:j===F?I:w});return U}},ColorHistogram$1=_ColorHistogram$1;__publicField$3(ColorHistogram$1,"_boxSize",[64,64]),__publicField$3(ColorHistogram$1,"_boxPixels",2),__publicField$3(ColorHistogram$1,"_hueGroups",10);var RemovedColor$1=class{constructor(d,m,g){__publicField$3(this,"index"),__publicField$3(this,"color"),__publicField$3(this,"distance"),this.index=d,this.color=m,this.distance=g}},RGBQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256,g=2){super(),__publicField$3(this,"_colors"),__publicField$3(this,"_initialDistance"),__publicField$3(this,"_distanceIncrement"),__publicField$3(this,"_histogram"),__publicField$3(this,"_distance"),this._distance=d,this._colors=m,this._histogram=new ColorHistogram$1(g,m),this._initialDistance=.01,this._distanceIncrement=.005}sample(d){this._histogram.sample(d)}*quantize(){const d=this._histogram.getImportanceSortedColorsIDXI32();if(d.length===0)throw new Error("No colors in image");yield*this._buildPalette(d)}*_buildPalette(d){const m=new Palette$1,g=m.getPointContainer().getPointArray(),w=new Array(d.length);for(let G=0;G<d.length;G++)g.push(Point$1.createByUint32(d[G])),w[G]=1;const $=g.length,I=[];let D=$,F=this._initialDistance;const U=new ProgressTracker$1(D-this._colors,99);for(;D>this._colors;){I.length=0;for(let G=0;G<$;G++){if(U.shouldNotify($-D)&&(yield{progress:U.progress}),w[G]===0)continue;const Z=g[G];for(let H=G+1;H<$;H++){if(w[H]===0)continue;const q=g[H],V=this._distance.calculateNormalized(Z,q);V<F&&(I.push(new RemovedColor$1(H,q,V)),w[H]=0,D--)}}F+=D>3*this._colors?this._initialDistance:this._distanceIncrement}if(D<this._colors){stableSort$1(I,((Z,H)=>H.distance-Z.distance));let G=0;for(;D<this._colors&&G<I.length;)w[I[G].index]=1,D++,G++}let j=g.length;for(let G=j-1;G>=0;G--)w[G]===0&&(G!==j-1&&(g[G]=g[j-1]),--j);g.length=j,m.sort(),yield{palette:m,progress:100}}};function createArray1D$1(d){const m=[];for(let g=0;g<d;g++)m[g]=0;return m}function createArray4D$1(d,m,g,w){const $=new Array(d);for(let I=0;I<d;I++){$[I]=new Array(m);for(let D=0;D<m;D++){$[I][D]=new Array(g);for(let F=0;F<g;F++){$[I][D][F]=new Array(w);for(let U=0;U<w;U++)$[I][D][F][U]=0}}}return $}function createArray3D$1(d,m,g){const w=new Array(d);for(let $=0;$<d;$++){w[$]=new Array(m);for(let I=0;I<m;I++){w[$][I]=new Array(g);for(let D=0;D<g;D++)w[$][I][D]=0}}return w}function fillArray3D$1(d,m,g,w,$){for(let I=0;I<m;I++){d[I]=[];for(let D=0;D<g;D++){d[I][D]=[];for(let F=0;F<w;F++)d[I][D][F]=$}}}function fillArray1D$1(d,m,g){for(let w=0;w<m;w++)d[w]=g}var WuColorCube$1=class{constructor(){__publicField$3(this,"redMinimum"),__publicField$3(this,"redMaximum"),__publicField$3(this,"greenMinimum"),__publicField$3(this,"greenMaximum"),__publicField$3(this,"blueMinimum"),__publicField$3(this,"blueMaximum"),__publicField$3(this,"volume"),__publicField$3(this,"alphaMinimum"),__publicField$3(this,"alphaMaximum")}},_WuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256,g=5){super(),__publicField$3(this,"_reds"),__publicField$3(this,"_greens"),__publicField$3(this,"_blues"),__publicField$3(this,"_alphas"),__publicField$3(this,"_sums"),__publicField$3(this,"_weights"),__publicField$3(this,"_momentsRed"),__publicField$3(this,"_momentsGreen"),__publicField$3(this,"_momentsBlue"),__publicField$3(this,"_momentsAlpha"),__publicField$3(this,"_moments"),__publicField$3(this,"_table"),__publicField$3(this,"_pixels"),__publicField$3(this,"_cubes"),__publicField$3(this,"_colors"),__publicField$3(this,"_significantBitsPerChannel"),__publicField$3(this,"_maxSideIndex"),__publicField$3(this,"_alphaMaxSideIndex"),__publicField$3(this,"_sideSize"),__publicField$3(this,"_alphaSideSize"),__publicField$3(this,"_distance"),this._distance=d,this._setQuality(g),this._initialize(m)}sample(d){const m=d.getPointArray();for(let g=0,w=m.length;g<w;g++)this._addColor(m[g]);this._pixels=this._pixels.concat(m)}*quantize(){yield*this._preparePalette();const d=new Palette$1;for(let m=0;m<this._colors;m++)if(this._sums[m]>0){const g=this._sums[m],w=this._reds[m]/g,$=this._greens[m]/g,I=this._blues[m]/g,D=this._alphas[m]/g,F=Point$1.createByRGBA(0|w,0|$,0|I,0|D);d.add(F)}d.sort(),yield{palette:d,progress:100}}*_preparePalette(){yield*this._calculateMoments();let d=0;const m=createArray1D$1(this._colors);for(let D=1;D<this._colors;++D){this._cut(this._cubes[d],this._cubes[D])?(m[d]=this._cubes[d].volume>1?this._calculateVariance(this._cubes[d]):0,m[D]=this._cubes[D].volume>1?this._calculateVariance(this._cubes[D]):0):(m[d]=0,D--),d=0;let F=m[0];for(let U=1;U<=D;++U)m[U]>F&&(F=m[U],d=U);if(F<=0){this._colors=D+1;break}}const g=[],w=[],$=[],I=[];for(let D=0;D<this._colors;++D){const F=_WuQuant$1._volume(this._cubes[D],this._weights);F>0?(g[D]=_WuQuant$1._volume(this._cubes[D],this._momentsRed)/F|0,w[D]=_WuQuant$1._volume(this._cubes[D],this._momentsGreen)/F|0,$[D]=_WuQuant$1._volume(this._cubes[D],this._momentsBlue)/F|0,I[D]=_WuQuant$1._volume(this._cubes[D],this._momentsAlpha)/F|0):(g[D]=0,w[D]=0,$[D]=0,I[D]=0)}this._reds=createArray1D$1(this._colors+1),this._greens=createArray1D$1(this._colors+1),this._blues=createArray1D$1(this._colors+1),this._alphas=createArray1D$1(this._colors+1),this._sums=createArray1D$1(this._colors+1);for(let D=0,F=this._pixels.length;D<F;D++){const U=this._pixels[D];let j=-1,G=Number.MAX_VALUE;for(let Z=0;Z<this._colors;Z++){const H=g[Z],q=w[Z],V=$[Z],Q=I[Z],X=this._distance.calculateRaw(H,q,V,Q,U.r,U.g,U.b,U.a);X<G&&(G=X,j=Z)}this._reds[j]+=U.r,this._greens[j]+=U.g,this._blues[j]+=U.b,this._alphas[j]+=U.a,this._sums[j]++}}_addColor(d){const m=8-this._significantBitsPerChannel,g=1+(d.r>>m),w=1+(d.g>>m),$=1+(d.b>>m),I=1+(d.a>>m);this._weights[I][g][w][$]++,this._momentsRed[I][g][w][$]+=d.r,this._momentsGreen[I][g][w][$]+=d.g,this._momentsBlue[I][g][w][$]+=d.b,this._momentsAlpha[I][g][w][$]+=d.a,this._moments[I][g][w][$]+=this._table[d.r]+this._table[d.g]+this._table[d.b]+this._table[d.a]}*_calculateMoments(){const d=[],m=[],g=[],w=[],$=[],I=[],D=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),F=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),U=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),j=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),G=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),Z=createArray3D$1(this._sideSize,this._sideSize,this._sideSize);let H=0;const q=new ProgressTracker$1(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let V=1;V<=this._alphaMaxSideIndex;++V){fillArray3D$1(D,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(F,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(U,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(j,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(G,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(Z,this._sideSize,this._sideSize,this._sideSize,0);for(let Q=1;Q<=this._maxSideIndex;++Q,++H){q.shouldNotify(H)&&(yield{progress:q.progress}),fillArray1D$1(d,this._sideSize,0),fillArray1D$1(m,this._sideSize,0),fillArray1D$1(g,this._sideSize,0),fillArray1D$1(w,this._sideSize,0),fillArray1D$1($,this._sideSize,0),fillArray1D$1(I,this._sideSize,0);for(let X=1;X<=this._maxSideIndex;++X){let re=0,J=0,se=0,ie=0,oe=0,pe=0;for(let de=1;de<=this._maxSideIndex;++de)re+=this._weights[V][Q][X][de],J+=this._momentsRed[V][Q][X][de],se+=this._momentsGreen[V][Q][X][de],ie+=this._momentsBlue[V][Q][X][de],oe+=this._momentsAlpha[V][Q][X][de],pe+=this._moments[V][Q][X][de],d[de]+=re,m[de]+=J,g[de]+=se,w[de]+=ie,$[de]+=oe,I[de]+=pe,D[Q][X][de]=D[Q-1][X][de]+d[de],F[Q][X][de]=F[Q-1][X][de]+m[de],U[Q][X][de]=U[Q-1][X][de]+g[de],j[Q][X][de]=j[Q-1][X][de]+w[de],G[Q][X][de]=G[Q-1][X][de]+$[de],Z[Q][X][de]=Z[Q-1][X][de]+I[de],this._weights[V][Q][X][de]=this._weights[V-1][Q][X][de]+D[Q][X][de],this._momentsRed[V][Q][X][de]=this._momentsRed[V-1][Q][X][de]+F[Q][X][de],this._momentsGreen[V][Q][X][de]=this._momentsGreen[V-1][Q][X][de]+U[Q][X][de],this._momentsBlue[V][Q][X][de]=this._momentsBlue[V-1][Q][X][de]+j[Q][X][de],this._momentsAlpha[V][Q][X][de]=this._momentsAlpha[V-1][Q][X][de]+G[Q][X][de],this._moments[V][Q][X][de]=this._moments[V-1][Q][X][de]+Z[Q][X][de]}}}}static _volumeFloat(d,m){return m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMaximum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum])}static _volume(d,m){return 0|_WuQuant$1._volumeFloat(d,m)}static _top(d,m,g,w){let $;switch(m){case _WuQuant$1._alpha:$=w[g][d.redMaximum][d.greenMaximum][d.blueMaximum]-w[g][d.redMaximum][d.greenMinimum][d.blueMaximum]-w[g][d.redMinimum][d.greenMaximum][d.blueMaximum]+w[g][d.redMinimum][d.greenMinimum][d.blueMaximum]-(w[g][d.redMaximum][d.greenMaximum][d.blueMinimum]-w[g][d.redMaximum][d.greenMinimum][d.blueMinimum]-w[g][d.redMinimum][d.greenMaximum][d.blueMinimum]+w[g][d.redMinimum][d.greenMinimum][d.blueMinimum]);break;case _WuQuant$1._red:$=w[d.alphaMaximum][g][d.greenMaximum][d.blueMaximum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMaximum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMaximum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMaximum]-(w[d.alphaMaximum][g][d.greenMaximum][d.blueMinimum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMinimum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMinimum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMinimum]);break;case _WuQuant$1._green:$=w[d.alphaMaximum][d.redMaximum][g][d.blueMaximum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMaximum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMaximum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMaximum]-(w[d.alphaMaximum][d.redMaximum][g][d.blueMinimum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMinimum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMinimum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMinimum]);break;case _WuQuant$1._blue:$=w[d.alphaMaximum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMaximum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMaximum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMaximum][d.redMinimum][d.greenMinimum][g]-(w[d.alphaMinimum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMinimum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMinimum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMinimum][d.redMinimum][d.greenMinimum][g]);break;default:throw new Error("impossible")}return 0|$}static _bottom(d,m,g){switch(m){case _WuQuant$1._alpha:return-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._red:return-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._green:return-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._blue:return-g[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);default:return 0}}_calculateVariance(d){const m=_WuQuant$1._volume(d,this._momentsRed),g=_WuQuant$1._volume(d,this._momentsGreen),w=_WuQuant$1._volume(d,this._momentsBlue),$=_WuQuant$1._volume(d,this._momentsAlpha);return _WuQuant$1._volumeFloat(d,this._moments)-(m*m+g*g+w*w+$*$)/_WuQuant$1._volume(d,this._weights)}_maximize(d,m,g,w,$,I,D,F,U){const j=0|_WuQuant$1._bottom(d,m,this._momentsRed),G=0|_WuQuant$1._bottom(d,m,this._momentsGreen),Z=0|_WuQuant$1._bottom(d,m,this._momentsBlue),H=0|_WuQuant$1._bottom(d,m,this._momentsAlpha),q=0|_WuQuant$1._bottom(d,m,this._weights);let V=0,Q=-1;for(let X=g;X<w;++X){let re=j+_WuQuant$1._top(d,m,X,this._momentsRed),J=G+_WuQuant$1._top(d,m,X,this._momentsGreen),se=Z+_WuQuant$1._top(d,m,X,this._momentsBlue),ie=H+_WuQuant$1._top(d,m,X,this._momentsAlpha),oe=q+_WuQuant$1._top(d,m,X,this._weights);if(oe!==0){let pe=re*re+J*J+se*se+ie*ie,de=pe/oe;re=$-re,J=I-J,se=D-se,ie=F-ie,oe=U-oe,oe!==0&&(pe=re*re+J*J+se*se+ie*ie,de+=pe/oe,de>V&&(V=de,Q=X))}}return{max:V,position:Q}}_cut(d,m){let g;const w=_WuQuant$1._volume(d,this._momentsRed),$=_WuQuant$1._volume(d,this._momentsGreen),I=_WuQuant$1._volume(d,this._momentsBlue),D=_WuQuant$1._volume(d,this._momentsAlpha),F=_WuQuant$1._volume(d,this._weights),U=this._maximize(d,_WuQuant$1._red,d.redMinimum+1,d.redMaximum,w,$,I,D,F),j=this._maximize(d,_WuQuant$1._green,d.greenMinimum+1,d.greenMaximum,w,$,I,D,F),G=this._maximize(d,_WuQuant$1._blue,d.blueMinimum+1,d.blueMaximum,w,$,I,D,F),Z=this._maximize(d,_WuQuant$1._alpha,d.alphaMinimum+1,d.alphaMaximum,w,$,I,D,F);if(Z.max>=U.max&&Z.max>=j.max&&Z.max>=G.max){if(g=_WuQuant$1._alpha,Z.position<0)return!1}else g=U.max>=Z.max&&U.max>=j.max&&U.max>=G.max?_WuQuant$1._red:j.max>=Z.max&&j.max>=U.max&&j.max>=G.max?_WuQuant$1._green:_WuQuant$1._blue;switch(m.redMaximum=d.redMaximum,m.greenMaximum=d.greenMaximum,m.blueMaximum=d.blueMaximum,m.alphaMaximum=d.alphaMaximum,g){case _WuQuant$1._red:m.redMinimum=d.redMaximum=U.position,m.greenMinimum=d.greenMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._green:m.greenMinimum=d.greenMaximum=j.position,m.redMinimum=d.redMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._blue:m.blueMinimum=d.blueMaximum=G.position,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._alpha:m.alphaMinimum=d.alphaMaximum=Z.position,m.blueMinimum=d.blueMinimum,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum}return d.volume=(d.redMaximum-d.redMinimum)*(d.greenMaximum-d.greenMinimum)*(d.blueMaximum-d.blueMinimum)*(d.alphaMaximum-d.alphaMinimum),m.volume=(m.redMaximum-m.redMinimum)*(m.greenMaximum-m.greenMinimum)*(m.blueMaximum-m.blueMinimum)*(m.alphaMaximum-m.alphaMinimum),!0}_initialize(d){this._colors=d,this._cubes=[];for(let m=0;m<d;m++)this._cubes[m]=new WuColorCube$1;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let m=0;m<256;++m)this._table[m]=m*m;this._pixels=[]}_setQuality(d=5){this._significantBitsPerChannel=d,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant$1=_WuQuant$1;__publicField$3(WuQuant$1,"_alpha",3),__publicField$3(WuQuant$1,"_red",2),__publicField$3(WuQuant$1,"_green",1),__publicField$3(WuQuant$1,"_blue",0);var image_exports$1={};__export$1(image_exports$1,{AbstractImageQuantizer:()=>AbstractImageQuantizer$1,ErrorDiffusionArray:()=>ErrorDiffusionArray$1,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel$1,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma$1,NearestColor:()=>NearestColor$1});var AbstractImageQuantizer$1=class{quantizeSync(d,m){for(const g of this.quantize(d,m))if(g.pointContainer)return g.pointContainer;throw new Error("unreachable")}},NearestColor$1=class extends AbstractImageQuantizer$1{constructor(d){super(),__publicField$3(this,"_distance"),this._distance=d}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=new ProgressTracker$1($,99);for(let D=0;D<$;D++){I.shouldNotify(D)&&(yield{progress:I.progress});for(let F=0,U=D*w;F<w;F++,U++){const j=g[U];j.from(m.getNearestColor(this._distance,j))}}yield{pointContainer:d,progress:100}}},ErrorDiffusionArrayKernel$1=(d=>(d[d.FloydSteinberg=0]="FloydSteinberg",d[d.FalseFloydSteinberg=1]="FalseFloydSteinberg",d[d.Stucki=2]="Stucki",d[d.Atkinson=3]="Atkinson",d[d.Jarvis=4]="Jarvis",d[d.Burkes=5]="Burkes",d[d.Sierra=6]="Sierra",d[d.TwoSierra=7]="TwoSierra",d[d.SierraLite=8]="SierraLite",d))(ErrorDiffusionArrayKernel$1||{}),ErrorDiffusionArray$1=class extends AbstractImageQuantizer$1{constructor(d,m,g=!0,w=0,$=!1){super(),__publicField$3(this,"_minColorDistance"),__publicField$3(this,"_serpentine"),__publicField$3(this,"_kernel"),__publicField$3(this,"_calculateErrorLikeGIMP"),__publicField$3(this,"_distance"),this._setKernel(m),this._distance=d,this._minColorDistance=w,this._serpentine=g,this._calculateErrorLikeGIMP=$}*quantize(d,m){const g=d.getPointArray(),w=new Point$1,$=d.getWidth(),I=d.getHeight(),D=[];let F=1,U=1;for(const G of this._kernel){const Z=G[2]+1;U<Z&&(U=Z)}for(let G=0;G<U;G++)this._fillErrorLine(D[G]=[],$);const j=new ProgressTracker$1(I,99);for(let G=0;G<I;G++){j.shouldNotify(G)&&(yield{progress:j.progress}),this._serpentine&&(F*=-1);const Z=G*$,H=F===1?0:$-1,q=F===1?$:-1;this._fillErrorLine(D[0],$),D.push(D.shift());const V=D[0];for(let Q=H,X=Z+H;Q!==q;Q+=F,X+=F){const re=g[X],J=V[Q];w.from(re);const se=Point$1.createByRGBA(inRange0to255Rounded$1(re.r+J[0]),inRange0to255Rounded$1(re.g+J[1]),inRange0to255Rounded$1(re.b+J[2]),inRange0to255Rounded$1(re.a+J[3])),ie=m.getNearestColor(this._distance,se);if(re.from(ie),this._minColorDistance&&this._distance.calculateNormalized(w,ie)<this._minColorDistance)continue;let oe,pe,de,ge;this._calculateErrorLikeGIMP?(oe=se.r-ie.r,pe=se.g-ie.g,de=se.b-ie.b,ge=se.a-ie.a):(oe=w.r-ie.r,pe=w.g-ie.g,de=w.b-ie.b,ge=w.a-ie.a);const ce=F===1?0:this._kernel.length-1,Ie=F===1?this._kernel.length:-1;for(let fe=ce;fe!==Ie;fe+=F){const Te=this._kernel[fe][1]*F,ut=this._kernel[fe][2];if(Te+Q>=0&&Te+Q<$&&ut+G>=0&&ut+G<I){const ze=this._kernel[fe][0],Ce=D[ut][Te+Q];Ce[0]+=oe*ze,Ce[1]+=pe*ze,Ce[2]+=de*ze,Ce[3]+=ge*ze}}}}yield{pointContainer:d,progress:100}}_fillErrorLine(d,m){d.length>m&&(d.length=m);const g=d.length;for(let w=0;w<g;w++){const $=d[w];$[0]=$[1]=$[2]=$[3]=0}for(let w=g;w<m;w++)d[w]=[0,0,0,0]}_setKernel(d){switch(d){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${d}`)}}};function*hilbertCurve$1(d,m,g){const w=Math.max(d,m),$={width:d,height:m,level:Math.floor(Math.log(w)/Math.log(2)+1),callback:g,tracker:new ProgressTracker$1(d*m,99),index:0,x:0,y:0};yield*walkHilbert$1($,1),visit$1($,0)}function*walkHilbert$1(d,m){if(!(d.level<1)){switch(d.tracker.shouldNotify(d.index)&&(yield{progress:d.tracker.progress}),d.level--,m){case 2:yield*walkHilbert$1(d,1),visit$1(d,3),yield*walkHilbert$1(d,2),visit$1(d,4),yield*walkHilbert$1(d,2),visit$1(d,2),yield*walkHilbert$1(d,4);break;case 3:yield*walkHilbert$1(d,4),visit$1(d,2),yield*walkHilbert$1(d,3),visit$1(d,1),yield*walkHilbert$1(d,3),visit$1(d,3),yield*walkHilbert$1(d,1);break;case 1:yield*walkHilbert$1(d,2),visit$1(d,4),yield*walkHilbert$1(d,1),visit$1(d,3),yield*walkHilbert$1(d,1),visit$1(d,1),yield*walkHilbert$1(d,3);break;case 4:yield*walkHilbert$1(d,3),visit$1(d,1),yield*walkHilbert$1(d,4),visit$1(d,2),yield*walkHilbert$1(d,4),visit$1(d,4),yield*walkHilbert$1(d,2)}d.level++}}function visit$1(d,m){switch(d.x>=0&&d.x<d.width&&d.y>=0&&d.y<d.height&&(d.callback(d.x,d.y),d.index++),m){case 2:d.x--;break;case 3:d.x++;break;case 1:d.y--;break;case 4:d.y++}}var ErrorDiffusionRiemersma$1=class extends AbstractImageQuantizer$1{constructor(d,m=16,g=1){super(),__publicField$3(this,"_distance"),__publicField$3(this,"_weights"),__publicField$3(this,"_errorQueueSize"),this._distance=d,this._errorQueueSize=m,this._weights=ErrorDiffusionRiemersma$1._createWeights(g,m)}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=[];let D=0;for(let F=0;F<this._errorQueueSize;F++)I[F]={r:0,g:0,b:0,a:0};yield*hilbertCurve$1(w,$,((F,U)=>{const j=g[F+U*w];let{r:G,g:Z,b:H,a:q}=j;for(let re=0;re<this._errorQueueSize;re++){const J=this._weights[re],se=I[(re+D)%this._errorQueueSize];G+=se.r*J,Z+=se.g*J,H+=se.b*J,q+=se.a*J}const V=Point$1.createByRGBA(inRange0to255Rounded$1(G),inRange0to255Rounded$1(Z),inRange0to255Rounded$1(H),inRange0to255Rounded$1(q)),Q=m.getNearestColor(this._distance,V);D=(D+1)%this._errorQueueSize;const X=(D+this._errorQueueSize-1)%this._errorQueueSize;I[X].r=j.r-Q.r,I[X].g=j.g-Q.g,I[X].b=j.b-Q.b,I[X].a=j.a-Q.a,j.from(Q)})),yield{pointContainer:d,progress:100}}static _createWeights(d,m){const g=[],w=Math.exp(Math.log(m)/(m-1));for(let $=0,I=1;$<m;$++)g[$]=(I+.5|0)/m*d,I*=w;return g}},quality_exports$1={};__export$1(quality_exports$1,{ssim:()=>ssim$1});var K1$1=.01,K2$1=.03;function ssim$1(d,m){if(d.getHeight()!==m.getHeight()||d.getWidth()!==m.getWidth())throw new Error("Images have different sizes!");const g=(255*K1$1)**2,w=(255*K2$1)**2;let $=0,I=0;return iterate$1(d,m,((D,F,U,j)=>{let G=0,Z=0,H=0;for(let V=0;V<D.length;V++)Z+=(D[V]-U)**2,H+=(F[V]-j)**2,G+=(D[V]-U)*(F[V]-j);const q=D.length-1;Z/=q,H/=q,G/=q,I+=(2*U*j+g)*(2*G+w)/((U**2+j**2+g)*(Z+H+w)),$++})),I/$}function iterate$1(d,m,g){const w=d.getWidth(),$=d.getHeight();for(let I=0;I<$;I+=8)for(let D=0;D<w;D+=8){const F=Math.min(8,w-D),U=Math.min(8,$-I),j=calculateLumaValuesForWindow$1(d,D,I,F,U),G=calculateLumaValuesForWindow$1(m,D,I,F,U);g(j,G,calculateAverageLuma$1(j),calculateAverageLuma$1(G))}}function calculateLumaValuesForWindow$1(d,m,g,w,$){const I=d.getPointArray(),D=[];let F=0;for(let U=g;U<g+$;U++){const j=U*d.getWidth();for(let G=m;G<m+w;G++){const Z=I[j+G];D[F]=.2126*Z.r+.7152*Z.g+.0722*Z.b,F++}}return D}function calculateAverageLuma$1(d){let m=0;for(const g of d)m+=g;return m/d.length}var setImmediateImpl=typeof setImmediate=="function"?setImmediate:typeof process<"u"&&typeof(process==null?void 0:process.nextTick)=="function"?d=>process.nextTick(d):d=>setTimeout(d,0);function buildPaletteSync$1(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w}={}){const $=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(m),g,w);return d.forEach((I=>$.sample(I))),$.quantizeSync()}async function buildPalette(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w,onProgress:$}={}){return new Promise(((I,D)=>{const F=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(m),g,w);let U;d.forEach((Z=>F.sample(Z)));const j=F.quantize(),G=()=>{try{const Z=j.next();Z.done?I(U):(Z.value.palette&&(U=Z.value.palette),$&&$(Z.value.progress),setImmediateImpl(G))}catch(Z){D(Z)}};setImmediateImpl(G)}))}function applyPaletteSync$1(d,m,{colorDistanceFormula:g,imageQuantization:w}={}){return imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(g),w).quantizeSync(d,m)}async function applyPalette(d,m,{colorDistanceFormula:g,imageQuantization:w,onProgress:$}={}){return new Promise(((I,D)=>{let F;const U=imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(g),w).quantize(d,m),j=()=>{try{const G=U.next();G.done?I(F):(G.value.pointContainer&&(F=G.value.pointContainer),$&&$(G.value.progress),setImmediateImpl(j))}catch(G){D(G)}};setImmediateImpl(j)}))}function colorDistanceFormulaToColorDistance$1(d="euclidean-bt709"){switch(d){case"cie94-graphic-arts":return new CIE94GraphicArts$1;case"cie94-textiles":return new CIE94Textiles$1;case"ciede2000":return new CIEDE2000$1;case"color-metric":return new CMetric$1;case"euclidean":return new Euclidean$1;case"euclidean-bt709":return new EuclideanBT709$1;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha$1;case"manhattan":return new Manhattan$1;case"manhattan-bt709":return new ManhattanBT709$1;case"manhattan-nommyde":return new ManhattanNommyde$1;case"pngquant":return new PNGQuant$1;default:throw new Error(`Unknown colorDistanceFormula ${d}`)}}function imageQuantizationToImageQuantizer$1(d,m="floyd-steinberg"){switch(m){case"nearest":return new NearestColor$1(d);case"riemersma":return new ErrorDiffusionRiemersma$1(d);case"floyd-steinberg":return new ErrorDiffusionArray$1(d,0);case"false-floyd-steinberg":return new ErrorDiffusionArray$1(d,1);case"stucki":return new ErrorDiffusionArray$1(d,2);case"atkinson":return new ErrorDiffusionArray$1(d,3);case"jarvis":return new ErrorDiffusionArray$1(d,4);case"burkes":return new ErrorDiffusionArray$1(d,5);case"sierra":return new ErrorDiffusionArray$1(d,6);case"two-sierra":return new ErrorDiffusionArray$1(d,7);case"sierra-lite":return new ErrorDiffusionArray$1(d,8);default:throw new Error(`Unknown imageQuantization ${m}`)}}function paletteQuantizationToPaletteQuantizer$1(d,m="wuquant",g=256){switch(m){case"neuquant":return new NeuQuant$1(d,g);case"rgbquant":return new RGBQuant$1(d,g);case"wuquant":return new WuQuant$1(d,g);case"neuquant-float":return new NeuQuantFloat$1(d,g);default:throw new Error(`Unknown paletteQuantization ${m}`)}}var imageQ=__toCommonJS(src_exports),gifframe={};const BitmapImage$1=bitmapimage;let GifFrame$1=class ih extends BitmapImage$1{constructor(...m){if(super(...m),m[0]instanceof ih){const g=m[0];this.xOffset=g.xOffset,this.yOffset=g.yOffset,this.disposalMethod=g.disposalMethod,this.delayCentisecs=g.delayCentisecs,this.interlaced=g.interlaced}else{const g=m[m.length-1];let w={};typeof g!="object"||g instanceof BitmapImage$1||(w=g),this.xOffset=w.xOffset||0,this.yOffset=w.yOffset||0,this.disposalMethod=w.disposalMethod!==void 0?w.disposalMethod:ih.DisposeToBackgroundColor,this.delayCentisecs=w.delayCentisecs||8,this.interlaced=w.interlaced||!1}}getPalette(){const m=new Set,g=this.bitmap.data;let w=0,$=!1;for(;w<g.length;){if(g[w+3]===0)$=!0;else{const U=g.readUInt32BE(w,!0)>>8&16777215;m.add(U)}w+=4}const I=new Array(m.size),D=m.values();for(w=0;w<I.length;++w)I[w]=D.next().value;I.sort(((U,j)=>U-j));let F=I.length;return $&&++F,{colors:I,usesTransparency:$,indexCount:F}}};var hasRequiredGifutil,hasRequiredGifcodec;function requireGifutil(){return hasRequiredGifutil||(hasRequiredGifutil=1,(function(d){const m=require$$0,g=imageQ,w=bitmapimage,{GifFrame:$}=gifframe,{GifError:I}=gif$1,{GifCodec:D}=requireGifcodec(),F=[".jpg",".jpeg",".png",".bmp"],U=new D;function j(G,Z,H,q,V){const Q=Array.isArray(G)?G:[G];if(V){if(["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"].indexOf(V.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${V.ditherAlgorithm}'`);V.serpentine===void 0&&(V.serpentine=!0),V.minimumColorDistanceToDither===void 0&&(V.minimumColorDistanceToDither=0),V.calculateErrorLikeGIMP===void 0&&(V.calculateErrorLikeGIMP=!1)}const X=new g.distance.Euclidean,re=new g.palette[Z](X,H,q);let J;J=V?new g.image.ErrorDiffusionArray(X,g.image.ErrorDiffusionArrayKernel[V.ditherAlgorithm],V.serpentine,V.minimumColorDistanceToDither,V.calculateErrorLikeGIMP):new g.image.NearestColor(X);const se=[];Q.forEach((oe=>{const pe=oe.bitmap.data,de=new ArrayBuffer(pe.length),ge=new Uint32Array(de);for(let Ie=0,fe=0;Ie<pe.length;Ie+=4,++fe)ge[fe]=pe.readUInt32LE(Ie,!0);const ce=g.utils.PointContainer.fromUint32Array(ge,oe.bitmap.width,oe.bitmap.height);re.sample(ce),se.push(ce)}));const ie=re.quantizeSync();for(let oe=0;oe<Q.length;++oe){const pe=Q[oe].bitmap.data,de=J.quantizeSync(se[oe],ie).toUint32Array();for(let ge=0,ce=0;ge<pe.length;ge+=4,++ce)pe.writeUInt32LE(de[ce],ge)}}d.cloneFrames=function(G){let Z=[];return G.forEach((H=>{Z.push(new $(H))})),Z},d.getColorInfo=function(G,Z){let H=!1;const q=[];for(let J=0;J<G.length;++J){let se=G[J].getPalette();if(se.usesTransparency&&(H=!0),se.indexCount>256)throw new I(`Frame ${J} uses more than 256 color indexes`);q.push(se)}if(Z===0)return{usesTransparency:H,palettes:q};const V=new Set;q.forEach((J=>{J.colors.forEach((se=>{V.add(se)}))}));let Q=V.size;if(H&&++Q,Z&&Q>Z)return{usesTransparency:H,palettes:q};const X=new Array(V.size),re=V.values();for(let J=0;J<X.length;++J)X[J]=re.next().value;return X.sort(((J,se)=>J-se)),{colors:X,indexCount:Q,usesTransparency:H,palettes:q}},d.copyAsJimp=function(G,Z){return d.shareAsJimp(G,new w(Z))},d.getMaxDimensions=function(G){let Z=0,H=0;return G.forEach((q=>{const V=q.xOffset+q.bitmap.width;V>Z&&(Z=V);const Q=q.yOffset+q.bitmap.height;Q>H&&(H=Q)})),{maxWidth:Z,maxHeight:H}},d.quantizeDekker=function(G,Z,H){j(G,"NeuQuantFloat",Z=Z||256,0,H)},d.quantizeSorokin=function(G,Z,H,q){let V;switch(Z=Z||256,H=H||"min-pop"){case"min-pop":V=2;break;case"top-pop":V=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${H}'`)}j(G,"RGBQuant",Z,V,q)},d.quantizeWu=function(G,Z,H,q){if(Z=Z||256,(H=H||5)<1||H>8)throw new Error("Invalid quantization quality");j(G,"WuQuant",Z,H,q)},d.read=function(G,Z){return Z=Z||U,Buffer.isBuffer(G)?Z.decodeGif(G):(function(H){return new Promise(((q,V)=>{m.readFile(H,((Q,X)=>Q?V(Q):q(X)))}))})(G).then((H=>Z.decodeGif(H)))},d.shareAsJimp=function(G,Z){const H=new G(Z.bitmap.width,Z.bitmap.height,0);return H.bitmap.data=Z.bitmap.data,H},d.write=function(G,Z,H,q){q=q||U;const V=G.match(/\.[a-zA-Z]+$/);if(V!==null&&F.includes(V[0].toLowerCase()))throw new Error(`GIF '${G}' has an unexpected suffix`);return q.encodeGif(Z,H).then((Q=>(function(X,re){return new Promise(((J,se)=>{m.writeFile(X,re,(ie=>ie?se(ie):J()))}))})(G,Q.buffer).then((()=>Q))))}})(gifutil)),gifutil}function requireGifcodec(){if(hasRequiredGifcodec)return gifcodec;hasRequiredGifcodec=1;const d=omggif,{Gif:m,GifError:g}=gif$1;function w(){const Z=requireGifutil();return w=function(){return Z},Z}const{GifFrame:$}=gifframe;function I(Z,H){const q=Z.indexOf(H);return q===-1?null:q}function D(Z,H){for(var q,V=0,Q=Z.length-1;V<=Q;)if(Z[q=Math.floor((V+Q)/2)]>H)Q=q-1;else{if(!(Z[q]<H))return q;V=q+1}return null}function F(Z){const H=Z.colors;Z.usesTransparency&&H.push(0);const q=H.length;let V=2;for(;q>V;)V<<=1;H.length=V,H.fill(0,q)}function U(Z,H){let q=Z.bitmap.width*Z.bitmap.height;return q=Math.ceil(q*H/8),q+=Math.ceil(q/255),100+q+768}function j(Z){let H=Z.indexCount,q=0;for(--H;H;)++q,H>>=1;return q>0?q:1}function G(Z,H,q,V,Q){if(q.interlaced)throw new g("writing interlaced GIFs is not supported");const X=(function(J,se,ie){const oe=ie.colors,pe=oe.length<=8?I:D,de=se.bitmap.data,ge=new Buffer(de.length/4);let ce=oe.length,Ie=0,fe=0;for(;Ie<de.length;){if(de[Ie+3]!==0){const Te=de.readUInt32BE(Ie,!0)>>8&16777215;ge[fe]=pe(oe,Te)}else ge[fe]=ce;Ie+=4,++fe}if(ie.usesTransparency){if(ce===256)throw new g(`Frame ${J} already has 256 colorsand so can't use transparency`)}else ce=null;return{buffer:ge,transparentIndex:ce}})(H,q,V),re={delay:q.delayCentisecs,disposal:q.disposalMethod,transparent:X.transparentIndex};Q&&(F(V),re.palette=V.colors);try{let J,se=Z.getOutputBuffer(),ie=Z.getOutputBufferPosition(),oe=!0;for(;oe;)if(J=Z.addFrame(q.xOffset,q.yOffset,q.bitmap.width,q.bitmap.height,X.buffer,re),oe=!1,J>=se.length-1){const pe=new Buffer(1.5*se.length);se.copy(pe),Z.setOutputBuffer(pe),Z.setOutputBufferPosition(ie),se=pe,oe=!0}return se}catch(J){throw new g(J)}}return gifcodec.GifCodec=class{constructor(Z={}){this._transparentRGB=null,typeof Z.transparentRGB=="number"&&Z.transparentRGB!==0&&(this._transparentRGBA=256*Z.transparentRGB),this._testInitialBufferSize=0}decodeGif(Z){try{let H;try{H=new d.GifReader(Z)}catch(X){throw new g(X)}const q=H.numFrames(),V=[],Q={width:H.width,height:H.height,loops:H.loopCount(),usesTransparency:!1};for(let X=0;X<q;++X){const re=this._decodeFrame(H,X,Q.usesTransparency);V.push(re.frame),re.usesTransparency&&(Q.usesTransparency=!0)}return Promise.resolve(new m(Z,V,Q))}catch(H){return Promise.reject(H)}}encodeGif(Z,H={}){try{if(Z===null||Z.length===0)throw new g("there are no frames");const q=w().getMaxDimensions(Z);return(H=Object.assign({},H)).width=q.maxWidth,H.height=q.maxHeight,H.loops===void 0&&(H.loops=0),H.colorScope=H.colorScope||m.GlobalColorsPreferred,Promise.resolve(this._encodeGif(Z,H))}catch(q){return Promise.reject(q)}}_decodeFrame(Z,H,q){let V,Q;try{if(V=Z.frameInfo(H),Q=new Buffer(Z.width*Z.height*4),Z.decodeAndBlitFrameRGBA(H,Q),V.width!==Z.width||V.height!==Z.height){if(V.y&&(Q=Q.slice(V.y*Z.width*4)),Z.width>V.width)for(let re=0;re<V.height;++re)Q.copy(Q,re*V.width*4,4*(V.x+re*Z.width),4*(V.x+re*Z.width)+4*V.width);Q=Q.slice(0,V.width*V.height*4)}}catch(re){throw new g(re)}let X=!1;if(this._transparentRGBA===null){if(!q)for(let re=3;re<Q.length;re+=4)Q[re]===0&&(X=!0,re=Q.length)}else for(let re=3;re<Q.length;re+=4)Q[re]===0&&(Q.writeUInt32BE(this._transparentRGBA,re-3),X=!0);return{frame:new $(V.width,V.height,Q,{xOffset:V.x,yOffset:V.y,disposalMethod:V.disposal,interlaced:V.interlaced,delayCentisecs:V.delay}),usesTransparency:X}}_encodeGif(Z,H){let q;if(H.colorScope===m.LocalColorsOnly)q=w().getColorInfo(Z,0);else if(q=w().getColorInfo(Z,256),!q.colors){if(H.colorScope===m.GlobalColorsOnly)throw new g("Too many color indexes for global color table");H.colorScope=m.LocalColorsOnly}H.usesTransparency=q.usesTransparency;const V=q.palettes;return H.colorScope===m.LocalColorsOnly?(function(Q,X,re,J){const se={loop:X.loops};let ie,oe=new Buffer(re);try{ie=new d.GifWriter(oe,X.width,X.height,se)}catch(pe){throw new g(pe)}for(let pe=0;pe<Q.length;++pe)oe=G(ie,pe,Q[pe],J[pe],!0);return new m(oe.slice(0,ie.end()),Q,X)})(Z,H,2e3,V):(function(Q,X,re,J){const se={colors:J.colors.slice(),usesTransparency:J.usesTransparency};F(se);const ie={palette:se.colors,loop:X.loops};let oe,pe=new Buffer(re);try{oe=new d.GifWriter(pe,X.width,X.height,ie)}catch(de){throw new g(de)}for(let de=0;de<Q.length;++de)pe=G(oe,de,Q[de],J,!1);return new m(pe.slice(0,oe.end()),Q,X)})(Z,H,2e3,q)}_getSizeEstimateGlobal(Z,H){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let q=968;const V=j(Z);return H.forEach((Q=>{q+=U(Q,V)})),q}_getSizeEstimateLocal(Z,H){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let q=200;for(let V=0;V<H.length;++V){const Q=j(Z[V]);q+=U(H[V],Q)}return q}},gifcodec}GifFrame$1.DisposeToAnything=0,GifFrame$1.DisposeNothing=1,GifFrame$1.DisposeToBackgroundColor=2,GifFrame$1.DisposeToPrevious=3,gifframe.GifFrame=GifFrame$1;const BitmapImage=bitmapimage,{GifCodec}=requireGifcodec(),{GifFrame}=gifframe,GifUtil=requireGifutil();var src={BitmapImage,GifCodec,GifFrame,GifUtil};function gif(){return{mime:"image/gif",encode:async d=>{const m=new src.BitmapImage(d);src.GifUtil.quantizeDekker(m,256);const g=new src.GifFrame(d);return(await new src.GifCodec().encodeGif([g],{})).buffer},decode:d=>{const m=new omggif.GifReader(d),g=Buffer.alloc(m.width*m.height*4);return m.decodeAndBlitFrameRGBA(0,g),{data:g,width:m.width,height:m.height}}}}var encoder={exports:{}};(function(d){function m(g){var w,$,I,D,F,U=Math.floor,j=new Array(64),G=new Array(64),Z=new Array(64),H=new Array(64),q=new Array(65535),V=new Array(65535),Q=new Array(64),X=new Array(64),re=[],J=0,se=7,ie=new Array(64),oe=new Array(64),pe=new Array(64),de=new Array(256),ge=new Array(2048),ce=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ie=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],fe=[0,1,2,3,4,5,6,7,8,9,10,11],Te=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ut=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ze=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ce=[0,1,2,3,4,5,6,7,8,9,10,11],Fe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Et=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function bt(Lt,dt){for(var It=0,dr=0,fr=new Array,pr=1;pr<=16;pr++){for(var Nt=1;Nt<=Lt[pr];Nt++)fr[dt[dr]]=[],fr[dt[dr]][0]=It,fr[dt[dr]][1]=pr,dr++,It++;It*=2}return fr}function ht(Lt){for(var dt=Lt[0],It=Lt[1]-1;It>=0;)dt&1<<It&&(J|=1<<se),It--,--se<0&&(J==255?(Zt(255),Zt(0)):Zt(J),se=7,J=0)}function Zt(Lt){re.push(Lt)}function Ye(Lt){Zt(Lt>>8&255),Zt(255&Lt)}function _t(Lt,dt,It,dr,fr){for(var pr,Nt=fr[0],$e=fr[240],At=(function(ft,mr){var gr,oi,hi,ai,fi,ui,wi,_i,bi,Ei,gi=0;for(bi=0;bi<8;++bi){gr=ft[gi],oi=ft[gi+1],hi=ft[gi+2],ai=ft[gi+3],fi=ft[gi+4],ui=ft[gi+5],wi=ft[gi+6];var Yt=gr+(_i=ft[gi+7]),di=gr-_i,_r=oi+wi,ri=oi-wi,yt=hi+ui,ni=hi-ui,$i=ai+fi,Oe=ai-fi,ii=Yt+$i,br=Yt-$i,hr=_r+yt,yr=_r-yt;ft[gi]=ii+hr,ft[gi+4]=ii-hr;var ti=.707106781*(yr+br);ft[gi+2]=br+ti,ft[gi+6]=br-ti;var vi=.382683433*((ii=Oe+ni)-(yr=ri+di)),mi=.5411961*ii+vi,yi=1.306562965*yr+vi,Si=.707106781*(hr=ni+ri),Li=di+Si,Ai=di-Si;ft[gi+5]=Ai+mi,ft[gi+3]=Ai-mi,ft[gi+1]=Li+yi,ft[gi+7]=Li-yi,gi+=8}for(gi=0,bi=0;bi<8;++bi){gr=ft[gi],oi=ft[gi+8],hi=ft[gi+16],ai=ft[gi+24],fi=ft[gi+32],ui=ft[gi+40],wi=ft[gi+48];var Mi=gr+(_i=ft[gi+56]),Ri=gr-_i,Oi=oi+wi,Hi=oi-wi,qi=hi+ui,Bi=hi-ui,zi=ai+fi,Ui=ai-fi,Di=Mi+zi,Pi=Mi-zi,Ci=Oi+qi,Ki=Oi-qi;ft[gi]=Di+Ci,ft[gi+32]=Di-Ci;var Tn=.707106781*(Ki+Pi);ft[gi+16]=Pi+Tn,ft[gi+48]=Pi-Tn;var Zi=.382683433*((Di=Ui+Bi)-(Ki=Hi+Ri)),An=.5411961*Di+Zi,xn=1.306562965*Ki+Zi,Gi=.707106781*(Ci=Bi+Hi),$n=Ri+Gi,Fi=Ri-Gi;ft[gi+40]=Fi+An,ft[gi+24]=Fi-An,ft[gi+8]=$n+xn,ft[gi+56]=$n-xn,gi++}for(bi=0;bi<64;++bi)Ei=ft[bi]*mr[bi],Q[bi]=Ei>0?Ei+.5|0:Ei-.5|0;return Q})(Lt,dt),Ge=0;Ge<64;++Ge)X[ce[Ge]]=At[Ge];var st=X[0]-It;It=X[0],st==0?ht(dr[0]):(ht(dr[V[pr=32767+st]]),ht(q[pr]));for(var Xe=63;Xe>0&&X[Xe]==0;Xe--);if(Xe==0)return ht(Nt),It;for(var gt,Qt=1;Qt<=Xe;){for(var me=Qt;X[Qt]==0&&Qt<=Xe;++Qt);var Be=Qt-me;if(Be>=16){gt=Be>>4;for(var lt=1;lt<=gt;++lt)ht($e);Be&=15}pr=32767+X[Qt],ht(fr[(Be<<4)+V[pr]]),ht(q[pr]),Qt++}return Xe!=63&&ht(Nt),It}function Vt(Lt){Lt<=0&&(Lt=1),Lt>100&&(Lt=100),F!=Lt&&((function(dt){for(var It=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],dr=0;dr<64;dr++){var fr=U((It[dr]*dt+50)/100);fr<1?fr=1:fr>255&&(fr=255),j[ce[dr]]=fr}for(var pr=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Nt=0;Nt<64;Nt++){var $e=U((pr[Nt]*dt+50)/100);$e<1?$e=1:$e>255&&($e=255),G[ce[Nt]]=$e}for(var At=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ge=0,st=0;st<8;st++)for(var Xe=0;Xe<8;Xe++)Z[Ge]=1/(j[ce[Ge]]*At[st]*At[Xe]*8),H[Ge]=1/(G[ce[Ge]]*At[st]*At[Xe]*8),Ge++})(Lt<50?Math.floor(5e3/Lt):Math.floor(200-2*Lt)),F=Lt)}this.encode=function(Lt,dt){var It;new Date().getTime(),dt&&Vt(dt),re=new Array,J=0,se=7,Ye(65496),Ye(65504),Ye(16),Zt(74),Zt(70),Zt(73),Zt(70),Zt(0),Zt(1),Zt(1),Zt(0),Ye(1),Ye(1),Zt(0),Zt(0),(It=Lt.comments)!==void 0&&It.constructor===Array&&It.forEach((hi=>{if(typeof hi=="string"){Ye(65534);var ai,fi=hi.length;for(Ye(fi+2),ai=0;ai<fi;ai++)Zt(hi.charCodeAt(ai))}})),(function(hi){if(hi){Ye(65505),hi[0]===69&&hi[1]===120&&hi[2]===105&&hi[3]===102?Ye(hi.length+2):(Ye(hi.length+5+2),Zt(69),Zt(120),Zt(105),Zt(102),Zt(0));for(var ai=0;ai<hi.length;ai++)Zt(hi[ai])}})(Lt.exifBuffer),(function(){Ye(65499),Ye(132),Zt(0);for(var hi=0;hi<64;hi++)Zt(j[hi]);Zt(1);for(var ai=0;ai<64;ai++)Zt(G[ai])})(),(function(hi,ai){Ye(65472),Ye(17),Zt(8),Ye(ai),Ye(hi),Zt(3),Zt(1),Zt(17),Zt(0),Zt(2),Zt(17),Zt(1),Zt(3),Zt(17),Zt(1)})(Lt.width,Lt.height),(function(){Ye(65476),Ye(418),Zt(0);for(var hi=0;hi<16;hi++)Zt(Ie[hi+1]);for(var ai=0;ai<=11;ai++)Zt(fe[ai]);Zt(16);for(var fi=0;fi<16;fi++)Zt(Te[fi+1]);for(var ui=0;ui<=161;ui++)Zt(ut[ui]);Zt(1);for(var wi=0;wi<16;wi++)Zt(ze[wi+1]);for(var _i=0;_i<=11;_i++)Zt(Ce[_i]);Zt(17);for(var bi=0;bi<16;bi++)Zt(Fe[bi+1]);for(var Ei=0;Ei<=161;Ei++)Zt(Et[Ei])})(),Ye(65498),Ye(12),Zt(3),Zt(1),Zt(0),Zt(2),Zt(17),Zt(3),Zt(17),Zt(0),Zt(63),Zt(0);var dr=0,fr=0,pr=0;J=0,se=7,this.encode.displayName="_encode_";for(var Nt,$e,At,Ge,st,Xe,gt,Qt,me,Be=Lt.data,lt=Lt.width,ft=Lt.height,mr=4*lt,gr=0;gr<ft;){for(Nt=0;Nt<mr;){for(Xe=st=mr*gr+Nt,gt=-1,Qt=0,me=0;me<64;me++)Xe=st+(Qt=me>>3)*mr+(gt=4*(7&me)),gr+Qt>=ft&&(Xe-=mr*(gr+1+Qt-ft)),Nt+gt>=mr&&(Xe-=Nt+gt-mr+4),$e=Be[Xe++],At=Be[Xe++],Ge=Be[Xe++],ie[me]=(ge[$e]+ge[At+256|0]+ge[Ge+512|0]>>16)-128,oe[me]=(ge[$e+768|0]+ge[At+1024|0]+ge[Ge+1280|0]>>16)-128,pe[me]=(ge[$e+1280|0]+ge[At+1536|0]+ge[Ge+1792|0]>>16)-128;dr=_t(ie,Z,dr,w,I),fr=_t(oe,H,fr,$,D),pr=_t(pe,H,pr,$,D),Nt+=32}gr+=8}if(se>=0){var oi=[];oi[1]=se+1,oi[0]=(1<<se+1)-1,ht(oi)}return Ye(65497),Buffer.from(re)},new Date().getTime(),g||(g=50),(function(){for(var Lt=String.fromCharCode,dt=0;dt<256;dt++)de[dt]=Lt(dt)})(),w=bt(Ie,fe),$=bt(ze,Ce),I=bt(Te,ut),D=bt(Fe,Et),(function(){for(var Lt=1,dt=2,It=1;It<=15;It++){for(var dr=Lt;dr<dt;dr++)V[32767+dr]=It,q[32767+dr]=[],q[32767+dr][1]=It,q[32767+dr][0]=dr;for(var fr=-(dt-1);fr<=-Lt;fr++)V[32767+fr]=It,q[32767+fr]=[],q[32767+fr][1]=It,q[32767+fr][0]=dt-1+fr;Lt<<=1,dt<<=1}})(),(function(){for(var Lt=0;Lt<256;Lt++)ge[Lt]=19595*Lt,ge[Lt+256|0]=38470*Lt,ge[Lt+512|0]=7471*Lt+32768,ge[Lt+768|0]=-11059*Lt,ge[Lt+1024|0]=-21709*Lt,ge[Lt+1280|0]=32768*Lt+8421375,ge[Lt+1536|0]=-27439*Lt,ge[Lt+1792|0]=-5329*Lt})(),Vt(g),new Date().getTime()}encoder.exports=function(g,w){w===void 0&&(w=50);var $=new m(w),I=$.encode(g,w);return{data:I,width:g.width,height:g.height}}})();var encoderExports=encoder.exports,decoder={exports:{}},module,JpegImage;module=decoder,JpegImage=(function(){var d=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),m=4017,g=799,w=3406,$=2276,I=1567,D=3784,F=5793,U=2896;function j(){}function G(re,J){for(var se,ie,oe=0,pe=[],de=16;de>0&&!re[de-1];)de--;pe.push({children:[],index:0});var ge,ce=pe[0];for(se=0;se<de;se++){for(ie=0;ie<re[se];ie++){for((ce=pe.pop()).children[ce.index]=J[oe];ce.index>0;){if(pe.length===0)throw new Error("Could not recreate Huffman Table");ce=pe.pop()}for(ce.index++,pe.push(ce);pe.length<=se;)pe.push(ge={children:[],index:0}),ce.children[ce.index]=ge.children,ce=ge;oe++}se+1<de&&(pe.push(ge={children:[],index:0}),ce.children[ce.index]=ge.children,ce=ge)}return pe[0].children}function Z(re,J,se,ie,oe,pe,de,ge,ce,Ie){se.precision,se.samplesPerLine,se.scanLines;var fe=se.mcusPerLine,Te=se.progressive;se.maxH,se.maxV;var ut=J,ze=0,Ce=0;function Fe(){if(Ce>0)return Ce--,ze>>Ce&1;if((ze=re[J++])==255){var Qt=re[J++];if(Qt)throw new Error("unexpected marker: "+(ze<<8|Qt).toString(16))}return Ce=7,ze>>>7}function Et(Qt){for(var me,Be=Qt;(me=Fe())!==null;){if(typeof(Be=Be[me])=="number")return Be;if(typeof Be!="object")throw new Error("invalid huffman sequence")}return null}function bt(Qt){for(var me=0;Qt>0;){var Be=Fe();if(Be===null)return;me=me<<1|Be,Qt--}return me}function ht(Qt){var me=bt(Qt);return me>=1<<Qt-1?me:me+(-1<<Qt)+1}var Zt,Ye=0,_t=0;function Vt(Qt,me,Be,lt,ft){var mr=Be%fe,gr=(Be/fe|0)*Qt.v+lt,oi=mr*Qt.h+ft;Qt.blocks[gr]===void 0&&Ie.tolerantDecoding||me(Qt,Qt.blocks[gr][oi])}function Lt(Qt,me,Be){var lt=Be/Qt.blocksPerLine|0,ft=Be%Qt.blocksPerLine;Qt.blocks[lt]===void 0&&Ie.tolerantDecoding||me(Qt,Qt.blocks[lt][ft])}var dt,It,dr,fr,pr,Nt,$e=ie.length;Nt=Te?pe===0?ge===0?function(Qt,me){var Be=Et(Qt.huffmanTableDC),lt=Be===0?0:ht(Be)<<ce;me[0]=Qt.pred+=lt}:function(Qt,me){me[0]|=Fe()<<ce}:ge===0?function(Qt,me){if(Ye>0)Ye--;else for(var Be=pe,lt=de;Be<=lt;){var ft=Et(Qt.huffmanTableAC),mr=15&ft,gr=ft>>4;if(mr!==0)me[d[Be+=gr]]=ht(mr)*(1<<ce),Be++;else{if(gr<15){Ye=bt(gr)+(1<<gr)-1;break}Be+=16}}}:function(Qt,me){for(var Be=pe,lt=de,ft=0;Be<=lt;){var mr=d[Be],gr=me[mr]<0?-1:1;switch(_t){case 0:var oi=Et(Qt.huffmanTableAC),hi=15&oi;if(ft=oi>>4,hi===0)ft<15?(Ye=bt(ft)+(1<<ft),_t=4):(ft=16,_t=1);else{if(hi!==1)throw new Error("invalid ACn encoding");Zt=ht(hi),_t=ft?2:3}continue;case 1:case 2:me[mr]?me[mr]+=(Fe()<<ce)*gr:--ft==0&&(_t=_t==2?3:0);break;case 3:me[mr]?me[mr]+=(Fe()<<ce)*gr:(me[mr]=Zt<<ce,_t=0);break;case 4:me[mr]&&(me[mr]+=(Fe()<<ce)*gr)}Be++}_t===4&&--Ye==0&&(_t=0)}:function(Qt,me){var Be=Et(Qt.huffmanTableDC),lt=Be===0?0:ht(Be);me[0]=Qt.pred+=lt;for(var ft=1;ft<64;){var mr=Et(Qt.huffmanTableAC),gr=15&mr,oi=mr>>4;if(gr!==0)me[d[ft+=oi]]=ht(gr),ft++;else{if(oi<15)break;ft+=16}}};var At,Ge,st,Xe,gt=0;for(Ge=$e==1?ie[0].blocksPerLine*ie[0].blocksPerColumn:fe*se.mcusPerColumn,oe||(oe=Ge);gt<Ge;){for(It=0;It<$e;It++)ie[It].pred=0;if(Ye=0,$e==1)for(dt=ie[0],pr=0;pr<oe;pr++)Lt(dt,Nt,gt),gt++;else for(pr=0;pr<oe;pr++){for(It=0;It<$e;It++)for(st=(dt=ie[It]).h,Xe=dt.v,dr=0;dr<Xe;dr++)for(fr=0;fr<st;fr++)Vt(dt,Nt,gt,dr,fr);if(++gt===Ge)break}if(gt===Ge)do{if(re[J]===255&&re[J+1]!==0)break;J+=1}while(J<re.length-2);if(Ce=0,(At=re[J]<<8|re[J+1])<65280)throw new Error("marker was not found");if(!(At>=65488&&At<=65495))break;J+=2}return J-ut}function H(re,J){var se,ie,oe=[],pe=J.blocksPerLine,de=J.blocksPerColumn,ge=pe<<3,ce=new Int32Array(64),Ie=new Uint8Array(64);function fe(bt,ht,Zt){var Ye,_t,Vt,Lt,dt,It,dr,fr,pr,Nt,$e=J.quantizationTable,At=Zt;for(Nt=0;Nt<64;Nt++)At[Nt]=bt[Nt]*$e[Nt];for(Nt=0;Nt<8;++Nt){var Ge=8*Nt;At[1+Ge]!=0||At[2+Ge]!=0||At[3+Ge]!=0||At[4+Ge]!=0||At[5+Ge]!=0||At[6+Ge]!=0||At[7+Ge]!=0?(Ye=F*At[0+Ge]+128>>8,_t=F*At[4+Ge]+128>>8,Vt=At[2+Ge],Lt=At[6+Ge],dt=U*(At[1+Ge]-At[7+Ge])+128>>8,fr=U*(At[1+Ge]+At[7+Ge])+128>>8,It=At[3+Ge]<<4,dr=At[5+Ge]<<4,pr=Ye-_t+1>>1,Ye=Ye+_t+1>>1,_t=pr,pr=Vt*D+Lt*I+128>>8,Vt=Vt*I-Lt*D+128>>8,Lt=pr,pr=dt-dr+1>>1,dt=dt+dr+1>>1,dr=pr,pr=fr+It+1>>1,It=fr-It+1>>1,fr=pr,pr=Ye-Lt+1>>1,Ye=Ye+Lt+1>>1,Lt=pr,pr=_t-Vt+1>>1,_t=_t+Vt+1>>1,Vt=pr,pr=dt*$+fr*w+2048>>12,dt=dt*w-fr*$+2048>>12,fr=pr,pr=It*g+dr*m+2048>>12,It=It*m-dr*g+2048>>12,dr=pr,At[0+Ge]=Ye+fr,At[7+Ge]=Ye-fr,At[1+Ge]=_t+dr,At[6+Ge]=_t-dr,At[2+Ge]=Vt+It,At[5+Ge]=Vt-It,At[3+Ge]=Lt+dt,At[4+Ge]=Lt-dt):(pr=F*At[0+Ge]+512>>10,At[0+Ge]=pr,At[1+Ge]=pr,At[2+Ge]=pr,At[3+Ge]=pr,At[4+Ge]=pr,At[5+Ge]=pr,At[6+Ge]=pr,At[7+Ge]=pr)}for(Nt=0;Nt<8;++Nt){var st=Nt;At[8+st]!=0||At[16+st]!=0||At[24+st]!=0||At[32+st]!=0||At[40+st]!=0||At[48+st]!=0||At[56+st]!=0?(Ye=F*At[0+st]+2048>>12,_t=F*At[32+st]+2048>>12,Vt=At[16+st],Lt=At[48+st],dt=U*(At[8+st]-At[56+st])+2048>>12,fr=U*(At[8+st]+At[56+st])+2048>>12,It=At[24+st],dr=At[40+st],pr=Ye-_t+1>>1,Ye=Ye+_t+1>>1,_t=pr,pr=Vt*D+Lt*I+2048>>12,Vt=Vt*I-Lt*D+2048>>12,Lt=pr,pr=dt-dr+1>>1,dt=dt+dr+1>>1,dr=pr,pr=fr+It+1>>1,It=fr-It+1>>1,fr=pr,pr=Ye-Lt+1>>1,Ye=Ye+Lt+1>>1,Lt=pr,pr=_t-Vt+1>>1,_t=_t+Vt+1>>1,Vt=pr,pr=dt*$+fr*w+2048>>12,dt=dt*w-fr*$+2048>>12,fr=pr,pr=It*g+dr*m+2048>>12,It=It*m-dr*g+2048>>12,dr=pr,At[0+st]=Ye+fr,At[56+st]=Ye-fr,At[8+st]=_t+dr,At[48+st]=_t-dr,At[16+st]=Vt+It,At[40+st]=Vt-It,At[24+st]=Lt+dt,At[32+st]=Lt-dt):(pr=F*Zt[Nt+0]+8192>>14,At[0+st]=pr,At[8+st]=pr,At[16+st]=pr,At[24+st]=pr,At[32+st]=pr,At[40+st]=pr,At[48+st]=pr,At[56+st]=pr)}for(Nt=0;Nt<64;++Nt){var Xe=128+(At[Nt]+8>>4);ht[Nt]=Xe<0?0:Xe>255?255:Xe}}X(ge*de*8);for(var Te=0;Te<de;Te++){var ut=Te<<3;for(se=0;se<8;se++)oe.push(new Uint8Array(ge));for(var ze=0;ze<pe;ze++){fe(J.blocks[Te][ze],Ie,ce);var Ce=0,Fe=ze<<3;for(ie=0;ie<8;ie++){var Et=oe[ut+ie];for(se=0;se<8;se++)Et[Fe+se]=Ie[Ce++]}}}return oe}function q(re){return re<0?0:re>255?255:re}j.prototype={load:function(re){var J=new XMLHttpRequest;J.open("GET",re,!0),J.responseType="arraybuffer",J.onload=(function(){var se=new Uint8Array(J.response||J.mozResponseArrayBuffer);this.parse(se),this.onload&&this.onload()}).bind(this),J.send(null)},parse:function(re){var J=1e3*this.opts.maxResolutionInMP*1e3,se=0;function ie(){var ai=re[se]<<8|re[se+1];return se+=2,ai}function oe(ai){var fi,ui,wi=1,_i=1;for(ui in ai.components)ai.components.hasOwnProperty(ui)&&(wi<(fi=ai.components[ui]).h&&(wi=fi.h),_i<fi.v&&(_i=fi.v));var bi=Math.ceil(ai.samplesPerLine/8/wi),Ei=Math.ceil(ai.scanLines/8/_i);for(ui in ai.components)if(ai.components.hasOwnProperty(ui)){fi=ai.components[ui];var gi=Math.ceil(Math.ceil(ai.samplesPerLine/8)*fi.h/wi),Yt=Math.ceil(Math.ceil(ai.scanLines/8)*fi.v/_i),di=bi*fi.h,_r=Ei*fi.v,ri=[];X(_r*di*256);for(var yt=0;yt<_r;yt++){for(var ni=[],$i=0;$i<di;$i++)ni.push(new Int32Array(64));ri.push(ni)}fi.blocksPerLine=gi,fi.blocksPerColumn=Yt,fi.blocks=ri}ai.maxH=wi,ai.maxV=_i,ai.mcusPerLine=bi,ai.mcusPerColumn=Ei}re.length;var pe,de,ge,ce,Ie=null,fe=null,Te=[],ut=[],ze=[],Ce=[],Fe=ie(),Et=-1;if(this.comments=[],Fe!=65496)throw new Error("SOI not found");for(Fe=ie();Fe!=65497;){switch(Fe){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var bt=(ge=void 0,ce=void 0,ge=ie(),ce=re.subarray(se,se+ge-2),se+=ce.length,ce);if(Fe===65534){var ht=String.fromCharCode.apply(null,bt);this.comments.push(ht)}Fe===65504&&bt[0]===74&&bt[1]===70&&bt[2]===73&&bt[3]===70&&bt[4]===0&&(Ie={version:{major:bt[5],minor:bt[6]},densityUnits:bt[7],xDensity:bt[8]<<8|bt[9],yDensity:bt[10]<<8|bt[11],thumbWidth:bt[12],thumbHeight:bt[13],thumbData:bt.subarray(14,14+3*bt[12]*bt[13])}),Fe===65505&&bt[0]===69&&bt[1]===120&&bt[2]===105&&bt[3]===102&&bt[4]===0&&(this.exifBuffer=bt.subarray(5,bt.length)),Fe===65518&&bt[0]===65&&bt[1]===100&&bt[2]===111&&bt[3]===98&&bt[4]===101&&bt[5]===0&&(fe={version:bt[6],flags0:bt[7]<<8|bt[8],flags1:bt[9]<<8|bt[10],transformCode:bt[11]});break;case 65499:for(var Zt=ie()+se-2;se<Zt;){var Ye=re[se++];X(256);var _t=new Int32Array(64);if(Ye>>4){if(Ye>>4!=1)throw new Error("DQT: invalid table spec");for(oi=0;oi<64;oi++)_t[d[oi]]=ie()}else for(oi=0;oi<64;oi++)_t[d[oi]]=re[se++];Te[15&Ye]=_t}break;case 65472:case 65473:case 65474:ie(),(pe={}).extended=Fe===65473,pe.progressive=Fe===65474,pe.precision=re[se++],pe.scanLines=ie(),pe.samplesPerLine=ie(),pe.components={},pe.componentsOrder=[];var Vt=pe.scanLines*pe.samplesPerLine;if(Vt>J){var Lt=Math.ceil((Vt-J)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Lt}MP`)}var dt,It=re[se++];for(mr=0;mr<It;mr++){dt=re[se];var dr=re[se+1]>>4,fr=15&re[se+1],pr=re[se+2];if(dr<=0||fr<=0)throw new Error("Invalid sampling factor, expected values above 0");pe.componentsOrder.push(dt),pe.components[dt]={h:dr,v:fr,quantizationIdx:pr},se+=3}oe(pe),ut.push(pe);break;case 65476:var Nt=ie();for(mr=2;mr<Nt;){var $e=re[se++],At=new Uint8Array(16),Ge=0;for(oi=0;oi<16;oi++,se++)Ge+=At[oi]=re[se];X(16+Ge);var st=new Uint8Array(Ge);for(oi=0;oi<Ge;oi++,se++)st[oi]=re[se];mr+=17+Ge,($e>>4?ze:Ce)[15&$e]=G(At,st)}break;case 65501:ie(),de=ie();break;case 65500:ie(),ie();break;case 65498:ie();var Xe=re[se++],gt=[];for(mr=0;mr<Xe;mr++){hi=pe.components[re[se++]];var Qt=re[se++];hi.huffmanTableDC=Ce[Qt>>4],hi.huffmanTableAC=ze[15&Qt],gt.push(hi)}var me=re[se++],Be=re[se++],lt=re[se++],ft=Z(re,se,pe,gt,de,me,Be,lt>>4,15&lt,this.opts);se+=ft;break;case 65535:re[se]!==255&&se--;break;default:if(re[se-3]==255&&re[se-2]>=192&&re[se-2]<=254){se-=3;break}if(Fe===224||Fe==225){if(Et!==-1)throw new Error(`first unknown JPEG marker at offset ${Et.toString(16)}, second unknown JPEG marker ${Fe.toString(16)} at offset ${(se-1).toString(16)}`);Et=se-1;const ai=ie();if(re[se+ai-2]===255){se+=ai-2;break}}throw new Error("unknown JPEG marker "+Fe.toString(16))}Fe=ie()}if(ut.length!=1)throw new Error("only single frame JPEGs supported");for(var mr=0;mr<ut.length;mr++){var gr=ut[mr].components;for(var oi in gr)gr[oi].quantizationTable=Te[gr[oi].quantizationIdx],delete gr[oi].quantizationIdx}for(this.width=pe.samplesPerLine,this.height=pe.scanLines,this.jfif=Ie,this.adobe=fe,this.components=[],mr=0;mr<pe.componentsOrder.length;mr++){var hi=pe.components[pe.componentsOrder[mr]];this.components.push({lines:H(0,hi),scaleX:hi.h/pe.maxH,scaleY:hi.v/pe.maxV})}},getData:function(re,J){var se,ie,oe,pe,de,ge,ce,Ie,fe,Te,ut,ze,Ce,Fe,Et,bt,ht,Zt,Ye,_t,Vt,Lt=this.width/re,dt=this.height/J,It=0,dr=re*J*this.components.length;X(dr);var fr=new Uint8Array(dr);switch(this.components.length){case 1:for(se=this.components[0],Te=0;Te<J;Te++)for(de=se.lines[0|Te*se.scaleY*dt],fe=0;fe<re;fe++)ut=de[0|fe*se.scaleX*Lt],fr[It++]=ut;break;case 2:for(se=this.components[0],ie=this.components[1],Te=0;Te<J;Te++)for(de=se.lines[0|Te*se.scaleY*dt],ge=ie.lines[0|Te*ie.scaleY*dt],fe=0;fe<re;fe++)ut=de[0|fe*se.scaleX*Lt],fr[It++]=ut,ut=ge[0|fe*ie.scaleX*Lt],fr[It++]=ut;break;case 3:for(Vt=!0,this.adobe&&this.adobe.transformCode?Vt=!0:this.opts.colorTransform!==void 0&&(Vt=!!this.opts.colorTransform),se=this.components[0],ie=this.components[1],oe=this.components[2],Te=0;Te<J;Te++)for(de=se.lines[0|Te*se.scaleY*dt],ge=ie.lines[0|Te*ie.scaleY*dt],ce=oe.lines[0|Te*oe.scaleY*dt],fe=0;fe<re;fe++)Vt?(ut=de[0|fe*se.scaleX*Lt],ze=ge[0|fe*ie.scaleX*Lt],Zt=q(ut+1.402*((Ce=ce[0|fe*oe.scaleX*Lt])-128)),Ye=q(ut-.3441363*(ze-128)-.71413636*(Ce-128)),_t=q(ut+1.772*(ze-128))):(Zt=de[0|fe*se.scaleX*Lt],Ye=ge[0|fe*ie.scaleX*Lt],_t=ce[0|fe*oe.scaleX*Lt]),fr[It++]=Zt,fr[It++]=Ye,fr[It++]=_t;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(Vt=!1,this.adobe&&this.adobe.transformCode?Vt=!0:this.opts.colorTransform!==void 0&&(Vt=!!this.opts.colorTransform),se=this.components[0],ie=this.components[1],oe=this.components[2],pe=this.components[3],Te=0;Te<J;Te++)for(de=se.lines[0|Te*se.scaleY*dt],ge=ie.lines[0|Te*ie.scaleY*dt],ce=oe.lines[0|Te*oe.scaleY*dt],Ie=pe.lines[0|Te*pe.scaleY*dt],fe=0;fe<re;fe++)Vt?(ut=de[0|fe*se.scaleX*Lt],ze=ge[0|fe*ie.scaleX*Lt],Ce=ce[0|fe*oe.scaleX*Lt],Fe=Ie[0|fe*pe.scaleX*Lt],Et=255-q(ut+1.402*(Ce-128)),bt=255-q(ut-.3441363*(ze-128)-.71413636*(Ce-128)),ht=255-q(ut+1.772*(ze-128))):(Et=de[0|fe*se.scaleX*Lt],bt=ge[0|fe*ie.scaleX*Lt],ht=ce[0|fe*oe.scaleX*Lt],Fe=Ie[0|fe*pe.scaleX*Lt]),fr[It++]=255-Et,fr[It++]=255-bt,fr[It++]=255-ht,fr[It++]=255-Fe;break;default:throw new Error("Unsupported color mode")}return fr},copyToImageData:function(re,J){var se,ie,oe,pe,de,ge,ce,Ie,fe,Te=re.width,ut=re.height,ze=re.data,Ce=this.getData(Te,ut),Fe=0,Et=0;switch(this.components.length){case 1:for(ie=0;ie<ut;ie++)for(se=0;se<Te;se++)oe=Ce[Fe++],ze[Et++]=oe,ze[Et++]=oe,ze[Et++]=oe,J&&(ze[Et++]=255);break;case 3:for(ie=0;ie<ut;ie++)for(se=0;se<Te;se++)ce=Ce[Fe++],Ie=Ce[Fe++],fe=Ce[Fe++],ze[Et++]=ce,ze[Et++]=Ie,ze[Et++]=fe,J&&(ze[Et++]=255);break;case 4:for(ie=0;ie<ut;ie++)for(se=0;se<Te;se++)de=Ce[Fe++],ge=Ce[Fe++],oe=Ce[Fe++],ce=255-q(de*(1-(pe=Ce[Fe++])/255)+pe),Ie=255-q(ge*(1-pe/255)+pe),fe=255-q(oe*(1-pe/255)+pe),ze[Et++]=ce,ze[Et++]=Ie,ze[Et++]=fe,J&&(ze[Et++]=255);break;default:throw new Error("Unsupported color mode")}}};var V=0,Q=0;function X(re=0){var J=V+re;if(J>Q){var se=Math.ceil((J-Q)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${se}MB`)}V=J}return j.resetMaxMemoryUsage=function(re){V=0,Q=re},j.getBytesAllocated=function(){return V},j.requestMemoryAllocation=X,j})(),module.exports=function(d,m={}){var g={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...m},w=new Uint8Array(d),$=new JpegImage;$.opts=g,JpegImage.resetMaxMemoryUsage(1024*g.maxMemoryUsageInMB*1024),$.parse(w);var I=g.formatAsRGBA?4:3,D=$.width*$.height*I;try{JpegImage.requestMemoryAllocation(D);var F={width:$.width,height:$.height,exifBuffer:$.exifBuffer,data:g.useTArray?new Uint8Array(D):Buffer.alloc(D)};$.comments.length>0&&(F.comments=$.comments)}catch(U){throw U instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+D):U instanceof ReferenceError&&U.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):U}return $.copyToImageData(F,g.formatAsRGBA),F};var decoderExports=decoder.exports,encode=encoderExports,decode=decoderExports,jpegJs={encode,decode},JPEG=getDefaultExportFromCjs(jpegJs);function jpeg$2(){return{mime:"image/jpeg",encode:(d,{quality:m=100}={})=>JPEG.encode(d,m).data,decode:(d,m)=>JPEG.decode(d,m)}}function commonjsRequire(d){throw new Error('Could not dynamically require "'+d+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var browser$1={exports:{}};browser$1.exports=(function(){function d(m,g,w){function $(F,U){if(!g[F]){if(!m[F]){var j=typeof commonjsRequire=="function"&&commonjsRequire;if(!U&&j)return j(F,!0);if(I)return I(F,!0);var G=new Error("Cannot find module '"+F+"'");throw G.code="MODULE_NOT_FOUND",G}var Z=g[F]={exports:{}};m[F][0].call(Z.exports,(function(H){return $(m[F][1][H]||H)}),Z,Z.exports,d,m,g,w)}return g[F].exports}for(var I=typeof commonjsRequire=="function"&&commonjsRequire,D=0;D<w.length;D++)$(w[D]);return $}return d})()({1:[function(d,m,g){(function(w){(function(){let $=d("./interlace"),I=[function(){},function(G,Z,H,q){if(q===Z.length)throw new Error("Ran out of data");let V=Z[q];G[H]=V,G[H+1]=V,G[H+2]=V,G[H+3]=255},function(G,Z,H,q){if(q+1>=Z.length)throw new Error("Ran out of data");let V=Z[q];G[H]=V,G[H+1]=V,G[H+2]=V,G[H+3]=Z[q+1]},function(G,Z,H,q){if(q+2>=Z.length)throw new Error("Ran out of data");G[H]=Z[q],G[H+1]=Z[q+1],G[H+2]=Z[q+2],G[H+3]=255},function(G,Z,H,q){if(q+3>=Z.length)throw new Error("Ran out of data");G[H]=Z[q],G[H+1]=Z[q+1],G[H+2]=Z[q+2],G[H+3]=Z[q+3]}],D=[function(){},function(G,Z,H,q){let V=Z[0];G[H]=V,G[H+1]=V,G[H+2]=V,G[H+3]=q},function(G,Z,H){let q=Z[0];G[H]=q,G[H+1]=q,G[H+2]=q,G[H+3]=Z[1]},function(G,Z,H,q){G[H]=Z[0],G[H+1]=Z[1],G[H+2]=Z[2],G[H+3]=q},function(G,Z,H){G[H]=Z[0],G[H+1]=Z[1],G[H+2]=Z[2],G[H+3]=Z[3]}];function F(G,Z){let H=[],q=0;function V(){if(q===G.length)throw new Error("Ran out of data");let Q,X,re,J,se,ie,oe,pe,de=G[q];switch(q++,Z){default:throw new Error("unrecognised depth");case 16:oe=G[q],q++,H.push((de<<8)+oe);break;case 4:oe=15&de,pe=de>>4,H.push(pe,oe);break;case 2:se=3&de,ie=de>>2&3,oe=de>>4&3,pe=de>>6&3,H.push(pe,oe,ie,se);break;case 1:Q=1&de,X=de>>1&1,re=de>>2&1,J=de>>3&1,se=de>>4&1,ie=de>>5&1,oe=de>>6&1,pe=de>>7&1,H.push(pe,oe,ie,se,J,re,X,Q)}}return{get:function(Q){for(;H.length<Q;)V();let X=H.slice(0,Q);return H=H.slice(Q),X},resetAfterLine:function(){H.length=0},end:function(){if(q!==G.length)throw new Error("extra data found")}}}function U(G,Z,H,q,V,Q){let X=G.width,re=G.height,J=G.index;for(let se=0;se<re;se++)for(let ie=0;ie<X;ie++){let oe=H(ie,se,J);I[q](Z,V,oe,Q),Q+=q}return Q}function j(G,Z,H,q,V,Q){let X=G.width,re=G.height,J=G.index;for(let se=0;se<re;se++){for(let ie=0;ie<X;ie++){let oe=V.get(q),pe=H(ie,se,J);D[q](Z,oe,pe,Q)}V.resetAfterLine()}}g.dataToBitMap=function(G,Z){let H,q,V=Z.width,Q=Z.height,X=Z.depth,re=Z.bpp,J=Z.interlace;X!==8&&(H=F(G,X)),q=X<=8?w.alloc(V*Q*4):new Uint16Array(V*Q*4);let se,ie,oe=Math.pow(2,X)-1,pe=0;if(J)se=$.getImagePasses(V,Q),ie=$.getInterlaceIterator(V,Q);else{let de=0;ie=function(){let ge=de;return de+=4,ge},se=[{width:V,height:Q}]}for(let de=0;de<se.length;de++)X===8?pe=U(se[de],q,ie,re,G,pe):j(se[de],q,ie,re,H,oe);if(X===8){if(pe!==G.length)throw new Error("extra data found")}else H.end();return q}}).call(this)}).call(this,d("buffer").Buffer)},{"./interlace":11,buffer:32}],2:[function(d,m,g){(function(w){(function(){let $=d("./constants");m.exports=function(I,D,F,U){let j=[$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(U.colorType)!==-1;if(U.colorType===U.inputColorType){let se=(function(){let ie=new ArrayBuffer(2);return new DataView(ie).setInt16(0,256,!0),new Int16Array(ie)[0]!==256})();if(U.bitDepth===8||U.bitDepth===16&&se)return I}let G=U.bitDepth!==16?I:new Uint16Array(I.buffer),Z=255,H=$.COLORTYPE_TO_BPP_MAP[U.inputColorType];H!==4||U.inputHasAlpha||(H=3);let q=$.COLORTYPE_TO_BPP_MAP[U.colorType];U.bitDepth===16&&(Z=65535,q*=2);let V=w.alloc(D*F*q),Q=0,X=0,re=U.bgColor||{};function J(){let se,ie,oe,pe=Z;switch(U.inputColorType){case $.COLORTYPE_COLOR_ALPHA:pe=G[Q+3],se=G[Q],ie=G[Q+1],oe=G[Q+2];break;case $.COLORTYPE_COLOR:se=G[Q],ie=G[Q+1],oe=G[Q+2];break;case $.COLORTYPE_ALPHA:pe=G[Q+1],se=G[Q],ie=se,oe=se;break;case $.COLORTYPE_GRAYSCALE:se=G[Q],ie=se,oe=se;break;default:throw new Error("input color type:"+U.inputColorType+" is not supported at present")}return U.inputHasAlpha&&(j||(pe/=Z,se=Math.min(Math.max(Math.round((1-pe)*re.red+pe*se),0),Z),ie=Math.min(Math.max(Math.round((1-pe)*re.green+pe*ie),0),Z),oe=Math.min(Math.max(Math.round((1-pe)*re.blue+pe*oe),0),Z))),{red:se,green:ie,blue:oe,alpha:pe}}re.red===void 0&&(re.red=Z),re.green===void 0&&(re.green=Z),re.blue===void 0&&(re.blue=Z);for(let se=0;se<F;se++)for(let ie=0;ie<D;ie++){let oe=J();switch(U.colorType){case $.COLORTYPE_COLOR_ALPHA:case $.COLORTYPE_COLOR:U.bitDepth===8?(V[X]=oe.red,V[X+1]=oe.green,V[X+2]=oe.blue,j&&(V[X+3]=oe.alpha)):(V.writeUInt16BE(oe.red,X),V.writeUInt16BE(oe.green,X+2),V.writeUInt16BE(oe.blue,X+4),j&&V.writeUInt16BE(oe.alpha,X+6));break;case $.COLORTYPE_ALPHA:case $.COLORTYPE_GRAYSCALE:{let pe=(oe.red+oe.green+oe.blue)/3;U.bitDepth===8?(V[X]=pe,j&&(V[X+1]=oe.alpha)):(V.writeUInt16BE(pe,X),j&&V.writeUInt16BE(oe.alpha,X+2));break}default:throw new Error("unrecognised color Type "+U.colorType)}Q+=H,X+=q}return V}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,buffer:32}],3:[function(d,m,g){(function(w,$){(function(){let I=d("util"),D=d("stream"),F=m.exports=function(){D.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};I.inherits(F,D),F.prototype.read=function(U,j){this._reads.push({length:Math.abs(U),allowLess:U<0,func:j}),w.nextTick((function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}).bind(this))},F.prototype.write=function(U,j){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let G;return G=$.isBuffer(U)?U:$.from(U,j||this._encoding),this._buffers.push(G),this._buffered+=G.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused},F.prototype.end=function(U,j){U&&this.write(U,j),this.writable=!1,this._buffers&&(this._buffers.length===0?this._end():(this._buffers.push(null),this._process()))},F.prototype.destroySoon=F.prototype.end,F.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},F.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},F.prototype._processReadAllowingLess=function(U){this._reads.shift();let j=this._buffers[0];j.length>U.length?(this._buffered-=U.length,this._buffers[0]=j.slice(U.length),U.func.call(this,j.slice(0,U.length))):(this._buffered-=j.length,this._buffers.shift(),U.func.call(this,j))},F.prototype._processRead=function(U){this._reads.shift();let j=0,G=0,Z=$.alloc(U.length);for(;j<U.length;){let H=this._buffers[G++],q=Math.min(H.length,U.length-j);H.copy(Z,j,0,q),j+=q,q!==H.length&&(this._buffers[--G]=H.slice(q))}G>0&&this._buffers.splice(0,G),this._buffered-=U.length,U.func.call(this,Z)},F.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let U=this._reads[0];if(U.allowLess)this._processReadAllowingLess(U);else{if(!(this._buffered>=U.length))break;this._processRead(U)}}this._buffers&&!this.writable&&this._end()}catch(U){this.emit("error",U)}}}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,buffer:32,stream:65,util:84}],4:[function(d,m,g){m.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(d,m,g){let w=[];(function(){for(let I=0;I<256;I++){let D=I;for(let F=0;F<8;F++)1&D?D=3988292384^D>>>1:D>>>=1;w[I]=D}})();let $=m.exports=function(){this._crc=-1};$.prototype.write=function(I){for(let D=0;D<I.length;D++)this._crc=w[255&(this._crc^I[D])]^this._crc>>>8;return!0},$.prototype.crc32=function(){return~this._crc},$.crc32=function(I){let D=-1;for(let F=0;F<I.length;F++)D=w[255&(D^I[F])]^D>>>8;return~D}},{}],6:[function(d,m,g){(function(w){(function(){let $=d("./paeth-predictor");function I(re,J,se,ie,oe){for(let pe=0;pe<se;pe++)ie[oe+pe]=re[J+pe]}function D(re,J,se){let ie=0,oe=J+se;for(let pe=J;pe<oe;pe++)ie+=Math.abs(re[pe]);return ie}function F(re,J,se,ie,oe,pe){for(let de=0;de<se;de++){let ge=de>=pe?re[J+de-pe]:0,ce=re[J+de]-ge;ie[oe+de]=ce}}function U(re,J,se,ie){let oe=0;for(let pe=0;pe<se;pe++){let de=pe>=ie?re[J+pe-ie]:0,ge=re[J+pe]-de;oe+=Math.abs(ge)}return oe}function j(re,J,se,ie,oe){for(let pe=0;pe<se;pe++){let de=J>0?re[J+pe-se]:0,ge=re[J+pe]-de;ie[oe+pe]=ge}}function G(re,J,se){let ie=0,oe=J+se;for(let pe=J;pe<oe;pe++){let de=J>0?re[pe-se]:0,ge=re[pe]-de;ie+=Math.abs(ge)}return ie}function Z(re,J,se,ie,oe,pe){for(let de=0;de<se;de++){let ge=de>=pe?re[J+de-pe]:0,ce=J>0?re[J+de-se]:0,Ie=re[J+de]-(ge+ce>>1);ie[oe+de]=Ie}}function H(re,J,se,ie){let oe=0;for(let pe=0;pe<se;pe++){let de=pe>=ie?re[J+pe-ie]:0,ge=J>0?re[J+pe-se]:0,ce=re[J+pe]-(de+ge>>1);oe+=Math.abs(ce)}return oe}function q(re,J,se,ie,oe,pe){for(let de=0;de<se;de++){let ge=de>=pe?re[J+de-pe]:0,ce=J>0?re[J+de-se]:0,Ie=J>0&&de>=pe?re[J+de-(se+pe)]:0,fe=re[J+de]-$(ge,ce,Ie);ie[oe+de]=fe}}function V(re,J,se,ie){let oe=0;for(let pe=0;pe<se;pe++){let de=pe>=ie?re[J+pe-ie]:0,ge=J>0?re[J+pe-se]:0,ce=J>0&&pe>=ie?re[J+pe-(se+ie)]:0,Ie=re[J+pe]-$(de,ge,ce);oe+=Math.abs(Ie)}return oe}let Q={0:I,1:F,2:j,3:Z,4:q},X={0:D,1:U,2:G,3:H,4:V};m.exports=function(re,J,se,ie,oe){let pe;if("filterType"in ie&&ie.filterType!==-1){if(typeof ie.filterType!="number")throw new Error("unrecognised filter types");pe=[ie.filterType]}else pe=[0,1,2,3,4];ie.bitDepth===16&&(oe*=2);let de=J*oe,ge=0,ce=0,Ie=w.alloc((de+1)*se),fe=pe[0];for(let Te=0;Te<se;Te++){if(pe.length>1){let ut=1/0;for(let ze=0;ze<pe.length;ze++){let Ce=X[pe[ze]](re,ce,de,oe);Ce<ut&&(fe=pe[ze],ut=Ce)}}Ie[ge]=fe,ge++,Q[fe](re,ce,de,Ie,ge,oe),ge+=de,ce+=de}return Ie}}).call(this)}).call(this,d("buffer").Buffer)},{"./paeth-predictor":15,buffer:32}],7:[function(d,m,g){(function(w){(function(){let $=d("util"),I=d("./chunkstream"),D=d("./filter-parse"),F=m.exports=function(U){I.call(this);let j=[],G=this;this._filter=new D(U,{read:this.read.bind(this),write:function(Z){j.push(Z)},complete:function(){G.emit("complete",w.concat(j))}}),this._filter.start()};$.inherits(F,I)}).call(this)}).call(this,d("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:32,util:84}],8:[function(d,m,g){(function(w){(function(){let $=d("./sync-reader"),I=d("./filter-parse");g.process=function(D,F){let U=[],j=new $(D);return new I(F,{read:j.read.bind(j),write:function(G){U.push(G)},complete:function(){}}).start(),j.process(),w.concat(U)}}).call(this)}).call(this,d("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:32}],9:[function(d,m,g){(function(w){(function(){let $=d("./interlace"),I=d("./paeth-predictor");function D(U,j,G){let Z=U*j;return G!==8&&(Z=Math.ceil(Z/(8/G))),Z}let F=m.exports=function(U,j){let G=U.width,Z=U.height,H=U.interlace,q=U.bpp,V=U.depth;if(this.read=j.read,this.write=j.write,this.complete=j.complete,this._imageIndex=0,this._images=[],H){let Q=$.getImagePasses(G,Z);for(let X=0;X<Q.length;X++)this._images.push({byteWidth:D(Q[X].width,q,V),height:Q[X].height,lineIndex:0})}else this._images.push({byteWidth:D(G,q,V),height:Z,lineIndex:0});this._xComparison=V===8?q:V===16?2*q:1};F.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},F.prototype._unFilterType1=function(U,j,G){let Z=this._xComparison,H=Z-1;for(let q=0;q<G;q++){let V=U[1+q],Q=q>H?j[q-Z]:0;j[q]=V+Q}},F.prototype._unFilterType2=function(U,j,G){let Z=this._lastLine;for(let H=0;H<G;H++){let q=U[1+H],V=Z?Z[H]:0;j[H]=q+V}},F.prototype._unFilterType3=function(U,j,G){let Z=this._xComparison,H=Z-1,q=this._lastLine;for(let V=0;V<G;V++){let Q=U[1+V],X=q?q[V]:0,re=V>H?j[V-Z]:0,J=Math.floor((re+X)/2);j[V]=Q+J}},F.prototype._unFilterType4=function(U,j,G){let Z=this._xComparison,H=Z-1,q=this._lastLine;for(let V=0;V<G;V++){let Q=U[1+V],X=q?q[V]:0,re=V>H?j[V-Z]:0,J=V>H&&q?q[V-Z]:0,se=I(re,X,J);j[V]=Q+se}},F.prototype._reverseFilterLine=function(U){let j,G=U[0],Z=this._images[this._imageIndex],H=Z.byteWidth;if(G===0)j=U.slice(1,H+1);else switch(j=w.alloc(H),G){case 1:this._unFilterType1(U,j,H);break;case 2:this._unFilterType2(U,j,H);break;case 3:this._unFilterType3(U,j,H);break;case 4:this._unFilterType4(U,j,H);break;default:throw new Error("Unrecognised filter type - "+G)}this.write(j),Z.lineIndex++,Z.lineIndex>=Z.height?(this._lastLine=null,this._imageIndex++,Z=this._images[this._imageIndex]):this._lastLine=j,Z?this.read(Z.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this)}).call(this,d("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:32}],10:[function(d,m,g){(function(w){(function(){function $(F,U,j,G,Z){let H=0;for(let q=0;q<G;q++)for(let V=0;V<j;V++){let Q=Z[F[H]];if(!Q)throw new Error("index "+F[H]+" not in palette");for(let X=0;X<4;X++)U[H+X]=Q[X];H+=4}}function I(F,U,j,G,Z){let H=0;for(let q=0;q<G;q++)for(let V=0;V<j;V++){let Q=!1;if(Z.length===1?Z[0]===F[H]&&(Q=!0):Z[0]===F[H]&&Z[1]===F[H+1]&&Z[2]===F[H+2]&&(Q=!0),Q)for(let X=0;X<4;X++)U[H+X]=0;H+=4}}function D(F,U,j,G,Z){let H=255,q=Math.pow(2,Z)-1,V=0;for(let Q=0;Q<G;Q++)for(let X=0;X<j;X++){for(let re=0;re<4;re++)U[V+re]=Math.floor(F[V+re]*H/q+.5);V+=4}}m.exports=function(F,U,j=!1){let G=U.depth,Z=U.width,H=U.height,q=U.colorType,V=U.transColor,Q=U.palette,X=F;return q===3?$(F,X,Z,H,Q):(V&&I(F,X,Z,H,V),G===8||j||(G===16&&(X=w.alloc(Z*H*4)),D(F,X,Z,H,G))),X}}).call(this)}).call(this,d("buffer").Buffer)},{buffer:32}],11:[function(d,m,g){let w=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];g.getImagePasses=function($,I){let D=[],F=$%8,U=I%8,j=($-F)/8,G=(I-U)/8;for(let Z=0;Z<w.length;Z++){let H=w[Z],q=j*H.x.length,V=G*H.y.length;for(let Q=0;Q<H.x.length&&H.x[Q]<F;Q++)q++;for(let Q=0;Q<H.y.length&&H.y[Q]<U;Q++)V++;q>0&&V>0&&D.push({width:q,height:V,index:Z})}return D},g.getInterlaceIterator=function($){return function(I,D,F){let U=I%w[F].x.length,j=(I-U)/w[F].x.length*8+w[F].x[U],G=D%w[F].y.length;return 4*j+((D-G)/w[F].y.length*8+w[F].y[G])*$*4}}},{}],12:[function(d,m,g){(function(w){(function(){let $=d("util"),I=d("stream"),D=d("./constants"),F=d("./packer"),U=m.exports=function(j){I.call(this);let G=j||{};this._packer=new F(G),this._deflate=this._packer.createDeflate(),this.readable=!0};$.inherits(U,I),U.prototype.pack=function(j,G,Z,H){this.emit("data",w.from(D.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(G,Z)),H&&this.emit("data",this._packer.packGAMA(H));let q=this._packer.filterData(j,G,Z);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",(function(V){this.emit("data",this._packer.packIDAT(V))}).bind(this)),this._deflate.on("end",(function(){this.emit("data",this._packer.packIEND()),this.emit("end")}).bind(this)),this._deflate.end(q)}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,stream:65,util:84}],13:[function(d,m,g){(function(w){(function(){let $=!0,I=d("zlib");I.deflateSync||($=!1);let D=d("./constants"),F=d("./packer");m.exports=function(U,j){if(!$)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let G=new F(j||{}),Z=[];Z.push(w.from(D.PNG_SIGNATURE)),Z.push(G.packIHDR(U.width,U.height)),U.gamma&&Z.push(G.packGAMA(U.gamma));let H=G.filterData(U.data,U.width,U.height),q=I.deflateSync(H,G.getDeflateOptions());if(H=null,!q||!q.length)throw new Error("bad png - invalid compressed data response");return Z.push(G.packIDAT(q)),Z.push(G.packIEND()),w.concat(Z)}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,zlib:31}],14:[function(d,m,g){(function(w){(function(){let $=d("./constants"),I=d("./crc"),D=d("./bitpacker"),F=d("./filter-pack"),U=d("zlib"),j=m.exports=function(G){if(this._options=G,G.deflateChunkSize=G.deflateChunkSize||32768,G.deflateLevel=G.deflateLevel!=null?G.deflateLevel:9,G.deflateStrategy=G.deflateStrategy!=null?G.deflateStrategy:3,G.inputHasAlpha=G.inputHasAlpha==null||G.inputHasAlpha,G.deflateFactory=G.deflateFactory||U.createDeflate,G.bitDepth=G.bitDepth||8,G.colorType=typeof G.colorType=="number"?G.colorType:$.COLORTYPE_COLOR_ALPHA,G.inputColorType=typeof G.inputColorType=="number"?G.inputColorType:$.COLORTYPE_COLOR_ALPHA,[$.COLORTYPE_GRAYSCALE,$.COLORTYPE_COLOR,$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(G.colorType)===-1)throw new Error("option color type:"+G.colorType+" is not supported at present");if([$.COLORTYPE_GRAYSCALE,$.COLORTYPE_COLOR,$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(G.inputColorType)===-1)throw new Error("option input color type:"+G.inputColorType+" is not supported at present");if(G.bitDepth!==8&&G.bitDepth!==16)throw new Error("option bit depth:"+G.bitDepth+" is not supported at present")};j.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},j.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},j.prototype.filterData=function(G,Z,H){let q=D(G,Z,H,this._options),V=$.COLORTYPE_TO_BPP_MAP[this._options.colorType];return F(q,Z,H,this._options,V)},j.prototype._packChunk=function(G,Z){let H=Z?Z.length:0,q=w.alloc(H+12);return q.writeUInt32BE(H,0),q.writeUInt32BE(G,4),Z&&Z.copy(q,8),q.writeInt32BE(I.crc32(q.slice(4,q.length-4)),q.length-4),q},j.prototype.packGAMA=function(G){let Z=w.alloc(4);return Z.writeUInt32BE(Math.floor(G*$.GAMMA_DIVISION),0),this._packChunk($.TYPE_gAMA,Z)},j.prototype.packIHDR=function(G,Z){let H=w.alloc(13);return H.writeUInt32BE(G,0),H.writeUInt32BE(Z,4),H[8]=this._options.bitDepth,H[9]=this._options.colorType,H[10]=0,H[11]=0,H[12]=0,this._packChunk($.TYPE_IHDR,H)},j.prototype.packIDAT=function(G){return this._packChunk($.TYPE_IDAT,G)},j.prototype.packIEND=function(){return this._packChunk($.TYPE_IEND,null)}}).call(this)}).call(this,d("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:32,zlib:31}],15:[function(d,m,g){m.exports=function(w,$,I){let D=w+$-I,F=Math.abs(D-w),U=Math.abs(D-$),j=Math.abs(D-I);return F<=U&&F<=j?w:U<=j?$:I}},{}],16:[function(d,m,g){let w=d("util"),$=d("zlib"),I=d("./chunkstream"),D=d("./filter-parse-async"),F=d("./parser"),U=d("./bitmapper"),j=d("./format-normaliser"),G=m.exports=function(Z){I.call(this),this._parser=new F(Z,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=Z,this.writable=!0,this._parser.start()};w.inherits(G,I),G.prototype._handleError=function(Z){this.emit("error",Z),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},G.prototype._inflateData=function(Z){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=$.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let H=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,q=Math.max(H,$.Z_MIN_CHUNK);this._inflate=$.createInflate({chunkSize:q});let V=H,Q=this.emit.bind(this,"error");this._inflate.on("error",(function(re){V&&Q(re)})),this._filter.on("complete",this._complete.bind(this));let X=this._filter.write.bind(this._filter);this._inflate.on("data",(function(re){V&&(re.length>V&&(re=re.slice(0,V)),V-=re.length,X(re))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(Z)},G.prototype._handleMetaData=function(Z){this._metaData=Z,this._bitmapInfo=Object.create(Z),this._filter=new D(this._bitmapInfo)},G.prototype._handleTransColor=function(Z){this._bitmapInfo.transColor=Z},G.prototype._handlePalette=function(Z){this._bitmapInfo.palette=Z},G.prototype._simpleTransparency=function(){this._metaData.alpha=!0},G.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},G.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},G.prototype._complete=function(Z){if(this.errord)return;let H;try{let q=U.dataToBitMap(Z,this._bitmapInfo);H=j(q,this._bitmapInfo,this._options.skipRescale),q=null}catch(q){return void this._handleError(q)}this.emit("parsed",H)}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:84,zlib:31}],17:[function(d,m,g){(function(w){(function(){let $=!0,I=d("zlib"),D=d("./sync-inflate");I.deflateSync||($=!1);let F=d("./sync-reader"),U=d("./filter-parse-sync"),j=d("./parser"),G=d("./bitmapper"),Z=d("./format-normaliser");m.exports=function(H,q){if(!$)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let V,Q,X;function re(Ce){V=Ce}function J(Ce){Q=Ce}function se(Ce){Q.transColor=Ce}function ie(Ce){Q.palette=Ce}function oe(){Q.alpha=!0}function pe(Ce){X=Ce}let de=[];function ge(Ce){de.push(Ce)}let ce=new F(H);if(new j(q,{read:ce.read.bind(ce),error:re,metadata:J,gamma:pe,palette:ie,transColor:se,inflateData:ge,simpleTransparency:oe}).start(),ce.process(),V)throw V;let Ie,fe=w.concat(de);if(de.length=0,Q.interlace)Ie=I.inflateSync(fe);else{let Ce=(1+(Q.width*Q.bpp*Q.depth+7>>3))*Q.height;Ie=D(fe,{chunkSize:Ce,maxLength:Ce})}if(fe=null,!Ie||!Ie.length)throw new Error("bad png - invalid inflate data response");let Te=U.process(Ie,Q);fe=null;let ut=G.dataToBitMap(Te,Q);Te=null;let ze=Z(ut,Q,q.skipRescale);return Q.data=ze,Q.gamma=X||0,Q}}).call(this)}).call(this,d("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:32,zlib:31}],18:[function(d,m,g){(function(w){(function(){let $=d("./constants"),I=d("./crc"),D=m.exports=function(F,U){this._options=F,F.checkCRC=F.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[$.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[$.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[$.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[$.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[$.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[$.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=U.read,this.error=U.error,this.metadata=U.metadata,this.gamma=U.gamma,this.transColor=U.transColor,this.palette=U.palette,this.parsed=U.parsed,this.inflateData=U.inflateData,this.finished=U.finished,this.simpleTransparency=U.simpleTransparency,this.headersFinished=U.headersFinished||function(){}};D.prototype.start=function(){this.read($.PNG_SIGNATURE.length,this._parseSignature.bind(this))},D.prototype._parseSignature=function(F){let U=$.PNG_SIGNATURE;for(let j=0;j<U.length;j++)if(F[j]!==U[j])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},D.prototype._parseChunkBegin=function(F){let U=F.readUInt32BE(0),j=F.readUInt32BE(4),G="";for(let H=4;H<8;H++)G+=String.fromCharCode(F[H]);let Z=!!(32&F[4]);if(this._hasIHDR||j===$.TYPE_IHDR){if(this._crc=new I,this._crc.write(w.from(G)),this._chunks[j])return this._chunks[j](U);Z?this.read(U+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+G))}else this.error(new Error("Expected IHDR on beggining"))},D.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},D.prototype._parseChunkEnd=function(F){let U=F.readInt32BE(0),j=this._crc.crc32();this._options.checkCRC&&j!==U?this.error(new Error("Crc error - "+U+" - "+j)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleIHDR=function(F){this.read(F,this._parseIHDR.bind(this))},D.prototype._parseIHDR=function(F){this._crc.write(F);let U=F.readUInt32BE(0),j=F.readUInt32BE(4),G=F[8],Z=F[9],H=F[10],q=F[11],V=F[12];if(G!==8&&G!==4&&G!==2&&G!==1&&G!==16)return void this.error(new Error("Unsupported bit depth "+G));if(!(Z in $.COLORTYPE_TO_BPP_MAP))return void this.error(new Error("Unsupported color type"));if(H!==0)return void this.error(new Error("Unsupported compression method"));if(q!==0)return void this.error(new Error("Unsupported filter method"));if(V!==0&&V!==1)return void this.error(new Error("Unsupported interlace method"));this._colorType=Z;let Q=$.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:U,height:j,depth:G,interlace:!!V,palette:!!(Z&$.COLORTYPE_PALETTE),color:!!(Z&$.COLORTYPE_COLOR),alpha:!!(Z&$.COLORTYPE_ALPHA),bpp:Q,colorType:Z}),this._handleChunkEnd()},D.prototype._handlePLTE=function(F){this.read(F,this._parsePLTE.bind(this))},D.prototype._parsePLTE=function(F){this._crc.write(F);let U=Math.floor(F.length/3);for(let j=0;j<U;j++)this._palette.push([F[3*j],F[3*j+1],F[3*j+2],255]);this.palette(this._palette),this._handleChunkEnd()},D.prototype._handleTRNS=function(F){this.simpleTransparency(),this.read(F,this._parseTRNS.bind(this))},D.prototype._parseTRNS=function(F){if(this._crc.write(F),this._colorType===$.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0)return void this.error(new Error("Transparency chunk must be after palette"));if(F.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let U=0;U<F.length;U++)this._palette[U][3]=F[U];this.palette(this._palette)}this._colorType===$.COLORTYPE_GRAYSCALE&&this.transColor([F.readUInt16BE(0)]),this._colorType===$.COLORTYPE_COLOR&&this.transColor([F.readUInt16BE(0),F.readUInt16BE(2),F.readUInt16BE(4)]),this._handleChunkEnd()},D.prototype._handleGAMA=function(F){this.read(F,this._parseGAMA.bind(this))},D.prototype._parseGAMA=function(F){this._crc.write(F),this.gamma(F.readUInt32BE(0)/$.GAMMA_DIVISION),this._handleChunkEnd()},D.prototype._handleIDAT=function(F){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-F,this._parseIDAT.bind(this,F))},D.prototype._parseIDAT=function(F,U){if(this._crc.write(U),this._colorType===$.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(U);let j=F-U.length;j>0?this._handleIDAT(j):this._handleChunkEnd()},D.prototype._handleIEND=function(F){this.read(F,this._parseIEND.bind(this))},D.prototype._parseIEND=function(F){this._crc.write(F),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:32}],19:[function(d,m,g){let w=d("./parser-sync"),$=d("./packer-sync");g.read=function(I,D){return w(I,D||{})},g.write=function(I,D){return $(I,D)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(d,m,g){(function(w,$){(function(){let I=d("util"),D=d("stream"),F=d("./parser-async"),U=d("./packer-async"),j=d("./png-sync"),G=g.PNG=function(Z){D.call(this),Z=Z||{},this.width=0|Z.width,this.height=0|Z.height,this.data=this.width>0&&this.height>0?$.alloc(4*this.width*this.height):null,Z.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new F(Z),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",(function(H){this.data=H,this.emit("parsed",H)}).bind(this)),this._packer=new U(Z),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};I.inherits(G,D),G.sync=j,G.prototype.pack=function(){return this.data&&this.data.length?(w.nextTick((function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}).bind(this)),this):(this.emit("error","No data provided"),this)},G.prototype.parse=function(Z,H){if(H){let q,V;q=(function(Q){this.removeListener("error",V),this.data=Q,H(null,this)}).bind(this),V=(function(Q){this.removeListener("parsed",q),H(Q,null)}).bind(this),this.once("parsed",q),this.once("error",V)}return this.end(Z),this},G.prototype.write=function(Z){return this._parser.write(Z),!0},G.prototype.end=function(Z){this._parser.end(Z)},G.prototype._metadata=function(Z){this.width=Z.width,this.height=Z.height,this.emit("metadata",Z)},G.prototype._gamma=function(Z){this.gamma=Z},G.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},G.bitblt=function(Z,H,q,V,Q,X,re,J){if(V|=0,Q|=0,X|=0,re|=0,J|=0,(q|=0)>Z.width||V>Z.height||q+Q>Z.width||V+X>Z.height)throw new Error("bitblt reading outside image");if(re>H.width||J>H.height||re+Q>H.width||J+X>H.height)throw new Error("bitblt writing outside image");for(let se=0;se<X;se++)Z.data.copy(H.data,(J+se)*H.width+re<<2,(V+se)*Z.width+q<<2,(V+se)*Z.width+q+Q<<2)},G.prototype.bitblt=function(Z,H,q,V,Q,X,re){return G.bitblt(this,Z,H,q,V,Q,X,re),this},G.adjustGamma=function(Z){if(Z.gamma){for(let H=0;H<Z.height;H++)for(let q=0;q<Z.width;q++){let V=Z.width*H+q<<2;for(let Q=0;Q<3;Q++){let X=Z.data[V+Q]/255;X=Math.pow(X,1/2.2/Z.gamma),Z.data[V+Q]=Math.round(255*X)}}Z.gamma=0}},G.prototype.adjustGamma=function(){G.adjustGamma(this)}}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:63,buffer:32,stream:65,util:84}],21:[function(d,m,g){(function(w,$){(function(){let I=d("assert").ok,D=d("zlib"),F=d("util"),U=d("buffer").kMaxLength;function j(V){if(!(this instanceof j))return new j(V);V&&V.chunkSize<D.Z_MIN_CHUNK&&(V.chunkSize=D.Z_MIN_CHUNK),D.Inflate.call(this,V),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,V&&V.maxLength!=null&&(this._maxLength=V.maxLength)}function G(V){return new j(V)}function Z(V,Q){V._handle&&(V._handle.close(),V._handle=null)}function H(V,Q){if(typeof Q=="string"&&(Q=$.from(Q)),!(Q instanceof $))throw new TypeError("Not a string or buffer");let X=V._finishFlushFlag;return X==null&&(X=D.Z_FINISH),V._processChunk(Q,X)}function q(V,Q){return H(new j(Q),V)}j.prototype._processChunk=function(V,Q,X){if(typeof X=="function")return D.Inflate._processChunk.call(this,V,Q,X);let re,J,se=this,ie=V&&V.length,oe=this._chunkSize-this._offset,pe=this._maxLength,de=0,ge=[],ce=0;function Ie(Te,ut){if(se._hadError)return;let ze=oe-ut;if(I(ze>=0,"have should not go down"),ze>0){let Ce=se._buffer.slice(se._offset,se._offset+ze);if(se._offset+=ze,Ce.length>pe&&(Ce=Ce.slice(0,pe)),ge.push(Ce),ce+=Ce.length,pe-=Ce.length,pe===0)return!1}return(ut===0||se._offset>=se._chunkSize)&&(oe=se._chunkSize,se._offset=0,se._buffer=$.allocUnsafe(se._chunkSize)),ut===0&&(de+=ie-Te,ie=Te,!0)}this.on("error",(function(Te){re=Te})),I(this._handle,"zlib binding closed");do J=this._handle.writeSync(Q,V,de,ie,this._buffer,this._offset,oe),J=J||this._writeState;while(!this._hadError&&Ie(J[0],J[1]));if(this._hadError)throw re;if(ce>=U)throw Z(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+U.toString(16)+" bytes");let fe=$.concat(ge,ce);return Z(this),fe},F.inherits(j,D.Inflate),m.exports=g=q,g.Inflate=j,g.createInflate=G,g.inflateSync=q}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,assert:23,buffer:32,util:84,zlib:31}],22:[function(d,m,g){let w=m.exports=function($){this._buffer=$,this._reads=[]};w.prototype.read=function($,I){this._reads.push({length:Math.abs($),allowLess:$<0,func:I})},w.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let $=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=$.length||$.allowLess))break;{this._reads.shift();let I=this._buffer;this._buffer=I.slice($.length),$.func.call(this,I.slice(0,$.length))}}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")}},{}],23:[function(d,m,g){(function(w){(function(){var $=d("object-assign");/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */function I(ze,Ce){if(ze===Ce)return 0;for(var Fe=ze.length,Et=Ce.length,bt=0,ht=Math.min(Fe,Et);bt<ht;++bt)if(ze[bt]!==Ce[bt]){Fe=ze[bt],Et=Ce[bt];break}return Fe<Et?-1:Et<Fe?1:0}function D(ze){return w.Buffer&&typeof w.Buffer.isBuffer=="function"?w.Buffer.isBuffer(ze):!(ze==null||!ze._isBuffer)}var F=d("util/"),U=Object.prototype.hasOwnProperty,j=Array.prototype.slice,G=(function(){}).name==="foo";function Z(ze){return Object.prototype.toString.call(ze)}function H(ze){return!D(ze)&&typeof w.ArrayBuffer=="function"&&(typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(ze):!!ze&&(ze instanceof DataView||!!(ze.buffer&&ze.buffer instanceof ArrayBuffer)))}var q=m.exports=ie,V=/\s*function\s+([^\(\s]*)\s*/;function Q(ze){if(F.isFunction(ze)){if(G)return ze.name;var Ce=ze.toString().match(V);return Ce&&Ce[1]}}function X(ze,Ce){return typeof ze=="string"?ze.length<Ce?ze:ze.slice(0,Ce):ze}function re(ze){if(G||!F.isFunction(ze))return F.inspect(ze);var Ce=Q(ze);return"[Function"+(Ce?": "+Ce:"")+"]"}function J(ze){return X(re(ze.actual),128)+" "+ze.operator+" "+X(re(ze.expected),128)}function se(ze,Ce,Fe,Et,bt){throw new q.AssertionError({message:Fe,actual:ze,expected:Ce,operator:Et,stackStartFunction:bt})}function ie(ze,Ce){ze||se(ze,!0,Ce,"==",q.ok)}function oe(ze,Ce,Fe,Et){if(ze===Ce)return!0;if(D(ze)&&D(Ce))return I(ze,Ce)===0;if(F.isDate(ze)&&F.isDate(Ce))return ze.getTime()===Ce.getTime();if(F.isRegExp(ze)&&F.isRegExp(Ce))return ze.source===Ce.source&&ze.global===Ce.global&&ze.multiline===Ce.multiline&&ze.lastIndex===Ce.lastIndex&&ze.ignoreCase===Ce.ignoreCase;if(ze!==null&&typeof ze=="object"||Ce!==null&&typeof Ce=="object"){if(H(ze)&&H(Ce)&&Z(ze)===Z(Ce)&&!(ze instanceof Float32Array||ze instanceof Float64Array))return I(new Uint8Array(ze.buffer),new Uint8Array(Ce.buffer))===0;if(D(ze)!==D(Ce))return!1;var bt=(Et=Et||{actual:[],expected:[]}).actual.indexOf(ze);return bt!==-1&&bt===Et.expected.indexOf(Ce)||(Et.actual.push(ze),Et.expected.push(Ce),de(ze,Ce,Fe,Et))}return Fe?ze===Ce:ze==Ce}function pe(ze){return Object.prototype.toString.call(ze)=="[object Arguments]"}function de(ze,Ce,Fe,Et){if(ze==null||Ce==null)return!1;if(F.isPrimitive(ze)||F.isPrimitive(Ce))return ze===Ce;if(Fe&&Object.getPrototypeOf(ze)!==Object.getPrototypeOf(Ce))return!1;var bt=pe(ze),ht=pe(Ce);if(bt&&!ht||!bt&&ht)return!1;if(bt)return oe(ze=j.call(ze),Ce=j.call(Ce),Fe);var Zt,Ye,_t=ut(ze),Vt=ut(Ce);if(_t.length!==Vt.length)return!1;for(_t.sort(),Vt.sort(),Ye=_t.length-1;Ye>=0;Ye--)if(_t[Ye]!==Vt[Ye])return!1;for(Ye=_t.length-1;Ye>=0;Ye--)if(!oe(ze[Zt=_t[Ye]],Ce[Zt],Fe,Et))return!1;return!0}function ge(ze,Ce,Fe){oe(ze,Ce,!0)&&se(ze,Ce,Fe,"notDeepStrictEqual",ge)}function ce(ze,Ce){if(!ze||!Ce)return!1;if(Object.prototype.toString.call(Ce)=="[object RegExp]")return Ce.test(ze);try{if(ze instanceof Ce)return!0}catch{}return!Error.isPrototypeOf(Ce)&&Ce.call({},ze)===!0}function Ie(ze){var Ce;try{ze()}catch(Fe){Ce=Fe}return Ce}function fe(ze,Ce,Fe,Et){var bt;if(typeof Ce!="function")throw new TypeError('"block" argument must be a function');typeof Fe=="string"&&(Et=Fe,Fe=null),bt=Ie(Ce),Et=(Fe&&Fe.name?" ("+Fe.name+").":".")+(Et?" "+Et:"."),ze&&!bt&&se(bt,Fe,"Missing expected exception"+Et);var ht=typeof Et=="string",Zt=!ze&&bt&&!Fe;if((!ze&&F.isError(bt)&&ht&&ce(bt,Fe)||Zt)&&se(bt,Fe,"Got unwanted exception"+Et),ze&&bt&&Fe&&!ce(bt,Fe)||!ze&&bt)throw bt}function Te(ze,Ce){ze||se(ze,!0,Ce,"==",Te)}q.AssertionError=function(ze){this.name="AssertionError",this.actual=ze.actual,this.expected=ze.expected,this.operator=ze.operator,ze.message?(this.message=ze.message,this.generatedMessage=!1):(this.message=J(this),this.generatedMessage=!0);var Ce=ze.stackStartFunction||se;if(Error.captureStackTrace)Error.captureStackTrace(this,Ce);else{var Fe=new Error;if(Fe.stack){var Et=Fe.stack,bt=Q(Ce),ht=Et.indexOf(`
`+bt);if(ht>=0){var Zt=Et.indexOf(`
`,ht+1);Et=Et.substring(Zt+1)}this.stack=Et}}},F.inherits(q.AssertionError,Error),q.fail=se,q.ok=ie,q.equal=function(ze,Ce,Fe){ze!=Ce&&se(ze,Ce,Fe,"==",q.equal)},q.notEqual=function(ze,Ce,Fe){ze==Ce&&se(ze,Ce,Fe,"!=",q.notEqual)},q.deepEqual=function(ze,Ce,Fe){oe(ze,Ce,!1)||se(ze,Ce,Fe,"deepEqual",q.deepEqual)},q.deepStrictEqual=function(ze,Ce,Fe){oe(ze,Ce,!0)||se(ze,Ce,Fe,"deepStrictEqual",q.deepStrictEqual)},q.notDeepEqual=function(ze,Ce,Fe){oe(ze,Ce,!1)&&se(ze,Ce,Fe,"notDeepEqual",q.notDeepEqual)},q.notDeepStrictEqual=ge,q.strictEqual=function(ze,Ce,Fe){ze!==Ce&&se(ze,Ce,Fe,"===",q.strictEqual)},q.notStrictEqual=function(ze,Ce,Fe){ze===Ce&&se(ze,Ce,Fe,"!==",q.notStrictEqual)},q.throws=function(ze,Ce,Fe){fe(!0,ze,Ce,Fe)},q.doesNotThrow=function(ze,Ce,Fe){fe(!1,ze,Ce,Fe)},q.ifError=function(ze){if(ze)throw ze},q.strict=$(Te,q,{equal:q.strictEqual,deepEqual:q.deepStrictEqual,notEqual:q.notStrictEqual,notDeepEqual:q.notDeepStrictEqual}),q.strict.strict=q.strict;var ut=Object.keys||function(ze){var Ce=[];for(var Fe in ze)U.call(ze,Fe)&&Ce.push(Fe);return Ce}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"object-assign":51,"util/":26}],24:[function(d,m,g){typeof Object.create=="function"?m.exports=function(w,$){w.super_=$,w.prototype=Object.create($.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}})}:m.exports=function(w,$){w.super_=$;var I=function(){};I.prototype=$.prototype,w.prototype=new I,w.prototype.constructor=w}},{}],25:[function(d,m,g){m.exports=function(w){return w&&typeof w=="object"&&typeof w.copy=="function"&&typeof w.fill=="function"&&typeof w.readUInt8=="function"}},{}],26:[function(d,m,g){(function(w,$){(function(){var I=/%[sdj%]/g;g.format=function(Ye){if(!de(Ye)){for(var _t=[],Vt=0;Vt<arguments.length;Vt++)_t.push(U(arguments[Vt]));return _t.join(" ")}Vt=1;for(var Lt=arguments,dt=Lt.length,It=String(Ye).replace(I,(function(fr){if(fr==="%%")return"%";if(Vt>=dt)return fr;switch(fr){case"%s":return String(Lt[Vt++]);case"%d":return Number(Lt[Vt++]);case"%j":try{return JSON.stringify(Lt[Vt++])}catch{return"[Circular]"}default:return fr}})),dr=Lt[Vt];Vt<dt;dr=Lt[++Vt])ie(dr)||!fe(dr)?It+=" "+dr:It+=" "+U(dr);return It},g.deprecate=function(Ye,_t){if(ce($.process))return function(){return g.deprecate(Ye,_t).apply(this,arguments)};if(w.noDeprecation===!0)return Ye;var Vt=!1;function Lt(){if(!Vt){if(w.throwDeprecation)throw new Error(_t);w.traceDeprecation?console.trace(_t):console.error(_t),Vt=!0}return Ye.apply(this,arguments)}return Lt};var D,F={};function U(Ye,_t){var Vt={seen:[],stylize:G};return arguments.length>=3&&(Vt.depth=arguments[2]),arguments.length>=4&&(Vt.colors=arguments[3]),se(_t)?Vt.showHidden=_t:_t&&g._extend(Vt,_t),ce(Vt.showHidden)&&(Vt.showHidden=!1),ce(Vt.depth)&&(Vt.depth=2),ce(Vt.colors)&&(Vt.colors=!1),ce(Vt.customInspect)&&(Vt.customInspect=!0),Vt.colors&&(Vt.stylize=j),H(Vt,Ye,Vt.depth)}function j(Ye,_t){var Vt=U.styles[_t];return Vt?"\x1B["+U.colors[Vt][0]+"m"+Ye+"\x1B["+U.colors[Vt][1]+"m":Ye}function G(Ye,_t){return Ye}function Z(Ye){var _t={};return Ye.forEach((function(Vt,Lt){_t[Vt]=!0})),_t}function H(Ye,_t,Vt){if(Ye.customInspect&&_t&&ze(_t.inspect)&&_t.inspect!==g.inspect&&(!_t.constructor||_t.constructor.prototype!==_t)){var Lt=_t.inspect(Vt,Ye);return de(Lt)||(Lt=H(Ye,Lt,Vt)),Lt}var dt=q(Ye,_t);if(dt)return dt;var It=Object.keys(_t),dr=Z(It);if(Ye.showHidden&&(It=Object.getOwnPropertyNames(_t)),ut(_t)&&(It.indexOf("message")>=0||It.indexOf("description")>=0))return V(_t);if(It.length===0){if(ze(_t)){var fr=_t.name?": "+_t.name:"";return Ye.stylize("[Function"+fr+"]","special")}if(Ie(_t))return Ye.stylize(RegExp.prototype.toString.call(_t),"regexp");if(Te(_t))return Ye.stylize(Date.prototype.toString.call(_t),"date");if(ut(_t))return V(_t)}var pr,Nt="",$e=!1,At=["{","}"];return J(_t)&&($e=!0,At=["[","]"]),ze(_t)&&(Nt=" [Function"+(_t.name?": "+_t.name:"")+"]"),Ie(_t)&&(Nt=" "+RegExp.prototype.toString.call(_t)),Te(_t)&&(Nt=" "+Date.prototype.toUTCString.call(_t)),ut(_t)&&(Nt=" "+V(_t)),It.length!==0||$e&&_t.length!=0?Vt<0?Ie(_t)?Ye.stylize(RegExp.prototype.toString.call(_t),"regexp"):Ye.stylize("[Object]","special"):(Ye.seen.push(_t),pr=$e?Q(Ye,_t,Vt,dr,It):It.map((function(Ge){return X(Ye,_t,Vt,dr,Ge,$e)})),Ye.seen.pop(),re(pr,Nt,At)):At[0]+Nt+At[1]}function q(Ye,_t){if(ce(_t))return Ye.stylize("undefined","undefined");if(de(_t)){var Vt="'"+JSON.stringify(_t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ye.stylize(Vt,"string")}return pe(_t)?Ye.stylize(""+_t,"number"):se(_t)?Ye.stylize(""+_t,"boolean"):ie(_t)?Ye.stylize("null","null"):void 0}function V(Ye){return"["+Error.prototype.toString.call(Ye)+"]"}function Q(Ye,_t,Vt,Lt,dt){for(var It=[],dr=0,fr=_t.length;dr<fr;++dr)Zt(_t,String(dr))?It.push(X(Ye,_t,Vt,Lt,String(dr),!0)):It.push("");return dt.forEach((function(pr){pr.match(/^\d+$/)||It.push(X(Ye,_t,Vt,Lt,pr,!0))})),It}function X(Ye,_t,Vt,Lt,dt,It){var dr,fr,pr;if((pr=Object.getOwnPropertyDescriptor(_t,dt)||{value:_t[dt]}).get?fr=pr.set?Ye.stylize("[Getter/Setter]","special"):Ye.stylize("[Getter]","special"):pr.set&&(fr=Ye.stylize("[Setter]","special")),Zt(Lt,dt)||(dr="["+dt+"]"),fr||(Ye.seen.indexOf(pr.value)<0?(fr=ie(Vt)?H(Ye,pr.value,null):H(Ye,pr.value,Vt-1)).indexOf(`
`)>-1&&(fr=It?fr.split(`
`).map((function(Nt){return"  "+Nt})).join(`
`).substr(2):`
`+fr.split(`
`).map((function(Nt){return"   "+Nt})).join(`
`)):fr=Ye.stylize("[Circular]","special")),ce(dr)){if(It&&dt.match(/^\d+$/))return fr;(dr=JSON.stringify(""+dt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(dr=dr.substr(1,dr.length-2),dr=Ye.stylize(dr,"name")):(dr=dr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),dr=Ye.stylize(dr,"string"))}return dr+": "+fr}function re(Ye,_t,Vt){return Ye.reduce((function(Lt,dt){return dt.indexOf(`
`),Lt+dt.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?Vt[0]+(_t===""?"":_t+`
 `)+" "+Ye.join(`,
  `)+" "+Vt[1]:Vt[0]+_t+" "+Ye.join(", ")+" "+Vt[1]}function J(Ye){return Array.isArray(Ye)}function se(Ye){return typeof Ye=="boolean"}function ie(Ye){return Ye===null}function oe(Ye){return Ye==null}function pe(Ye){return typeof Ye=="number"}function de(Ye){return typeof Ye=="string"}function ge(Ye){return typeof Ye=="symbol"}function ce(Ye){return Ye===void 0}function Ie(Ye){return fe(Ye)&&Fe(Ye)==="[object RegExp]"}function fe(Ye){return typeof Ye=="object"&&Ye!==null}function Te(Ye){return fe(Ye)&&Fe(Ye)==="[object Date]"}function ut(Ye){return fe(Ye)&&(Fe(Ye)==="[object Error]"||Ye instanceof Error)}function ze(Ye){return typeof Ye=="function"}function Ce(Ye){return Ye===null||typeof Ye=="boolean"||typeof Ye=="number"||typeof Ye=="string"||typeof Ye=="symbol"||Ye===void 0}function Fe(Ye){return Object.prototype.toString.call(Ye)}function Et(Ye){return Ye<10?"0"+Ye.toString(10):Ye.toString(10)}g.debuglog=function(Ye){if(ce(D)&&(D=w.env.NODE_DEBUG||""),Ye=Ye.toUpperCase(),!F[Ye])if(new RegExp("\\b"+Ye+"\\b","i").test(D)){var _t=w.pid;F[Ye]=function(){var Vt=g.format.apply(g,arguments);console.error("%s %d: %s",Ye,_t,Vt)}}else F[Ye]=function(){};return F[Ye]},g.inspect=U,U.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},U.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},g.isArray=J,g.isBoolean=se,g.isNull=ie,g.isNullOrUndefined=oe,g.isNumber=pe,g.isString=de,g.isSymbol=ge,g.isUndefined=ce,g.isRegExp=Ie,g.isObject=fe,g.isDate=Te,g.isError=ut,g.isFunction=ze,g.isPrimitive=Ce,g.isBuffer=d("./support/isBuffer");var bt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ht(){var Ye=new Date,_t=[Et(Ye.getHours()),Et(Ye.getMinutes()),Et(Ye.getSeconds())].join(":");return[Ye.getDate(),bt[Ye.getMonth()],_t].join(" ")}function Zt(Ye,_t){return Object.prototype.hasOwnProperty.call(Ye,_t)}g.log=function(){console.log("%s - %s",ht(),g.format.apply(g,arguments))},g.inherits=d("inherits"),g._extend=function(Ye,_t){if(!_t||!fe(_t))return Ye;for(var Vt=Object.keys(_t),Lt=Vt.length;Lt--;)Ye[Vt[Lt]]=_t[Vt[Lt]];return Ye}}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"./support/isBuffer":25,_process:63,inherits:24}],27:[function(d,m,g){(function(w){(function(){var $=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],I=typeof globalThis>"u"?w:globalThis;m.exports=function(){for(var D=[],F=0;F<$.length;F++)typeof I[$[F]]=="function"&&(D[D.length]=$[F]);return D}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],28:[function(d,m,g){g.byteLength=G,g.toByteArray=H,g.fromByteArray=Q;for(var w=[],$=[],I=typeof Uint8Array<"u"?Uint8Array:Array,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=0,U=D.length;F<U;++F)w[F]=D[F],$[D.charCodeAt(F)]=F;function j(X){var re=X.length;if(re%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var J=X.indexOf("=");return J===-1&&(J=re),[J,J===re?0:4-J%4]}function G(X){var re=j(X),J=re[0],se=re[1];return 3*(J+se)/4-se}function Z(X,re,J){return 3*(re+J)/4-J}function H(X){var re,J,se=j(X),ie=se[0],oe=se[1],pe=new I(Z(X,ie,oe)),de=0,ge=oe>0?ie-4:ie;for(J=0;J<ge;J+=4)re=$[X.charCodeAt(J)]<<18|$[X.charCodeAt(J+1)]<<12|$[X.charCodeAt(J+2)]<<6|$[X.charCodeAt(J+3)],pe[de++]=re>>16&255,pe[de++]=re>>8&255,pe[de++]=255&re;return oe===2&&(re=$[X.charCodeAt(J)]<<2|$[X.charCodeAt(J+1)]>>4,pe[de++]=255&re),oe===1&&(re=$[X.charCodeAt(J)]<<10|$[X.charCodeAt(J+1)]<<4|$[X.charCodeAt(J+2)]>>2,pe[de++]=re>>8&255,pe[de++]=255&re),pe}function q(X){return w[X>>18&63]+w[X>>12&63]+w[X>>6&63]+w[63&X]}function V(X,re,J){for(var se,ie=[],oe=re;oe<J;oe+=3)se=(X[oe]<<16&16711680)+(X[oe+1]<<8&65280)+(255&X[oe+2]),ie.push(q(se));return ie.join("")}function Q(X){for(var re,J=X.length,se=J%3,ie=[],oe=16383,pe=0,de=J-se;pe<de;pe+=oe)ie.push(V(X,pe,pe+oe>de?de:pe+oe));return se===1?(re=X[J-1],ie.push(w[re>>2]+w[re<<4&63]+"==")):se===2&&(re=(X[J-2]<<8)+X[J-1],ie.push(w[re>>10]+w[re>>4&63]+w[re<<2&63]+"=")),ie.join("")}$[45]=62,$[95]=63},{}],29:[function(d,m,g){},{}],30:[function(d,m,g){(function(w,$){(function(){var I=d("assert"),D=d("pako/lib/zlib/zstream"),F=d("pako/lib/zlib/deflate.js"),U=d("pako/lib/zlib/inflate.js"),j=d("pako/lib/zlib/constants");for(var G in j)g[G]=j[G];g.NONE=0,g.DEFLATE=1,g.INFLATE=2,g.GZIP=3,g.GUNZIP=4,g.DEFLATERAW=5,g.INFLATERAW=6,g.UNZIP=7;var Z=31,H=139;function q(V){if(typeof V!="number"||V<g.DEFLATE||V>g.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=V,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}q.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,I(this.init_done,"close before init"),I(this.mode<=g.UNZIP),this.mode===g.DEFLATE||this.mode===g.GZIP||this.mode===g.DEFLATERAW?F.deflateEnd(this.strm):this.mode!==g.INFLATE&&this.mode!==g.GUNZIP&&this.mode!==g.INFLATERAW&&this.mode!==g.UNZIP||U.inflateEnd(this.strm),this.mode=g.NONE,this.dictionary=null)},q.prototype.write=function(V,Q,X,re,J,se,ie){return this._write(!0,V,Q,X,re,J,se,ie)},q.prototype.writeSync=function(V,Q,X,re,J,se,ie){return this._write(!1,V,Q,X,re,J,se,ie)},q.prototype._write=function(V,Q,X,re,J,se,ie,oe){if(I.equal(arguments.length,8),I(this.init_done,"write before init"),I(this.mode!==g.NONE,"already finalized"),I.equal(!1,this.write_in_progress,"write already in progress"),I.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,I.equal(!1,Q===void 0,"must provide flush value"),this.write_in_progress=!0,Q!==g.Z_NO_FLUSH&&Q!==g.Z_PARTIAL_FLUSH&&Q!==g.Z_SYNC_FLUSH&&Q!==g.Z_FULL_FLUSH&&Q!==g.Z_FINISH&&Q!==g.Z_BLOCK)throw new Error("Invalid flush value");if(X==null&&(X=$.alloc(0),J=0,re=0),this.strm.avail_in=J,this.strm.input=X,this.strm.next_in=re,this.strm.avail_out=oe,this.strm.output=se,this.strm.next_out=ie,this.flush=Q,!V)return this._process(),this._checkError()?this._afterSync():void 0;var pe=this;return w.nextTick((function(){pe._process(),pe._after()})),this},q.prototype._afterSync=function(){var V=this.strm.avail_out,Q=this.strm.avail_in;return this.write_in_progress=!1,[Q,V]},q.prototype._process=function(){var V=null;switch(this.mode){case g.DEFLATE:case g.GZIP:case g.DEFLATERAW:this.err=F.deflate(this.strm,this.flush);break;case g.UNZIP:switch(this.strm.avail_in>0&&(V=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(V===null)break;if(this.strm.input[V]!==Z){this.mode=g.INFLATE;break}if(this.gzip_id_bytes_read=1,V++,this.strm.avail_in===1)break;case 1:if(V===null)break;this.strm.input[V]===H?(this.gzip_id_bytes_read=2,this.mode=g.GUNZIP):this.mode=g.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case g.INFLATE:case g.GUNZIP:case g.INFLATERAW:for(this.err=U.inflate(this.strm,this.flush),this.err===g.Z_NEED_DICT&&this.dictionary&&(this.err=U.inflateSetDictionary(this.strm,this.dictionary),this.err===g.Z_OK?this.err=U.inflate(this.strm,this.flush):this.err===g.Z_DATA_ERROR&&(this.err=g.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===g.GUNZIP&&this.err===g.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=U.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},q.prototype._checkError=function(){switch(this.err){case g.Z_OK:case g.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===g.Z_FINISH)return this._error("unexpected end of file"),!1;break;case g.Z_STREAM_END:break;case g.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},q.prototype._after=function(){if(this._checkError()){var V=this.strm.avail_out,Q=this.strm.avail_in;this.write_in_progress=!1,this.callback(Q,V),this.pending_close&&this.close()}},q.prototype._error=function(V){this.strm.msg&&(V=this.strm.msg),this.onerror(V,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},q.prototype.init=function(V,Q,X,re,J){I(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),I(V>=8&&V<=15,"invalid windowBits"),I(Q>=-1&&Q<=9,"invalid compression level"),I(X>=1&&X<=9,"invalid memlevel"),I(re===g.Z_FILTERED||re===g.Z_HUFFMAN_ONLY||re===g.Z_RLE||re===g.Z_FIXED||re===g.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(Q,V,X,re,J),this._setDictionary()},q.prototype.params=function(){throw new Error("deflateParams Not supported")},q.prototype.reset=function(){this._reset(),this._setDictionary()},q.prototype._init=function(V,Q,X,re,J){switch(this.level=V,this.windowBits=Q,this.memLevel=X,this.strategy=re,this.flush=g.Z_NO_FLUSH,this.err=g.Z_OK,this.mode!==g.GZIP&&this.mode!==g.GUNZIP||(this.windowBits+=16),this.mode===g.UNZIP&&(this.windowBits+=32),this.mode!==g.DEFLATERAW&&this.mode!==g.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new D,this.mode){case g.DEFLATE:case g.GZIP:case g.DEFLATERAW:this.err=F.deflateInit2(this.strm,this.level,g.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case g.INFLATE:case g.GUNZIP:case g.INFLATERAW:case g.UNZIP:this.err=U.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==g.Z_OK&&this._error("Init error"),this.dictionary=J,this.write_in_progress=!1,this.init_done=!0},q.prototype._setDictionary=function(){if(this.dictionary!=null){switch(this.err=g.Z_OK,this.mode){case g.DEFLATE:case g.DEFLATERAW:this.err=F.deflateSetDictionary(this.strm,this.dictionary)}this.err!==g.Z_OK&&this._error("Failed to set dictionary")}},q.prototype._reset=function(){switch(this.err=g.Z_OK,this.mode){case g.DEFLATE:case g.DEFLATERAW:case g.GZIP:this.err=F.deflateReset(this.strm);break;case g.INFLATE:case g.INFLATERAW:case g.GUNZIP:this.err=U.inflateReset(this.strm)}this.err!==g.Z_OK&&this._error("Failed to reset stream")},g.Zlib=q}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,assert:23,buffer:32,"pako/lib/zlib/constants":54,"pako/lib/zlib/deflate.js":56,"pako/lib/zlib/inflate.js":58,"pako/lib/zlib/zstream":62}],31:[function(d,m,g){(function(w){(function(){var $=d("buffer").Buffer,I=d("stream").Transform,D=d("./binding"),F=d("util"),U=d("assert").ok,j=d("buffer").kMaxLength,G="Cannot create final Buffer. It would be larger than 0x"+j.toString(16)+" bytes";D.Z_MIN_WINDOWBITS=8,D.Z_MAX_WINDOWBITS=15,D.Z_DEFAULT_WINDOWBITS=15,D.Z_MIN_CHUNK=64,D.Z_MAX_CHUNK=1/0,D.Z_DEFAULT_CHUNK=16384,D.Z_MIN_MEMLEVEL=1,D.Z_MAX_MEMLEVEL=9,D.Z_DEFAULT_MEMLEVEL=8,D.Z_MIN_LEVEL=-1,D.Z_MAX_LEVEL=9,D.Z_DEFAULT_LEVEL=D.Z_DEFAULT_COMPRESSION;for(var Z=Object.keys(D),H=0;H<Z.length;H++){var q=Z[H];q.match(/^Z/)&&Object.defineProperty(g,q,{enumerable:!0,value:D[q],writable:!1})}for(var V={Z_OK:D.Z_OK,Z_STREAM_END:D.Z_STREAM_END,Z_NEED_DICT:D.Z_NEED_DICT,Z_ERRNO:D.Z_ERRNO,Z_STREAM_ERROR:D.Z_STREAM_ERROR,Z_DATA_ERROR:D.Z_DATA_ERROR,Z_MEM_ERROR:D.Z_MEM_ERROR,Z_BUF_ERROR:D.Z_BUF_ERROR,Z_VERSION_ERROR:D.Z_VERSION_ERROR},Q=Object.keys(V),X=0;X<Q.length;X++){var re=Q[X];V[V[re]]=re}function J(Ce,Fe,Et){var bt=[],ht=0;function Zt(){for(var Vt;(Vt=Ce.read())!==null;)bt.push(Vt),ht+=Vt.length;Ce.once("readable",Zt)}function Ye(Vt){Ce.removeListener("end",_t),Ce.removeListener("readable",Zt),Et(Vt)}function _t(){var Vt,Lt=null;ht>=j?Lt=new RangeError(G):Vt=$.concat(bt,ht),bt=[],Ce.close(),Et(Lt,Vt)}Ce.on("error",Ye),Ce.on("end",_t),Ce.end(Fe),Zt()}function se(Ce,Fe){if(typeof Fe=="string"&&(Fe=$.from(Fe)),!$.isBuffer(Fe))throw new TypeError("Not a string or buffer");var Et=Ce._finishFlushFlag;return Ce._processChunk(Fe,Et)}function ie(Ce){if(!(this instanceof ie))return new ie(Ce);Te.call(this,Ce,D.DEFLATE)}function oe(Ce){if(!(this instanceof oe))return new oe(Ce);Te.call(this,Ce,D.INFLATE)}function pe(Ce){if(!(this instanceof pe))return new pe(Ce);Te.call(this,Ce,D.GZIP)}function de(Ce){if(!(this instanceof de))return new de(Ce);Te.call(this,Ce,D.GUNZIP)}function ge(Ce){if(!(this instanceof ge))return new ge(Ce);Te.call(this,Ce,D.DEFLATERAW)}function ce(Ce){if(!(this instanceof ce))return new ce(Ce);Te.call(this,Ce,D.INFLATERAW)}function Ie(Ce){if(!(this instanceof Ie))return new Ie(Ce);Te.call(this,Ce,D.UNZIP)}function fe(Ce){return Ce===D.Z_NO_FLUSH||Ce===D.Z_PARTIAL_FLUSH||Ce===D.Z_SYNC_FLUSH||Ce===D.Z_FULL_FLUSH||Ce===D.Z_FINISH||Ce===D.Z_BLOCK}function Te(Ce,Fe){var Et=this;if(this._opts=Ce=Ce||{},this._chunkSize=Ce.chunkSize||g.Z_DEFAULT_CHUNK,I.call(this,Ce),Ce.flush&&!fe(Ce.flush))throw new Error("Invalid flush flag: "+Ce.flush);if(Ce.finishFlush&&!fe(Ce.finishFlush))throw new Error("Invalid flush flag: "+Ce.finishFlush);if(this._flushFlag=Ce.flush||D.Z_NO_FLUSH,this._finishFlushFlag=Ce.finishFlush!==void 0?Ce.finishFlush:D.Z_FINISH,Ce.chunkSize&&(Ce.chunkSize<g.Z_MIN_CHUNK||Ce.chunkSize>g.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+Ce.chunkSize);if(Ce.windowBits&&(Ce.windowBits<g.Z_MIN_WINDOWBITS||Ce.windowBits>g.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+Ce.windowBits);if(Ce.level&&(Ce.level<g.Z_MIN_LEVEL||Ce.level>g.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+Ce.level);if(Ce.memLevel&&(Ce.memLevel<g.Z_MIN_MEMLEVEL||Ce.memLevel>g.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+Ce.memLevel);if(Ce.strategy&&Ce.strategy!=g.Z_FILTERED&&Ce.strategy!=g.Z_HUFFMAN_ONLY&&Ce.strategy!=g.Z_RLE&&Ce.strategy!=g.Z_FIXED&&Ce.strategy!=g.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+Ce.strategy);if(Ce.dictionary&&!$.isBuffer(Ce.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new D.Zlib(Fe);var bt=this;this._hadError=!1,this._handle.onerror=function(Ye,_t){ut(bt),bt._hadError=!0;var Vt=new Error(Ye);Vt.errno=_t,Vt.code=g.codes[_t],bt.emit("error",Vt)};var ht=g.Z_DEFAULT_COMPRESSION;typeof Ce.level=="number"&&(ht=Ce.level);var Zt=g.Z_DEFAULT_STRATEGY;typeof Ce.strategy=="number"&&(Zt=Ce.strategy),this._handle.init(Ce.windowBits||g.Z_DEFAULT_WINDOWBITS,ht,Ce.memLevel||g.Z_DEFAULT_MEMLEVEL,Zt,Ce.dictionary),this._buffer=$.allocUnsafe(this._chunkSize),this._offset=0,this._level=ht,this._strategy=Zt,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!Et._handle},configurable:!0,enumerable:!0})}function ut(Ce,Fe){Fe&&w.nextTick(Fe),Ce._handle&&(Ce._handle.close(),Ce._handle=null)}function ze(Ce){Ce.emit("close")}Object.defineProperty(g,"codes",{enumerable:!0,value:Object.freeze(V),writable:!1}),g.Deflate=ie,g.Inflate=oe,g.Gzip=pe,g.Gunzip=de,g.DeflateRaw=ge,g.InflateRaw=ce,g.Unzip=Ie,g.createDeflate=function(Ce){return new ie(Ce)},g.createInflate=function(Ce){return new oe(Ce)},g.createDeflateRaw=function(Ce){return new ge(Ce)},g.createInflateRaw=function(Ce){return new ce(Ce)},g.createGzip=function(Ce){return new pe(Ce)},g.createGunzip=function(Ce){return new de(Ce)},g.createUnzip=function(Ce){return new Ie(Ce)},g.deflate=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new ie(Fe),Ce,Et)},g.deflateSync=function(Ce,Fe){return se(new ie(Fe),Ce)},g.gzip=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new pe(Fe),Ce,Et)},g.gzipSync=function(Ce,Fe){return se(new pe(Fe),Ce)},g.deflateRaw=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new ge(Fe),Ce,Et)},g.deflateRawSync=function(Ce,Fe){return se(new ge(Fe),Ce)},g.unzip=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new Ie(Fe),Ce,Et)},g.unzipSync=function(Ce,Fe){return se(new Ie(Fe),Ce)},g.inflate=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new oe(Fe),Ce,Et)},g.inflateSync=function(Ce,Fe){return se(new oe(Fe),Ce)},g.gunzip=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new de(Fe),Ce,Et)},g.gunzipSync=function(Ce,Fe){return se(new de(Fe),Ce)},g.inflateRaw=function(Ce,Fe,Et){return typeof Fe=="function"&&(Et=Fe,Fe={}),J(new ce(Fe),Ce,Et)},g.inflateRawSync=function(Ce,Fe){return se(new ce(Fe),Ce)},F.inherits(Te,I),Te.prototype.params=function(Ce,Fe,Et){if(Ce<g.Z_MIN_LEVEL||Ce>g.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+Ce);if(Fe!=g.Z_FILTERED&&Fe!=g.Z_HUFFMAN_ONLY&&Fe!=g.Z_RLE&&Fe!=g.Z_FIXED&&Fe!=g.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+Fe);if(this._level!==Ce||this._strategy!==Fe){var bt=this;this.flush(D.Z_SYNC_FLUSH,(function(){U(bt._handle,"zlib binding closed"),bt._handle.params(Ce,Fe),bt._hadError||(bt._level=Ce,bt._strategy=Fe,Et&&Et())}))}else w.nextTick(Et)},Te.prototype.reset=function(){return U(this._handle,"zlib binding closed"),this._handle.reset()},Te.prototype._flush=function(Ce){this._transform($.alloc(0),"",Ce)},Te.prototype.flush=function(Ce,Fe){var Et=this,bt=this._writableState;(typeof Ce=="function"||Ce===void 0&&!Fe)&&(Fe=Ce,Ce=D.Z_FULL_FLUSH),bt.ended?Fe&&w.nextTick(Fe):bt.ending?Fe&&this.once("end",Fe):bt.needDrain?Fe&&this.once("drain",(function(){return Et.flush(Ce,Fe)})):(this._flushFlag=Ce,this.write($.alloc(0),"",Fe))},Te.prototype.close=function(Ce){ut(this,Ce),w.nextTick(ze,this)},Te.prototype._transform=function(Ce,Fe,Et){var bt,ht=this._writableState,Zt=(ht.ending||ht.ended)&&(!Ce||ht.length===Ce.length);return Ce===null||$.isBuffer(Ce)?this._handle?(Zt?bt=this._finishFlushFlag:(bt=this._flushFlag,Ce.length>=ht.length&&(this._flushFlag=this._opts.flush||D.Z_NO_FLUSH)),void this._processChunk(Ce,bt,Et)):Et(new Error("zlib binding closed")):Et(new Error("invalid input"))},Te.prototype._processChunk=function(Ce,Fe,Et){var bt=Ce&&Ce.length,ht=this._chunkSize-this._offset,Zt=0,Ye=this,_t=typeof Et=="function";if(!_t){var Vt,Lt=[],dt=0;this.on("error",(function(Nt){Vt=Nt})),U(this._handle,"zlib binding closed");do var It=this._handle.writeSync(Fe,Ce,Zt,bt,this._buffer,this._offset,ht);while(!this._hadError&&pr(It[0],It[1]));if(this._hadError)throw Vt;if(dt>=j)throw ut(this),new RangeError(G);var dr=$.concat(Lt,dt);return ut(this),dr}U(this._handle,"zlib binding closed");var fr=this._handle.write(Fe,Ce,Zt,bt,this._buffer,this._offset,ht);function pr(Nt,$e){if(this&&(this.buffer=null,this.callback=null),!Ye._hadError){var At=ht-$e;if(U(At>=0,"have should not go down"),At>0){var Ge=Ye._buffer.slice(Ye._offset,Ye._offset+At);Ye._offset+=At,_t?Ye.push(Ge):(Lt.push(Ge),dt+=Ge.length)}if(($e===0||Ye._offset>=Ye._chunkSize)&&(ht=Ye._chunkSize,Ye._offset=0,Ye._buffer=$.allocUnsafe(Ye._chunkSize)),$e===0){if(Zt+=bt-Nt,bt=Nt,!_t)return!0;var st=Ye._handle.write(Fe,Ce,Zt,bt,Ye._buffer,Ye._offset,Ye._chunkSize);return st.callback=pr,void(st.buffer=Ce)}if(!_t)return!1;Et()}}fr.buffer=Ce,fr.callback=pr},F.inherits(ie,Te),F.inherits(oe,Te),F.inherits(pe,Te),F.inherits(de,Te),F.inherits(ge,Te),F.inherits(ce,Te),F.inherits(Ie,Te)}).call(this)}).call(this,d("_process"))},{"./binding":30,_process:63,assert:23,buffer:32,stream:65,util:84}],32:[function(d,m,g){(function(w){(function(){var $=d("base64-js"),I=d("ieee754");g.Buffer=j,g.SlowBuffer=se,g.INSPECT_MAX_BYTES=50;var D=2147483647;function F(){try{var me=new Uint8Array(1);return me.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},me.foo()===42}catch{return!1}}function U(me){if(me>D)throw new RangeError('The value "'+me+'" is invalid for option "size"');var Be=new Uint8Array(me);return Be.__proto__=j.prototype,Be}function j(me,Be,lt){if(typeof me=="number"){if(typeof Be=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return q(me)}return G(me,Be,lt)}function G(me,Be,lt){if(typeof me=="string")return V(me,Be);if(ArrayBuffer.isView(me))return Q(me);if(me==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof me);if(gt(me,ArrayBuffer)||me&&gt(me.buffer,ArrayBuffer))return X(me,Be,lt);if(typeof me=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var ft=me.valueOf&&me.valueOf();if(ft!=null&&ft!==me)return j.from(ft,Be,lt);var mr=re(me);if(mr)return mr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof me[Symbol.toPrimitive]=="function")return j.from(me[Symbol.toPrimitive]("string"),Be,lt);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof me)}function Z(me){if(typeof me!="number")throw new TypeError('"size" argument must be of type number');if(me<0)throw new RangeError('The value "'+me+'" is invalid for option "size"')}function H(me,Be,lt){return Z(me),me<=0?U(me):Be!==void 0?typeof lt=="string"?U(me).fill(Be,lt):U(me).fill(Be):U(me)}function q(me){return Z(me),U(me<0?0:0|J(me))}function V(me,Be){if(typeof Be=="string"&&Be!==""||(Be="utf8"),!j.isEncoding(Be))throw new TypeError("Unknown encoding: "+Be);var lt=0|ie(me,Be),ft=U(lt),mr=ft.write(me,Be);return mr!==lt&&(ft=ft.slice(0,mr)),ft}function Q(me){for(var Be=me.length<0?0:0|J(me.length),lt=U(Be),ft=0;ft<Be;ft+=1)lt[ft]=255&me[ft];return lt}function X(me,Be,lt){if(Be<0||me.byteLength<Be)throw new RangeError('"offset" is outside of buffer bounds');if(me.byteLength<Be+(lt||0))throw new RangeError('"length" is outside of buffer bounds');var ft;return(ft=Be===void 0&&lt===void 0?new Uint8Array(me):lt===void 0?new Uint8Array(me,Be):new Uint8Array(me,Be,lt)).__proto__=j.prototype,ft}function re(me){if(j.isBuffer(me)){var Be=0|J(me.length),lt=U(Be);return lt.length===0||me.copy(lt,0,0,Be),lt}return me.length!==void 0?typeof me.length!="number"||Qt(me.length)?U(0):Q(me):me.type==="Buffer"&&Array.isArray(me.data)?Q(me.data):void 0}function J(me){if(me>=D)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+D.toString(16)+" bytes");return 0|me}function se(me){return+me!=me&&(me=0),j.alloc(+me)}function ie(me,Be){if(j.isBuffer(me))return me.length;if(ArrayBuffer.isView(me)||gt(me,ArrayBuffer))return me.byteLength;if(typeof me!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof me);var lt=me.length,ft=arguments.length>2&&arguments[2]===!0;if(!ft&&lt===0)return 0;for(var mr=!1;;)switch(Be){case"ascii":case"latin1":case"binary":return lt;case"utf8":case"utf-8":return $e(me).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*lt;case"hex":return lt>>>1;case"base64":return st(me).length;default:if(mr)return ft?-1:$e(me).length;Be=(""+Be).toLowerCase(),mr=!0}}function oe(me,Be,lt){var ft=!1;if((Be===void 0||Be<0)&&(Be=0),Be>this.length||((lt===void 0||lt>this.length)&&(lt=this.length),lt<=0)||(lt>>>=0)<=(Be>>>=0))return"";for(me||(me="utf8");;)switch(me){case"hex":return Ye(this,Be,lt);case"utf8":case"utf-8":return Fe(this,Be,lt);case"ascii":return ht(this,Be,lt);case"latin1":case"binary":return Zt(this,Be,lt);case"base64":return Ce(this,Be,lt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _t(this,Be,lt);default:if(ft)throw new TypeError("Unknown encoding: "+me);me=(me+"").toLowerCase(),ft=!0}}function pe(me,Be,lt){var ft=me[Be];me[Be]=me[lt],me[lt]=ft}function de(me,Be,lt,ft,mr){if(me.length===0)return-1;if(typeof lt=="string"?(ft=lt,lt=0):lt>2147483647?lt=2147483647:lt<-2147483648&&(lt=-2147483648),Qt(lt=+lt)&&(lt=mr?0:me.length-1),lt<0&&(lt=me.length+lt),lt>=me.length){if(mr)return-1;lt=me.length-1}else if(lt<0){if(!mr)return-1;lt=0}if(typeof Be=="string"&&(Be=j.from(Be,ft)),j.isBuffer(Be))return Be.length===0?-1:ge(me,Be,lt,ft,mr);if(typeof Be=="number")return Be&=255,typeof Uint8Array.prototype.indexOf=="function"?mr?Uint8Array.prototype.indexOf.call(me,Be,lt):Uint8Array.prototype.lastIndexOf.call(me,Be,lt):ge(me,[Be],lt,ft,mr);throw new TypeError("val must be string, number or Buffer")}function ge(me,Be,lt,ft,mr){var gr,oi=1,hi=me.length,ai=Be.length;if(ft!==void 0&&((ft=String(ft).toLowerCase())==="ucs2"||ft==="ucs-2"||ft==="utf16le"||ft==="utf-16le")){if(me.length<2||Be.length<2)return-1;oi=2,hi/=2,ai/=2,lt/=2}function fi(bi,Ei){return oi===1?bi[Ei]:bi.readUInt16BE(Ei*oi)}if(mr){var ui=-1;for(gr=lt;gr<hi;gr++)if(fi(me,gr)===fi(Be,ui===-1?0:gr-ui)){if(ui===-1&&(ui=gr),gr-ui+1===ai)return ui*oi}else ui!==-1&&(gr-=gr-ui),ui=-1}else for(lt+ai>hi&&(lt=hi-ai),gr=lt;gr>=0;gr--){for(var wi=!0,_i=0;_i<ai;_i++)if(fi(me,gr+_i)!==fi(Be,_i)){wi=!1;break}if(wi)return gr}return-1}function ce(me,Be,lt,ft){lt=Number(lt)||0;var mr=me.length-lt;ft?(ft=Number(ft))>mr&&(ft=mr):ft=mr;var gr=Be.length;ft>gr/2&&(ft=gr/2);for(var oi=0;oi<ft;++oi){var hi=parseInt(Be.substr(2*oi,2),16);if(Qt(hi))return oi;me[lt+oi]=hi}return oi}function Ie(me,Be,lt,ft){return Xe($e(Be,me.length-lt),me,lt,ft)}function fe(me,Be,lt,ft){return Xe(At(Be),me,lt,ft)}function Te(me,Be,lt,ft){return fe(me,Be,lt,ft)}function ut(me,Be,lt,ft){return Xe(st(Be),me,lt,ft)}function ze(me,Be,lt,ft){return Xe(Ge(Be,me.length-lt),me,lt,ft)}function Ce(me,Be,lt){return Be===0&&lt===me.length?$.fromByteArray(me):$.fromByteArray(me.slice(Be,lt))}function Fe(me,Be,lt){lt=Math.min(me.length,lt);for(var ft=[],mr=Be;mr<lt;){var gr,oi,hi,ai,fi=me[mr],ui=null,wi=fi>239?4:fi>223?3:fi>191?2:1;if(mr+wi<=lt)switch(wi){case 1:fi<128&&(ui=fi);break;case 2:(192&(gr=me[mr+1]))==128&&(ai=(31&fi)<<6|63&gr)>127&&(ui=ai);break;case 3:gr=me[mr+1],oi=me[mr+2],(192&gr)==128&&(192&oi)==128&&(ai=(15&fi)<<12|(63&gr)<<6|63&oi)>2047&&(ai<55296||ai>57343)&&(ui=ai);break;case 4:gr=me[mr+1],oi=me[mr+2],hi=me[mr+3],(192&gr)==128&&(192&oi)==128&&(192&hi)==128&&(ai=(15&fi)<<18|(63&gr)<<12|(63&oi)<<6|63&hi)>65535&&ai<1114112&&(ui=ai)}ui===null?(ui=65533,wi=1):ui>65535&&(ui-=65536,ft.push(ui>>>10&1023|55296),ui=56320|1023&ui),ft.push(ui),mr+=wi}return bt(ft)}g.kMaxLength=D,j.TYPED_ARRAY_SUPPORT=F(),j.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(j.prototype,"parent",{enumerable:!0,get:function(){if(j.isBuffer(this))return this.buffer}}),Object.defineProperty(j.prototype,"offset",{enumerable:!0,get:function(){if(j.isBuffer(this))return this.byteOffset}}),typeof Symbol<"u"&&Symbol.species!=null&&j[Symbol.species]===j&&Object.defineProperty(j,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),j.poolSize=8192,j.from=function(me,Be,lt){return G(me,Be,lt)},j.prototype.__proto__=Uint8Array.prototype,j.__proto__=Uint8Array,j.alloc=function(me,Be,lt){return H(me,Be,lt)},j.allocUnsafe=function(me){return q(me)},j.allocUnsafeSlow=function(me){return q(me)},j.isBuffer=function(me){return me!=null&&me._isBuffer===!0&&me!==j.prototype},j.compare=function(me,Be){if(gt(me,Uint8Array)&&(me=j.from(me,me.offset,me.byteLength)),gt(Be,Uint8Array)&&(Be=j.from(Be,Be.offset,Be.byteLength)),!j.isBuffer(me)||!j.isBuffer(Be))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(me===Be)return 0;for(var lt=me.length,ft=Be.length,mr=0,gr=Math.min(lt,ft);mr<gr;++mr)if(me[mr]!==Be[mr]){lt=me[mr],ft=Be[mr];break}return lt<ft?-1:ft<lt?1:0},j.isEncoding=function(me){switch(String(me).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},j.concat=function(me,Be){if(!Array.isArray(me))throw new TypeError('"list" argument must be an Array of Buffers');if(me.length===0)return j.alloc(0);var lt;if(Be===void 0)for(Be=0,lt=0;lt<me.length;++lt)Be+=me[lt].length;var ft=j.allocUnsafe(Be),mr=0;for(lt=0;lt<me.length;++lt){var gr=me[lt];if(gt(gr,Uint8Array)&&(gr=j.from(gr)),!j.isBuffer(gr))throw new TypeError('"list" argument must be an Array of Buffers');gr.copy(ft,mr),mr+=gr.length}return ft},j.byteLength=ie,j.prototype._isBuffer=!0,j.prototype.swap16=function(){var me=this.length;if(me%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Be=0;Be<me;Be+=2)pe(this,Be,Be+1);return this},j.prototype.swap32=function(){var me=this.length;if(me%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Be=0;Be<me;Be+=4)pe(this,Be,Be+3),pe(this,Be+1,Be+2);return this},j.prototype.swap64=function(){var me=this.length;if(me%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Be=0;Be<me;Be+=8)pe(this,Be,Be+7),pe(this,Be+1,Be+6),pe(this,Be+2,Be+5),pe(this,Be+3,Be+4);return this},j.prototype.toString=function(){var me=this.length;return me===0?"":arguments.length===0?Fe(this,0,me):oe.apply(this,arguments)},j.prototype.toLocaleString=j.prototype.toString,j.prototype.equals=function(me){if(!j.isBuffer(me))throw new TypeError("Argument must be a Buffer");return this===me||j.compare(this,me)===0},j.prototype.inspect=function(){var me="",Be=g.INSPECT_MAX_BYTES;return me=this.toString("hex",0,Be).replace(/(.{2})/g,"$1 ").trim(),this.length>Be&&(me+=" ... "),"<Buffer "+me+">"},j.prototype.compare=function(me,Be,lt,ft,mr){if(gt(me,Uint8Array)&&(me=j.from(me,me.offset,me.byteLength)),!j.isBuffer(me))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof me);if(Be===void 0&&(Be=0),lt===void 0&&(lt=me?me.length:0),ft===void 0&&(ft=0),mr===void 0&&(mr=this.length),Be<0||lt>me.length||ft<0||mr>this.length)throw new RangeError("out of range index");if(ft>=mr&&Be>=lt)return 0;if(ft>=mr)return-1;if(Be>=lt)return 1;if(this===me)return 0;for(var gr=(mr>>>=0)-(ft>>>=0),oi=(lt>>>=0)-(Be>>>=0),hi=Math.min(gr,oi),ai=this.slice(ft,mr),fi=me.slice(Be,lt),ui=0;ui<hi;++ui)if(ai[ui]!==fi[ui]){gr=ai[ui],oi=fi[ui];break}return gr<oi?-1:oi<gr?1:0},j.prototype.includes=function(me,Be,lt){return this.indexOf(me,Be,lt)!==-1},j.prototype.indexOf=function(me,Be,lt){return de(this,me,Be,lt,!0)},j.prototype.lastIndexOf=function(me,Be,lt){return de(this,me,Be,lt,!1)},j.prototype.write=function(me,Be,lt,ft){if(Be===void 0)ft="utf8",lt=this.length,Be=0;else if(lt===void 0&&typeof Be=="string")ft=Be,lt=this.length,Be=0;else{if(!isFinite(Be))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");Be>>>=0,isFinite(lt)?(lt>>>=0,ft===void 0&&(ft="utf8")):(ft=lt,lt=void 0)}var mr=this.length-Be;if((lt===void 0||lt>mr)&&(lt=mr),me.length>0&&(lt<0||Be<0)||Be>this.length)throw new RangeError("Attempt to write outside buffer bounds");ft||(ft="utf8");for(var gr=!1;;)switch(ft){case"hex":return ce(this,me,Be,lt);case"utf8":case"utf-8":return Ie(this,me,Be,lt);case"ascii":return fe(this,me,Be,lt);case"latin1":case"binary":return Te(this,me,Be,lt);case"base64":return ut(this,me,Be,lt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ze(this,me,Be,lt);default:if(gr)throw new TypeError("Unknown encoding: "+ft);ft=(""+ft).toLowerCase(),gr=!0}},j.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Et=4096;function bt(me){var Be=me.length;if(Be<=Et)return String.fromCharCode.apply(String,me);for(var lt="",ft=0;ft<Be;)lt+=String.fromCharCode.apply(String,me.slice(ft,ft+=Et));return lt}function ht(me,Be,lt){var ft="";lt=Math.min(me.length,lt);for(var mr=Be;mr<lt;++mr)ft+=String.fromCharCode(127&me[mr]);return ft}function Zt(me,Be,lt){var ft="";lt=Math.min(me.length,lt);for(var mr=Be;mr<lt;++mr)ft+=String.fromCharCode(me[mr]);return ft}function Ye(me,Be,lt){var ft=me.length;(!Be||Be<0)&&(Be=0),(!lt||lt<0||lt>ft)&&(lt=ft);for(var mr="",gr=Be;gr<lt;++gr)mr+=Nt(me[gr]);return mr}function _t(me,Be,lt){for(var ft=me.slice(Be,lt),mr="",gr=0;gr<ft.length;gr+=2)mr+=String.fromCharCode(ft[gr]+256*ft[gr+1]);return mr}function Vt(me,Be,lt){if(me%1!=0||me<0)throw new RangeError("offset is not uint");if(me+Be>lt)throw new RangeError("Trying to access beyond buffer length")}function Lt(me,Be,lt,ft,mr,gr){if(!j.isBuffer(me))throw new TypeError('"buffer" argument must be a Buffer instance');if(Be>mr||Be<gr)throw new RangeError('"value" argument is out of bounds');if(lt+ft>me.length)throw new RangeError("Index out of range")}function dt(me,Be,lt,ft,mr,gr){if(lt+ft>me.length)throw new RangeError("Index out of range");if(lt<0)throw new RangeError("Index out of range")}function It(me,Be,lt,ft,mr){return Be=+Be,lt>>>=0,mr||dt(me,Be,lt,4),I.write(me,Be,lt,ft,23,4),lt+4}function dr(me,Be,lt,ft,mr){return Be=+Be,lt>>>=0,mr||dt(me,Be,lt,8),I.write(me,Be,lt,ft,52,8),lt+8}j.prototype.slice=function(me,Be){var lt=this.length;(me=~~me)<0?(me+=lt)<0&&(me=0):me>lt&&(me=lt),(Be=Be===void 0?lt:~~Be)<0?(Be+=lt)<0&&(Be=0):Be>lt&&(Be=lt),Be<me&&(Be=me);var ft=this.subarray(me,Be);return ft.__proto__=j.prototype,ft},j.prototype.readUIntLE=function(me,Be,lt){me>>>=0,Be>>>=0,lt||Vt(me,Be,this.length);for(var ft=this[me],mr=1,gr=0;++gr<Be&&(mr*=256);)ft+=this[me+gr]*mr;return ft},j.prototype.readUIntBE=function(me,Be,lt){me>>>=0,Be>>>=0,lt||Vt(me,Be,this.length);for(var ft=this[me+--Be],mr=1;Be>0&&(mr*=256);)ft+=this[me+--Be]*mr;return ft},j.prototype.readUInt8=function(me,Be){return me>>>=0,Be||Vt(me,1,this.length),this[me]},j.prototype.readUInt16LE=function(me,Be){return me>>>=0,Be||Vt(me,2,this.length),this[me]|this[me+1]<<8},j.prototype.readUInt16BE=function(me,Be){return me>>>=0,Be||Vt(me,2,this.length),this[me]<<8|this[me+1]},j.prototype.readUInt32LE=function(me,Be){return me>>>=0,Be||Vt(me,4,this.length),(this[me]|this[me+1]<<8|this[me+2]<<16)+16777216*this[me+3]},j.prototype.readUInt32BE=function(me,Be){return me>>>=0,Be||Vt(me,4,this.length),16777216*this[me]+(this[me+1]<<16|this[me+2]<<8|this[me+3])},j.prototype.readIntLE=function(me,Be,lt){me>>>=0,Be>>>=0,lt||Vt(me,Be,this.length);for(var ft=this[me],mr=1,gr=0;++gr<Be&&(mr*=256);)ft+=this[me+gr]*mr;return ft>=(mr*=128)&&(ft-=Math.pow(2,8*Be)),ft},j.prototype.readIntBE=function(me,Be,lt){me>>>=0,Be>>>=0,lt||Vt(me,Be,this.length);for(var ft=Be,mr=1,gr=this[me+--ft];ft>0&&(mr*=256);)gr+=this[me+--ft]*mr;return gr>=(mr*=128)&&(gr-=Math.pow(2,8*Be)),gr},j.prototype.readInt8=function(me,Be){return me>>>=0,Be||Vt(me,1,this.length),128&this[me]?-1*(255-this[me]+1):this[me]},j.prototype.readInt16LE=function(me,Be){me>>>=0,Be||Vt(me,2,this.length);var lt=this[me]|this[me+1]<<8;return 32768&lt?4294901760|lt:lt},j.prototype.readInt16BE=function(me,Be){me>>>=0,Be||Vt(me,2,this.length);var lt=this[me+1]|this[me]<<8;return 32768&lt?4294901760|lt:lt},j.prototype.readInt32LE=function(me,Be){return me>>>=0,Be||Vt(me,4,this.length),this[me]|this[me+1]<<8|this[me+2]<<16|this[me+3]<<24},j.prototype.readInt32BE=function(me,Be){return me>>>=0,Be||Vt(me,4,this.length),this[me]<<24|this[me+1]<<16|this[me+2]<<8|this[me+3]},j.prototype.readFloatLE=function(me,Be){return me>>>=0,Be||Vt(me,4,this.length),I.read(this,me,!0,23,4)},j.prototype.readFloatBE=function(me,Be){return me>>>=0,Be||Vt(me,4,this.length),I.read(this,me,!1,23,4)},j.prototype.readDoubleLE=function(me,Be){return me>>>=0,Be||Vt(me,8,this.length),I.read(this,me,!0,52,8)},j.prototype.readDoubleBE=function(me,Be){return me>>>=0,Be||Vt(me,8,this.length),I.read(this,me,!1,52,8)},j.prototype.writeUIntLE=function(me,Be,lt,ft){me=+me,Be>>>=0,lt>>>=0,ft||Lt(this,me,Be,lt,Math.pow(2,8*lt)-1,0);var mr=1,gr=0;for(this[Be]=255&me;++gr<lt&&(mr*=256);)this[Be+gr]=me/mr&255;return Be+lt},j.prototype.writeUIntBE=function(me,Be,lt,ft){me=+me,Be>>>=0,lt>>>=0,ft||Lt(this,me,Be,lt,Math.pow(2,8*lt)-1,0);var mr=lt-1,gr=1;for(this[Be+mr]=255&me;--mr>=0&&(gr*=256);)this[Be+mr]=me/gr&255;return Be+lt},j.prototype.writeUInt8=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,1,255,0),this[Be]=255&me,Be+1},j.prototype.writeUInt16LE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,2,65535,0),this[Be]=255&me,this[Be+1]=me>>>8,Be+2},j.prototype.writeUInt16BE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,2,65535,0),this[Be]=me>>>8,this[Be+1]=255&me,Be+2},j.prototype.writeUInt32LE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,4,4294967295,0),this[Be+3]=me>>>24,this[Be+2]=me>>>16,this[Be+1]=me>>>8,this[Be]=255&me,Be+4},j.prototype.writeUInt32BE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,4,4294967295,0),this[Be]=me>>>24,this[Be+1]=me>>>16,this[Be+2]=me>>>8,this[Be+3]=255&me,Be+4},j.prototype.writeIntLE=function(me,Be,lt,ft){if(me=+me,Be>>>=0,!ft){var mr=Math.pow(2,8*lt-1);Lt(this,me,Be,lt,mr-1,-mr)}var gr=0,oi=1,hi=0;for(this[Be]=255&me;++gr<lt&&(oi*=256);)me<0&&hi===0&&this[Be+gr-1]!==0&&(hi=1),this[Be+gr]=(me/oi|0)-hi&255;return Be+lt},j.prototype.writeIntBE=function(me,Be,lt,ft){if(me=+me,Be>>>=0,!ft){var mr=Math.pow(2,8*lt-1);Lt(this,me,Be,lt,mr-1,-mr)}var gr=lt-1,oi=1,hi=0;for(this[Be+gr]=255&me;--gr>=0&&(oi*=256);)me<0&&hi===0&&this[Be+gr+1]!==0&&(hi=1),this[Be+gr]=(me/oi|0)-hi&255;return Be+lt},j.prototype.writeInt8=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,1,127,-128),me<0&&(me=255+me+1),this[Be]=255&me,Be+1},j.prototype.writeInt16LE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,2,32767,-32768),this[Be]=255&me,this[Be+1]=me>>>8,Be+2},j.prototype.writeInt16BE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,2,32767,-32768),this[Be]=me>>>8,this[Be+1]=255&me,Be+2},j.prototype.writeInt32LE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,4,2147483647,-2147483648),this[Be]=255&me,this[Be+1]=me>>>8,this[Be+2]=me>>>16,this[Be+3]=me>>>24,Be+4},j.prototype.writeInt32BE=function(me,Be,lt){return me=+me,Be>>>=0,lt||Lt(this,me,Be,4,2147483647,-2147483648),me<0&&(me=4294967295+me+1),this[Be]=me>>>24,this[Be+1]=me>>>16,this[Be+2]=me>>>8,this[Be+3]=255&me,Be+4},j.prototype.writeFloatLE=function(me,Be,lt){return It(this,me,Be,!0,lt)},j.prototype.writeFloatBE=function(me,Be,lt){return It(this,me,Be,!1,lt)},j.prototype.writeDoubleLE=function(me,Be,lt){return dr(this,me,Be,!0,lt)},j.prototype.writeDoubleBE=function(me,Be,lt){return dr(this,me,Be,!1,lt)},j.prototype.copy=function(me,Be,lt,ft){if(!j.isBuffer(me))throw new TypeError("argument should be a Buffer");if(lt||(lt=0),ft||ft===0||(ft=this.length),Be>=me.length&&(Be=me.length),Be||(Be=0),ft>0&&ft<lt&&(ft=lt),ft===lt||me.length===0||this.length===0)return 0;if(Be<0)throw new RangeError("targetStart out of bounds");if(lt<0||lt>=this.length)throw new RangeError("Index out of range");if(ft<0)throw new RangeError("sourceEnd out of bounds");ft>this.length&&(ft=this.length),me.length-Be<ft-lt&&(ft=me.length-Be+lt);var mr=ft-lt;if(this===me&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(Be,lt,ft);else if(this===me&&lt<Be&&Be<ft)for(var gr=mr-1;gr>=0;--gr)me[gr+Be]=this[gr+lt];else Uint8Array.prototype.set.call(me,this.subarray(lt,ft),Be);return mr},j.prototype.fill=function(me,Be,lt,ft){if(typeof me=="string"){if(typeof Be=="string"?(ft=Be,Be=0,lt=this.length):typeof lt=="string"&&(ft=lt,lt=this.length),ft!==void 0&&typeof ft!="string")throw new TypeError("encoding must be a string");if(typeof ft=="string"&&!j.isEncoding(ft))throw new TypeError("Unknown encoding: "+ft);if(me.length===1){var mr=me.charCodeAt(0);(ft==="utf8"&&mr<128||ft==="latin1")&&(me=mr)}}else typeof me=="number"&&(me&=255);if(Be<0||this.length<Be||this.length<lt)throw new RangeError("Out of range index");if(lt<=Be)return this;var gr;if(Be>>>=0,lt=lt===void 0?this.length:lt>>>0,me||(me=0),typeof me=="number")for(gr=Be;gr<lt;++gr)this[gr]=me;else{var oi=j.isBuffer(me)?me:j.from(me,ft),hi=oi.length;if(hi===0)throw new TypeError('The value "'+me+'" is invalid for argument "value"');for(gr=0;gr<lt-Be;++gr)this[gr+Be]=oi[gr%hi]}return this};var fr=/[^+/0-9A-Za-z-_]/g;function pr(me){if((me=(me=me.split("=")[0]).trim().replace(fr,"")).length<2)return"";for(;me.length%4!=0;)me+="=";return me}function Nt(me){return me<16?"0"+me.toString(16):me.toString(16)}function $e(me,Be){var lt;Be=Be||1/0;for(var ft=me.length,mr=null,gr=[],oi=0;oi<ft;++oi){if((lt=me.charCodeAt(oi))>55295&&lt<57344){if(!mr){if(lt>56319){(Be-=3)>-1&&gr.push(239,191,189);continue}if(oi+1===ft){(Be-=3)>-1&&gr.push(239,191,189);continue}mr=lt;continue}if(lt<56320){(Be-=3)>-1&&gr.push(239,191,189),mr=lt;continue}lt=65536+(mr-55296<<10|lt-56320)}else mr&&(Be-=3)>-1&&gr.push(239,191,189);if(mr=null,lt<128){if((Be-=1)<0)break;gr.push(lt)}else if(lt<2048){if((Be-=2)<0)break;gr.push(lt>>6|192,63&lt|128)}else if(lt<65536){if((Be-=3)<0)break;gr.push(lt>>12|224,lt>>6&63|128,63&lt|128)}else{if(!(lt<1114112))throw new Error("Invalid code point");if((Be-=4)<0)break;gr.push(lt>>18|240,lt>>12&63|128,lt>>6&63|128,63&lt|128)}}return gr}function At(me){for(var Be=[],lt=0;lt<me.length;++lt)Be.push(255&me.charCodeAt(lt));return Be}function Ge(me,Be){for(var lt,ft,mr,gr=[],oi=0;oi<me.length&&!((Be-=2)<0);++oi)ft=(lt=me.charCodeAt(oi))>>8,mr=lt%256,gr.push(mr),gr.push(ft);return gr}function st(me){return $.toByteArray(pr(me))}function Xe(me,Be,lt,ft){for(var mr=0;mr<ft&&!(mr+lt>=Be.length||mr>=me.length);++mr)Be[mr+lt]=me[mr];return mr}function gt(me,Be){return me instanceof Be||me!=null&&me.constructor!=null&&me.constructor.name!=null&&me.constructor.name===Be.name}function Qt(me){return me!=me}}).call(this)}).call(this,d("buffer").Buffer)},{"base64-js":28,buffer:32,ieee754:45}],33:[function(d,m,g){var w=d("get-intrinsic"),$=d("./"),I=$(w("String.prototype.indexOf"));m.exports=function(D,F){var U=w(D,!!F);return typeof U=="function"&&I(D,".prototype.")>-1?$(U):U}},{"./":34,"get-intrinsic":39}],34:[function(d,m,g){var w=d("function-bind"),$=d("get-intrinsic"),I=$("%Function.prototype.apply%"),D=$("%Function.prototype.call%"),F=$("%Reflect.apply%",!0)||w.call(D,I),U=$("%Object.getOwnPropertyDescriptor%",!0),j=$("%Object.defineProperty%",!0),G=$("%Math.max%");if(j)try{j({},"a",{value:1})}catch{j=null}m.exports=function(H){var q=F(w,D,arguments);return U&&j&&U(q,"length").configurable&&j(q,"length",{value:1+G(0,H.length-(arguments.length-1))}),q};var Z=function(){return F(w,I,arguments)};j?j(m.exports,"apply",{value:Z}):m.exports.apply=Z},{"function-bind":38,"get-intrinsic":39}],35:[function(d,m,g){var w,$=typeof Reflect=="object"?Reflect:null,I=$&&typeof $.apply=="function"?$.apply:function(de,ge,ce){return Function.prototype.apply.call(de,ge,ce)};function D(de){console&&console.warn&&console.warn(de)}w=$&&typeof $.ownKeys=="function"?$.ownKeys:Object.getOwnPropertySymbols?function(de){return Object.getOwnPropertyNames(de).concat(Object.getOwnPropertySymbols(de))}:function(de){return Object.getOwnPropertyNames(de)};var F=Number.isNaN||function(de){return de!=de};function U(){U.init.call(this)}m.exports=U,m.exports.once=ie,U.EventEmitter=U,U.prototype._events=void 0,U.prototype._eventsCount=0,U.prototype._maxListeners=void 0;var j=10;function G(de){if(typeof de!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof de)}function Z(de){return de._maxListeners===void 0?U.defaultMaxListeners:de._maxListeners}function H(de,ge,ce,Ie){var fe,Te,ut;if(G(ce),(Te=de._events)===void 0?(Te=de._events=Object.create(null),de._eventsCount=0):(Te.newListener!==void 0&&(de.emit("newListener",ge,ce.listener?ce.listener:ce),Te=de._events),ut=Te[ge]),ut===void 0)ut=Te[ge]=ce,++de._eventsCount;else if(typeof ut=="function"?ut=Te[ge]=Ie?[ce,ut]:[ut,ce]:Ie?ut.unshift(ce):ut.push(ce),(fe=Z(de))>0&&ut.length>fe&&!ut.warned){ut.warned=!0;var ze=new Error("Possible EventEmitter memory leak detected. "+ut.length+" "+String(ge)+" listeners added. Use emitter.setMaxListeners() to increase limit");ze.name="MaxListenersExceededWarning",ze.emitter=de,ze.type=ge,ze.count=ut.length,D(ze)}return de}function q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function V(de,ge,ce){var Ie={fired:!1,wrapFn:void 0,target:de,type:ge,listener:ce},fe=q.bind(Ie);return fe.listener=ce,Ie.wrapFn=fe,fe}function Q(de,ge,ce){var Ie=de._events;if(Ie===void 0)return[];var fe=Ie[ge];return fe===void 0?[]:typeof fe=="function"?ce?[fe.listener||fe]:[fe]:ce?se(fe):re(fe,fe.length)}function X(de){var ge=this._events;if(ge!==void 0){var ce=ge[de];if(typeof ce=="function")return 1;if(ce!==void 0)return ce.length}return 0}function re(de,ge){for(var ce=new Array(ge),Ie=0;Ie<ge;++Ie)ce[Ie]=de[Ie];return ce}function J(de,ge){for(;ge+1<de.length;ge++)de[ge]=de[ge+1];de.pop()}function se(de){for(var ge=new Array(de.length),ce=0;ce<ge.length;++ce)ge[ce]=de[ce].listener||de[ce];return ge}function ie(de,ge){return new Promise((function(ce,Ie){function fe(ut){de.removeListener(ge,Te),Ie(ut)}function Te(){typeof de.removeListener=="function"&&de.removeListener("error",fe),ce([].slice.call(arguments))}pe(de,ge,Te,{once:!0}),ge!=="error"&&oe(de,fe,{once:!0})}))}function oe(de,ge,ce){typeof de.on=="function"&&pe(de,"error",ge,ce)}function pe(de,ge,ce,Ie){if(typeof de.on=="function")Ie.once?de.once(ge,ce):de.on(ge,ce);else{if(typeof de.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof de);de.addEventListener(ge,(function fe(Te){Ie.once&&de.removeEventListener(ge,fe),ce(Te)}))}}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return j},set:function(de){if(typeof de!="number"||de<0||F(de))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+de+".");j=de}}),U.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(de){if(typeof de!="number"||de<0||F(de))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+de+".");return this._maxListeners=de,this},U.prototype.getMaxListeners=function(){return Z(this)},U.prototype.emit=function(de){for(var ge=[],ce=1;ce<arguments.length;ce++)ge.push(arguments[ce]);var Ie=de==="error",fe=this._events;if(fe!==void 0)Ie=Ie&&fe.error===void 0;else if(!Ie)return!1;if(Ie){var Te;if(ge.length>0&&(Te=ge[0]),Te instanceof Error)throw Te;var ut=new Error("Unhandled error."+(Te?" ("+Te.message+")":""));throw ut.context=Te,ut}var ze=fe[de];if(ze===void 0)return!1;if(typeof ze=="function")I(ze,this,ge);else{var Ce=ze.length,Fe=re(ze,Ce);for(ce=0;ce<Ce;++ce)I(Fe[ce],this,ge)}return!0},U.prototype.addListener=function(de,ge){return H(this,de,ge,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(de,ge){return H(this,de,ge,!0)},U.prototype.once=function(de,ge){return G(ge),this.on(de,V(this,de,ge)),this},U.prototype.prependOnceListener=function(de,ge){return G(ge),this.prependListener(de,V(this,de,ge)),this},U.prototype.removeListener=function(de,ge){var ce,Ie,fe,Te,ut;if(G(ge),(Ie=this._events)===void 0)return this;if((ce=Ie[de])===void 0)return this;if(ce===ge||ce.listener===ge)--this._eventsCount==0?this._events=Object.create(null):(delete Ie[de],Ie.removeListener&&this.emit("removeListener",de,ce.listener||ge));else if(typeof ce!="function"){for(fe=-1,Te=ce.length-1;Te>=0;Te--)if(ce[Te]===ge||ce[Te].listener===ge){ut=ce[Te].listener,fe=Te;break}if(fe<0)return this;fe===0?ce.shift():J(ce,fe),ce.length===1&&(Ie[de]=ce[0]),Ie.removeListener!==void 0&&this.emit("removeListener",de,ut||ge)}return this},U.prototype.off=U.prototype.removeListener,U.prototype.removeAllListeners=function(de){var ge,ce,Ie;if((ce=this._events)===void 0)return this;if(ce.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ce[de]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete ce[de]),this;if(arguments.length===0){var fe,Te=Object.keys(ce);for(Ie=0;Ie<Te.length;++Ie)(fe=Te[Ie])!=="removeListener"&&this.removeAllListeners(fe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(ge=ce[de])=="function")this.removeListener(de,ge);else if(ge!==void 0)for(Ie=ge.length-1;Ie>=0;Ie--)this.removeListener(de,ge[Ie]);return this},U.prototype.listeners=function(de){return Q(this,de,!0)},U.prototype.rawListeners=function(de){return Q(this,de,!1)},U.listenerCount=function(de,ge){return typeof de.listenerCount=="function"?de.listenerCount(ge):X.call(de,ge)},U.prototype.listenerCount=X,U.prototype.eventNames=function(){return this._eventsCount>0?w(this._events):[]}},{}],36:[function(d,m,g){var w=d("is-callable"),$=Object.prototype.toString,I=Object.prototype.hasOwnProperty,D=function(G,Z,H){for(var q=0,V=G.length;q<V;q++)I.call(G,q)&&(H==null?Z(G[q],q,G):Z.call(H,G[q],q,G))},F=function(G,Z,H){for(var q=0,V=G.length;q<V;q++)H==null?Z(G.charAt(q),q,G):Z.call(H,G.charAt(q),q,G)},U=function(G,Z,H){for(var q in G)I.call(G,q)&&(H==null?Z(G[q],q,G):Z.call(H,G[q],q,G))},j=function(G,Z,H){if(!w(Z))throw new TypeError("iterator must be a function");var q;arguments.length>=3&&(q=H),$.call(G)==="[object Array]"?D(G,Z,q):typeof G=="string"?F(G,Z,q):U(G,Z,q)};m.exports=j},{"is-callable":48}],37:[function(d,m,g){var w="Function.prototype.bind called on incompatible ",$=Array.prototype.slice,I=Object.prototype.toString,D="[object Function]";m.exports=function(F){var U=this;if(typeof U!="function"||I.call(U)!==D)throw new TypeError(w+U);for(var j,G=$.call(arguments,1),Z=function(){if(this instanceof j){var X=U.apply(this,G.concat($.call(arguments)));return Object(X)===X?X:this}return U.apply(F,G.concat($.call(arguments)))},H=Math.max(0,U.length-G.length),q=[],V=0;V<H;V++)q.push("$"+V);if(j=Function("binder","return function ("+q.join(",")+"){ return binder.apply(this,arguments); }")(Z),U.prototype){var Q=function(){};Q.prototype=U.prototype,j.prototype=new Q,Q.prototype=null}return j}},{}],38:[function(d,m,g){var w=d("./implementation");m.exports=Function.prototype.bind||w},{"./implementation":37}],39:[function(d,m,g){var w,$=SyntaxError,I=Function,D=TypeError,F=function(ze){try{return I('"use strict"; return ('+ze+").constructor;")()}catch{}},U=Object.getOwnPropertyDescriptor;if(U)try{U({},"")}catch{U=null}var j=function(){throw new D},G=U?(function(){try{return j}catch{try{return U(arguments,"callee").get}catch{return j}}})():j,Z=d("has-symbols")(),H=Object.getPrototypeOf||function(ze){return ze.__proto__},q={},V=typeof Uint8Array>"u"?w:H(Uint8Array),Q={"%AggregateError%":typeof AggregateError>"u"?w:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?w:ArrayBuffer,"%ArrayIteratorPrototype%":Z?H([][Symbol.iterator]()):w,"%AsyncFromSyncIteratorPrototype%":w,"%AsyncFunction%":q,"%AsyncGenerator%":q,"%AsyncGeneratorFunction%":q,"%AsyncIteratorPrototype%":q,"%Atomics%":typeof Atomics>"u"?w:Atomics,"%BigInt%":typeof BigInt>"u"?w:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?w:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?w:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?w:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?w:Float32Array,"%Float64Array%":typeof Float64Array>"u"?w:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?w:FinalizationRegistry,"%Function%":I,"%GeneratorFunction%":q,"%Int8Array%":typeof Int8Array>"u"?w:Int8Array,"%Int16Array%":typeof Int16Array>"u"?w:Int16Array,"%Int32Array%":typeof Int32Array>"u"?w:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Z?H(H([][Symbol.iterator]())):w,"%JSON%":typeof JSON=="object"?JSON:w,"%Map%":typeof Map>"u"?w:Map,"%MapIteratorPrototype%":typeof Map<"u"&&Z?H(new Map()[Symbol.iterator]()):w,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?w:Promise,"%Proxy%":typeof Proxy>"u"?w:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?w:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?w:Set,"%SetIteratorPrototype%":typeof Set<"u"&&Z?H(new Set()[Symbol.iterator]()):w,"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?w:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Z?H(""[Symbol.iterator]()):w,"%Symbol%":Z?Symbol:w,"%SyntaxError%":$,"%ThrowTypeError%":G,"%TypedArray%":V,"%TypeError%":D,"%Uint8Array%":typeof Uint8Array>"u"?w:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?w:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?w:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?w:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?w:WeakMap,"%WeakRef%":typeof WeakRef>"u"?w:WeakRef,"%WeakSet%":typeof WeakSet>"u"?w:WeakSet};try{null.error}catch(ze){var X=H(H(ze));Q["%Error.prototype%"]=X}var re=function ze(Ce){var Fe;if(Ce==="%AsyncFunction%")Fe=F("async function () {}");else if(Ce==="%GeneratorFunction%")Fe=F("function* () {}");else if(Ce==="%AsyncGeneratorFunction%")Fe=F("async function* () {}");else if(Ce==="%AsyncGenerator%"){var Et=ze("%AsyncGeneratorFunction%");Et&&(Fe=Et.prototype)}else if(Ce==="%AsyncIteratorPrototype%"){var bt=ze("%AsyncGenerator%");bt&&(Fe=H(bt.prototype))}return Q[Ce]=Fe,Fe},J={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},se=d("function-bind"),ie=d("has"),oe=se.call(Function.call,Array.prototype.concat),pe=se.call(Function.apply,Array.prototype.splice),de=se.call(Function.call,String.prototype.replace),ge=se.call(Function.call,String.prototype.slice),ce=se.call(Function.call,RegExp.prototype.exec),Ie=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,fe=/\\(\\)?/g,Te=function(ze){var Ce=ge(ze,0,1),Fe=ge(ze,-1);if(Ce==="%"&&Fe!=="%")throw new $("invalid intrinsic syntax, expected closing `%`");if(Fe==="%"&&Ce!=="%")throw new $("invalid intrinsic syntax, expected opening `%`");var Et=[];return de(ze,Ie,(function(bt,ht,Zt,Ye){Et[Et.length]=Zt?de(Ye,fe,"$1"):ht||bt})),Et},ut=function(ze,Ce){var Fe,Et=ze;if(ie(J,Et)&&(Et="%"+(Fe=J[Et])[0]+"%"),ie(Q,Et)){var bt=Q[Et];if(bt===q&&(bt=re(Et)),bt===void 0&&!Ce)throw new D("intrinsic "+ze+" exists, but is not available. Please file an issue!");return{alias:Fe,name:Et,value:bt}}throw new $("intrinsic "+ze+" does not exist!")};m.exports=function(ze,Ce){if(typeof ze!="string"||ze.length===0)throw new D("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Ce!="boolean")throw new D('"allowMissing" argument must be a boolean');if(ce(/^%?[^%]*%?$/,ze)===null)throw new $("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Fe=Te(ze),Et=Fe.length>0?Fe[0]:"",bt=ut("%"+Et+"%",Ce),ht=bt.name,Zt=bt.value,Ye=!1,_t=bt.alias;_t&&(Et=_t[0],pe(Fe,oe([0,1],_t)));for(var Vt=1,Lt=!0;Vt<Fe.length;Vt+=1){var dt=Fe[Vt],It=ge(dt,0,1),dr=ge(dt,-1);if((It==='"'||It==="'"||It==="`"||dr==='"'||dr==="'"||dr==="`")&&It!==dr)throw new $("property names with quotes must have matching quotes");if(dt!=="constructor"&&Lt||(Ye=!0),ie(Q,ht="%"+(Et+="."+dt)+"%"))Zt=Q[ht];else if(Zt!=null){if(!(dt in Zt)){if(!Ce)throw new D("base intrinsic for "+ze+" exists, but the property is not available.");return}if(U&&Vt+1>=Fe.length){var fr=U(Zt,dt);Zt=(Lt=!!fr)&&"get"in fr&&!("originalValue"in fr.get)?fr.get:Zt[dt]}else Lt=ie(Zt,dt),Zt=Zt[dt];Lt&&!Ye&&(Q[ht]=Zt)}}return Zt}},{"function-bind":38,has:44,"has-symbols":41}],40:[function(d,m,g){var w=d("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(w)try{w([],"length")}catch{w=null}m.exports=w},{"get-intrinsic":39}],41:[function(d,m,g){var w=typeof Symbol<"u"&&Symbol,$=d("./shams");m.exports=function(){return typeof w=="function"&&typeof Symbol=="function"&&typeof w("foo")=="symbol"&&typeof Symbol("bar")=="symbol"&&$()}},{"./shams":42}],42:[function(d,m,g){m.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var w={},$=Symbol("test"),I=Object($);if(typeof $=="string"||Object.prototype.toString.call($)!=="[object Symbol]"||Object.prototype.toString.call(I)!=="[object Symbol]")return!1;var D=42;for($ in w[$]=D,w)return!1;if(typeof Object.keys=="function"&&Object.keys(w).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(w).length!==0)return!1;var F=Object.getOwnPropertySymbols(w);if(F.length!==1||F[0]!==$||!Object.prototype.propertyIsEnumerable.call(w,$))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var U=Object.getOwnPropertyDescriptor(w,$);if(U.value!==D||U.enumerable!==!0)return!1}return!0}},{}],43:[function(d,m,g){var w=d("has-symbols/shams");m.exports=function(){return w()&&!!Symbol.toStringTag}},{"has-symbols/shams":42}],44:[function(d,m,g){var w=d("function-bind");m.exports=w.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":38}],45:[function(d,m,g){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */g.read=function(w,$,I,D,F){var U,j,G=8*F-D-1,Z=(1<<G)-1,H=Z>>1,q=-7,V=I?F-1:0,Q=I?-1:1,X=w[$+V];for(V+=Q,U=X&(1<<-q)-1,X>>=-q,q+=G;q>0;U=256*U+w[$+V],V+=Q,q-=8);for(j=U&(1<<-q)-1,U>>=-q,q+=D;q>0;j=256*j+w[$+V],V+=Q,q-=8);if(U===0)U=1-H;else{if(U===Z)return j?NaN:1/0*(X?-1:1);j+=Math.pow(2,D),U-=H}return(X?-1:1)*j*Math.pow(2,U-D)},g.write=function(w,$,I,D,F,U){var j,G,Z,H=8*U-F-1,q=(1<<H)-1,V=q>>1,Q=F===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=D?0:U-1,re=D?1:-1,J=$<0||$===0&&1/$<0?1:0;for($=Math.abs($),isNaN($)||$===1/0?(G=isNaN($)?1:0,j=q):(j=Math.floor(Math.log($)/Math.LN2),$*(Z=Math.pow(2,-j))<1&&(j--,Z*=2),($+=j+V>=1?Q/Z:Q*Math.pow(2,1-V))*Z>=2&&(j++,Z/=2),j+V>=q?(G=0,j=q):j+V>=1?(G=($*Z-1)*Math.pow(2,F),j+=V):(G=$*Math.pow(2,V-1)*Math.pow(2,F),j=0));F>=8;w[I+X]=255&G,X+=re,G/=256,F-=8);for(j=j<<F|G,H+=F;H>0;w[I+X]=255&j,X+=re,j/=256,H-=8);w[I+X-re]|=128*J}},{}],46:[function(d,m,g){typeof Object.create=="function"?m.exports=function(w,$){$&&(w.super_=$,w.prototype=Object.create($.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}))}:m.exports=function(w,$){if($){w.super_=$;var I=function(){};I.prototype=$.prototype,w.prototype=new I,w.prototype.constructor=w}}},{}],47:[function(d,m,g){var w=d("has-tostringtag/shams")(),$=d("call-bind/callBound")("Object.prototype.toString"),I=function(U){return!(w&&U&&typeof U=="object"&&Symbol.toStringTag in U)&&$(U)==="[object Arguments]"},D=function(U){return!!I(U)||U!==null&&typeof U=="object"&&typeof U.length=="number"&&U.length>=0&&$(U)!=="[object Array]"&&$(U.callee)==="[object Function]"},F=(function(){return I(arguments)})();I.isLegacyArguments=D,m.exports=F?I:D},{"call-bind/callBound":33,"has-tostringtag/shams":43}],48:[function(d,m,g){var w,$,I=Function.prototype.toString,D=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply;if(typeof D=="function"&&typeof Object.defineProperty=="function")try{w=Object.defineProperty({},"length",{get:function(){throw $}}),$={},D((function(){throw 42}),null,w)}catch(oe){oe!==$&&(D=null)}else D=null;var F=/^\s*class\b/,U=function(oe){try{var pe=I.call(oe);return F.test(pe)}catch{return!1}},j=function(oe){try{return!U(oe)&&(I.call(oe),!0)}catch{return!1}},G=Object.prototype.toString,Z="[object Object]",H="[object Function]",q="[object GeneratorFunction]",V="[object HTMLAllCollection]",Q="[object HTML document.all class]",X="[object HTMLCollection]",re=typeof Symbol=="function"&&!!Symbol.toStringTag,J=!(0 in[,]),se=function(){return!1};if(typeof document=="object"){var ie=document.all;G.call(ie)===G.call(document.all)&&(se=function(oe){if((J||!oe)&&(oe===void 0||typeof oe=="object"))try{var pe=G.call(oe);return(pe===V||pe===Q||pe===X||pe===Z)&&oe("")==null}catch{}return!1})}m.exports=D?function(oe){if(se(oe))return!0;if(!oe||typeof oe!="function"&&typeof oe!="object")return!1;try{D(oe,null,w)}catch(pe){if(pe!==$)return!1}return!U(oe)&&j(oe)}:function(oe){if(se(oe))return!0;if(!oe||typeof oe!="function"&&typeof oe!="object")return!1;if(re)return j(oe);if(U(oe))return!1;var pe=G.call(oe);return!(pe!==H&&pe!==q&&!/^\[object HTML/.test(pe))&&j(oe)}},{}],49:[function(d,m,g){var w,$=Object.prototype.toString,I=Function.prototype.toString,D=/^\s*(?:function)?\*/,F=d("has-tostringtag/shams")(),U=Object.getPrototypeOf,j=function(){if(!F)return!1;try{return Function("return function*() {}")()}catch{}};m.exports=function(G){if(typeof G!="function")return!1;if(D.test(I.call(G)))return!0;if(!F)return $.call(G)==="[object GeneratorFunction]";if(!U)return!1;if(w===void 0){var Z=j();w=!!Z&&U(Z)}return U(G)===w}},{"has-tostringtag/shams":43}],50:[function(d,m,g){(function(w){(function(){var $=d("for-each"),I=d("available-typed-arrays"),D=d("call-bind/callBound"),F=D("Object.prototype.toString"),U=d("has-tostringtag/shams")(),j=d("gopd"),G=typeof globalThis>"u"?w:globalThis,Z=I(),H=D("Array.prototype.indexOf",!0)||function(re,J){for(var se=0;se<re.length;se+=1)if(re[se]===J)return se;return-1},q=D("String.prototype.slice"),V={},Q=Object.getPrototypeOf;U&&j&&Q&&$(Z,(function(re){var J=new G[re];if(Symbol.toStringTag in J){var se=Q(J),ie=j(se,Symbol.toStringTag);if(!ie){var oe=Q(se);ie=j(oe,Symbol.toStringTag)}V[re]=ie.get}}));var X=function(re){var J=!1;return $(V,(function(se,ie){if(!J)try{J=se.call(re)===ie}catch{}})),J};m.exports=function(re){if(!re||typeof re!="object")return!1;if(!U||!(Symbol.toStringTag in re)){var J=q(F(re),8,-1);return H(Z,J)>-1}return!!j&&X(re)}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43}],51:[function(d,m,g){var w=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;function D(U){if(U==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(U)}function F(){try{if(!Object.assign)return!1;var U=new String("abc");if(U[5]="de",Object.getOwnPropertyNames(U)[0]==="5")return!1;for(var j={},G=0;G<10;G++)j["_"+String.fromCharCode(G)]=G;var Z=Object.getOwnPropertyNames(j).map((function(q){return j[q]}));if(Z.join("")!=="0123456789")return!1;var H={};return"abcdefghijklmnopqrst".split("").forEach((function(q){H[q]=q})),Object.keys(Object.assign({},H)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}m.exports=F()?Object.assign:function(U,j){for(var G,Z,H=D(U),q=1;q<arguments.length;q++){for(var V in G=Object(arguments[q]))$.call(G,V)&&(H[V]=G[V]);if(w){Z=w(G);for(var Q=0;Q<Z.length;Q++)I.call(G,Z[Q])&&(H[Z[Q]]=G[Z[Q]])}}return H}},{}],52:[function(d,m,g){var w=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function $(F,U){return Object.prototype.hasOwnProperty.call(F,U)}g.assign=function(F){for(var U=Array.prototype.slice.call(arguments,1);U.length;){var j=U.shift();if(j){if(typeof j!="object")throw new TypeError(j+"must be non-object");for(var G in j)$(j,G)&&(F[G]=j[G])}}return F},g.shrinkBuf=function(F,U){return F.length===U?F:F.subarray?F.subarray(0,U):(F.length=U,F)};var I={arraySet:function(F,U,j,G,Z){if(U.subarray&&F.subarray)F.set(U.subarray(j,j+G),Z);else for(var H=0;H<G;H++)F[Z+H]=U[j+H]},flattenChunks:function(F){var U,j,G,Z,H,q;for(G=0,U=0,j=F.length;U<j;U++)G+=F[U].length;for(q=new Uint8Array(G),Z=0,U=0,j=F.length;U<j;U++)H=F[U],q.set(H,Z),Z+=H.length;return q}},D={arraySet:function(F,U,j,G,Z){for(var H=0;H<G;H++)F[Z+H]=U[j+H]},flattenChunks:function(F){return[].concat.apply([],F)}};g.setTyped=function(F){F?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,I)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,D))},g.setTyped(w)},{}],53:[function(d,m,g){function w($,I,D,F){for(var U=65535&$,j=$>>>16&65535,G=0;D!==0;){D-=G=D>2e3?2e3:D;do j=j+(U=U+I[F++]|0)|0;while(--G);U%=65521,j%=65521}return U|j<<16}m.exports=w},{}],54:[function(d,m,g){m.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],55:[function(d,m,g){function w(){for(var D,F=[],U=0;U<256;U++){D=U;for(var j=0;j<8;j++)D=1&D?3988292384^D>>>1:D>>>1;F[U]=D}return F}var $=w();function I(D,F,U,j){var G=$,Z=j+U;D^=-1;for(var H=j;H<Z;H++)D=D>>>8^G[255&(D^F[H])];return~D}m.exports=I},{}],56:[function(d,m,g){var w,$=d("../utils/common"),I=d("./trees"),D=d("./adler32"),F=d("./crc32"),U=d("./messages"),j=0,G=1,Z=3,H=4,q=5,V=0,Q=1,X=-2,re=-3,J=-5,se=-1,ie=1,oe=2,pe=3,de=4,ge=0,ce=2,Ie=8,fe=9,Te=15,ut=8,ze=286,Ce=30,Fe=19,Et=2*ze+1,bt=15,ht=3,Zt=258,Ye=Zt+ht+1,_t=32,Vt=42,Lt=69,dt=73,It=91,dr=103,fr=113,pr=666,Nt=1,$e=2,At=3,Ge=4,st=3;function Xe(Oe,ii){return Oe.msg=U[ii],ii}function gt(Oe){return(Oe<<1)-(Oe>4?9:0)}function Qt(Oe){for(var ii=Oe.length;--ii>=0;)Oe[ii]=0}function me(Oe){var ii=Oe.state,br=ii.pending;br>Oe.avail_out&&(br=Oe.avail_out),br!==0&&($.arraySet(Oe.output,ii.pending_buf,ii.pending_out,br,Oe.next_out),Oe.next_out+=br,ii.pending_out+=br,Oe.total_out+=br,Oe.avail_out-=br,ii.pending-=br,ii.pending===0&&(ii.pending_out=0))}function Be(Oe,ii){I._tr_flush_block(Oe,Oe.block_start>=0?Oe.block_start:-1,Oe.strstart-Oe.block_start,ii),Oe.block_start=Oe.strstart,me(Oe.strm)}function lt(Oe,ii){Oe.pending_buf[Oe.pending++]=ii}function ft(Oe,ii){Oe.pending_buf[Oe.pending++]=ii>>>8&255,Oe.pending_buf[Oe.pending++]=255&ii}function mr(Oe,ii,br,hr){var yr=Oe.avail_in;return yr>hr&&(yr=hr),yr===0?0:(Oe.avail_in-=yr,$.arraySet(ii,Oe.input,Oe.next_in,yr,br),Oe.state.wrap===1?Oe.adler=D(Oe.adler,ii,yr,br):Oe.state.wrap===2&&(Oe.adler=F(Oe.adler,ii,yr,br)),Oe.next_in+=yr,Oe.total_in+=yr,yr)}function gr(Oe,ii){var br,hr,yr=Oe.max_chain_length,ti=Oe.strstart,vi=Oe.prev_length,mi=Oe.nice_match,yi=Oe.strstart>Oe.w_size-Ye?Oe.strstart-(Oe.w_size-Ye):0,Si=Oe.window,Li=Oe.w_mask,Ai=Oe.prev,Mi=Oe.strstart+Zt,Ri=Si[ti+vi-1],Oi=Si[ti+vi];Oe.prev_length>=Oe.good_match&&(yr>>=2),mi>Oe.lookahead&&(mi=Oe.lookahead);do if(Si[(br=ii)+vi]===Oi&&Si[br+vi-1]===Ri&&Si[br]===Si[ti]&&Si[++br]===Si[ti+1]){ti+=2,br++;do;while(Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&Si[++ti]===Si[++br]&&ti<Mi);if(hr=Zt-(Mi-ti),ti=Mi-Zt,hr>vi){if(Oe.match_start=ii,vi=hr,hr>=mi)break;Ri=Si[ti+vi-1],Oi=Si[ti+vi]}}while((ii=Ai[ii&Li])>yi&&--yr!=0);return vi<=Oe.lookahead?vi:Oe.lookahead}function oi(Oe){var ii,br,hr,yr,ti,vi=Oe.w_size;do{if(yr=Oe.window_size-Oe.lookahead-Oe.strstart,Oe.strstart>=vi+(vi-Ye)){$.arraySet(Oe.window,Oe.window,vi,vi,0),Oe.match_start-=vi,Oe.strstart-=vi,Oe.block_start-=vi,ii=br=Oe.hash_size;do hr=Oe.head[--ii],Oe.head[ii]=hr>=vi?hr-vi:0;while(--br);ii=br=vi;do hr=Oe.prev[--ii],Oe.prev[ii]=hr>=vi?hr-vi:0;while(--br);yr+=vi}if(Oe.strm.avail_in===0)break;if(br=mr(Oe.strm,Oe.window,Oe.strstart+Oe.lookahead,yr),Oe.lookahead+=br,Oe.lookahead+Oe.insert>=ht)for(ti=Oe.strstart-Oe.insert,Oe.ins_h=Oe.window[ti],Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[ti+1])&Oe.hash_mask;Oe.insert&&(Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[ti+ht-1])&Oe.hash_mask,Oe.prev[ti&Oe.w_mask]=Oe.head[Oe.ins_h],Oe.head[Oe.ins_h]=ti,ti++,Oe.insert--,!(Oe.lookahead+Oe.insert<ht)););}while(Oe.lookahead<Ye&&Oe.strm.avail_in!==0)}function hi(Oe,ii){var br=65535;for(br>Oe.pending_buf_size-5&&(br=Oe.pending_buf_size-5);;){if(Oe.lookahead<=1){if(oi(Oe),Oe.lookahead===0&&ii===j)return Nt;if(Oe.lookahead===0)break}Oe.strstart+=Oe.lookahead,Oe.lookahead=0;var hr=Oe.block_start+br;if((Oe.strstart===0||Oe.strstart>=hr)&&(Oe.lookahead=Oe.strstart-hr,Oe.strstart=hr,Be(Oe,!1),Oe.strm.avail_out===0)||Oe.strstart-Oe.block_start>=Oe.w_size-Ye&&(Be(Oe,!1),Oe.strm.avail_out===0))return Nt}return Oe.insert=0,ii===H?(Be(Oe,!0),Oe.strm.avail_out===0?At:Ge):(Oe.strstart>Oe.block_start&&(Be(Oe,!1),Oe.strm.avail_out),Nt)}function ai(Oe,ii){for(var br,hr;;){if(Oe.lookahead<Ye){if(oi(Oe),Oe.lookahead<Ye&&ii===j)return Nt;if(Oe.lookahead===0)break}if(br=0,Oe.lookahead>=ht&&(Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[Oe.strstart+ht-1])&Oe.hash_mask,br=Oe.prev[Oe.strstart&Oe.w_mask]=Oe.head[Oe.ins_h],Oe.head[Oe.ins_h]=Oe.strstart),br!==0&&Oe.strstart-br<=Oe.w_size-Ye&&(Oe.match_length=gr(Oe,br)),Oe.match_length>=ht)if(hr=I._tr_tally(Oe,Oe.strstart-Oe.match_start,Oe.match_length-ht),Oe.lookahead-=Oe.match_length,Oe.match_length<=Oe.max_lazy_match&&Oe.lookahead>=ht){Oe.match_length--;do Oe.strstart++,Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[Oe.strstart+ht-1])&Oe.hash_mask,br=Oe.prev[Oe.strstart&Oe.w_mask]=Oe.head[Oe.ins_h],Oe.head[Oe.ins_h]=Oe.strstart;while(--Oe.match_length!=0);Oe.strstart++}else Oe.strstart+=Oe.match_length,Oe.match_length=0,Oe.ins_h=Oe.window[Oe.strstart],Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[Oe.strstart+1])&Oe.hash_mask;else hr=I._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++;if(hr&&(Be(Oe,!1),Oe.strm.avail_out===0))return Nt}return Oe.insert=Oe.strstart<ht-1?Oe.strstart:ht-1,ii===H?(Be(Oe,!0),Oe.strm.avail_out===0?At:Ge):Oe.last_lit&&(Be(Oe,!1),Oe.strm.avail_out===0)?Nt:$e}function fi(Oe,ii){for(var br,hr,yr;;){if(Oe.lookahead<Ye){if(oi(Oe),Oe.lookahead<Ye&&ii===j)return Nt;if(Oe.lookahead===0)break}if(br=0,Oe.lookahead>=ht&&(Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[Oe.strstart+ht-1])&Oe.hash_mask,br=Oe.prev[Oe.strstart&Oe.w_mask]=Oe.head[Oe.ins_h],Oe.head[Oe.ins_h]=Oe.strstart),Oe.prev_length=Oe.match_length,Oe.prev_match=Oe.match_start,Oe.match_length=ht-1,br!==0&&Oe.prev_length<Oe.max_lazy_match&&Oe.strstart-br<=Oe.w_size-Ye&&(Oe.match_length=gr(Oe,br),Oe.match_length<=5&&(Oe.strategy===ie||Oe.match_length===ht&&Oe.strstart-Oe.match_start>4096)&&(Oe.match_length=ht-1)),Oe.prev_length>=ht&&Oe.match_length<=Oe.prev_length){yr=Oe.strstart+Oe.lookahead-ht,hr=I._tr_tally(Oe,Oe.strstart-1-Oe.prev_match,Oe.prev_length-ht),Oe.lookahead-=Oe.prev_length-1,Oe.prev_length-=2;do++Oe.strstart<=yr&&(Oe.ins_h=(Oe.ins_h<<Oe.hash_shift^Oe.window[Oe.strstart+ht-1])&Oe.hash_mask,br=Oe.prev[Oe.strstart&Oe.w_mask]=Oe.head[Oe.ins_h],Oe.head[Oe.ins_h]=Oe.strstart);while(--Oe.prev_length!=0);if(Oe.match_available=0,Oe.match_length=ht-1,Oe.strstart++,hr&&(Be(Oe,!1),Oe.strm.avail_out===0))return Nt}else if(Oe.match_available){if((hr=I._tr_tally(Oe,0,Oe.window[Oe.strstart-1]))&&Be(Oe,!1),Oe.strstart++,Oe.lookahead--,Oe.strm.avail_out===0)return Nt}else Oe.match_available=1,Oe.strstart++,Oe.lookahead--}return Oe.match_available&&(hr=I._tr_tally(Oe,0,Oe.window[Oe.strstart-1]),Oe.match_available=0),Oe.insert=Oe.strstart<ht-1?Oe.strstart:ht-1,ii===H?(Be(Oe,!0),Oe.strm.avail_out===0?At:Ge):Oe.last_lit&&(Be(Oe,!1),Oe.strm.avail_out===0)?Nt:$e}function ui(Oe,ii){for(var br,hr,yr,ti,vi=Oe.window;;){if(Oe.lookahead<=Zt){if(oi(Oe),Oe.lookahead<=Zt&&ii===j)return Nt;if(Oe.lookahead===0)break}if(Oe.match_length=0,Oe.lookahead>=ht&&Oe.strstart>0&&(hr=vi[yr=Oe.strstart-1])===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]){ti=Oe.strstart+Zt;do;while(hr===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]&&hr===vi[++yr]&&yr<ti);Oe.match_length=Zt-(ti-yr),Oe.match_length>Oe.lookahead&&(Oe.match_length=Oe.lookahead)}if(Oe.match_length>=ht?(br=I._tr_tally(Oe,1,Oe.match_length-ht),Oe.lookahead-=Oe.match_length,Oe.strstart+=Oe.match_length,Oe.match_length=0):(br=I._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++),br&&(Be(Oe,!1),Oe.strm.avail_out===0))return Nt}return Oe.insert=0,ii===H?(Be(Oe,!0),Oe.strm.avail_out===0?At:Ge):Oe.last_lit&&(Be(Oe,!1),Oe.strm.avail_out===0)?Nt:$e}function wi(Oe,ii){for(var br;;){if(Oe.lookahead===0&&(oi(Oe),Oe.lookahead===0)){if(ii===j)return Nt;break}if(Oe.match_length=0,br=I._tr_tally(Oe,0,Oe.window[Oe.strstart]),Oe.lookahead--,Oe.strstart++,br&&(Be(Oe,!1),Oe.strm.avail_out===0))return Nt}return Oe.insert=0,ii===H?(Be(Oe,!0),Oe.strm.avail_out===0?At:Ge):Oe.last_lit&&(Be(Oe,!1),Oe.strm.avail_out===0)?Nt:$e}function _i(Oe,ii,br,hr,yr){this.good_length=Oe,this.max_lazy=ii,this.nice_length=br,this.max_chain=hr,this.func=yr}function bi(Oe){Oe.window_size=2*Oe.w_size,Qt(Oe.head),Oe.max_lazy_match=w[Oe.level].max_lazy,Oe.good_match=w[Oe.level].good_length,Oe.nice_match=w[Oe.level].nice_length,Oe.max_chain_length=w[Oe.level].max_chain,Oe.strstart=0,Oe.block_start=0,Oe.lookahead=0,Oe.insert=0,Oe.match_length=Oe.prev_length=ht-1,Oe.match_available=0,Oe.ins_h=0}function Ei(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ie,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new $.Buf16(2*Et),this.dyn_dtree=new $.Buf16(2*(2*Ce+1)),this.bl_tree=new $.Buf16(2*(2*Fe+1)),Qt(this.dyn_ltree),Qt(this.dyn_dtree),Qt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new $.Buf16(bt+1),this.heap=new $.Buf16(2*ze+1),Qt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new $.Buf16(2*ze+1),Qt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gi(Oe){var ii;return Oe&&Oe.state?(Oe.total_in=Oe.total_out=0,Oe.data_type=ce,(ii=Oe.state).pending=0,ii.pending_out=0,ii.wrap<0&&(ii.wrap=-ii.wrap),ii.status=ii.wrap?Vt:fr,Oe.adler=ii.wrap===2?0:1,ii.last_flush=j,I._tr_init(ii),V):Xe(Oe,X)}function Yt(Oe){var ii=gi(Oe);return ii===V&&bi(Oe.state),ii}function di(Oe,ii){return Oe&&Oe.state?Oe.state.wrap!==2?X:(Oe.state.gzhead=ii,V):X}function _r(Oe,ii,br,hr,yr,ti){if(!Oe)return X;var vi=1;if(ii===se&&(ii=6),hr<0?(vi=0,hr=-hr):hr>15&&(vi=2,hr-=16),yr<1||yr>fe||br!==Ie||hr<8||hr>15||ii<0||ii>9||ti<0||ti>de)return Xe(Oe,X);hr===8&&(hr=9);var mi=new Ei;return Oe.state=mi,mi.strm=Oe,mi.wrap=vi,mi.gzhead=null,mi.w_bits=hr,mi.w_size=1<<mi.w_bits,mi.w_mask=mi.w_size-1,mi.hash_bits=yr+7,mi.hash_size=1<<mi.hash_bits,mi.hash_mask=mi.hash_size-1,mi.hash_shift=~~((mi.hash_bits+ht-1)/ht),mi.window=new $.Buf8(2*mi.w_size),mi.head=new $.Buf16(mi.hash_size),mi.prev=new $.Buf16(mi.w_size),mi.lit_bufsize=1<<yr+6,mi.pending_buf_size=4*mi.lit_bufsize,mi.pending_buf=new $.Buf8(mi.pending_buf_size),mi.d_buf=1*mi.lit_bufsize,mi.l_buf=3*mi.lit_bufsize,mi.level=ii,mi.strategy=ti,mi.method=br,Yt(Oe)}function ri(Oe,ii){return _r(Oe,ii,Ie,Te,ut,ge)}function yt(Oe,ii){var br,hr,yr,ti;if(!Oe||!Oe.state||ii>q||ii<0)return Oe?Xe(Oe,X):X;if(hr=Oe.state,!Oe.output||!Oe.input&&Oe.avail_in!==0||hr.status===pr&&ii!==H)return Xe(Oe,Oe.avail_out===0?J:X);if(hr.strm=Oe,br=hr.last_flush,hr.last_flush=ii,hr.status===Vt)if(hr.wrap===2)Oe.adler=0,lt(hr,31),lt(hr,139),lt(hr,8),hr.gzhead?(lt(hr,(hr.gzhead.text?1:0)+(hr.gzhead.hcrc?2:0)+(hr.gzhead.extra?4:0)+(hr.gzhead.name?8:0)+(hr.gzhead.comment?16:0)),lt(hr,255&hr.gzhead.time),lt(hr,hr.gzhead.time>>8&255),lt(hr,hr.gzhead.time>>16&255),lt(hr,hr.gzhead.time>>24&255),lt(hr,hr.level===9?2:hr.strategy>=oe||hr.level<2?4:0),lt(hr,255&hr.gzhead.os),hr.gzhead.extra&&hr.gzhead.extra.length&&(lt(hr,255&hr.gzhead.extra.length),lt(hr,hr.gzhead.extra.length>>8&255)),hr.gzhead.hcrc&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending,0)),hr.gzindex=0,hr.status=Lt):(lt(hr,0),lt(hr,0),lt(hr,0),lt(hr,0),lt(hr,0),lt(hr,hr.level===9?2:hr.strategy>=oe||hr.level<2?4:0),lt(hr,st),hr.status=fr);else{var vi=Ie+(hr.w_bits-8<<4)<<8;vi|=(hr.strategy>=oe||hr.level<2?0:hr.level<6?1:hr.level===6?2:3)<<6,hr.strstart!==0&&(vi|=_t),vi+=31-vi%31,hr.status=fr,ft(hr,vi),hr.strstart!==0&&(ft(hr,Oe.adler>>>16),ft(hr,65535&Oe.adler)),Oe.adler=1}if(hr.status===Lt)if(hr.gzhead.extra){for(yr=hr.pending;hr.gzindex<(65535&hr.gzhead.extra.length)&&(hr.pending!==hr.pending_buf_size||(hr.gzhead.hcrc&&hr.pending>yr&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending-yr,yr)),me(Oe),yr=hr.pending,hr.pending!==hr.pending_buf_size));)lt(hr,255&hr.gzhead.extra[hr.gzindex]),hr.gzindex++;hr.gzhead.hcrc&&hr.pending>yr&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending-yr,yr)),hr.gzindex===hr.gzhead.extra.length&&(hr.gzindex=0,hr.status=dt)}else hr.status=dt;if(hr.status===dt)if(hr.gzhead.name){yr=hr.pending;do{if(hr.pending===hr.pending_buf_size&&(hr.gzhead.hcrc&&hr.pending>yr&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending-yr,yr)),me(Oe),yr=hr.pending,hr.pending===hr.pending_buf_size)){ti=1;break}ti=hr.gzindex<hr.gzhead.name.length?255&hr.gzhead.name.charCodeAt(hr.gzindex++):0,lt(hr,ti)}while(ti!==0);hr.gzhead.hcrc&&hr.pending>yr&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending-yr,yr)),ti===0&&(hr.gzindex=0,hr.status=It)}else hr.status=It;if(hr.status===It)if(hr.gzhead.comment){yr=hr.pending;do{if(hr.pending===hr.pending_buf_size&&(hr.gzhead.hcrc&&hr.pending>yr&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending-yr,yr)),me(Oe),yr=hr.pending,hr.pending===hr.pending_buf_size)){ti=1;break}ti=hr.gzindex<hr.gzhead.comment.length?255&hr.gzhead.comment.charCodeAt(hr.gzindex++):0,lt(hr,ti)}while(ti!==0);hr.gzhead.hcrc&&hr.pending>yr&&(Oe.adler=F(Oe.adler,hr.pending_buf,hr.pending-yr,yr)),ti===0&&(hr.status=dr)}else hr.status=dr;if(hr.status===dr&&(hr.gzhead.hcrc?(hr.pending+2>hr.pending_buf_size&&me(Oe),hr.pending+2<=hr.pending_buf_size&&(lt(hr,255&Oe.adler),lt(hr,Oe.adler>>8&255),Oe.adler=0,hr.status=fr)):hr.status=fr),hr.pending!==0){if(me(Oe),Oe.avail_out===0)return hr.last_flush=-1,V}else if(Oe.avail_in===0&&gt(ii)<=gt(br)&&ii!==H)return Xe(Oe,J);if(hr.status===pr&&Oe.avail_in!==0)return Xe(Oe,J);if(Oe.avail_in!==0||hr.lookahead!==0||ii!==j&&hr.status!==pr){var mi=hr.strategy===oe?wi(hr,ii):hr.strategy===pe?ui(hr,ii):w[hr.level].func(hr,ii);if(mi!==At&&mi!==Ge||(hr.status=pr),mi===Nt||mi===At)return Oe.avail_out===0&&(hr.last_flush=-1),V;if(mi===$e&&(ii===G?I._tr_align(hr):ii!==q&&(I._tr_stored_block(hr,0,0,!1),ii===Z&&(Qt(hr.head),hr.lookahead===0&&(hr.strstart=0,hr.block_start=0,hr.insert=0))),me(Oe),Oe.avail_out===0))return hr.last_flush=-1,V}return ii!==H?V:hr.wrap<=0?Q:(hr.wrap===2?(lt(hr,255&Oe.adler),lt(hr,Oe.adler>>8&255),lt(hr,Oe.adler>>16&255),lt(hr,Oe.adler>>24&255),lt(hr,255&Oe.total_in),lt(hr,Oe.total_in>>8&255),lt(hr,Oe.total_in>>16&255),lt(hr,Oe.total_in>>24&255)):(ft(hr,Oe.adler>>>16),ft(hr,65535&Oe.adler)),me(Oe),hr.wrap>0&&(hr.wrap=-hr.wrap),hr.pending!==0?V:Q)}function ni(Oe){var ii;return Oe&&Oe.state?(ii=Oe.state.status)!==Vt&&ii!==Lt&&ii!==dt&&ii!==It&&ii!==dr&&ii!==fr&&ii!==pr?Xe(Oe,X):(Oe.state=null,ii===fr?Xe(Oe,re):V):X}function $i(Oe,ii){var br,hr,yr,ti,vi,mi,yi,Si,Li=ii.length;if(!Oe||!Oe.state||(ti=(br=Oe.state).wrap)===2||ti===1&&br.status!==Vt||br.lookahead)return X;for(ti===1&&(Oe.adler=D(Oe.adler,ii,Li,0)),br.wrap=0,Li>=br.w_size&&(ti===0&&(Qt(br.head),br.strstart=0,br.block_start=0,br.insert=0),Si=new $.Buf8(br.w_size),$.arraySet(Si,ii,Li-br.w_size,br.w_size,0),ii=Si,Li=br.w_size),vi=Oe.avail_in,mi=Oe.next_in,yi=Oe.input,Oe.avail_in=Li,Oe.next_in=0,Oe.input=ii,oi(br);br.lookahead>=ht;){hr=br.strstart,yr=br.lookahead-(ht-1);do br.ins_h=(br.ins_h<<br.hash_shift^br.window[hr+ht-1])&br.hash_mask,br.prev[hr&br.w_mask]=br.head[br.ins_h],br.head[br.ins_h]=hr,hr++;while(--yr);br.strstart=hr,br.lookahead=ht-1,oi(br)}return br.strstart+=br.lookahead,br.block_start=br.strstart,br.insert=br.lookahead,br.lookahead=0,br.match_length=br.prev_length=ht-1,br.match_available=0,Oe.next_in=mi,Oe.input=yi,Oe.avail_in=vi,br.wrap=ti,V}w=[new _i(0,0,0,0,hi),new _i(4,4,8,4,ai),new _i(4,5,16,8,ai),new _i(4,6,32,32,ai),new _i(4,4,16,16,fi),new _i(8,16,32,32,fi),new _i(8,16,128,128,fi),new _i(8,32,128,256,fi),new _i(32,128,258,1024,fi),new _i(32,258,258,4096,fi)],g.deflateInit=ri,g.deflateInit2=_r,g.deflateReset=Yt,g.deflateResetKeep=gi,g.deflateSetHeader=di,g.deflate=yt,g.deflateEnd=ni,g.deflateSetDictionary=$i,g.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./messages":60,"./trees":61}],57:[function(d,m,g){var w=30,$=12;m.exports=function(I,D){var F,U,j,G,Z,H,q,V,Q,X,re,J,se,ie,oe,pe,de,ge,ce,Ie,fe,Te,ut,ze,Ce;F=I.state,U=I.next_in,ze=I.input,j=U+(I.avail_in-5),G=I.next_out,Ce=I.output,Z=G-(D-I.avail_out),H=G+(I.avail_out-257),q=F.dmax,V=F.wsize,Q=F.whave,X=F.wnext,re=F.window,J=F.hold,se=F.bits,ie=F.lencode,oe=F.distcode,pe=(1<<F.lenbits)-1,de=(1<<F.distbits)-1;e:do{se<15&&(J+=ze[U++]<<se,se+=8,J+=ze[U++]<<se,se+=8),ge=ie[J&pe];t:for(;;){if(J>>>=ce=ge>>>24,se-=ce,(ce=ge>>>16&255)==0)Ce[G++]=65535&ge;else{if(!(16&ce)){if(64&ce){if(32&ce){F.mode=$;break e}I.msg="invalid literal/length code",F.mode=w;break e}ge=ie[(65535&ge)+(J&(1<<ce)-1)];continue t}for(Ie=65535&ge,(ce&=15)&&(se<ce&&(J+=ze[U++]<<se,se+=8),Ie+=J&(1<<ce)-1,J>>>=ce,se-=ce),se<15&&(J+=ze[U++]<<se,se+=8,J+=ze[U++]<<se,se+=8),ge=oe[J&de];;){if(J>>>=ce=ge>>>24,se-=ce,16&(ce=ge>>>16&255)){if(fe=65535&ge,se<(ce&=15)&&(J+=ze[U++]<<se,(se+=8)<ce&&(J+=ze[U++]<<se,se+=8)),(fe+=J&(1<<ce)-1)>q){I.msg="invalid distance too far back",F.mode=w;break e}if(J>>>=ce,se-=ce,fe>(ce=G-Z)){if((ce=fe-ce)>Q&&F.sane){I.msg="invalid distance too far back",F.mode=w;break e}if(Te=0,ut=re,X===0){if(Te+=V-ce,ce<Ie){Ie-=ce;do Ce[G++]=re[Te++];while(--ce);Te=G-fe,ut=Ce}}else if(X<ce){if(Te+=V+X-ce,(ce-=X)<Ie){Ie-=ce;do Ce[G++]=re[Te++];while(--ce);if(Te=0,X<Ie){Ie-=ce=X;do Ce[G++]=re[Te++];while(--ce);Te=G-fe,ut=Ce}}}else if(Te+=X-ce,ce<Ie){Ie-=ce;do Ce[G++]=re[Te++];while(--ce);Te=G-fe,ut=Ce}for(;Ie>2;)Ce[G++]=ut[Te++],Ce[G++]=ut[Te++],Ce[G++]=ut[Te++],Ie-=3;Ie&&(Ce[G++]=ut[Te++],Ie>1&&(Ce[G++]=ut[Te++]))}else{Te=G-fe;do Ce[G++]=Ce[Te++],Ce[G++]=Ce[Te++],Ce[G++]=Ce[Te++],Ie-=3;while(Ie>2);Ie&&(Ce[G++]=Ce[Te++],Ie>1&&(Ce[G++]=Ce[Te++]))}break}if(64&ce){I.msg="invalid distance code",F.mode=w;break e}ge=oe[(65535&ge)+(J&(1<<ce)-1)]}}break}}while(U<j&&G<H);U-=Ie=se>>3,J&=(1<<(se-=Ie<<3))-1,I.next_in=U,I.next_out=G,I.avail_in=U<j?j-U+5:5-(U-j),I.avail_out=G<H?H-G+257:257-(G-H),F.hold=J,F.bits=se}},{}],58:[function(d,m,g){var w=d("../utils/common"),$=d("./adler32"),I=d("./crc32"),D=d("./inffast"),F=d("./inftrees"),U=0,j=1,G=2,Z=4,H=5,q=6,V=0,Q=1,X=2,re=-2,J=-3,se=-4,ie=-5,oe=8,pe=1,de=2,ge=3,ce=4,Ie=5,fe=6,Te=7,ut=8,ze=9,Ce=10,Fe=11,Et=12,bt=13,ht=14,Zt=15,Ye=16,_t=17,Vt=18,Lt=19,dt=20,It=21,dr=22,fr=23,pr=24,Nt=25,$e=26,At=27,Ge=28,st=29,Xe=30,gt=31,Qt=852,me=592,Be=15;function lt(_r){return(_r>>>24&255)+(_r>>>8&65280)+((65280&_r)<<8)+((255&_r)<<24)}function ft(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new w.Buf16(320),this.work=new w.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function mr(_r){var ri;return _r&&_r.state?(ri=_r.state,_r.total_in=_r.total_out=ri.total=0,_r.msg="",ri.wrap&&(_r.adler=1&ri.wrap),ri.mode=pe,ri.last=0,ri.havedict=0,ri.dmax=32768,ri.head=null,ri.hold=0,ri.bits=0,ri.lencode=ri.lendyn=new w.Buf32(Qt),ri.distcode=ri.distdyn=new w.Buf32(me),ri.sane=1,ri.back=-1,V):re}function gr(_r){var ri;return _r&&_r.state?((ri=_r.state).wsize=0,ri.whave=0,ri.wnext=0,mr(_r)):re}function oi(_r,ri){var yt,ni;return _r&&_r.state?(ni=_r.state,ri<0?(yt=0,ri=-ri):(yt=1+(ri>>4),ri<48&&(ri&=15)),ri&&(ri<8||ri>15)?re:(ni.window!==null&&ni.wbits!==ri&&(ni.window=null),ni.wrap=yt,ni.wbits=ri,gr(_r))):re}function hi(_r,ri){var yt,ni;return _r?(ni=new ft,_r.state=ni,ni.window=null,(yt=oi(_r,ri))!==V&&(_r.state=null),yt):re}function ai(_r){return hi(_r,Be)}var fi,ui,wi=!0;function _i(_r){if(wi){var ri;for(fi=new w.Buf32(512),ui=new w.Buf32(32),ri=0;ri<144;)_r.lens[ri++]=8;for(;ri<256;)_r.lens[ri++]=9;for(;ri<280;)_r.lens[ri++]=7;for(;ri<288;)_r.lens[ri++]=8;for(F(j,_r.lens,0,288,fi,0,_r.work,{bits:9}),ri=0;ri<32;)_r.lens[ri++]=5;F(G,_r.lens,0,32,ui,0,_r.work,{bits:5}),wi=!1}_r.lencode=fi,_r.lenbits=9,_r.distcode=ui,_r.distbits=5}function bi(_r,ri,yt,ni){var $i,Oe=_r.state;return Oe.window===null&&(Oe.wsize=1<<Oe.wbits,Oe.wnext=0,Oe.whave=0,Oe.window=new w.Buf8(Oe.wsize)),ni>=Oe.wsize?(w.arraySet(Oe.window,ri,yt-Oe.wsize,Oe.wsize,0),Oe.wnext=0,Oe.whave=Oe.wsize):(($i=Oe.wsize-Oe.wnext)>ni&&($i=ni),w.arraySet(Oe.window,ri,yt-ni,$i,Oe.wnext),(ni-=$i)?(w.arraySet(Oe.window,ri,yt-ni,ni,0),Oe.wnext=ni,Oe.whave=Oe.wsize):(Oe.wnext+=$i,Oe.wnext===Oe.wsize&&(Oe.wnext=0),Oe.whave<Oe.wsize&&(Oe.whave+=$i))),0}function Ei(_r,ri){var yt,ni,$i,Oe,ii,br,hr,yr,ti,vi,mi,yi,Si,Li,Ai,Mi,Ri,Oi,Hi,qi,Bi,zi,Ui,Di,Pi=0,Ci=new w.Buf8(4),Ki=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_r||!_r.state||!_r.output||!_r.input&&_r.avail_in!==0)return re;(yt=_r.state).mode===Et&&(yt.mode=bt),ii=_r.next_out,$i=_r.output,hr=_r.avail_out,Oe=_r.next_in,ni=_r.input,br=_r.avail_in,yr=yt.hold,ti=yt.bits,vi=br,mi=hr,zi=V;e:for(;;)switch(yt.mode){case pe:if(yt.wrap===0){yt.mode=bt;break}for(;ti<16;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(2&yt.wrap&&yr===35615){yt.check=0,Ci[0]=255&yr,Ci[1]=yr>>>8&255,yt.check=I(yt.check,Ci,2,0),yr=0,ti=0,yt.mode=de;break}if(yt.flags=0,yt.head&&(yt.head.done=!1),!(1&yt.wrap)||(((255&yr)<<8)+(yr>>8))%31){_r.msg="incorrect header check",yt.mode=Xe;break}if((15&yr)!==oe){_r.msg="unknown compression method",yt.mode=Xe;break}if(ti-=4,Bi=8+(15&(yr>>>=4)),yt.wbits===0)yt.wbits=Bi;else if(Bi>yt.wbits){_r.msg="invalid window size",yt.mode=Xe;break}yt.dmax=1<<Bi,_r.adler=yt.check=1,yt.mode=512&yr?Ce:Et,yr=0,ti=0;break;case de:for(;ti<16;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(yt.flags=yr,(255&yt.flags)!==oe){_r.msg="unknown compression method",yt.mode=Xe;break}if(57344&yt.flags){_r.msg="unknown header flags set",yt.mode=Xe;break}yt.head&&(yt.head.text=yr>>8&1),512&yt.flags&&(Ci[0]=255&yr,Ci[1]=yr>>>8&255,yt.check=I(yt.check,Ci,2,0)),yr=0,ti=0,yt.mode=ge;case ge:for(;ti<32;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yt.head&&(yt.head.time=yr),512&yt.flags&&(Ci[0]=255&yr,Ci[1]=yr>>>8&255,Ci[2]=yr>>>16&255,Ci[3]=yr>>>24&255,yt.check=I(yt.check,Ci,4,0)),yr=0,ti=0,yt.mode=ce;case ce:for(;ti<16;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yt.head&&(yt.head.xflags=255&yr,yt.head.os=yr>>8),512&yt.flags&&(Ci[0]=255&yr,Ci[1]=yr>>>8&255,yt.check=I(yt.check,Ci,2,0)),yr=0,ti=0,yt.mode=Ie;case Ie:if(1024&yt.flags){for(;ti<16;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yt.length=yr,yt.head&&(yt.head.extra_len=yr),512&yt.flags&&(Ci[0]=255&yr,Ci[1]=yr>>>8&255,yt.check=I(yt.check,Ci,2,0)),yr=0,ti=0}else yt.head&&(yt.head.extra=null);yt.mode=fe;case fe:if(1024&yt.flags&&((yi=yt.length)>br&&(yi=br),yi&&(yt.head&&(Bi=yt.head.extra_len-yt.length,yt.head.extra||(yt.head.extra=new Array(yt.head.extra_len)),w.arraySet(yt.head.extra,ni,Oe,yi,Bi)),512&yt.flags&&(yt.check=I(yt.check,ni,yi,Oe)),br-=yi,Oe+=yi,yt.length-=yi),yt.length))break e;yt.length=0,yt.mode=Te;case Te:if(2048&yt.flags){if(br===0)break e;yi=0;do Bi=ni[Oe+yi++],yt.head&&Bi&&yt.length<65536&&(yt.head.name+=String.fromCharCode(Bi));while(Bi&&yi<br);if(512&yt.flags&&(yt.check=I(yt.check,ni,yi,Oe)),br-=yi,Oe+=yi,Bi)break e}else yt.head&&(yt.head.name=null);yt.length=0,yt.mode=ut;case ut:if(4096&yt.flags){if(br===0)break e;yi=0;do Bi=ni[Oe+yi++],yt.head&&Bi&&yt.length<65536&&(yt.head.comment+=String.fromCharCode(Bi));while(Bi&&yi<br);if(512&yt.flags&&(yt.check=I(yt.check,ni,yi,Oe)),br-=yi,Oe+=yi,Bi)break e}else yt.head&&(yt.head.comment=null);yt.mode=ze;case ze:if(512&yt.flags){for(;ti<16;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(yr!==(65535&yt.check)){_r.msg="header crc mismatch",yt.mode=Xe;break}yr=0,ti=0}yt.head&&(yt.head.hcrc=yt.flags>>9&1,yt.head.done=!0),_r.adler=yt.check=0,yt.mode=Et;break;case Ce:for(;ti<32;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}_r.adler=yt.check=lt(yr),yr=0,ti=0,yt.mode=Fe;case Fe:if(yt.havedict===0)return _r.next_out=ii,_r.avail_out=hr,_r.next_in=Oe,_r.avail_in=br,yt.hold=yr,yt.bits=ti,X;_r.adler=yt.check=1,yt.mode=Et;case Et:if(ri===H||ri===q)break e;case bt:if(yt.last){yr>>>=7&ti,ti-=7&ti,yt.mode=At;break}for(;ti<3;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}switch(yt.last=1&yr,ti-=1,3&(yr>>>=1)){case 0:yt.mode=ht;break;case 1:if(_i(yt),yt.mode=dt,ri===q){yr>>>=2,ti-=2;break e}break;case 2:yt.mode=_t;break;case 3:_r.msg="invalid block type",yt.mode=Xe}yr>>>=2,ti-=2;break;case ht:for(yr>>>=7&ti,ti-=7&ti;ti<32;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if((65535&yr)!=(yr>>>16^65535)){_r.msg="invalid stored block lengths",yt.mode=Xe;break}if(yt.length=65535&yr,yr=0,ti=0,yt.mode=Zt,ri===q)break e;case Zt:yt.mode=Ye;case Ye:if(yi=yt.length){if(yi>br&&(yi=br),yi>hr&&(yi=hr),yi===0)break e;w.arraySet($i,ni,Oe,yi,ii),br-=yi,Oe+=yi,hr-=yi,ii+=yi,yt.length-=yi;break}yt.mode=Et;break;case _t:for(;ti<14;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(yt.nlen=257+(31&yr),yr>>>=5,ti-=5,yt.ndist=1+(31&yr),yr>>>=5,ti-=5,yt.ncode=4+(15&yr),yr>>>=4,ti-=4,yt.nlen>286||yt.ndist>30){_r.msg="too many length or distance symbols",yt.mode=Xe;break}yt.have=0,yt.mode=Vt;case Vt:for(;yt.have<yt.ncode;){for(;ti<3;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yt.lens[Ki[yt.have++]]=7&yr,yr>>>=3,ti-=3}for(;yt.have<19;)yt.lens[Ki[yt.have++]]=0;if(yt.lencode=yt.lendyn,yt.lenbits=7,Ui={bits:yt.lenbits},zi=F(U,yt.lens,0,19,yt.lencode,0,yt.work,Ui),yt.lenbits=Ui.bits,zi){_r.msg="invalid code lengths set",yt.mode=Xe;break}yt.have=0,yt.mode=Lt;case Lt:for(;yt.have<yt.nlen+yt.ndist;){for(;Mi=(Pi=yt.lencode[yr&(1<<yt.lenbits)-1])>>>16&255,Ri=65535&Pi,!((Ai=Pi>>>24)<=ti);){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(Ri<16)yr>>>=Ai,ti-=Ai,yt.lens[yt.have++]=Ri;else{if(Ri===16){for(Di=Ai+2;ti<Di;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(yr>>>=Ai,ti-=Ai,yt.have===0){_r.msg="invalid bit length repeat",yt.mode=Xe;break}Bi=yt.lens[yt.have-1],yi=3+(3&yr),yr>>>=2,ti-=2}else if(Ri===17){for(Di=Ai+3;ti<Di;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}ti-=Ai,Bi=0,yi=3+(7&(yr>>>=Ai)),yr>>>=3,ti-=3}else{for(Di=Ai+7;ti<Di;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}ti-=Ai,Bi=0,yi=11+(127&(yr>>>=Ai)),yr>>>=7,ti-=7}if(yt.have+yi>yt.nlen+yt.ndist){_r.msg="invalid bit length repeat",yt.mode=Xe;break}for(;yi--;)yt.lens[yt.have++]=Bi}}if(yt.mode===Xe)break;if(yt.lens[256]===0){_r.msg="invalid code -- missing end-of-block",yt.mode=Xe;break}if(yt.lenbits=9,Ui={bits:yt.lenbits},zi=F(j,yt.lens,0,yt.nlen,yt.lencode,0,yt.work,Ui),yt.lenbits=Ui.bits,zi){_r.msg="invalid literal/lengths set",yt.mode=Xe;break}if(yt.distbits=6,yt.distcode=yt.distdyn,Ui={bits:yt.distbits},zi=F(G,yt.lens,yt.nlen,yt.ndist,yt.distcode,0,yt.work,Ui),yt.distbits=Ui.bits,zi){_r.msg="invalid distances set",yt.mode=Xe;break}if(yt.mode=dt,ri===q)break e;case dt:yt.mode=It;case It:if(br>=6&&hr>=258){_r.next_out=ii,_r.avail_out=hr,_r.next_in=Oe,_r.avail_in=br,yt.hold=yr,yt.bits=ti,D(_r,mi),ii=_r.next_out,$i=_r.output,hr=_r.avail_out,Oe=_r.next_in,ni=_r.input,br=_r.avail_in,yr=yt.hold,ti=yt.bits,yt.mode===Et&&(yt.back=-1);break}for(yt.back=0;Mi=(Pi=yt.lencode[yr&(1<<yt.lenbits)-1])>>>16&255,Ri=65535&Pi,!((Ai=Pi>>>24)<=ti);){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(Mi&&!(240&Mi)){for(Oi=Ai,Hi=Mi,qi=Ri;Mi=(Pi=yt.lencode[qi+((yr&(1<<Oi+Hi)-1)>>Oi)])>>>16&255,Ri=65535&Pi,!(Oi+(Ai=Pi>>>24)<=ti);){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yr>>>=Oi,ti-=Oi,yt.back+=Oi}if(yr>>>=Ai,ti-=Ai,yt.back+=Ai,yt.length=Ri,Mi===0){yt.mode=$e;break}if(32&Mi){yt.back=-1,yt.mode=Et;break}if(64&Mi){_r.msg="invalid literal/length code",yt.mode=Xe;break}yt.extra=15&Mi,yt.mode=dr;case dr:if(yt.extra){for(Di=yt.extra;ti<Di;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yt.length+=yr&(1<<yt.extra)-1,yr>>>=yt.extra,ti-=yt.extra,yt.back+=yt.extra}yt.was=yt.length,yt.mode=fr;case fr:for(;Mi=(Pi=yt.distcode[yr&(1<<yt.distbits)-1])>>>16&255,Ri=65535&Pi,!((Ai=Pi>>>24)<=ti);){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(!(240&Mi)){for(Oi=Ai,Hi=Mi,qi=Ri;Mi=(Pi=yt.distcode[qi+((yr&(1<<Oi+Hi)-1)>>Oi)])>>>16&255,Ri=65535&Pi,!(Oi+(Ai=Pi>>>24)<=ti);){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yr>>>=Oi,ti-=Oi,yt.back+=Oi}if(yr>>>=Ai,ti-=Ai,yt.back+=Ai,64&Mi){_r.msg="invalid distance code",yt.mode=Xe;break}yt.offset=Ri,yt.extra=15&Mi,yt.mode=pr;case pr:if(yt.extra){for(Di=yt.extra;ti<Di;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}yt.offset+=yr&(1<<yt.extra)-1,yr>>>=yt.extra,ti-=yt.extra,yt.back+=yt.extra}if(yt.offset>yt.dmax){_r.msg="invalid distance too far back",yt.mode=Xe;break}yt.mode=Nt;case Nt:if(hr===0)break e;if(yi=mi-hr,yt.offset>yi){if((yi=yt.offset-yi)>yt.whave&&yt.sane){_r.msg="invalid distance too far back",yt.mode=Xe;break}yi>yt.wnext?(yi-=yt.wnext,Si=yt.wsize-yi):Si=yt.wnext-yi,yi>yt.length&&(yi=yt.length),Li=yt.window}else Li=$i,Si=ii-yt.offset,yi=yt.length;yi>hr&&(yi=hr),hr-=yi,yt.length-=yi;do $i[ii++]=Li[Si++];while(--yi);yt.length===0&&(yt.mode=It);break;case $e:if(hr===0)break e;$i[ii++]=yt.length,hr--,yt.mode=It;break;case At:if(yt.wrap){for(;ti<32;){if(br===0)break e;br--,yr|=ni[Oe++]<<ti,ti+=8}if(mi-=hr,_r.total_out+=mi,yt.total+=mi,mi&&(_r.adler=yt.check=yt.flags?I(yt.check,$i,mi,ii-mi):$(yt.check,$i,mi,ii-mi)),mi=hr,(yt.flags?yr:lt(yr))!==yt.check){_r.msg="incorrect data check",yt.mode=Xe;break}yr=0,ti=0}yt.mode=Ge;case Ge:if(yt.wrap&&yt.flags){for(;ti<32;){if(br===0)break e;br--,yr+=ni[Oe++]<<ti,ti+=8}if(yr!==(4294967295&yt.total)){_r.msg="incorrect length check",yt.mode=Xe;break}yr=0,ti=0}yt.mode=st;case st:zi=Q;break e;case Xe:zi=J;break e;case gt:return se;default:return re}return _r.next_out=ii,_r.avail_out=hr,_r.next_in=Oe,_r.avail_in=br,yt.hold=yr,yt.bits=ti,(yt.wsize||mi!==_r.avail_out&&yt.mode<Xe&&(yt.mode<At||ri!==Z))&&bi(_r,_r.output,_r.next_out,mi-_r.avail_out),vi-=_r.avail_in,mi-=_r.avail_out,_r.total_in+=vi,_r.total_out+=mi,yt.total+=mi,yt.wrap&&mi&&(_r.adler=yt.check=yt.flags?I(yt.check,$i,mi,_r.next_out-mi):$(yt.check,$i,mi,_r.next_out-mi)),_r.data_type=yt.bits+(yt.last?64:0)+(yt.mode===Et?128:0)+(yt.mode===dt||yt.mode===Zt?256:0),(vi===0&&mi===0||ri===Z)&&zi===V&&(zi=ie),zi}function gi(_r){if(!_r||!_r.state)return re;var ri=_r.state;return ri.window&&(ri.window=null),_r.state=null,V}function Yt(_r,ri){var yt;return _r&&_r.state&&2&(yt=_r.state).wrap?(yt.head=ri,ri.done=!1,V):re}function di(_r,ri){var yt,ni=ri.length;return _r&&_r.state?(yt=_r.state).wrap!==0&&yt.mode!==Fe?re:yt.mode===Fe&&$(1,ri,ni,0)!==yt.check?J:bi(_r,ri,ni,ni)?(yt.mode=gt,se):(yt.havedict=1,V):re}g.inflateReset=gr,g.inflateReset2=oi,g.inflateResetKeep=mr,g.inflateInit=ai,g.inflateInit2=hi,g.inflate=Ei,g.inflateEnd=gi,g.inflateGetHeader=Yt,g.inflateSetDictionary=di,g.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./inffast":57,"./inftrees":59}],59:[function(d,m,g){var w=d("../utils/common"),$=15,I=852,D=592,F=0,U=1,j=2,G=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Z=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],H=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],q=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];m.exports=function(V,Q,X,re,J,se,ie,oe){var pe,de,ge,ce,Ie,fe,Te,ut,ze,Ce=oe.bits,Fe=0,Et=0,bt=0,ht=0,Zt=0,Ye=0,_t=0,Vt=0,Lt=0,dt=0,It=null,dr=0,fr=new w.Buf16($+1),pr=new w.Buf16($+1),Nt=null,$e=0;for(Fe=0;Fe<=$;Fe++)fr[Fe]=0;for(Et=0;Et<re;Et++)fr[Q[X+Et]]++;for(Zt=Ce,ht=$;ht>=1&&fr[ht]===0;ht--);if(Zt>ht&&(Zt=ht),ht===0)return J[se++]=20971520,J[se++]=20971520,oe.bits=1,0;for(bt=1;bt<ht&&fr[bt]===0;bt++);for(Zt<bt&&(Zt=bt),Vt=1,Fe=1;Fe<=$;Fe++)if(Vt<<=1,(Vt-=fr[Fe])<0)return-1;if(Vt>0&&(V===F||ht!==1))return-1;for(pr[1]=0,Fe=1;Fe<$;Fe++)pr[Fe+1]=pr[Fe]+fr[Fe];for(Et=0;Et<re;Et++)Q[X+Et]!==0&&(ie[pr[Q[X+Et]]++]=Et);if(V===F?(It=Nt=ie,fe=19):V===U?(It=G,dr-=257,Nt=Z,$e-=257,fe=256):(It=H,Nt=q,fe=-1),dt=0,Et=0,Fe=bt,Ie=se,Ye=Zt,_t=0,ge=-1,ce=(Lt=1<<Zt)-1,V===U&&Lt>I||V===j&&Lt>D)return 1;for(;;){Te=Fe-_t,ie[Et]<fe?(ut=0,ze=ie[Et]):ie[Et]>fe?(ut=Nt[$e+ie[Et]],ze=It[dr+ie[Et]]):(ut=96,ze=0),pe=1<<Fe-_t,bt=de=1<<Ye;do J[Ie+(dt>>_t)+(de-=pe)]=Te<<24|ut<<16|ze;while(de!==0);for(pe=1<<Fe-1;dt&pe;)pe>>=1;if(pe!==0?(dt&=pe-1,dt+=pe):dt=0,Et++,--fr[Fe]==0){if(Fe===ht)break;Fe=Q[X+ie[Et]]}if(Fe>Zt&&(dt&ce)!==ge){for(_t===0&&(_t=Zt),Ie+=bt,Vt=1<<(Ye=Fe-_t);Ye+_t<ht&&!((Vt-=fr[Ye+_t])<=0);)Ye++,Vt<<=1;if(Lt+=1<<Ye,V===U&&Lt>I||V===j&&Lt>D)return 1;J[ge=dt&ce]=Zt<<24|Ye<<16|Ie-se}}return dt!==0&&(J[Ie+dt]=Fe-_t<<24|64<<16),oe.bits=Zt,0}},{"../utils/common":52}],60:[function(d,m,g){m.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],61:[function(d,m,g){var w=d("../utils/common"),$=4,I=0,D=1,F=2;function U(Yt){for(var di=Yt.length;--di>=0;)Yt[di]=0}var j=0,G=1,Z=2,H=3,q=258,V=29,Q=256,X=Q+1+V,re=30,J=19,se=2*X+1,ie=15,oe=16,pe=7,de=256,ge=16,ce=17,Ie=18,fe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Te=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ut=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ze=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ce=512,Fe=new Array(2*(X+2));U(Fe);var Et=new Array(2*re);U(Et);var bt=new Array(Ce);U(bt);var ht=new Array(q-H+1);U(ht);var Zt=new Array(V);U(Zt);var Ye,_t,Vt,Lt=new Array(re);function dt(Yt,di,_r,ri,yt){this.static_tree=Yt,this.extra_bits=di,this.extra_base=_r,this.elems=ri,this.max_length=yt,this.has_stree=Yt&&Yt.length}function It(Yt,di){this.dyn_tree=Yt,this.max_code=0,this.stat_desc=di}function dr(Yt){return Yt<256?bt[Yt]:bt[256+(Yt>>>7)]}function fr(Yt,di){Yt.pending_buf[Yt.pending++]=255&di,Yt.pending_buf[Yt.pending++]=di>>>8&255}function pr(Yt,di,_r){Yt.bi_valid>oe-_r?(Yt.bi_buf|=di<<Yt.bi_valid&65535,fr(Yt,Yt.bi_buf),Yt.bi_buf=di>>oe-Yt.bi_valid,Yt.bi_valid+=_r-oe):(Yt.bi_buf|=di<<Yt.bi_valid&65535,Yt.bi_valid+=_r)}function Nt(Yt,di,_r){pr(Yt,_r[2*di],_r[2*di+1])}function $e(Yt,di){var _r=0;do _r|=1&Yt,Yt>>>=1,_r<<=1;while(--di>0);return _r>>>1}function At(Yt){Yt.bi_valid===16?(fr(Yt,Yt.bi_buf),Yt.bi_buf=0,Yt.bi_valid=0):Yt.bi_valid>=8&&(Yt.pending_buf[Yt.pending++]=255&Yt.bi_buf,Yt.bi_buf>>=8,Yt.bi_valid-=8)}function Ge(Yt,di){var _r,ri,yt,ni,$i,Oe,ii=di.dyn_tree,br=di.max_code,hr=di.stat_desc.static_tree,yr=di.stat_desc.has_stree,ti=di.stat_desc.extra_bits,vi=di.stat_desc.extra_base,mi=di.stat_desc.max_length,yi=0;for(ni=0;ni<=ie;ni++)Yt.bl_count[ni]=0;for(ii[2*Yt.heap[Yt.heap_max]+1]=0,_r=Yt.heap_max+1;_r<se;_r++)(ni=ii[2*ii[2*(ri=Yt.heap[_r])+1]+1]+1)>mi&&(ni=mi,yi++),ii[2*ri+1]=ni,ri>br||(Yt.bl_count[ni]++,$i=0,ri>=vi&&($i=ti[ri-vi]),Oe=ii[2*ri],Yt.opt_len+=Oe*(ni+$i),yr&&(Yt.static_len+=Oe*(hr[2*ri+1]+$i)));if(yi!==0){do{for(ni=mi-1;Yt.bl_count[ni]===0;)ni--;Yt.bl_count[ni]--,Yt.bl_count[ni+1]+=2,Yt.bl_count[mi]--,yi-=2}while(yi>0);for(ni=mi;ni!==0;ni--)for(ri=Yt.bl_count[ni];ri!==0;)(yt=Yt.heap[--_r])>br||(ii[2*yt+1]!==ni&&(Yt.opt_len+=(ni-ii[2*yt+1])*ii[2*yt],ii[2*yt+1]=ni),ri--)}}function st(Yt,di,_r){var ri,yt,ni=new Array(ie+1),$i=0;for(ri=1;ri<=ie;ri++)ni[ri]=$i=$i+_r[ri-1]<<1;for(yt=0;yt<=di;yt++){var Oe=Yt[2*yt+1];Oe!==0&&(Yt[2*yt]=$e(ni[Oe]++,Oe))}}function Xe(){var Yt,di,_r,ri,yt,ni=new Array(ie+1);for(_r=0,ri=0;ri<V-1;ri++)for(Zt[ri]=_r,Yt=0;Yt<1<<fe[ri];Yt++)ht[_r++]=ri;for(ht[_r-1]=ri,yt=0,ri=0;ri<16;ri++)for(Lt[ri]=yt,Yt=0;Yt<1<<Te[ri];Yt++)bt[yt++]=ri;for(yt>>=7;ri<re;ri++)for(Lt[ri]=yt<<7,Yt=0;Yt<1<<Te[ri]-7;Yt++)bt[256+yt++]=ri;for(di=0;di<=ie;di++)ni[di]=0;for(Yt=0;Yt<=143;)Fe[2*Yt+1]=8,Yt++,ni[8]++;for(;Yt<=255;)Fe[2*Yt+1]=9,Yt++,ni[9]++;for(;Yt<=279;)Fe[2*Yt+1]=7,Yt++,ni[7]++;for(;Yt<=287;)Fe[2*Yt+1]=8,Yt++,ni[8]++;for(st(Fe,X+1,ni),Yt=0;Yt<re;Yt++)Et[2*Yt+1]=5,Et[2*Yt]=$e(Yt,5);Ye=new dt(Fe,fe,Q+1,X,ie),_t=new dt(Et,Te,0,re,ie),Vt=new dt(new Array(0),ut,0,J,pe)}function gt(Yt){var di;for(di=0;di<X;di++)Yt.dyn_ltree[2*di]=0;for(di=0;di<re;di++)Yt.dyn_dtree[2*di]=0;for(di=0;di<J;di++)Yt.bl_tree[2*di]=0;Yt.dyn_ltree[2*de]=1,Yt.opt_len=Yt.static_len=0,Yt.last_lit=Yt.matches=0}function Qt(Yt){Yt.bi_valid>8?fr(Yt,Yt.bi_buf):Yt.bi_valid>0&&(Yt.pending_buf[Yt.pending++]=Yt.bi_buf),Yt.bi_buf=0,Yt.bi_valid=0}function me(Yt,di,_r,ri){Qt(Yt),fr(Yt,_r),fr(Yt,~_r),w.arraySet(Yt.pending_buf,Yt.window,di,_r,Yt.pending),Yt.pending+=_r}function Be(Yt,di,_r,ri){var yt=2*di,ni=2*_r;return Yt[yt]<Yt[ni]||Yt[yt]===Yt[ni]&&ri[di]<=ri[_r]}function lt(Yt,di,_r){for(var ri=Yt.heap[_r],yt=_r<<1;yt<=Yt.heap_len&&(yt<Yt.heap_len&&Be(di,Yt.heap[yt+1],Yt.heap[yt],Yt.depth)&&yt++,!Be(di,ri,Yt.heap[yt],Yt.depth));)Yt.heap[_r]=Yt.heap[yt],_r=yt,yt<<=1;Yt.heap[_r]=ri}function ft(Yt,di,_r){var ri,yt,ni,$i,Oe=0;if(Yt.last_lit!==0)do ri=Yt.pending_buf[Yt.d_buf+2*Oe]<<8|Yt.pending_buf[Yt.d_buf+2*Oe+1],yt=Yt.pending_buf[Yt.l_buf+Oe],Oe++,ri===0?Nt(Yt,yt,di):(Nt(Yt,(ni=ht[yt])+Q+1,di),($i=fe[ni])!==0&&pr(Yt,yt-=Zt[ni],$i),Nt(Yt,ni=dr(--ri),_r),($i=Te[ni])!==0&&pr(Yt,ri-=Lt[ni],$i));while(Oe<Yt.last_lit);Nt(Yt,de,di)}function mr(Yt,di){var _r,ri,yt,ni=di.dyn_tree,$i=di.stat_desc.static_tree,Oe=di.stat_desc.has_stree,ii=di.stat_desc.elems,br=-1;for(Yt.heap_len=0,Yt.heap_max=se,_r=0;_r<ii;_r++)ni[2*_r]!==0?(Yt.heap[++Yt.heap_len]=br=_r,Yt.depth[_r]=0):ni[2*_r+1]=0;for(;Yt.heap_len<2;)ni[2*(yt=Yt.heap[++Yt.heap_len]=br<2?++br:0)]=1,Yt.depth[yt]=0,Yt.opt_len--,Oe&&(Yt.static_len-=$i[2*yt+1]);for(di.max_code=br,_r=Yt.heap_len>>1;_r>=1;_r--)lt(Yt,ni,_r);yt=ii;do _r=Yt.heap[1],Yt.heap[1]=Yt.heap[Yt.heap_len--],lt(Yt,ni,1),ri=Yt.heap[1],Yt.heap[--Yt.heap_max]=_r,Yt.heap[--Yt.heap_max]=ri,ni[2*yt]=ni[2*_r]+ni[2*ri],Yt.depth[yt]=(Yt.depth[_r]>=Yt.depth[ri]?Yt.depth[_r]:Yt.depth[ri])+1,ni[2*_r+1]=ni[2*ri+1]=yt,Yt.heap[1]=yt++,lt(Yt,ni,1);while(Yt.heap_len>=2);Yt.heap[--Yt.heap_max]=Yt.heap[1],Ge(Yt,di),st(ni,br,Yt.bl_count)}function gr(Yt,di,_r){var ri,yt,ni=-1,$i=di[1],Oe=0,ii=7,br=4;for($i===0&&(ii=138,br=3),di[2*(_r+1)+1]=65535,ri=0;ri<=_r;ri++)yt=$i,$i=di[2*(ri+1)+1],++Oe<ii&&yt===$i||(Oe<br?Yt.bl_tree[2*yt]+=Oe:yt!==0?(yt!==ni&&Yt.bl_tree[2*yt]++,Yt.bl_tree[2*ge]++):Oe<=10?Yt.bl_tree[2*ce]++:Yt.bl_tree[2*Ie]++,Oe=0,ni=yt,$i===0?(ii=138,br=3):yt===$i?(ii=6,br=3):(ii=7,br=4))}function oi(Yt,di,_r){var ri,yt,ni=-1,$i=di[1],Oe=0,ii=7,br=4;for($i===0&&(ii=138,br=3),ri=0;ri<=_r;ri++)if(yt=$i,$i=di[2*(ri+1)+1],!(++Oe<ii&&yt===$i)){if(Oe<br)do Nt(Yt,yt,Yt.bl_tree);while(--Oe!=0);else yt!==0?(yt!==ni&&(Nt(Yt,yt,Yt.bl_tree),Oe--),Nt(Yt,ge,Yt.bl_tree),pr(Yt,Oe-3,2)):Oe<=10?(Nt(Yt,ce,Yt.bl_tree),pr(Yt,Oe-3,3)):(Nt(Yt,Ie,Yt.bl_tree),pr(Yt,Oe-11,7));Oe=0,ni=yt,$i===0?(ii=138,br=3):yt===$i?(ii=6,br=3):(ii=7,br=4)}}function hi(Yt){var di;for(gr(Yt,Yt.dyn_ltree,Yt.l_desc.max_code),gr(Yt,Yt.dyn_dtree,Yt.d_desc.max_code),mr(Yt,Yt.bl_desc),di=J-1;di>=3&&Yt.bl_tree[2*ze[di]+1]===0;di--);return Yt.opt_len+=3*(di+1)+5+5+4,di}function ai(Yt,di,_r,ri){var yt;for(pr(Yt,di-257,5),pr(Yt,_r-1,5),pr(Yt,ri-4,4),yt=0;yt<ri;yt++)pr(Yt,Yt.bl_tree[2*ze[yt]+1],3);oi(Yt,Yt.dyn_ltree,di-1),oi(Yt,Yt.dyn_dtree,_r-1)}function fi(Yt){var di,_r=4093624447;for(di=0;di<=31;di++,_r>>>=1)if(1&_r&&Yt.dyn_ltree[2*di]!==0)return I;if(Yt.dyn_ltree[18]!==0||Yt.dyn_ltree[20]!==0||Yt.dyn_ltree[26]!==0)return D;for(di=32;di<Q;di++)if(Yt.dyn_ltree[2*di]!==0)return D;return I}U(Lt);var ui=!1;function wi(Yt){ui||(Xe(),ui=!0),Yt.l_desc=new It(Yt.dyn_ltree,Ye),Yt.d_desc=new It(Yt.dyn_dtree,_t),Yt.bl_desc=new It(Yt.bl_tree,Vt),Yt.bi_buf=0,Yt.bi_valid=0,gt(Yt)}function _i(Yt,di,_r,ri){pr(Yt,(j<<1)+(ri?1:0),3),me(Yt,di,_r)}function bi(Yt){pr(Yt,G<<1,3),Nt(Yt,de,Fe),At(Yt)}function Ei(Yt,di,_r,ri){var yt,ni,$i=0;Yt.level>0?(Yt.strm.data_type===F&&(Yt.strm.data_type=fi(Yt)),mr(Yt,Yt.l_desc),mr(Yt,Yt.d_desc),$i=hi(Yt),yt=Yt.opt_len+3+7>>>3,(ni=Yt.static_len+3+7>>>3)<=yt&&(yt=ni)):yt=ni=_r+5,_r+4<=yt&&di!==-1?_i(Yt,di,_r,ri):Yt.strategy===$||ni===yt?(pr(Yt,(G<<1)+(ri?1:0),3),ft(Yt,Fe,Et)):(pr(Yt,(Z<<1)+(ri?1:0),3),ai(Yt,Yt.l_desc.max_code+1,Yt.d_desc.max_code+1,$i+1),ft(Yt,Yt.dyn_ltree,Yt.dyn_dtree)),gt(Yt),ri&&Qt(Yt)}function gi(Yt,di,_r){return Yt.pending_buf[Yt.d_buf+2*Yt.last_lit]=di>>>8&255,Yt.pending_buf[Yt.d_buf+2*Yt.last_lit+1]=255&di,Yt.pending_buf[Yt.l_buf+Yt.last_lit]=255&_r,Yt.last_lit++,di===0?Yt.dyn_ltree[2*_r]++:(Yt.matches++,di--,Yt.dyn_ltree[2*(ht[_r]+Q+1)]++,Yt.dyn_dtree[2*dr(di)]++),Yt.last_lit===Yt.lit_bufsize-1}g._tr_init=wi,g._tr_stored_block=_i,g._tr_flush_block=Ei,g._tr_tally=gi,g._tr_align=bi},{"../utils/common":52}],62:[function(d,m,g){function w(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}m.exports=w},{}],63:[function(d,m,g){var w,$,I=m.exports={};function D(){throw new Error("setTimeout has not been defined")}function F(){throw new Error("clearTimeout has not been defined")}function U(J){if(w===setTimeout)return setTimeout(J,0);if((w===D||!w)&&setTimeout)return w=setTimeout,setTimeout(J,0);try{return w(J,0)}catch{try{return w.call(null,J,0)}catch{return w.call(this,J,0)}}}function j(J){if($===clearTimeout)return clearTimeout(J);if(($===F||!$)&&clearTimeout)return $=clearTimeout,clearTimeout(J);try{return $(J)}catch{try{return $.call(null,J)}catch{return $.call(this,J)}}}(function(){try{w=typeof setTimeout=="function"?setTimeout:D}catch{w=D}try{$=typeof clearTimeout=="function"?clearTimeout:F}catch{$=F}})();var G,Z=[],H=!1,q=-1;function V(){H&&G&&(H=!1,G.length?Z=G.concat(Z):q=-1,Z.length&&Q())}function Q(){if(!H){var J=U(V);H=!0;for(var se=Z.length;se;){for(G=Z,Z=[];++q<se;)G&&G[q].run();q=-1,se=Z.length}G=null,H=!1,j(J)}}function X(J,se){this.fun=J,this.array=se}function re(){}I.nextTick=function(J){var se=new Array(arguments.length-1);if(arguments.length>1)for(var ie=1;ie<arguments.length;ie++)se[ie-1]=arguments[ie];Z.push(new X(J,se)),Z.length!==1||H||U(Q)},X.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=re,I.addListener=re,I.once=re,I.off=re,I.removeListener=re,I.removeAllListeners=re,I.emit=re,I.prependListener=re,I.prependOnceListener=re,I.listeners=function(J){return[]},I.binding=function(J){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(J){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},{}],64:[function(d,m,g){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var w=d("buffer"),$=w.Buffer;function I(F,U){for(var j in F)U[j]=F[j]}function D(F,U,j){return $(F,U,j)}$.from&&$.alloc&&$.allocUnsafe&&$.allocUnsafeSlow?m.exports=w:(I(w,g),g.Buffer=D),D.prototype=Object.create($.prototype),I($,D),D.from=function(F,U,j){if(typeof F=="number")throw new TypeError("Argument must not be a number");return $(F,U,j)},D.alloc=function(F,U,j){if(typeof F!="number")throw new TypeError("Argument must be a number");var G=$(F);return U!==void 0?typeof j=="string"?G.fill(U,j):G.fill(U):G.fill(0),G},D.allocUnsafe=function(F){if(typeof F!="number")throw new TypeError("Argument must be a number");return $(F)},D.allocUnsafeSlow=function(F){if(typeof F!="number")throw new TypeError("Argument must be a number");return w.SlowBuffer(F)}},{buffer:32}],65:[function(d,m,g){m.exports=$;var w=d("events").EventEmitter;function $(){w.call(this)}d("inherits")($,w),$.Readable=d("readable-stream/lib/_stream_readable.js"),$.Writable=d("readable-stream/lib/_stream_writable.js"),$.Duplex=d("readable-stream/lib/_stream_duplex.js"),$.Transform=d("readable-stream/lib/_stream_transform.js"),$.PassThrough=d("readable-stream/lib/_stream_passthrough.js"),$.finished=d("readable-stream/lib/internal/streams/end-of-stream.js"),$.pipeline=d("readable-stream/lib/internal/streams/pipeline.js"),$.Stream=$,$.prototype.pipe=function(I,D){var F=this;function U(Q){I.writable&&I.write(Q)===!1&&F.pause&&F.pause()}function j(){F.readable&&F.resume&&F.resume()}F.on("data",U),I.on("drain",j),I._isStdio||D&&D.end===!1||(F.on("end",Z),F.on("close",H));var G=!1;function Z(){G||(G=!0,I.end())}function H(){G||(G=!0,typeof I.destroy=="function"&&I.destroy())}function q(Q){if(V(),w.listenerCount(this,"error")===0)throw Q}function V(){F.removeListener("data",U),I.removeListener("drain",j),F.removeListener("end",Z),F.removeListener("close",H),F.removeListener("error",q),I.removeListener("error",q),F.removeListener("end",V),F.removeListener("close",V),I.removeListener("close",V)}return F.on("error",q),I.on("error",q),F.on("end",V),F.on("close",V),I.on("close",V),I.emit("pipe",F),I}},{events:35,inherits:46,"readable-stream/lib/_stream_duplex.js":67,"readable-stream/lib/_stream_passthrough.js":68,"readable-stream/lib/_stream_readable.js":69,"readable-stream/lib/_stream_transform.js":70,"readable-stream/lib/_stream_writable.js":71,"readable-stream/lib/internal/streams/end-of-stream.js":75,"readable-stream/lib/internal/streams/pipeline.js":77}],66:[function(d,m,g){function w(G,Z){G.prototype=Object.create(Z.prototype),G.prototype.constructor=G,G.__proto__=Z}var $={};function I(G,Z,H){function q(Q,X,re){return typeof Z=="string"?Z:Z(Q,X,re)}H||(H=Error);var V=(function(Q){function X(re,J,se){return Q.call(this,q(re,J,se))||this}return w(X,Q),X})(H);V.prototype.name=H.name,V.prototype.code=G,$[G]=V}function D(G,Z){if(Array.isArray(G)){var H=G.length;return G=G.map((function(q){return String(q)})),H>2?"one of ".concat(Z," ").concat(G.slice(0,H-1).join(", "),", or ")+G[H-1]:H===2?"one of ".concat(Z," ").concat(G[0]," or ").concat(G[1]):"of ".concat(Z," ").concat(G[0])}return"of ".concat(Z," ").concat(String(G))}function F(G,Z,H){return G.substr(0,Z.length)===Z}function U(G,Z,H){return(H===void 0||H>G.length)&&(H=G.length),G.substring(H-Z.length,H)===Z}function j(G,Z,H){return typeof H!="number"&&(H=0),!(H+Z.length>G.length)&&G.indexOf(Z,H)!==-1}I("ERR_INVALID_OPT_VALUE",(function(G,Z){return'The value "'+Z+'" is invalid for option "'+G+'"'}),TypeError),I("ERR_INVALID_ARG_TYPE",(function(G,Z,H){var q,V;if(typeof Z=="string"&&F(Z,"not ")?(q="must not be",Z=Z.replace(/^not /,"")):q="must be",U(G," argument"))V="The ".concat(G," ").concat(q," ").concat(D(Z,"type"));else{var Q=j(G,".")?"property":"argument";V='The "'.concat(G,'" ').concat(Q," ").concat(q," ").concat(D(Z,"type"))}return V+=". Received type ".concat(typeof H)}),TypeError),I("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),I("ERR_METHOD_NOT_IMPLEMENTED",(function(G){return"The "+G+" method is not implemented"})),I("ERR_STREAM_PREMATURE_CLOSE","Premature close"),I("ERR_STREAM_DESTROYED",(function(G){return"Cannot call "+G+" after a stream was destroyed"})),I("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),I("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),I("ERR_STREAM_WRITE_AFTER_END","write after end"),I("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),I("ERR_UNKNOWN_ENCODING",(function(G){return"Unknown encoding: "+G}),TypeError),I("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),m.exports.codes=$},{}],67:[function(d,m,g){(function(w){(function(){var $=Object.keys||function(q){var V=[];for(var Q in q)V.push(Q);return V};m.exports=G;var I=d("./_stream_readable"),D=d("./_stream_writable");d("inherits")(G,I);for(var F=$(D.prototype),U=0;U<F.length;U++){var j=F[U];G.prototype[j]||(G.prototype[j]=D.prototype[j])}function G(q){if(!(this instanceof G))return new G(q);I.call(this,q),D.call(this,q),this.allowHalfOpen=!0,q&&(q.readable===!1&&(this.readable=!1),q.writable===!1&&(this.writable=!1),q.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Z)))}function Z(){this._writableState.ended||w.nextTick(H,this)}function H(q){q.end()}Object.defineProperty(G.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(G.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(G.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(q){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=q,this._writableState.destroyed=q)}})}).call(this)}).call(this,d("_process"))},{"./_stream_readable":69,"./_stream_writable":71,_process:63,inherits:46}],68:[function(d,m,g){m.exports=$;var w=d("./_stream_transform");function $(I){if(!(this instanceof $))return new $(I);w.call(this,I)}d("inherits")($,w),$.prototype._transform=function(I,D,F){F(null,I)}},{"./_stream_transform":70,inherits:46}],69:[function(d,m,g){(function(w,$){(function(){var I;m.exports=ut,ut.ReadableState=Te,d("events").EventEmitter;var D=function(Xe,gt){return Xe.listeners(gt).length},F=d("./internal/streams/stream"),U=d("buffer").Buffer,j=$.Uint8Array||function(){};function G(Xe){return U.from(Xe)}function Z(Xe){return U.isBuffer(Xe)||Xe instanceof j}var H,q=d("util");H=q&&q.debuglog?q.debuglog("stream"):function(){};var V,Q,X,re=d("./internal/streams/buffer_list"),J=d("./internal/streams/destroy"),se=d("./internal/streams/state").getHighWaterMark,ie=d("../errors").codes,oe=ie.ERR_INVALID_ARG_TYPE,pe=ie.ERR_STREAM_PUSH_AFTER_EOF,de=ie.ERR_METHOD_NOT_IMPLEMENTED,ge=ie.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;d("inherits")(ut,F);var ce=J.errorOrDestroy,Ie=["error","close","destroy","pause","resume"];function fe(Xe,gt,Qt){if(typeof Xe.prependListener=="function")return Xe.prependListener(gt,Qt);Xe._events&&Xe._events[gt]?Array.isArray(Xe._events[gt])?Xe._events[gt].unshift(Qt):Xe._events[gt]=[Qt,Xe._events[gt]]:Xe.on(gt,Qt)}function Te(Xe,gt,Qt){I=I||d("./_stream_duplex"),Xe=Xe||{},typeof Qt!="boolean"&&(Qt=gt instanceof I),this.objectMode=!!Xe.objectMode,Qt&&(this.objectMode=this.objectMode||!!Xe.readableObjectMode),this.highWaterMark=se(this,Xe,"readableHighWaterMark",Qt),this.buffer=new re,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Xe.emitClose!==!1,this.autoDestroy=!!Xe.autoDestroy,this.destroyed=!1,this.defaultEncoding=Xe.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Xe.encoding&&(V||(V=d("string_decoder/").StringDecoder),this.decoder=new V(Xe.encoding),this.encoding=Xe.encoding)}function ut(Xe){if(I=I||d("./_stream_duplex"),!(this instanceof ut))return new ut(Xe);var gt=this instanceof I;this._readableState=new Te(Xe,this,gt),this.readable=!0,Xe&&(typeof Xe.read=="function"&&(this._read=Xe.read),typeof Xe.destroy=="function"&&(this._destroy=Xe.destroy)),F.call(this)}function ze(Xe,gt,Qt,me,Be){H("readableAddChunk",gt);var lt,ft=Xe._readableState;if(gt===null)ft.reading=!1,Zt(Xe,ft);else if(Be||(lt=Fe(ft,gt)),lt)ce(Xe,lt);else if(ft.objectMode||gt&&gt.length>0)if(typeof gt=="string"||ft.objectMode||Object.getPrototypeOf(gt)===U.prototype||(gt=G(gt)),me)ft.endEmitted?ce(Xe,new ge):Ce(Xe,ft,gt,!0);else if(ft.ended)ce(Xe,new pe);else{if(ft.destroyed)return!1;ft.reading=!1,ft.decoder&&!Qt?(gt=ft.decoder.write(gt),ft.objectMode||gt.length!==0?Ce(Xe,ft,gt,!1):Vt(Xe,ft)):Ce(Xe,ft,gt,!1)}else me||(ft.reading=!1,Vt(Xe,ft));return!ft.ended&&(ft.length<ft.highWaterMark||ft.length===0)}function Ce(Xe,gt,Qt,me){gt.flowing&&gt.length===0&&!gt.sync?(gt.awaitDrain=0,Xe.emit("data",Qt)):(gt.length+=gt.objectMode?1:Qt.length,me?gt.buffer.unshift(Qt):gt.buffer.push(Qt),gt.needReadable&&Ye(Xe)),Vt(Xe,gt)}function Fe(Xe,gt){var Qt;return Z(gt)||typeof gt=="string"||gt===void 0||Xe.objectMode||(Qt=new oe("chunk",["string","Buffer","Uint8Array"],gt)),Qt}Object.defineProperty(ut.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(Xe){this._readableState&&(this._readableState.destroyed=Xe)}}),ut.prototype.destroy=J.destroy,ut.prototype._undestroy=J.undestroy,ut.prototype._destroy=function(Xe,gt){gt(Xe)},ut.prototype.push=function(Xe,gt){var Qt,me=this._readableState;return me.objectMode?Qt=!0:typeof Xe=="string"&&((gt=gt||me.defaultEncoding)!==me.encoding&&(Xe=U.from(Xe,gt),gt=""),Qt=!0),ze(this,Xe,gt,!1,Qt)},ut.prototype.unshift=function(Xe){return ze(this,Xe,null,!0,!1)},ut.prototype.isPaused=function(){return this._readableState.flowing===!1},ut.prototype.setEncoding=function(Xe){V||(V=d("string_decoder/").StringDecoder);var gt=new V(Xe);this._readableState.decoder=gt,this._readableState.encoding=this._readableState.decoder.encoding;for(var Qt=this._readableState.buffer.head,me="";Qt!==null;)me+=gt.write(Qt.data),Qt=Qt.next;return this._readableState.buffer.clear(),me!==""&&this._readableState.buffer.push(me),this._readableState.length=me.length,this};var Et=1073741824;function bt(Xe){return Xe>=Et?Xe=Et:(Xe--,Xe|=Xe>>>1,Xe|=Xe>>>2,Xe|=Xe>>>4,Xe|=Xe>>>8,Xe|=Xe>>>16,Xe++),Xe}function ht(Xe,gt){return Xe<=0||gt.length===0&&gt.ended?0:gt.objectMode?1:Xe!=Xe?gt.flowing&&gt.length?gt.buffer.head.data.length:gt.length:(Xe>gt.highWaterMark&&(gt.highWaterMark=bt(Xe)),Xe<=gt.length?Xe:gt.ended?gt.length:(gt.needReadable=!0,0))}function Zt(Xe,gt){if(H("onEofChunk"),!gt.ended){if(gt.decoder){var Qt=gt.decoder.end();Qt&&Qt.length&&(gt.buffer.push(Qt),gt.length+=gt.objectMode?1:Qt.length)}gt.ended=!0,gt.sync?Ye(Xe):(gt.needReadable=!1,gt.emittedReadable||(gt.emittedReadable=!0,_t(Xe)))}}function Ye(Xe){var gt=Xe._readableState;H("emitReadable",gt.needReadable,gt.emittedReadable),gt.needReadable=!1,gt.emittedReadable||(H("emitReadable",gt.flowing),gt.emittedReadable=!0,w.nextTick(_t,Xe))}function _t(Xe){var gt=Xe._readableState;H("emitReadable_",gt.destroyed,gt.length,gt.ended),gt.destroyed||!gt.length&&!gt.ended||(Xe.emit("readable"),gt.emittedReadable=!1),gt.needReadable=!gt.flowing&&!gt.ended&&gt.length<=gt.highWaterMark,Nt(Xe)}function Vt(Xe,gt){gt.readingMore||(gt.readingMore=!0,w.nextTick(Lt,Xe,gt))}function Lt(Xe,gt){for(;!gt.reading&&!gt.ended&&(gt.length<gt.highWaterMark||gt.flowing&&gt.length===0);){var Qt=gt.length;if(H("maybeReadMore read 0"),Xe.read(0),Qt===gt.length)break}gt.readingMore=!1}function dt(Xe){return function(){var gt=Xe._readableState;H("pipeOnDrain",gt.awaitDrain),gt.awaitDrain&&gt.awaitDrain--,gt.awaitDrain===0&&D(Xe,"data")&&(gt.flowing=!0,Nt(Xe))}}function It(Xe){var gt=Xe._readableState;gt.readableListening=Xe.listenerCount("readable")>0,gt.resumeScheduled&&!gt.paused?gt.flowing=!0:Xe.listenerCount("data")>0&&Xe.resume()}function dr(Xe){H("readable nexttick read 0"),Xe.read(0)}function fr(Xe,gt){gt.resumeScheduled||(gt.resumeScheduled=!0,w.nextTick(pr,Xe,gt))}function pr(Xe,gt){H("resume",gt.reading),gt.reading||Xe.read(0),gt.resumeScheduled=!1,Xe.emit("resume"),Nt(Xe),gt.flowing&&!gt.reading&&Xe.read(0)}function Nt(Xe){var gt=Xe._readableState;for(H("flow",gt.flowing);gt.flowing&&Xe.read()!==null;);}function $e(Xe,gt){return gt.length===0?null:(gt.objectMode?Qt=gt.buffer.shift():!Xe||Xe>=gt.length?(Qt=gt.decoder?gt.buffer.join(""):gt.buffer.length===1?gt.buffer.first():gt.buffer.concat(gt.length),gt.buffer.clear()):Qt=gt.buffer.consume(Xe,gt.decoder),Qt);var Qt}function At(Xe){var gt=Xe._readableState;H("endReadable",gt.endEmitted),gt.endEmitted||(gt.ended=!0,w.nextTick(Ge,gt,Xe))}function Ge(Xe,gt){if(H("endReadableNT",Xe.endEmitted,Xe.length),!Xe.endEmitted&&Xe.length===0&&(Xe.endEmitted=!0,gt.readable=!1,gt.emit("end"),Xe.autoDestroy)){var Qt=gt._writableState;(!Qt||Qt.autoDestroy&&Qt.finished)&&gt.destroy()}}function st(Xe,gt){for(var Qt=0,me=Xe.length;Qt<me;Qt++)if(Xe[Qt]===gt)return Qt;return-1}ut.prototype.read=function(Xe){H("read",Xe),Xe=parseInt(Xe,10);var gt=this._readableState,Qt=Xe;if(Xe!==0&&(gt.emittedReadable=!1),Xe===0&&gt.needReadable&&((gt.highWaterMark!==0?gt.length>=gt.highWaterMark:gt.length>0)||gt.ended))return H("read: emitReadable",gt.length,gt.ended),gt.length===0&&gt.ended?At(this):Ye(this),null;if((Xe=ht(Xe,gt))===0&&gt.ended)return gt.length===0&&At(this),null;var me,Be=gt.needReadable;return H("need readable",Be),(gt.length===0||gt.length-Xe<gt.highWaterMark)&&H("length less than watermark",Be=!0),gt.ended||gt.reading?H("reading or ended",Be=!1):Be&&(H("do read"),gt.reading=!0,gt.sync=!0,gt.length===0&&(gt.needReadable=!0),this._read(gt.highWaterMark),gt.sync=!1,gt.reading||(Xe=ht(Qt,gt))),(me=Xe>0?$e(Xe,gt):null)===null?(gt.needReadable=gt.length<=gt.highWaterMark,Xe=0):(gt.length-=Xe,gt.awaitDrain=0),gt.length===0&&(gt.ended||(gt.needReadable=!0),Qt!==Xe&&gt.ended&&At(this)),me!==null&&this.emit("data",me),me},ut.prototype._read=function(Xe){ce(this,new de("_read()"))},ut.prototype.pipe=function(Xe,gt){var Qt=this,me=this._readableState;switch(me.pipesCount){case 0:me.pipes=Xe;break;case 1:me.pipes=[me.pipes,Xe];break;default:me.pipes.push(Xe)}me.pipesCount+=1,H("pipe count=%d opts=%j",me.pipesCount,gt);var Be=gt&&gt.end===!1||Xe===w.stdout||Xe===w.stderr?wi:ft;function lt(_i,bi){H("onunpipe"),_i===Qt&&bi&&bi.hasUnpiped===!1&&(bi.hasUnpiped=!0,oi())}function ft(){H("onend"),Xe.end()}me.endEmitted?w.nextTick(Be):Qt.once("end",Be),Xe.on("unpipe",lt);var mr=dt(Qt);Xe.on("drain",mr);var gr=!1;function oi(){H("cleanup"),Xe.removeListener("close",fi),Xe.removeListener("finish",ui),Xe.removeListener("drain",mr),Xe.removeListener("error",ai),Xe.removeListener("unpipe",lt),Qt.removeListener("end",ft),Qt.removeListener("end",wi),Qt.removeListener("data",hi),gr=!0,!me.awaitDrain||Xe._writableState&&!Xe._writableState.needDrain||mr()}function hi(_i){H("ondata");var bi=Xe.write(_i);H("dest.write",bi),bi===!1&&((me.pipesCount===1&&me.pipes===Xe||me.pipesCount>1&&st(me.pipes,Xe)!==-1)&&!gr&&(H("false write response, pause",me.awaitDrain),me.awaitDrain++),Qt.pause())}function ai(_i){H("onerror",_i),wi(),Xe.removeListener("error",ai),D(Xe,"error")===0&&ce(Xe,_i)}function fi(){Xe.removeListener("finish",ui),wi()}function ui(){H("onfinish"),Xe.removeListener("close",fi),wi()}function wi(){H("unpipe"),Qt.unpipe(Xe)}return Qt.on("data",hi),fe(Xe,"error",ai),Xe.once("close",fi),Xe.once("finish",ui),Xe.emit("pipe",Qt),me.flowing||(H("pipe resume"),Qt.resume()),Xe},ut.prototype.unpipe=function(Xe){var gt=this._readableState,Qt={hasUnpiped:!1};if(gt.pipesCount===0)return this;if(gt.pipesCount===1)return Xe&&Xe!==gt.pipes||(Xe||(Xe=gt.pipes),gt.pipes=null,gt.pipesCount=0,gt.flowing=!1,Xe&&Xe.emit("unpipe",this,Qt)),this;if(!Xe){var me=gt.pipes,Be=gt.pipesCount;gt.pipes=null,gt.pipesCount=0,gt.flowing=!1;for(var lt=0;lt<Be;lt++)me[lt].emit("unpipe",this,{hasUnpiped:!1});return this}var ft=st(gt.pipes,Xe);return ft===-1||(gt.pipes.splice(ft,1),gt.pipesCount-=1,gt.pipesCount===1&&(gt.pipes=gt.pipes[0]),Xe.emit("unpipe",this,Qt)),this},ut.prototype.on=function(Xe,gt){var Qt=F.prototype.on.call(this,Xe,gt),me=this._readableState;return Xe==="data"?(me.readableListening=this.listenerCount("readable")>0,me.flowing!==!1&&this.resume()):Xe==="readable"&&(me.endEmitted||me.readableListening||(me.readableListening=me.needReadable=!0,me.flowing=!1,me.emittedReadable=!1,H("on readable",me.length,me.reading),me.length?Ye(this):me.reading||w.nextTick(dr,this))),Qt},ut.prototype.addListener=ut.prototype.on,ut.prototype.removeListener=function(Xe,gt){var Qt=F.prototype.removeListener.call(this,Xe,gt);return Xe==="readable"&&w.nextTick(It,this),Qt},ut.prototype.removeAllListeners=function(Xe){var gt=F.prototype.removeAllListeners.apply(this,arguments);return Xe!=="readable"&&Xe!==void 0||w.nextTick(It,this),gt},ut.prototype.resume=function(){var Xe=this._readableState;return Xe.flowing||(H("resume"),Xe.flowing=!Xe.readableListening,fr(this,Xe)),Xe.paused=!1,this},ut.prototype.pause=function(){return H("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(H("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},ut.prototype.wrap=function(Xe){var gt=this,Qt=this._readableState,me=!1;for(var Be in Xe.on("end",(function(){if(H("wrapped end"),Qt.decoder&&!Qt.ended){var ft=Qt.decoder.end();ft&&ft.length&&gt.push(ft)}gt.push(null)})),Xe.on("data",(function(ft){H("wrapped data"),Qt.decoder&&(ft=Qt.decoder.write(ft)),Qt.objectMode&&ft==null||(Qt.objectMode||ft&&ft.length)&&(gt.push(ft)||(me=!0,Xe.pause()))})),Xe)this[Be]===void 0&&typeof Xe[Be]=="function"&&(this[Be]=(function(ft){return function(){return Xe[ft].apply(Xe,arguments)}})(Be));for(var lt=0;lt<Ie.length;lt++)Xe.on(Ie[lt],this.emit.bind(this,Ie[lt]));return this._read=function(ft){H("wrapped _read",ft),me&&(me=!1,Xe.resume())},this},typeof Symbol=="function"&&(ut.prototype[Symbol.asyncIterator]=function(){return Q===void 0&&(Q=d("./internal/streams/async_iterator")),Q(this)}),Object.defineProperty(ut.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(ut.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(ut.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(Xe){this._readableState&&(this._readableState.flowing=Xe)}}),ut._fromList=$e,Object.defineProperty(ut.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(ut.from=function(Xe,gt){return X===void 0&&(X=d("./internal/streams/from")),X(ut,Xe,gt)})}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/async_iterator":72,"./internal/streams/buffer_list":73,"./internal/streams/destroy":74,"./internal/streams/from":76,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,events:35,inherits:46,"string_decoder/":80,util:29}],70:[function(d,m,g){m.exports=G;var w=d("../errors").codes,$=w.ERR_METHOD_NOT_IMPLEMENTED,I=w.ERR_MULTIPLE_CALLBACK,D=w.ERR_TRANSFORM_ALREADY_TRANSFORMING,F=w.ERR_TRANSFORM_WITH_LENGTH_0,U=d("./_stream_duplex");function j(q,V){var Q=this._transformState;Q.transforming=!1;var X=Q.writecb;if(X===null)return this.emit("error",new I);Q.writechunk=null,Q.writecb=null,V!=null&&this.push(V),X(q);var re=this._readableState;re.reading=!1,(re.needReadable||re.length<re.highWaterMark)&&this._read(re.highWaterMark)}function G(q){if(!(this instanceof G))return new G(q);U.call(this,q),this._transformState={afterTransform:j.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,q&&(typeof q.transform=="function"&&(this._transform=q.transform),typeof q.flush=="function"&&(this._flush=q.flush)),this.on("prefinish",Z)}function Z(){var q=this;typeof this._flush!="function"||this._readableState.destroyed?H(this,null,null):this._flush((function(V,Q){H(q,V,Q)}))}function H(q,V,Q){if(V)return q.emit("error",V);if(Q!=null&&q.push(Q),q._writableState.length)throw new F;if(q._transformState.transforming)throw new D;return q.push(null)}d("inherits")(G,U),G.prototype.push=function(q,V){return this._transformState.needTransform=!1,U.prototype.push.call(this,q,V)},G.prototype._transform=function(q,V,Q){Q(new $("_transform()"))},G.prototype._write=function(q,V,Q){var X=this._transformState;if(X.writecb=Q,X.writechunk=q,X.writeencoding=V,!X.transforming){var re=this._readableState;(X.needTransform||re.needReadable||re.length<re.highWaterMark)&&this._read(re.highWaterMark)}},G.prototype._read=function(q){var V=this._transformState;V.writechunk===null||V.transforming?V.needTransform=!0:(V.transforming=!0,this._transform(V.writechunk,V.writeencoding,V.afterTransform))},G.prototype._destroy=function(q,V){U.prototype._destroy.call(this,q,(function(Q){V(Q)}))}},{"../errors":66,"./_stream_duplex":67,inherits:46}],71:[function(d,m,g){(function(w,$){(function(){function I(Nt){var $e=this;this.next=null,this.entry=null,this.finish=function(){pr($e,Nt)}}var D;m.exports=Te,Te.WritableState=fe;var F={deprecate:d("util-deprecate")},U=d("./internal/streams/stream"),j=d("buffer").Buffer,G=$.Uint8Array||function(){};function Z(Nt){return j.from(Nt)}function H(Nt){return j.isBuffer(Nt)||Nt instanceof G}var q,V=d("./internal/streams/destroy"),Q=d("./internal/streams/state").getHighWaterMark,X=d("../errors").codes,re=X.ERR_INVALID_ARG_TYPE,J=X.ERR_METHOD_NOT_IMPLEMENTED,se=X.ERR_MULTIPLE_CALLBACK,ie=X.ERR_STREAM_CANNOT_PIPE,oe=X.ERR_STREAM_DESTROYED,pe=X.ERR_STREAM_NULL_VALUES,de=X.ERR_STREAM_WRITE_AFTER_END,ge=X.ERR_UNKNOWN_ENCODING,ce=V.errorOrDestroy;function Ie(){}function fe(Nt,$e,At){D=D||d("./_stream_duplex"),Nt=Nt||{},typeof At!="boolean"&&(At=$e instanceof D),this.objectMode=!!Nt.objectMode,At&&(this.objectMode=this.objectMode||!!Nt.writableObjectMode),this.highWaterMark=Q(this,Nt,"writableHighWaterMark",At),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Ge=Nt.decodeStrings===!1;this.decodeStrings=!Ge,this.defaultEncoding=Nt.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(st){Zt($e,st)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Nt.emitClose!==!1,this.autoDestroy=!!Nt.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new I(this)}function Te(Nt){var $e=this instanceof(D=D||d("./_stream_duplex"));if(!$e&&!q.call(Te,this))return new Te(Nt);this._writableState=new fe(Nt,this,$e),this.writable=!0,Nt&&(typeof Nt.write=="function"&&(this._write=Nt.write),typeof Nt.writev=="function"&&(this._writev=Nt.writev),typeof Nt.destroy=="function"&&(this._destroy=Nt.destroy),typeof Nt.final=="function"&&(this._final=Nt.final)),U.call(this)}function ut(Nt,$e){var At=new de;ce(Nt,At),w.nextTick($e,At)}function ze(Nt,$e,At,Ge){var st;return At===null?st=new pe:typeof At=="string"||$e.objectMode||(st=new re("chunk",["string","Buffer"],At)),!st||(ce(Nt,st),w.nextTick(Ge,st),!1)}function Ce(Nt,$e,At){return Nt.objectMode||Nt.decodeStrings===!1||typeof $e!="string"||($e=j.from($e,At)),$e}function Fe(Nt,$e,At,Ge,st,Xe){if(!At){var gt=Ce($e,Ge,st);Ge!==gt&&(At=!0,st="buffer",Ge=gt)}var Qt=$e.objectMode?1:Ge.length;$e.length+=Qt;var me=$e.length<$e.highWaterMark;if(me||($e.needDrain=!0),$e.writing||$e.corked){var Be=$e.lastBufferedRequest;$e.lastBufferedRequest={chunk:Ge,encoding:st,isBuf:At,callback:Xe,next:null},Be?Be.next=$e.lastBufferedRequest:$e.bufferedRequest=$e.lastBufferedRequest,$e.bufferedRequestCount+=1}else Et(Nt,$e,!1,Qt,Ge,st,Xe);return me}function Et(Nt,$e,At,Ge,st,Xe,gt){$e.writelen=Ge,$e.writecb=gt,$e.writing=!0,$e.sync=!0,$e.destroyed?$e.onwrite(new oe("write")):At?Nt._writev(st,$e.onwrite):Nt._write(st,Xe,$e.onwrite),$e.sync=!1}function bt(Nt,$e,At,Ge,st){--$e.pendingcb,At?(w.nextTick(st,Ge),w.nextTick(dr,Nt,$e),Nt._writableState.errorEmitted=!0,ce(Nt,Ge)):(st(Ge),Nt._writableState.errorEmitted=!0,ce(Nt,Ge),dr(Nt,$e))}function ht(Nt){Nt.writing=!1,Nt.writecb=null,Nt.length-=Nt.writelen,Nt.writelen=0}function Zt(Nt,$e){var At=Nt._writableState,Ge=At.sync,st=At.writecb;if(typeof st!="function")throw new se;if(ht(At),$e)bt(Nt,At,Ge,$e,st);else{var Xe=Lt(At)||Nt.destroyed;Xe||At.corked||At.bufferProcessing||!At.bufferedRequest||Vt(Nt,At),Ge?w.nextTick(Ye,Nt,At,Xe,st):Ye(Nt,At,Xe,st)}}function Ye(Nt,$e,At,Ge){At||_t(Nt,$e),$e.pendingcb--,Ge(),dr(Nt,$e)}function _t(Nt,$e){$e.length===0&&$e.needDrain&&($e.needDrain=!1,Nt.emit("drain"))}function Vt(Nt,$e){$e.bufferProcessing=!0;var At=$e.bufferedRequest;if(Nt._writev&&At&&At.next){var Ge=$e.bufferedRequestCount,st=new Array(Ge),Xe=$e.corkedRequestsFree;Xe.entry=At;for(var gt=0,Qt=!0;At;)st[gt]=At,At.isBuf||(Qt=!1),At=At.next,gt+=1;st.allBuffers=Qt,Et(Nt,$e,!0,$e.length,st,"",Xe.finish),$e.pendingcb++,$e.lastBufferedRequest=null,Xe.next?($e.corkedRequestsFree=Xe.next,Xe.next=null):$e.corkedRequestsFree=new I($e),$e.bufferedRequestCount=0}else{for(;At;){var me=At.chunk,Be=At.encoding,lt=At.callback;if(Et(Nt,$e,!1,$e.objectMode?1:me.length,me,Be,lt),At=At.next,$e.bufferedRequestCount--,$e.writing)break}At===null&&($e.lastBufferedRequest=null)}$e.bufferedRequest=At,$e.bufferProcessing=!1}function Lt(Nt){return Nt.ending&&Nt.length===0&&Nt.bufferedRequest===null&&!Nt.finished&&!Nt.writing}function dt(Nt,$e){Nt._final((function(At){$e.pendingcb--,At&&ce(Nt,At),$e.prefinished=!0,Nt.emit("prefinish"),dr(Nt,$e)}))}function It(Nt,$e){$e.prefinished||$e.finalCalled||(typeof Nt._final!="function"||$e.destroyed?($e.prefinished=!0,Nt.emit("prefinish")):($e.pendingcb++,$e.finalCalled=!0,w.nextTick(dt,Nt,$e)))}function dr(Nt,$e){var At=Lt($e);if(At&&(It(Nt,$e),$e.pendingcb===0&&($e.finished=!0,Nt.emit("finish"),$e.autoDestroy))){var Ge=Nt._readableState;(!Ge||Ge.autoDestroy&&Ge.endEmitted)&&Nt.destroy()}return At}function fr(Nt,$e,At){$e.ending=!0,dr(Nt,$e),At&&($e.finished?w.nextTick(At):Nt.once("finish",At)),$e.ended=!0,Nt.writable=!1}function pr(Nt,$e,At){var Ge=Nt.entry;for(Nt.entry=null;Ge;){var st=Ge.callback;$e.pendingcb--,st(At),Ge=Ge.next}$e.corkedRequestsFree.next=Nt}d("inherits")(Te,U),fe.prototype.getBuffer=function(){for(var Nt=this.bufferedRequest,$e=[];Nt;)$e.push(Nt),Nt=Nt.next;return $e},(function(){try{Object.defineProperty(fe.prototype,"buffer",{get:F.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(q=Function.prototype[Symbol.hasInstance],Object.defineProperty(Te,Symbol.hasInstance,{value:function(Nt){return!!q.call(this,Nt)||this===Te&&Nt&&Nt._writableState instanceof fe}})):q=function(Nt){return Nt instanceof this},Te.prototype.pipe=function(){ce(this,new ie)},Te.prototype.write=function(Nt,$e,At){var Ge=this._writableState,st=!1,Xe=!Ge.objectMode&&H(Nt);return Xe&&!j.isBuffer(Nt)&&(Nt=Z(Nt)),typeof $e=="function"&&(At=$e,$e=null),Xe?$e="buffer":$e||($e=Ge.defaultEncoding),typeof At!="function"&&(At=Ie),Ge.ending?ut(this,At):(Xe||ze(this,Ge,Nt,At))&&(Ge.pendingcb++,st=Fe(this,Ge,Xe,Nt,$e,At)),st},Te.prototype.cork=function(){this._writableState.corked++},Te.prototype.uncork=function(){var Nt=this._writableState;Nt.corked&&(Nt.corked--,Nt.writing||Nt.corked||Nt.bufferProcessing||!Nt.bufferedRequest||Vt(this,Nt))},Te.prototype.setDefaultEncoding=function(Nt){if(typeof Nt=="string"&&(Nt=Nt.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Nt+"").toLowerCase())>-1))throw new ge(Nt);return this._writableState.defaultEncoding=Nt,this},Object.defineProperty(Te.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Te.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Te.prototype._write=function(Nt,$e,At){At(new J("_write()"))},Te.prototype._writev=null,Te.prototype.end=function(Nt,$e,At){var Ge=this._writableState;return typeof Nt=="function"?(At=Nt,Nt=null,$e=null):typeof $e=="function"&&(At=$e,$e=null),Nt!=null&&this.write(Nt,$e),Ge.corked&&(Ge.corked=1,this.uncork()),Ge.ending||fr(this,Ge,At),this},Object.defineProperty(Te.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(Te.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(Nt){this._writableState&&(this._writableState.destroyed=Nt)}}),Te.prototype.destroy=V.destroy,Te.prototype._undestroy=V.undestroy,Te.prototype._destroy=function(Nt,$e){$e(Nt)}}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/destroy":74,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,inherits:46,"util-deprecate":81}],72:[function(d,m,g){(function(w){(function(){var $;function I(oe,pe,de){return pe in oe?Object.defineProperty(oe,pe,{value:de,enumerable:!0,configurable:!0,writable:!0}):oe[pe]=de,oe}var D=d("./end-of-stream"),F=Symbol("lastResolve"),U=Symbol("lastReject"),j=Symbol("error"),G=Symbol("ended"),Z=Symbol("lastPromise"),H=Symbol("handlePromise"),q=Symbol("stream");function V(oe,pe){return{value:oe,done:pe}}function Q(oe){var pe=oe[F];if(pe!==null){var de=oe[q].read();de!==null&&(oe[Z]=null,oe[F]=null,oe[U]=null,pe(V(de,!1)))}}function X(oe){w.nextTick(Q,oe)}function re(oe,pe){return function(de,ge){oe.then((function(){pe[G]?de(V(void 0,!0)):pe[H](de,ge)}),ge)}}var J=Object.getPrototypeOf((function(){})),se=Object.setPrototypeOf(($={get stream(){return this[q]},next:function(){var oe=this,pe=this[j];if(pe!==null)return Promise.reject(pe);if(this[G])return Promise.resolve(V(void 0,!0));if(this[q].destroyed)return new Promise((function(Ie,fe){w.nextTick((function(){oe[j]?fe(oe[j]):Ie(V(void 0,!0))}))}));var de,ge=this[Z];if(ge)de=new Promise(re(ge,this));else{var ce=this[q].read();if(ce!==null)return Promise.resolve(V(ce,!1));de=new Promise(this[H])}return this[Z]=de,de}},I($,Symbol.asyncIterator,(function(){return this})),I($,"return",(function(){var oe=this;return new Promise((function(pe,de){oe[q].destroy(null,(function(ge){ge?de(ge):pe(V(void 0,!0))}))}))})),$),J),ie=function(oe){var pe,de=Object.create(se,(I(pe={},q,{value:oe,writable:!0}),I(pe,F,{value:null,writable:!0}),I(pe,U,{value:null,writable:!0}),I(pe,j,{value:null,writable:!0}),I(pe,G,{value:oe._readableState.endEmitted,writable:!0}),I(pe,H,{value:function(ge,ce){var Ie=de[q].read();Ie?(de[Z]=null,de[F]=null,de[U]=null,ge(V(Ie,!1))):(de[F]=ge,de[U]=ce)},writable:!0}),pe));return de[Z]=null,D(oe,(function(ge){if(ge&&ge.code!=="ERR_STREAM_PREMATURE_CLOSE"){var ce=de[U];return ce!==null&&(de[Z]=null,de[F]=null,de[U]=null,ce(ge)),void(de[j]=ge)}var Ie=de[F];Ie!==null&&(de[Z]=null,de[F]=null,de[U]=null,Ie(V(void 0,!0))),de[G]=!0})),oe.on("readable",X.bind(null,de)),de};m.exports=ie}).call(this)}).call(this,d("_process"))},{"./end-of-stream":75,_process:63}],73:[function(d,m,g){function w(q,V){var Q=Object.keys(q);if(Object.getOwnPropertySymbols){var X=Object.getOwnPropertySymbols(q);V&&(X=X.filter((function(re){return Object.getOwnPropertyDescriptor(q,re).enumerable}))),Q.push.apply(Q,X)}return Q}function $(q){for(var V=1;V<arguments.length;V++){var Q=arguments[V]!=null?arguments[V]:{};V%2?w(Object(Q),!0).forEach((function(X){I(q,X,Q[X])})):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(Q)):w(Object(Q)).forEach((function(X){Object.defineProperty(q,X,Object.getOwnPropertyDescriptor(Q,X))}))}return q}function I(q,V,Q){return V in q?Object.defineProperty(q,V,{value:Q,enumerable:!0,configurable:!0,writable:!0}):q[V]=Q,q}function D(q,V){if(!(q instanceof V))throw new TypeError("Cannot call a class as a function")}function F(q,V){for(var Q=0;Q<V.length;Q++){var X=V[Q];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(q,X.key,X)}}function U(q,V,Q){return V&&F(q.prototype,V),q}var j=d("buffer").Buffer,G=d("util").inspect,Z=G&&G.custom||"inspect";function H(q,V,Q){j.prototype.copy.call(q,V,Q)}m.exports=(function(){function q(){D(this,q),this.head=null,this.tail=null,this.length=0}return U(q,[{key:"push",value:function(V){var Q={data:V,next:null};this.length>0?this.tail.next=Q:this.head=Q,this.tail=Q,++this.length}},{key:"unshift",value:function(V){var Q={data:V,next:this.head};this.length===0&&(this.tail=Q),this.head=Q,++this.length}},{key:"shift",value:function(){if(this.length!==0){var V=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,V}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(V){if(this.length===0)return"";for(var Q=this.head,X=""+Q.data;Q=Q.next;)X+=V+Q.data;return X}},{key:"concat",value:function(V){if(this.length===0)return j.alloc(0);for(var Q=j.allocUnsafe(V>>>0),X=this.head,re=0;X;)H(X.data,Q,re),re+=X.data.length,X=X.next;return Q}},{key:"consume",value:function(V,Q){var X;return V<this.head.data.length?(X=this.head.data.slice(0,V),this.head.data=this.head.data.slice(V)):X=V===this.head.data.length?this.shift():Q?this._getString(V):this._getBuffer(V),X}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(V){var Q=this.head,X=1,re=Q.data;for(V-=re.length;Q=Q.next;){var J=Q.data,se=V>J.length?J.length:V;if(se===J.length?re+=J:re+=J.slice(0,V),(V-=se)==0){se===J.length?(++X,Q.next?this.head=Q.next:this.head=this.tail=null):(this.head=Q,Q.data=J.slice(se));break}++X}return this.length-=X,re}},{key:"_getBuffer",value:function(V){var Q=j.allocUnsafe(V),X=this.head,re=1;for(X.data.copy(Q),V-=X.data.length;X=X.next;){var J=X.data,se=V>J.length?J.length:V;if(J.copy(Q,Q.length-V,0,se),(V-=se)==0){se===J.length?(++re,X.next?this.head=X.next:this.head=this.tail=null):(this.head=X,X.data=J.slice(se));break}++re}return this.length-=re,Q}},{key:Z,value:function(V,Q){return G(this,$({},Q,{depth:0,customInspect:!1}))}}]),q})()},{buffer:32,util:29}],74:[function(d,m,g){(function(w){(function(){function $(G,Z){var H=this,q=this._readableState&&this._readableState.destroyed,V=this._writableState&&this._writableState.destroyed;return q||V?(Z?Z(G):G&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,w.nextTick(U,this,G)):w.nextTick(U,this,G)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(G||null,(function(Q){!Z&&Q?H._writableState?H._writableState.errorEmitted?w.nextTick(D,H):(H._writableState.errorEmitted=!0,w.nextTick(I,H,Q)):w.nextTick(I,H,Q):Z?(w.nextTick(D,H),Z(Q)):w.nextTick(D,H)})),this)}function I(G,Z){U(G,Z),D(G)}function D(G){G._writableState&&!G._writableState.emitClose||G._readableState&&!G._readableState.emitClose||G.emit("close")}function F(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function U(G,Z){G.emit("error",Z)}function j(G,Z){var H=G._readableState,q=G._writableState;H&&H.autoDestroy||q&&q.autoDestroy?G.destroy(Z):G.emit("error",Z)}m.exports={destroy:$,undestroy:F,errorOrDestroy:j}}).call(this)}).call(this,d("_process"))},{_process:63}],75:[function(d,m,g){var w=d("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function $(U){var j=!1;return function(){if(!j){j=!0;for(var G=arguments.length,Z=new Array(G),H=0;H<G;H++)Z[H]=arguments[H];U.apply(this,Z)}}}function I(){}function D(U){return U.setHeader&&typeof U.abort=="function"}function F(U,j,G){if(typeof j=="function")return F(U,null,j);j||(j={}),G=$(G||I);var Z=j.readable||j.readable!==!1&&U.readable,H=j.writable||j.writable!==!1&&U.writable,q=function(){U.writable||Q()},V=U._writableState&&U._writableState.finished,Q=function(){H=!1,V=!0,Z||G.call(U)},X=U._readableState&&U._readableState.endEmitted,re=function(){Z=!1,X=!0,H||G.call(U)},J=function(oe){G.call(U,oe)},se=function(){var oe;return Z&&!X?(U._readableState&&U._readableState.ended||(oe=new w),G.call(U,oe)):H&&!V?(U._writableState&&U._writableState.ended||(oe=new w),G.call(U,oe)):void 0},ie=function(){U.req.on("finish",Q)};return D(U)?(U.on("complete",Q),U.on("abort",se),U.req?ie():U.on("request",ie)):H&&!U._writableState&&(U.on("end",q),U.on("close",q)),U.on("end",re),U.on("finish",Q),j.error!==!1&&U.on("error",J),U.on("close",se),function(){U.removeListener("complete",Q),U.removeListener("abort",se),U.removeListener("request",ie),U.req&&U.req.removeListener("finish",Q),U.removeListener("end",q),U.removeListener("close",q),U.removeListener("finish",Q),U.removeListener("end",re),U.removeListener("error",J),U.removeListener("close",se)}}m.exports=F},{"../../../errors":66}],76:[function(d,m,g){m.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],77:[function(d,m,g){var w;function $(Q){var X=!1;return function(){X||(X=!0,Q.apply(void 0,arguments))}}var I=d("../../../errors").codes,D=I.ERR_MISSING_ARGS,F=I.ERR_STREAM_DESTROYED;function U(Q){if(Q)throw Q}function j(Q){return Q.setHeader&&typeof Q.abort=="function"}function G(Q,X,re,J){J=$(J);var se=!1;Q.on("close",(function(){se=!0})),w===void 0&&(w=d("./end-of-stream")),w(Q,{readable:X,writable:re},(function(oe){if(oe)return J(oe);se=!0,J()}));var ie=!1;return function(oe){if(!se&&!ie)return ie=!0,j(Q)?Q.abort():typeof Q.destroy=="function"?Q.destroy():void J(oe||new F("pipe"))}}function Z(Q){Q()}function H(Q,X){return Q.pipe(X)}function q(Q){return Q.length?typeof Q[Q.length-1]!="function"?U:Q.pop():U}function V(){for(var Q=arguments.length,X=new Array(Q),re=0;re<Q;re++)X[re]=arguments[re];var J,se=q(X);if(Array.isArray(X[0])&&(X=X[0]),X.length<2)throw new D("streams");var ie=X.map((function(oe,pe){var de=pe<X.length-1;return G(oe,de,pe>0,(function(ge){J||(J=ge),ge&&ie.forEach(Z),de||(ie.forEach(Z),se(J))}))}));return X.reduce(H)}m.exports=V},{"../../../errors":66,"./end-of-stream":75}],78:[function(d,m,g){var w=d("../../../errors").codes.ERR_INVALID_OPT_VALUE;function $(D,F,U){return D.highWaterMark!=null?D.highWaterMark:F?D[U]:null}function I(D,F,U,j){var G=$(F,j,U);if(G!=null){if(!isFinite(G)||Math.floor(G)!==G||G<0)throw new w(j?U:"highWaterMark",G);return Math.floor(G)}return D.objectMode?16:16384}m.exports={getHighWaterMark:I}},{"../../../errors":66}],79:[function(d,m,g){m.exports=d("events").EventEmitter},{events:35}],80:[function(d,m,g){var w=d("safe-buffer").Buffer,$=w.isEncoding||function(ie){switch((ie=""+ie)&&ie.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function I(ie){if(!ie)return"utf8";for(var oe;;)switch(ie){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return ie;default:if(oe)return;ie=(""+ie).toLowerCase(),oe=!0}}function D(ie){var oe=I(ie);if(typeof oe!="string"&&(w.isEncoding===$||!$(ie)))throw new Error("Unknown encoding: "+ie);return oe||ie}function F(ie){var oe;switch(this.encoding=D(ie),this.encoding){case"utf16le":this.text=V,this.end=Q,oe=4;break;case"utf8":this.fillLast=Z,oe=4;break;case"base64":this.text=X,this.end=re,oe=3;break;default:return this.write=J,void(this.end=se)}this.lastNeed=0,this.lastTotal=0,this.lastChar=w.allocUnsafe(oe)}function U(ie){return ie<=127?0:ie>>5==6?2:ie>>4==14?3:ie>>3==30?4:ie>>6==2?-1:-2}function j(ie,oe,pe){var de=oe.length-1;if(de<pe)return 0;var ge=U(oe[de]);return ge>=0?(ge>0&&(ie.lastNeed=ge-1),ge):--de<pe||ge===-2?0:(ge=U(oe[de]))>=0?(ge>0&&(ie.lastNeed=ge-2),ge):--de<pe||ge===-2?0:(ge=U(oe[de]))>=0?(ge>0&&(ge===2?ge=0:ie.lastNeed=ge-3),ge):0}function G(ie,oe,pe){if((192&oe[0])!=128)return ie.lastNeed=0,"";if(ie.lastNeed>1&&oe.length>1){if((192&oe[1])!=128)return ie.lastNeed=1,"";if(ie.lastNeed>2&&oe.length>2&&(192&oe[2])!=128)return ie.lastNeed=2,""}}function Z(ie){var oe=this.lastTotal-this.lastNeed,pe=G(this,ie);return pe!==void 0?pe:this.lastNeed<=ie.length?(ie.copy(this.lastChar,oe,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(ie.copy(this.lastChar,oe,0,ie.length),void(this.lastNeed-=ie.length))}function H(ie,oe){var pe=j(this,ie,oe);if(!this.lastNeed)return ie.toString("utf8",oe);this.lastTotal=pe;var de=ie.length-(pe-this.lastNeed);return ie.copy(this.lastChar,0,de),ie.toString("utf8",oe,de)}function q(ie){var oe=ie&&ie.length?this.write(ie):"";return this.lastNeed?oe+"":oe}function V(ie,oe){if((ie.length-oe)%2==0){var pe=ie.toString("utf16le",oe);if(pe){var de=pe.charCodeAt(pe.length-1);if(de>=55296&&de<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=ie[ie.length-2],this.lastChar[1]=ie[ie.length-1],pe.slice(0,-1)}return pe}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=ie[ie.length-1],ie.toString("utf16le",oe,ie.length-1)}function Q(ie){var oe=ie&&ie.length?this.write(ie):"";if(this.lastNeed){var pe=this.lastTotal-this.lastNeed;return oe+this.lastChar.toString("utf16le",0,pe)}return oe}function X(ie,oe){var pe=(ie.length-oe)%3;return pe===0?ie.toString("base64",oe):(this.lastNeed=3-pe,this.lastTotal=3,pe===1?this.lastChar[0]=ie[ie.length-1]:(this.lastChar[0]=ie[ie.length-2],this.lastChar[1]=ie[ie.length-1]),ie.toString("base64",oe,ie.length-pe))}function re(ie){var oe=ie&&ie.length?this.write(ie):"";return this.lastNeed?oe+this.lastChar.toString("base64",0,3-this.lastNeed):oe}function J(ie){return ie.toString(this.encoding)}function se(ie){return ie&&ie.length?this.write(ie):""}g.StringDecoder=F,F.prototype.write=function(ie){if(ie.length===0)return"";var oe,pe;if(this.lastNeed){if((oe=this.fillLast(ie))===void 0)return"";pe=this.lastNeed,this.lastNeed=0}else pe=0;return pe<ie.length?oe?oe+this.text(ie,pe):this.text(ie,pe):oe||""},F.prototype.end=q,F.prototype.text=H,F.prototype.fillLast=function(ie){if(this.lastNeed<=ie.length)return ie.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);ie.copy(this.lastChar,this.lastTotal-this.lastNeed,0,ie.length),this.lastNeed-=ie.length}},{"safe-buffer":64}],81:[function(d,m,g){(function(w){(function(){function $(D,F){if(I("noDeprecation"))return D;var U=!1;function j(){if(!U){if(I("throwDeprecation"))throw new Error(F);I("traceDeprecation")?console.trace(F):console.warn(F),U=!0}return D.apply(this,arguments)}return j}function I(D){try{if(!w.localStorage)return!1}catch{return!1}var F=w.localStorage[D];return F!=null&&String(F).toLowerCase()==="true"}m.exports=$}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],82:[function(d,m,g){arguments[4][25][0].apply(g,arguments)},{dup:25}],83:[function(d,m,g){var w=d("is-arguments"),$=d("is-generator-function"),I=d("which-typed-array"),D=d("is-typed-array");function F(ft){return ft.call.bind(ft)}var U=typeof BigInt<"u",j=typeof Symbol<"u",G=F(Object.prototype.toString),Z=F(Number.prototype.valueOf),H=F(String.prototype.valueOf),q=F(Boolean.prototype.valueOf);if(U)var V=F(BigInt.prototype.valueOf);if(j)var Q=F(Symbol.prototype.valueOf);function X(ft,mr){if(typeof ft!="object")return!1;try{return mr(ft),!0}catch{return!1}}function re(ft){return typeof Promise<"u"&&ft instanceof Promise||ft!==null&&typeof ft=="object"&&typeof ft.then=="function"&&typeof ft.catch=="function"}function J(ft){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(ft):D(ft)||dt(ft)}function se(ft){return I(ft)==="Uint8Array"}function ie(ft){return I(ft)==="Uint8ClampedArray"}function oe(ft){return I(ft)==="Uint16Array"}function pe(ft){return I(ft)==="Uint32Array"}function de(ft){return I(ft)==="Int8Array"}function ge(ft){return I(ft)==="Int16Array"}function ce(ft){return I(ft)==="Int32Array"}function Ie(ft){return I(ft)==="Float32Array"}function fe(ft){return I(ft)==="Float64Array"}function Te(ft){return I(ft)==="BigInt64Array"}function ut(ft){return I(ft)==="BigUint64Array"}function ze(ft){return G(ft)==="[object Map]"}function Ce(ft){return typeof Map<"u"&&(ze.working?ze(ft):ft instanceof Map)}function Fe(ft){return G(ft)==="[object Set]"}function Et(ft){return typeof Set<"u"&&(Fe.working?Fe(ft):ft instanceof Set)}function bt(ft){return G(ft)==="[object WeakMap]"}function ht(ft){return typeof WeakMap<"u"&&(bt.working?bt(ft):ft instanceof WeakMap)}function Zt(ft){return G(ft)==="[object WeakSet]"}function Ye(ft){return Zt(ft)}function _t(ft){return G(ft)==="[object ArrayBuffer]"}function Vt(ft){return typeof ArrayBuffer<"u"&&(_t.working?_t(ft):ft instanceof ArrayBuffer)}function Lt(ft){return G(ft)==="[object DataView]"}function dt(ft){return typeof DataView<"u"&&(Lt.working?Lt(ft):ft instanceof DataView)}g.isArgumentsObject=w,g.isGeneratorFunction=$,g.isTypedArray=D,g.isPromise=re,g.isArrayBufferView=J,g.isUint8Array=se,g.isUint8ClampedArray=ie,g.isUint16Array=oe,g.isUint32Array=pe,g.isInt8Array=de,g.isInt16Array=ge,g.isInt32Array=ce,g.isFloat32Array=Ie,g.isFloat64Array=fe,g.isBigInt64Array=Te,g.isBigUint64Array=ut,ze.working=typeof Map<"u"&&ze(new Map),g.isMap=Ce,Fe.working=typeof Set<"u"&&Fe(new Set),g.isSet=Et,bt.working=typeof WeakMap<"u"&&bt(new WeakMap),g.isWeakMap=ht,Zt.working=typeof WeakSet<"u"&&Zt(new WeakSet),g.isWeakSet=Ye,_t.working=typeof ArrayBuffer<"u"&&_t(new ArrayBuffer),g.isArrayBuffer=Vt,Lt.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Lt(new DataView(new ArrayBuffer(1),0,1)),g.isDataView=dt;var It=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function dr(ft){return G(ft)==="[object SharedArrayBuffer]"}function fr(ft){return It!==void 0&&(dr.working===void 0&&(dr.working=dr(new It)),dr.working?dr(ft):ft instanceof It)}function pr(ft){return G(ft)==="[object AsyncFunction]"}function Nt(ft){return G(ft)==="[object Map Iterator]"}function $e(ft){return G(ft)==="[object Set Iterator]"}function At(ft){return G(ft)==="[object Generator]"}function Ge(ft){return G(ft)==="[object WebAssembly.Module]"}function st(ft){return X(ft,Z)}function Xe(ft){return X(ft,H)}function gt(ft){return X(ft,q)}function Qt(ft){return U&&X(ft,V)}function me(ft){return j&&X(ft,Q)}function Be(ft){return st(ft)||Xe(ft)||gt(ft)||Qt(ft)||me(ft)}function lt(ft){return typeof Uint8Array<"u"&&(Vt(ft)||fr(ft))}g.isSharedArrayBuffer=fr,g.isAsyncFunction=pr,g.isMapIterator=Nt,g.isSetIterator=$e,g.isGeneratorObject=At,g.isWebAssemblyCompiledModule=Ge,g.isNumberObject=st,g.isStringObject=Xe,g.isBooleanObject=gt,g.isBigIntObject=Qt,g.isSymbolObject=me,g.isBoxedPrimitive=Be,g.isAnyArrayBuffer=lt,["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(ft){Object.defineProperty(g,ft,{enumerable:!1,value:function(){throw new Error(ft+" is not supported in userland")}})}))},{"is-arguments":47,"is-generator-function":49,"is-typed-array":50,"which-typed-array":85}],84:[function(d,m,g){(function(w){(function(){var $=Object.getOwnPropertyDescriptors||function(dt){for(var It=Object.keys(dt),dr={},fr=0;fr<It.length;fr++)dr[It[fr]]=Object.getOwnPropertyDescriptor(dt,It[fr]);return dr},I=/%[sdj%]/g;g.format=function(dt){if(!ge(dt)){for(var It=[],dr=0;dr<arguments.length;dr++)It.push(j(arguments[dr]));return It.join(" ")}dr=1;for(var fr=arguments,pr=fr.length,Nt=String(dt).replace(I,(function(At){if(At==="%%")return"%";if(dr>=pr)return At;switch(At){case"%s":return String(fr[dr++]);case"%d":return Number(fr[dr++]);case"%j":try{return JSON.stringify(fr[dr++])}catch{return"[Circular]"}default:return At}})),$e=fr[dr];dr<pr;$e=fr[++dr])oe($e)||!Te($e)?Nt+=" "+$e:Nt+=" "+j($e);return Nt},g.deprecate=function(dt,It){if(w!==void 0&&w.noDeprecation===!0)return dt;if(w===void 0)return function(){return g.deprecate(dt,It).apply(this,arguments)};var dr=!1;function fr(){if(!dr){if(w.throwDeprecation)throw new Error(It);w.traceDeprecation?console.trace(It):console.error(It),dr=!0}return dt.apply(this,arguments)}return fr};var D={},F=/^$/;if(w.env.NODE_DEBUG){var U=w.env.NODE_DEBUG;U=U.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),F=new RegExp("^"+U+"$","i")}function j(dt,It){var dr={seen:[],stylize:Z};return arguments.length>=3&&(dr.depth=arguments[2]),arguments.length>=4&&(dr.colors=arguments[3]),ie(It)?dr.showHidden=It:It&&g._extend(dr,It),Ie(dr.showHidden)&&(dr.showHidden=!1),Ie(dr.depth)&&(dr.depth=2),Ie(dr.colors)&&(dr.colors=!1),Ie(dr.customInspect)&&(dr.customInspect=!0),dr.colors&&(dr.stylize=G),q(dr,dt,dr.depth)}function G(dt,It){var dr=j.styles[It];return dr?"\x1B["+j.colors[dr][0]+"m"+dt+"\x1B["+j.colors[dr][1]+"m":dt}function Z(dt,It){return dt}function H(dt){var It={};return dt.forEach((function(dr,fr){It[dr]=!0})),It}function q(dt,It,dr){if(dt.customInspect&&It&&Ce(It.inspect)&&It.inspect!==g.inspect&&(!It.constructor||It.constructor.prototype!==It)){var fr=It.inspect(dr,dt);return ge(fr)||(fr=q(dt,fr,dr)),fr}var pr=V(dt,It);if(pr)return pr;var Nt=Object.keys(It),$e=H(Nt);if(dt.showHidden&&(Nt=Object.getOwnPropertyNames(It)),ze(It)&&(Nt.indexOf("message")>=0||Nt.indexOf("description")>=0))return Q(It);if(Nt.length===0){if(Ce(It)){var At=It.name?": "+It.name:"";return dt.stylize("[Function"+At+"]","special")}if(fe(It))return dt.stylize(RegExp.prototype.toString.call(It),"regexp");if(ut(It))return dt.stylize(Date.prototype.toString.call(It),"date");if(ze(It))return Q(It)}var Ge,st="",Xe=!1,gt=["{","}"];return se(It)&&(Xe=!0,gt=["[","]"]),Ce(It)&&(st=" [Function"+(It.name?": "+It.name:"")+"]"),fe(It)&&(st=" "+RegExp.prototype.toString.call(It)),ut(It)&&(st=" "+Date.prototype.toUTCString.call(It)),ze(It)&&(st=" "+Q(It)),Nt.length!==0||Xe&&It.length!=0?dr<0?fe(It)?dt.stylize(RegExp.prototype.toString.call(It),"regexp"):dt.stylize("[Object]","special"):(dt.seen.push(It),Ge=Xe?X(dt,It,dr,$e,Nt):Nt.map((function(Qt){return re(dt,It,dr,$e,Qt,Xe)})),dt.seen.pop(),J(Ge,st,gt)):gt[0]+st+gt[1]}function V(dt,It){if(Ie(It))return dt.stylize("undefined","undefined");if(ge(It)){var dr="'"+JSON.stringify(It).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return dt.stylize(dr,"string")}return de(It)?dt.stylize(""+It,"number"):ie(It)?dt.stylize(""+It,"boolean"):oe(It)?dt.stylize("null","null"):void 0}function Q(dt){return"["+Error.prototype.toString.call(dt)+"]"}function X(dt,It,dr,fr,pr){for(var Nt=[],$e=0,At=It.length;$e<At;++$e)Ye(It,String($e))?Nt.push(re(dt,It,dr,fr,String($e),!0)):Nt.push("");return pr.forEach((function(Ge){Ge.match(/^\d+$/)||Nt.push(re(dt,It,dr,fr,Ge,!0))})),Nt}function re(dt,It,dr,fr,pr,Nt){var $e,At,Ge;if((Ge=Object.getOwnPropertyDescriptor(It,pr)||{value:It[pr]}).get?At=Ge.set?dt.stylize("[Getter/Setter]","special"):dt.stylize("[Getter]","special"):Ge.set&&(At=dt.stylize("[Setter]","special")),Ye(fr,pr)||($e="["+pr+"]"),At||(dt.seen.indexOf(Ge.value)<0?(At=oe(dr)?q(dt,Ge.value,null):q(dt,Ge.value,dr-1)).indexOf(`
`)>-1&&(At=Nt?At.split(`
`).map((function(st){return"  "+st})).join(`
`).slice(2):`
`+At.split(`
`).map((function(st){return"   "+st})).join(`
`)):At=dt.stylize("[Circular]","special")),Ie($e)){if(Nt&&pr.match(/^\d+$/))return At;($e=JSON.stringify(""+pr)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?($e=$e.slice(1,-1),$e=dt.stylize($e,"name")):($e=$e.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),$e=dt.stylize($e,"string"))}return $e+": "+At}function J(dt,It,dr){return dt.reduce((function(fr,pr){return pr.indexOf(`
`),fr+pr.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?dr[0]+(It===""?"":It+`
 `)+" "+dt.join(`,
  `)+" "+dr[1]:dr[0]+It+" "+dt.join(", ")+" "+dr[1]}function se(dt){return Array.isArray(dt)}function ie(dt){return typeof dt=="boolean"}function oe(dt){return dt===null}function pe(dt){return dt==null}function de(dt){return typeof dt=="number"}function ge(dt){return typeof dt=="string"}function ce(dt){return typeof dt=="symbol"}function Ie(dt){return dt===void 0}function fe(dt){return Te(dt)&&Et(dt)==="[object RegExp]"}function Te(dt){return typeof dt=="object"&&dt!==null}function ut(dt){return Te(dt)&&Et(dt)==="[object Date]"}function ze(dt){return Te(dt)&&(Et(dt)==="[object Error]"||dt instanceof Error)}function Ce(dt){return typeof dt=="function"}function Fe(dt){return dt===null||typeof dt=="boolean"||typeof dt=="number"||typeof dt=="string"||typeof dt=="symbol"||dt===void 0}function Et(dt){return Object.prototype.toString.call(dt)}function bt(dt){return dt<10?"0"+dt.toString(10):dt.toString(10)}g.debuglog=function(dt){if(dt=dt.toUpperCase(),!D[dt])if(F.test(dt)){var It=w.pid;D[dt]=function(){var dr=g.format.apply(g,arguments);console.error("%s %d: %s",dt,It,dr)}}else D[dt]=function(){};return D[dt]},g.inspect=j,j.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},j.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},g.types=d("./support/types"),g.isArray=se,g.isBoolean=ie,g.isNull=oe,g.isNullOrUndefined=pe,g.isNumber=de,g.isString=ge,g.isSymbol=ce,g.isUndefined=Ie,g.isRegExp=fe,g.types.isRegExp=fe,g.isObject=Te,g.isDate=ut,g.types.isDate=ut,g.isError=ze,g.types.isNativeError=ze,g.isFunction=Ce,g.isPrimitive=Fe,g.isBuffer=d("./support/isBuffer");var ht=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Zt(){var dt=new Date,It=[bt(dt.getHours()),bt(dt.getMinutes()),bt(dt.getSeconds())].join(":");return[dt.getDate(),ht[dt.getMonth()],It].join(" ")}function Ye(dt,It){return Object.prototype.hasOwnProperty.call(dt,It)}g.log=function(){console.log("%s - %s",Zt(),g.format.apply(g,arguments))},g.inherits=d("inherits"),g._extend=function(dt,It){if(!It||!Te(It))return dt;for(var dr=Object.keys(It),fr=dr.length;fr--;)dt[dr[fr]]=It[dr[fr]];return dt};var _t=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;function Vt(dt,It){if(!dt){var dr=new Error("Promise was rejected with a falsy value");dr.reason=dt,dt=dr}return It(dt)}function Lt(dt){if(typeof dt!="function")throw new TypeError('The "original" argument must be of type Function');function It(){for(var dr=[],fr=0;fr<arguments.length;fr++)dr.push(arguments[fr]);var pr=dr.pop();if(typeof pr!="function")throw new TypeError("The last argument must be of type Function");var Nt=this,$e=function(){return pr.apply(Nt,arguments)};dt.apply(this,dr).then((function(At){w.nextTick($e.bind(null,null,At))}),(function(At){w.nextTick(Vt.bind(null,At,$e))}))}return Object.setPrototypeOf(It,Object.getPrototypeOf(dt)),Object.defineProperties(It,$(dt)),It}g.promisify=function(dt){if(typeof dt!="function")throw new TypeError('The "original" argument must be of type Function');if(_t&&dt[_t]){var It;if(typeof(It=dt[_t])!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(It,_t,{value:It,enumerable:!1,writable:!1,configurable:!0}),It}function It(){for(var dr,fr,pr=new Promise((function(At,Ge){dr=At,fr=Ge})),Nt=[],$e=0;$e<arguments.length;$e++)Nt.push(arguments[$e]);Nt.push((function(At,Ge){At?fr(At):dr(Ge)}));try{dt.apply(this,Nt)}catch(At){fr(At)}return pr}return Object.setPrototypeOf(It,Object.getPrototypeOf(dt)),_t&&Object.defineProperty(It,_t,{value:It,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(It,$(dt))},g.promisify.custom=_t,g.callbackify=Lt}).call(this)}).call(this,d("_process"))},{"./support/isBuffer":82,"./support/types":83,_process:63,inherits:46}],85:[function(d,m,g){(function(w){(function(){var $=d("for-each"),I=d("available-typed-arrays"),D=d("call-bind/callBound"),F=d("gopd"),U=D("Object.prototype.toString"),j=d("has-tostringtag/shams")(),G=typeof globalThis>"u"?w:globalThis,Z=I(),H=D("String.prototype.slice"),q={},V=Object.getPrototypeOf;j&&F&&V&&$(Z,(function(re){if(typeof G[re]=="function"){var J=new G[re];if(Symbol.toStringTag in J){var se=V(J),ie=F(se,Symbol.toStringTag);if(!ie){var oe=V(se);ie=F(oe,Symbol.toStringTag)}q[re]=ie.get}}}));var Q=function(re){var J=!1;return $(q,(function(se,ie){if(!J)try{var oe=se.call(re);oe===ie&&(J=oe)}catch{}})),J},X=d("is-typed-array");m.exports=function(re){return!!X(re)&&(j&&Symbol.toStringTag in re?Q(re):H(U(re),8,-1))}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43,"is-typed-array":50}]},{},[20])(20);var browserExports=browser$1.exports,PNGFilterType,PNGFilterType2,PNGColorType,PNGColorType2;function png(){return{mime:"image/png",hasAlpha:!0,encode:(d,{deflateLevel:m=9,deflateStrategy:g=3,filterType:w=PNGFilterType.AUTO,colorType:$,inputHasAlpha:I=!0,...D}={})=>{const F=new browserExports.PNG({width:d.width,height:d.height});return F.data=d.data,browserExports.PNG.sync.write(F,{...D,deflateLevel:m,deflateStrategy:g,filterType:w,colorType:$!==void 0?$:I?PNGColorType.COLOR_ALPHA:PNGColorType.COLOR,inputHasAlpha:I})},decode:(d,m)=>{const g=browserExports.PNG.sync.read(d,m);return{data:g.data,width:g.width,height:g.height}}}}PNGFilterType2=PNGFilterType||(PNGFilterType={}),PNGFilterType2[PNGFilterType2.AUTO=-1]="AUTO",PNGFilterType2[PNGFilterType2.NONE=0]="NONE",PNGFilterType2[PNGFilterType2.SUB=1]="SUB",PNGFilterType2[PNGFilterType2.UP=2]="UP",PNGFilterType2[PNGFilterType2.AVERAGE=3]="AVERAGE",PNGFilterType2[PNGFilterType2.PATH=4]="PATH",PNGColorType2=PNGColorType||(PNGColorType={}),PNGColorType2[PNGColorType2.GRAYSCALE=0]="GRAYSCALE",PNGColorType2[PNGColorType2.COLOR=2]="COLOR",PNGColorType2[PNGColorType2.GRAYSCALE_ALPHA=4]="GRAYSCALE_ALPHA",PNGColorType2[PNGColorType2.COLOR_ALPHA=6]="COLOR_ALPHA";var UTIF={exports:{}},common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,(function(d){var m=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function g(I,D){return Object.prototype.hasOwnProperty.call(I,D)}d.assign=function(I){for(var D=Array.prototype.slice.call(arguments,1);D.length;){var F=D.shift();if(F){if(typeof F!="object")throw new TypeError(F+"must be non-object");for(var U in F)g(F,U)&&(I[U]=F[U])}}return I},d.shrinkBuf=function(I,D){return I.length===D?I:I.subarray?I.subarray(0,D):(I.length=D,I)};var w={arraySet:function(I,D,F,U,j){if(D.subarray&&I.subarray)I.set(D.subarray(F,F+U),j);else for(var G=0;G<U;G++)I[j+G]=D[F+G]},flattenChunks:function(I){var D,F,U,j,G,Z;for(U=0,D=0,F=I.length;D<F;D++)U+=I[D].length;for(Z=new Uint8Array(U),j=0,D=0,F=I.length;D<F;D++)G=I[D],Z.set(G,j),j+=G.length;return Z}},$={arraySet:function(I,D,F,U,j){for(var G=0;G<U;G++)I[j+G]=D[F+G]},flattenChunks:function(I){return[].concat.apply([],I)}};d.setTyped=function(I){I?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,w)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,$))},d.setTyped(m)})(common)),common}var deflate$1={},deflate={},trees={},hasRequiredTrees,adler32_1,hasRequiredAdler32,crc32_1,hasRequiredCrc32,messages,hasRequiredMessages,hasRequiredDeflate$1;function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var d=requireCommon(),m=0,g=1;function w(Ge){for(var st=Ge.length;--st>=0;)Ge[st]=0}var $=0,I=29,D=256,F=D+1+I,U=30,j=19,G=2*F+1,Z=15,H=16,q=7,V=256,Q=16,X=17,re=18,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],se=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ie=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pe=new Array(2*(F+2));w(pe);var de=new Array(2*U);w(de);var ge=new Array(512);w(ge);var ce=new Array(256);w(ce);var Ie=new Array(I);w(Ie);var fe,Te,ut,ze=new Array(U);function Ce(Ge,st,Xe,gt,Qt){this.static_tree=Ge,this.extra_bits=st,this.extra_base=Xe,this.elems=gt,this.max_length=Qt,this.has_stree=Ge&&Ge.length}function Fe(Ge,st){this.dyn_tree=Ge,this.max_code=0,this.stat_desc=st}function Et(Ge){return Ge<256?ge[Ge]:ge[256+(Ge>>>7)]}function bt(Ge,st){Ge.pending_buf[Ge.pending++]=255&st,Ge.pending_buf[Ge.pending++]=st>>>8&255}function ht(Ge,st,Xe){Ge.bi_valid>H-Xe?(Ge.bi_buf|=st<<Ge.bi_valid&65535,bt(Ge,Ge.bi_buf),Ge.bi_buf=st>>H-Ge.bi_valid,Ge.bi_valid+=Xe-H):(Ge.bi_buf|=st<<Ge.bi_valid&65535,Ge.bi_valid+=Xe)}function Zt(Ge,st,Xe){ht(Ge,Xe[2*st],Xe[2*st+1])}function Ye(Ge,st){var Xe=0;do Xe|=1&Ge,Ge>>>=1,Xe<<=1;while(--st>0);return Xe>>>1}function _t(Ge,st,Xe){var gt,Qt,me=new Array(Z+1),Be=0;for(gt=1;gt<=Z;gt++)me[gt]=Be=Be+Xe[gt-1]<<1;for(Qt=0;Qt<=st;Qt++){var lt=Ge[2*Qt+1];lt!==0&&(Ge[2*Qt]=Ye(me[lt]++,lt))}}function Vt(Ge){var st;for(st=0;st<F;st++)Ge.dyn_ltree[2*st]=0;for(st=0;st<U;st++)Ge.dyn_dtree[2*st]=0;for(st=0;st<j;st++)Ge.bl_tree[2*st]=0;Ge.dyn_ltree[2*V]=1,Ge.opt_len=Ge.static_len=0,Ge.last_lit=Ge.matches=0}function Lt(Ge){Ge.bi_valid>8?bt(Ge,Ge.bi_buf):Ge.bi_valid>0&&(Ge.pending_buf[Ge.pending++]=Ge.bi_buf),Ge.bi_buf=0,Ge.bi_valid=0}function dt(Ge,st,Xe,gt){var Qt=2*st,me=2*Xe;return Ge[Qt]<Ge[me]||Ge[Qt]===Ge[me]&&gt[st]<=gt[Xe]}function It(Ge,st,Xe){for(var gt=Ge.heap[Xe],Qt=Xe<<1;Qt<=Ge.heap_len&&(Qt<Ge.heap_len&&dt(st,Ge.heap[Qt+1],Ge.heap[Qt],Ge.depth)&&Qt++,!dt(st,gt,Ge.heap[Qt],Ge.depth));)Ge.heap[Xe]=Ge.heap[Qt],Xe=Qt,Qt<<=1;Ge.heap[Xe]=gt}function dr(Ge,st,Xe){var gt,Qt,me,Be,lt=0;if(Ge.last_lit!==0)do gt=Ge.pending_buf[Ge.d_buf+2*lt]<<8|Ge.pending_buf[Ge.d_buf+2*lt+1],Qt=Ge.pending_buf[Ge.l_buf+lt],lt++,gt===0?Zt(Ge,Qt,st):(Zt(Ge,(me=ce[Qt])+D+1,st),(Be=J[me])!==0&&ht(Ge,Qt-=Ie[me],Be),Zt(Ge,me=Et(--gt),Xe),(Be=se[me])!==0&&ht(Ge,gt-=ze[me],Be));while(lt<Ge.last_lit);Zt(Ge,V,st)}function fr(Ge,st){var Xe,gt,Qt,me=st.dyn_tree,Be=st.stat_desc.static_tree,lt=st.stat_desc.has_stree,ft=st.stat_desc.elems,mr=-1;for(Ge.heap_len=0,Ge.heap_max=G,Xe=0;Xe<ft;Xe++)me[2*Xe]!==0?(Ge.heap[++Ge.heap_len]=mr=Xe,Ge.depth[Xe]=0):me[2*Xe+1]=0;for(;Ge.heap_len<2;)me[2*(Qt=Ge.heap[++Ge.heap_len]=mr<2?++mr:0)]=1,Ge.depth[Qt]=0,Ge.opt_len--,lt&&(Ge.static_len-=Be[2*Qt+1]);for(st.max_code=mr,Xe=Ge.heap_len>>1;Xe>=1;Xe--)It(Ge,me,Xe);Qt=ft;do Xe=Ge.heap[1],Ge.heap[1]=Ge.heap[Ge.heap_len--],It(Ge,me,1),gt=Ge.heap[1],Ge.heap[--Ge.heap_max]=Xe,Ge.heap[--Ge.heap_max]=gt,me[2*Qt]=me[2*Xe]+me[2*gt],Ge.depth[Qt]=(Ge.depth[Xe]>=Ge.depth[gt]?Ge.depth[Xe]:Ge.depth[gt])+1,me[2*Xe+1]=me[2*gt+1]=Qt,Ge.heap[1]=Qt++,It(Ge,me,1);while(Ge.heap_len>=2);Ge.heap[--Ge.heap_max]=Ge.heap[1],(function(gr,oi){var hi,ai,fi,ui,wi,_i,bi=oi.dyn_tree,Ei=oi.max_code,gi=oi.stat_desc.static_tree,Yt=oi.stat_desc.has_stree,di=oi.stat_desc.extra_bits,_r=oi.stat_desc.extra_base,ri=oi.stat_desc.max_length,yt=0;for(ui=0;ui<=Z;ui++)gr.bl_count[ui]=0;for(bi[2*gr.heap[gr.heap_max]+1]=0,hi=gr.heap_max+1;hi<G;hi++)(ui=bi[2*bi[2*(ai=gr.heap[hi])+1]+1]+1)>ri&&(ui=ri,yt++),bi[2*ai+1]=ui,ai>Ei||(gr.bl_count[ui]++,wi=0,ai>=_r&&(wi=di[ai-_r]),_i=bi[2*ai],gr.opt_len+=_i*(ui+wi),Yt&&(gr.static_len+=_i*(gi[2*ai+1]+wi)));if(yt!==0){do{for(ui=ri-1;gr.bl_count[ui]===0;)ui--;gr.bl_count[ui]--,gr.bl_count[ui+1]+=2,gr.bl_count[ri]--,yt-=2}while(yt>0);for(ui=ri;ui!==0;ui--)for(ai=gr.bl_count[ui];ai!==0;)(fi=gr.heap[--hi])>Ei||(bi[2*fi+1]!==ui&&(gr.opt_len+=(ui-bi[2*fi+1])*bi[2*fi],bi[2*fi+1]=ui),ai--)}})(Ge,st),_t(me,mr,Ge.bl_count)}function pr(Ge,st,Xe){var gt,Qt,me=-1,Be=st[1],lt=0,ft=7,mr=4;for(Be===0&&(ft=138,mr=3),st[2*(Xe+1)+1]=65535,gt=0;gt<=Xe;gt++)Qt=Be,Be=st[2*(gt+1)+1],++lt<ft&&Qt===Be||(lt<mr?Ge.bl_tree[2*Qt]+=lt:Qt!==0?(Qt!==me&&Ge.bl_tree[2*Qt]++,Ge.bl_tree[2*Q]++):lt<=10?Ge.bl_tree[2*X]++:Ge.bl_tree[2*re]++,lt=0,me=Qt,Be===0?(ft=138,mr=3):Qt===Be?(ft=6,mr=3):(ft=7,mr=4))}function Nt(Ge,st,Xe){var gt,Qt,me=-1,Be=st[1],lt=0,ft=7,mr=4;for(Be===0&&(ft=138,mr=3),gt=0;gt<=Xe;gt++)if(Qt=Be,Be=st[2*(gt+1)+1],!(++lt<ft&&Qt===Be)){if(lt<mr)do Zt(Ge,Qt,Ge.bl_tree);while(--lt!=0);else Qt!==0?(Qt!==me&&(Zt(Ge,Qt,Ge.bl_tree),lt--),Zt(Ge,Q,Ge.bl_tree),ht(Ge,lt-3,2)):lt<=10?(Zt(Ge,X,Ge.bl_tree),ht(Ge,lt-3,3)):(Zt(Ge,re,Ge.bl_tree),ht(Ge,lt-11,7));lt=0,me=Qt,Be===0?(ft=138,mr=3):Qt===Be?(ft=6,mr=3):(ft=7,mr=4)}}w(ze);var $e=!1;function At(Ge,st,Xe,gt){ht(Ge,($<<1)+(gt?1:0),3),(function(Qt,me,Be,lt){Lt(Qt),bt(Qt,Be),bt(Qt,~Be),d.arraySet(Qt.pending_buf,Qt.window,me,Be,Qt.pending),Qt.pending+=Be})(Ge,st,Xe)}return trees._tr_init=function(Ge){$e||((function(){var st,Xe,gt,Qt,me,Be=new Array(Z+1);for(gt=0,Qt=0;Qt<I-1;Qt++)for(Ie[Qt]=gt,st=0;st<1<<J[Qt];st++)ce[gt++]=Qt;for(ce[gt-1]=Qt,me=0,Qt=0;Qt<16;Qt++)for(ze[Qt]=me,st=0;st<1<<se[Qt];st++)ge[me++]=Qt;for(me>>=7;Qt<U;Qt++)for(ze[Qt]=me<<7,st=0;st<1<<se[Qt]-7;st++)ge[256+me++]=Qt;for(Xe=0;Xe<=Z;Xe++)Be[Xe]=0;for(st=0;st<=143;)pe[2*st+1]=8,st++,Be[8]++;for(;st<=255;)pe[2*st+1]=9,st++,Be[9]++;for(;st<=279;)pe[2*st+1]=7,st++,Be[7]++;for(;st<=287;)pe[2*st+1]=8,st++,Be[8]++;for(_t(pe,F+1,Be),st=0;st<U;st++)de[2*st+1]=5,de[2*st]=Ye(st,5);fe=new Ce(pe,J,D+1,F,Z),Te=new Ce(de,se,0,U,Z),ut=new Ce(new Array(0),ie,0,j,q)})(),$e=!0),Ge.l_desc=new Fe(Ge.dyn_ltree,fe),Ge.d_desc=new Fe(Ge.dyn_dtree,Te),Ge.bl_desc=new Fe(Ge.bl_tree,ut),Ge.bi_buf=0,Ge.bi_valid=0,Vt(Ge)},trees._tr_stored_block=At,trees._tr_flush_block=function(Ge,st,Xe,gt){var Qt,me,Be=0;Ge.level>0?(Ge.strm.data_type===2&&(Ge.strm.data_type=(function(lt){var ft,mr=4093624447;for(ft=0;ft<=31;ft++,mr>>>=1)if(1&mr&&lt.dyn_ltree[2*ft]!==0)return m;if(lt.dyn_ltree[18]!==0||lt.dyn_ltree[20]!==0||lt.dyn_ltree[26]!==0)return g;for(ft=32;ft<D;ft++)if(lt.dyn_ltree[2*ft]!==0)return g;return m})(Ge)),fr(Ge,Ge.l_desc),fr(Ge,Ge.d_desc),Be=(function(lt){var ft;for(pr(lt,lt.dyn_ltree,lt.l_desc.max_code),pr(lt,lt.dyn_dtree,lt.d_desc.max_code),fr(lt,lt.bl_desc),ft=j-1;ft>=3&&lt.bl_tree[2*oe[ft]+1]===0;ft--);return lt.opt_len+=3*(ft+1)+5+5+4,ft})(Ge),Qt=Ge.opt_len+3+7>>>3,(me=Ge.static_len+3+7>>>3)<=Qt&&(Qt=me)):Qt=me=Xe+5,Xe+4<=Qt&&st!==-1?At(Ge,st,Xe,gt):Ge.strategy===4||me===Qt?(ht(Ge,2+(gt?1:0),3),dr(Ge,pe,de)):(ht(Ge,4+(gt?1:0),3),(function(lt,ft,mr,gr){var oi;for(ht(lt,ft-257,5),ht(lt,mr-1,5),ht(lt,gr-4,4),oi=0;oi<gr;oi++)ht(lt,lt.bl_tree[2*oe[oi]+1],3);Nt(lt,lt.dyn_ltree,ft-1),Nt(lt,lt.dyn_dtree,mr-1)})(Ge,Ge.l_desc.max_code+1,Ge.d_desc.max_code+1,Be+1),dr(Ge,Ge.dyn_ltree,Ge.dyn_dtree)),Vt(Ge),gt&&Lt(Ge)},trees._tr_tally=function(Ge,st,Xe){return Ge.pending_buf[Ge.d_buf+2*Ge.last_lit]=st>>>8&255,Ge.pending_buf[Ge.d_buf+2*Ge.last_lit+1]=255&st,Ge.pending_buf[Ge.l_buf+Ge.last_lit]=255&Xe,Ge.last_lit++,st===0?Ge.dyn_ltree[2*Xe]++:(Ge.matches++,st--,Ge.dyn_ltree[2*(ce[Xe]+D+1)]++,Ge.dyn_dtree[2*Et(st)]++),Ge.last_lit===Ge.lit_bufsize-1},trees._tr_align=function(Ge){ht(Ge,2,3),Zt(Ge,V,pe),(function(st){st.bi_valid===16?(bt(st,st.bi_buf),st.bi_buf=0,st.bi_valid=0):st.bi_valid>=8&&(st.pending_buf[st.pending++]=255&st.bi_buf,st.bi_buf>>=8,st.bi_valid-=8)})(Ge)},trees}function requireAdler32(){return hasRequiredAdler32||(hasRequiredAdler32=1,adler32_1=function(d,m,g,w){for(var $=65535&d,I=d>>>16&65535,D=0;g!==0;){g-=D=g>2e3?2e3:g;do I=I+($=$+m[w++]|0)|0;while(--D);$%=65521,I%=65521}return $|I<<16}),adler32_1}function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;var d=(function(){for(var m,g=[],w=0;w<256;w++){m=w;for(var $=0;$<8;$++)m=1&m?3988292384^m>>>1:m>>>1;g[w]=m}return g})();return crc32_1=function(m,g,w,$){var I=d,D=$+w;m^=-1;for(var F=$;F<D;F++)m=m>>>8^I[255&(m^g[F])];return~m},crc32_1}function requireMessages(){return hasRequiredMessages?messages:(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var d,m=requireCommon(),g=requireTrees(),w=requireAdler32(),$=requireCrc32(),I=requireMessages(),D=0,F=4,U=0,j=-2,G=-1,Z=4,H=2,q=8,V=9,Q=286,X=30,re=19,J=2*Q+1,se=15,ie=3,oe=258,pe=oe+ie+1,de=42,ge=103,ce=113,Ie=666,fe=1,Te=2,ut=3,ze=4;function Ce($e,At){return $e.msg=I[At],At}function Fe($e){return($e<<1)-($e>4?9:0)}function Et($e){for(var At=$e.length;--At>=0;)$e[At]=0}function bt($e){var At=$e.state,Ge=At.pending;Ge>$e.avail_out&&(Ge=$e.avail_out),Ge!==0&&(m.arraySet($e.output,At.pending_buf,At.pending_out,Ge,$e.next_out),$e.next_out+=Ge,At.pending_out+=Ge,$e.total_out+=Ge,$e.avail_out-=Ge,At.pending-=Ge,At.pending===0&&(At.pending_out=0))}function ht($e,At){g._tr_flush_block($e,$e.block_start>=0?$e.block_start:-1,$e.strstart-$e.block_start,At),$e.block_start=$e.strstart,bt($e.strm)}function Zt($e,At){$e.pending_buf[$e.pending++]=At}function Ye($e,At){$e.pending_buf[$e.pending++]=At>>>8&255,$e.pending_buf[$e.pending++]=255&At}function _t($e,At){var Ge,st,Xe=$e.max_chain_length,gt=$e.strstart,Qt=$e.prev_length,me=$e.nice_match,Be=$e.strstart>$e.w_size-pe?$e.strstart-($e.w_size-pe):0,lt=$e.window,ft=$e.w_mask,mr=$e.prev,gr=$e.strstart+oe,oi=lt[gt+Qt-1],hi=lt[gt+Qt];$e.prev_length>=$e.good_match&&(Xe>>=2),me>$e.lookahead&&(me=$e.lookahead);do if(lt[(Ge=At)+Qt]===hi&&lt[Ge+Qt-1]===oi&&lt[Ge]===lt[gt]&&lt[++Ge]===lt[gt+1]){gt+=2,Ge++;do;while(lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&lt[++gt]===lt[++Ge]&&gt<gr);if(st=oe-(gr-gt),gt=gr-oe,st>Qt){if($e.match_start=At,Qt=st,st>=me)break;oi=lt[gt+Qt-1],hi=lt[gt+Qt]}}while((At=mr[At&ft])>Be&&--Xe!=0);return Qt<=$e.lookahead?Qt:$e.lookahead}function Vt($e){var At,Ge,st,Xe,gt,Qt,me,Be,lt,ft,mr=$e.w_size;do{if(Xe=$e.window_size-$e.lookahead-$e.strstart,$e.strstart>=mr+(mr-pe)){m.arraySet($e.window,$e.window,mr,mr,0),$e.match_start-=mr,$e.strstart-=mr,$e.block_start-=mr,At=Ge=$e.hash_size;do st=$e.head[--At],$e.head[At]=st>=mr?st-mr:0;while(--Ge);At=Ge=mr;do st=$e.prev[--At],$e.prev[At]=st>=mr?st-mr:0;while(--Ge);Xe+=mr}if($e.strm.avail_in===0)break;if(Qt=$e.strm,me=$e.window,Be=$e.strstart+$e.lookahead,lt=Xe,ft=void 0,(ft=Qt.avail_in)>lt&&(ft=lt),Ge=ft===0?0:(Qt.avail_in-=ft,m.arraySet(me,Qt.input,Qt.next_in,ft,Be),Qt.state.wrap===1?Qt.adler=w(Qt.adler,me,ft,Be):Qt.state.wrap===2&&(Qt.adler=$(Qt.adler,me,ft,Be)),Qt.next_in+=ft,Qt.total_in+=ft,ft),$e.lookahead+=Ge,$e.lookahead+$e.insert>=ie)for(gt=$e.strstart-$e.insert,$e.ins_h=$e.window[gt],$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[gt+1])&$e.hash_mask;$e.insert&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[gt+ie-1])&$e.hash_mask,$e.prev[gt&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=gt,gt++,$e.insert--,!($e.lookahead+$e.insert<ie)););}while($e.lookahead<pe&&$e.strm.avail_in!==0)}function Lt($e,At){for(var Ge,st;;){if($e.lookahead<pe){if(Vt($e),$e.lookahead<pe&&At===D)return fe;if($e.lookahead===0)break}if(Ge=0,$e.lookahead>=ie&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ie-1])&$e.hash_mask,Ge=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart),Ge!==0&&$e.strstart-Ge<=$e.w_size-pe&&($e.match_length=_t($e,Ge)),$e.match_length>=ie)if(st=g._tr_tally($e,$e.strstart-$e.match_start,$e.match_length-ie),$e.lookahead-=$e.match_length,$e.match_length<=$e.max_lazy_match&&$e.lookahead>=ie){$e.match_length--;do $e.strstart++,$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ie-1])&$e.hash_mask,Ge=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart;while(--$e.match_length!=0);$e.strstart++}else $e.strstart+=$e.match_length,$e.match_length=0,$e.ins_h=$e.window[$e.strstart],$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+1])&$e.hash_mask;else st=g._tr_tally($e,0,$e.window[$e.strstart]),$e.lookahead--,$e.strstart++;if(st&&(ht($e,!1),$e.strm.avail_out===0))return fe}return $e.insert=$e.strstart<ie-1?$e.strstart:ie-1,At===F?(ht($e,!0),$e.strm.avail_out===0?ut:ze):$e.last_lit&&(ht($e,!1),$e.strm.avail_out===0)?fe:Te}function dt($e,At){for(var Ge,st,Xe;;){if($e.lookahead<pe){if(Vt($e),$e.lookahead<pe&&At===D)return fe;if($e.lookahead===0)break}if(Ge=0,$e.lookahead>=ie&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ie-1])&$e.hash_mask,Ge=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart),$e.prev_length=$e.match_length,$e.prev_match=$e.match_start,$e.match_length=ie-1,Ge!==0&&$e.prev_length<$e.max_lazy_match&&$e.strstart-Ge<=$e.w_size-pe&&($e.match_length=_t($e,Ge),$e.match_length<=5&&($e.strategy===1||$e.match_length===ie&&$e.strstart-$e.match_start>4096)&&($e.match_length=ie-1)),$e.prev_length>=ie&&$e.match_length<=$e.prev_length){Xe=$e.strstart+$e.lookahead-ie,st=g._tr_tally($e,$e.strstart-1-$e.prev_match,$e.prev_length-ie),$e.lookahead-=$e.prev_length-1,$e.prev_length-=2;do++$e.strstart<=Xe&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ie-1])&$e.hash_mask,Ge=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart);while(--$e.prev_length!=0);if($e.match_available=0,$e.match_length=ie-1,$e.strstart++,st&&(ht($e,!1),$e.strm.avail_out===0))return fe}else if($e.match_available){if((st=g._tr_tally($e,0,$e.window[$e.strstart-1]))&&ht($e,!1),$e.strstart++,$e.lookahead--,$e.strm.avail_out===0)return fe}else $e.match_available=1,$e.strstart++,$e.lookahead--}return $e.match_available&&(st=g._tr_tally($e,0,$e.window[$e.strstart-1]),$e.match_available=0),$e.insert=$e.strstart<ie-1?$e.strstart:ie-1,At===F?(ht($e,!0),$e.strm.avail_out===0?ut:ze):$e.last_lit&&(ht($e,!1),$e.strm.avail_out===0)?fe:Te}function It($e,At,Ge,st,Xe){this.good_length=$e,this.max_lazy=At,this.nice_length=Ge,this.max_chain=st,this.func=Xe}function dr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new m.Buf16(2*J),this.dyn_dtree=new m.Buf16(2*(2*X+1)),this.bl_tree=new m.Buf16(2*(2*re+1)),Et(this.dyn_ltree),Et(this.dyn_dtree),Et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new m.Buf16(se+1),this.heap=new m.Buf16(2*Q+1),Et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new m.Buf16(2*Q+1),Et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fr($e){var At;return $e&&$e.state?($e.total_in=$e.total_out=0,$e.data_type=H,(At=$e.state).pending=0,At.pending_out=0,At.wrap<0&&(At.wrap=-At.wrap),At.status=At.wrap?de:ce,$e.adler=At.wrap===2?0:1,At.last_flush=D,g._tr_init(At),U):Ce($e,j)}function pr($e){var At=fr($e);return At===U&&(function(Ge){Ge.window_size=2*Ge.w_size,Et(Ge.head),Ge.max_lazy_match=d[Ge.level].max_lazy,Ge.good_match=d[Ge.level].good_length,Ge.nice_match=d[Ge.level].nice_length,Ge.max_chain_length=d[Ge.level].max_chain,Ge.strstart=0,Ge.block_start=0,Ge.lookahead=0,Ge.insert=0,Ge.match_length=Ge.prev_length=ie-1,Ge.match_available=0,Ge.ins_h=0})($e.state),At}function Nt($e,At,Ge,st,Xe,gt){if(!$e)return j;var Qt=1;if(At===G&&(At=6),st<0?(Qt=0,st=-st):st>15&&(Qt=2,st-=16),Xe<1||Xe>V||Ge!==q||st<8||st>15||At<0||At>9||gt<0||gt>Z)return Ce($e,j);st===8&&(st=9);var me=new dr;return $e.state=me,me.strm=$e,me.wrap=Qt,me.gzhead=null,me.w_bits=st,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=Xe+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+ie-1)/ie),me.window=new m.Buf8(2*me.w_size),me.head=new m.Buf16(me.hash_size),me.prev=new m.Buf16(me.w_size),me.lit_bufsize=1<<Xe+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new m.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=At,me.strategy=gt,me.method=Ge,pr($e)}return d=[new It(0,0,0,0,(function($e,At){var Ge=65535;for(Ge>$e.pending_buf_size-5&&(Ge=$e.pending_buf_size-5);;){if($e.lookahead<=1){if(Vt($e),$e.lookahead===0&&At===D)return fe;if($e.lookahead===0)break}$e.strstart+=$e.lookahead,$e.lookahead=0;var st=$e.block_start+Ge;if(($e.strstart===0||$e.strstart>=st)&&($e.lookahead=$e.strstart-st,$e.strstart=st,ht($e,!1),$e.strm.avail_out===0)||$e.strstart-$e.block_start>=$e.w_size-pe&&(ht($e,!1),$e.strm.avail_out===0))return fe}return $e.insert=0,At===F?(ht($e,!0),$e.strm.avail_out===0?ut:ze):($e.strstart>$e.block_start&&(ht($e,!1),$e.strm.avail_out),fe)})),new It(4,4,8,4,Lt),new It(4,5,16,8,Lt),new It(4,6,32,32,Lt),new It(4,4,16,16,dt),new It(8,16,32,32,dt),new It(8,16,128,128,dt),new It(8,32,128,256,dt),new It(32,128,258,1024,dt),new It(32,258,258,4096,dt)],deflate.deflateInit=function($e,At){return Nt($e,At,q,15,8,0)},deflate.deflateInit2=Nt,deflate.deflateReset=pr,deflate.deflateResetKeep=fr,deflate.deflateSetHeader=function($e,At){return $e&&$e.state?$e.state.wrap!==2?j:($e.state.gzhead=At,U):j},deflate.deflate=function($e,At){var Ge,st,Xe,gt;if(!$e||!$e.state||At>5||At<0)return $e?Ce($e,j):j;if(st=$e.state,!$e.output||!$e.input&&$e.avail_in!==0||st.status===Ie&&At!==F)return Ce($e,$e.avail_out===0?-5:j);if(st.strm=$e,Ge=st.last_flush,st.last_flush=At,st.status===de)if(st.wrap===2)$e.adler=0,Zt(st,31),Zt(st,139),Zt(st,8),st.gzhead?(Zt(st,(st.gzhead.text?1:0)+(st.gzhead.hcrc?2:0)+(st.gzhead.extra?4:0)+(st.gzhead.name?8:0)+(st.gzhead.comment?16:0)),Zt(st,255&st.gzhead.time),Zt(st,st.gzhead.time>>8&255),Zt(st,st.gzhead.time>>16&255),Zt(st,st.gzhead.time>>24&255),Zt(st,st.level===9?2:st.strategy>=2||st.level<2?4:0),Zt(st,255&st.gzhead.os),st.gzhead.extra&&st.gzhead.extra.length&&(Zt(st,255&st.gzhead.extra.length),Zt(st,st.gzhead.extra.length>>8&255)),st.gzhead.hcrc&&($e.adler=$($e.adler,st.pending_buf,st.pending,0)),st.gzindex=0,st.status=69):(Zt(st,0),Zt(st,0),Zt(st,0),Zt(st,0),Zt(st,0),Zt(st,st.level===9?2:st.strategy>=2||st.level<2?4:0),Zt(st,3),st.status=ce);else{var Qt=q+(st.w_bits-8<<4)<<8;Qt|=(st.strategy>=2||st.level<2?0:st.level<6?1:st.level===6?2:3)<<6,st.strstart!==0&&(Qt|=32),Qt+=31-Qt%31,st.status=ce,Ye(st,Qt),st.strstart!==0&&(Ye(st,$e.adler>>>16),Ye(st,65535&$e.adler)),$e.adler=1}if(st.status===69)if(st.gzhead.extra){for(Xe=st.pending;st.gzindex<(65535&st.gzhead.extra.length)&&(st.pending!==st.pending_buf_size||(st.gzhead.hcrc&&st.pending>Xe&&($e.adler=$($e.adler,st.pending_buf,st.pending-Xe,Xe)),bt($e),Xe=st.pending,st.pending!==st.pending_buf_size));)Zt(st,255&st.gzhead.extra[st.gzindex]),st.gzindex++;st.gzhead.hcrc&&st.pending>Xe&&($e.adler=$($e.adler,st.pending_buf,st.pending-Xe,Xe)),st.gzindex===st.gzhead.extra.length&&(st.gzindex=0,st.status=73)}else st.status=73;if(st.status===73)if(st.gzhead.name){Xe=st.pending;do{if(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>Xe&&($e.adler=$($e.adler,st.pending_buf,st.pending-Xe,Xe)),bt($e),Xe=st.pending,st.pending===st.pending_buf_size)){gt=1;break}gt=st.gzindex<st.gzhead.name.length?255&st.gzhead.name.charCodeAt(st.gzindex++):0,Zt(st,gt)}while(gt!==0);st.gzhead.hcrc&&st.pending>Xe&&($e.adler=$($e.adler,st.pending_buf,st.pending-Xe,Xe)),gt===0&&(st.gzindex=0,st.status=91)}else st.status=91;if(st.status===91)if(st.gzhead.comment){Xe=st.pending;do{if(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>Xe&&($e.adler=$($e.adler,st.pending_buf,st.pending-Xe,Xe)),bt($e),Xe=st.pending,st.pending===st.pending_buf_size)){gt=1;break}gt=st.gzindex<st.gzhead.comment.length?255&st.gzhead.comment.charCodeAt(st.gzindex++):0,Zt(st,gt)}while(gt!==0);st.gzhead.hcrc&&st.pending>Xe&&($e.adler=$($e.adler,st.pending_buf,st.pending-Xe,Xe)),gt===0&&(st.status=ge)}else st.status=ge;if(st.status===ge&&(st.gzhead.hcrc?(st.pending+2>st.pending_buf_size&&bt($e),st.pending+2<=st.pending_buf_size&&(Zt(st,255&$e.adler),Zt(st,$e.adler>>8&255),$e.adler=0,st.status=ce)):st.status=ce),st.pending!==0){if(bt($e),$e.avail_out===0)return st.last_flush=-1,U}else if($e.avail_in===0&&Fe(At)<=Fe(Ge)&&At!==F)return Ce($e,-5);if(st.status===Ie&&$e.avail_in!==0)return Ce($e,-5);if($e.avail_in!==0||st.lookahead!==0||At!==D&&st.status!==Ie){var me=st.strategy===2?(function(Be,lt){for(var ft;;){if(Be.lookahead===0&&(Vt(Be),Be.lookahead===0)){if(lt===D)return fe;break}if(Be.match_length=0,ft=g._tr_tally(Be,0,Be.window[Be.strstart]),Be.lookahead--,Be.strstart++,ft&&(ht(Be,!1),Be.strm.avail_out===0))return fe}return Be.insert=0,lt===F?(ht(Be,!0),Be.strm.avail_out===0?ut:ze):Be.last_lit&&(ht(Be,!1),Be.strm.avail_out===0)?fe:Te})(st,At):st.strategy===3?(function(Be,lt){for(var ft,mr,gr,oi,hi=Be.window;;){if(Be.lookahead<=oe){if(Vt(Be),Be.lookahead<=oe&&lt===D)return fe;if(Be.lookahead===0)break}if(Be.match_length=0,Be.lookahead>=ie&&Be.strstart>0&&(mr=hi[gr=Be.strstart-1])===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]){oi=Be.strstart+oe;do;while(mr===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]&&mr===hi[++gr]&&gr<oi);Be.match_length=oe-(oi-gr),Be.match_length>Be.lookahead&&(Be.match_length=Be.lookahead)}if(Be.match_length>=ie?(ft=g._tr_tally(Be,1,Be.match_length-ie),Be.lookahead-=Be.match_length,Be.strstart+=Be.match_length,Be.match_length=0):(ft=g._tr_tally(Be,0,Be.window[Be.strstart]),Be.lookahead--,Be.strstart++),ft&&(ht(Be,!1),Be.strm.avail_out===0))return fe}return Be.insert=0,lt===F?(ht(Be,!0),Be.strm.avail_out===0?ut:ze):Be.last_lit&&(ht(Be,!1),Be.strm.avail_out===0)?fe:Te})(st,At):d[st.level].func(st,At);if(me!==ut&&me!==ze||(st.status=Ie),me===fe||me===ut)return $e.avail_out===0&&(st.last_flush=-1),U;if(me===Te&&(At===1?g._tr_align(st):At!==5&&(g._tr_stored_block(st,0,0,!1),At===3&&(Et(st.head),st.lookahead===0&&(st.strstart=0,st.block_start=0,st.insert=0))),bt($e),$e.avail_out===0))return st.last_flush=-1,U}return At!==F?U:st.wrap<=0?1:(st.wrap===2?(Zt(st,255&$e.adler),Zt(st,$e.adler>>8&255),Zt(st,$e.adler>>16&255),Zt(st,$e.adler>>24&255),Zt(st,255&$e.total_in),Zt(st,$e.total_in>>8&255),Zt(st,$e.total_in>>16&255),Zt(st,$e.total_in>>24&255)):(Ye(st,$e.adler>>>16),Ye(st,65535&$e.adler)),bt($e),st.wrap>0&&(st.wrap=-st.wrap),st.pending!==0?U:1)},deflate.deflateEnd=function($e){var At;return $e&&$e.state?(At=$e.state.status)!==de&&At!==69&&At!==73&&At!==91&&At!==ge&&At!==ce&&At!==Ie?Ce($e,j):($e.state=null,At===ce?Ce($e,-3):U):j},deflate.deflateSetDictionary=function($e,At){var Ge,st,Xe,gt,Qt,me,Be,lt,ft=At.length;if(!$e||!$e.state||(gt=(Ge=$e.state).wrap)===2||gt===1&&Ge.status!==de||Ge.lookahead)return j;for(gt===1&&($e.adler=w($e.adler,At,ft,0)),Ge.wrap=0,ft>=Ge.w_size&&(gt===0&&(Et(Ge.head),Ge.strstart=0,Ge.block_start=0,Ge.insert=0),lt=new m.Buf8(Ge.w_size),m.arraySet(lt,At,ft-Ge.w_size,Ge.w_size,0),At=lt,ft=Ge.w_size),Qt=$e.avail_in,me=$e.next_in,Be=$e.input,$e.avail_in=ft,$e.next_in=0,$e.input=At,Vt(Ge);Ge.lookahead>=ie;){st=Ge.strstart,Xe=Ge.lookahead-(ie-1);do Ge.ins_h=(Ge.ins_h<<Ge.hash_shift^Ge.window[st+ie-1])&Ge.hash_mask,Ge.prev[st&Ge.w_mask]=Ge.head[Ge.ins_h],Ge.head[Ge.ins_h]=st,st++;while(--Xe);Ge.strstart=st,Ge.lookahead=ie-1,Vt(Ge)}return Ge.strstart+=Ge.lookahead,Ge.block_start=Ge.strstart,Ge.insert=Ge.lookahead,Ge.lookahead=0,Ge.match_length=Ge.prev_length=ie-1,Ge.match_available=0,$e.next_in=me,$e.input=Be,$e.avail_in=Qt,Ge.wrap=gt,U},deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var strings={},hasRequiredStrings,zstream,hasRequiredZstream,hasRequiredDeflate;function requireStrings(){if(hasRequiredStrings)return strings;hasRequiredStrings=1;var d=requireCommon(),m=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch{m=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{g=!1}for(var w=new d.Buf8(256),$=0;$<256;$++)w[$]=$>=252?6:$>=248?5:$>=240?4:$>=224?3:$>=192?2:1;function I(D,F){if(F<65534&&(D.subarray&&g||!D.subarray&&m))return String.fromCharCode.apply(null,d.shrinkBuf(D,F));for(var U="",j=0;j<F;j++)U+=String.fromCharCode(D[j]);return U}return w[254]=w[254]=1,strings.string2buf=function(D){var F,U,j,G,Z,H=D.length,q=0;for(G=0;G<H;G++)(64512&(U=D.charCodeAt(G)))==55296&&G+1<H&&(64512&(j=D.charCodeAt(G+1)))==56320&&(U=65536+(U-55296<<10)+(j-56320),G++),q+=U<128?1:U<2048?2:U<65536?3:4;for(F=new d.Buf8(q),Z=0,G=0;Z<q;G++)(64512&(U=D.charCodeAt(G)))==55296&&G+1<H&&(64512&(j=D.charCodeAt(G+1)))==56320&&(U=65536+(U-55296<<10)+(j-56320),G++),U<128?F[Z++]=U:U<2048?(F[Z++]=192|U>>>6,F[Z++]=128|63&U):U<65536?(F[Z++]=224|U>>>12,F[Z++]=128|U>>>6&63,F[Z++]=128|63&U):(F[Z++]=240|U>>>18,F[Z++]=128|U>>>12&63,F[Z++]=128|U>>>6&63,F[Z++]=128|63&U);return F},strings.buf2binstring=function(D){return I(D,D.length)},strings.binstring2buf=function(D){for(var F=new d.Buf8(D.length),U=0,j=F.length;U<j;U++)F[U]=D.charCodeAt(U);return F},strings.buf2string=function(D,F){var U,j,G,Z,H=F||D.length,q=new Array(2*H);for(j=0,U=0;U<H;)if((G=D[U++])<128)q[j++]=G;else if((Z=w[G])>4)q[j++]=65533,U+=Z-1;else{for(G&=Z===2?31:Z===3?15:7;Z>1&&U<H;)G=G<<6|63&D[U++],Z--;Z>1?q[j++]=65533:G<65536?q[j++]=G:(G-=65536,q[j++]=55296|G>>10&1023,q[j++]=56320|1023&G)}return I(q,j)},strings.utf8border=function(D,F){var U;for((F=F||D.length)>D.length&&(F=D.length),U=F-1;U>=0&&(192&D[U])==128;)U--;return U<0||U===0?F:U+w[D[U]]>F?U:F},strings}function requireZstream(){return hasRequiredZstream?zstream:(hasRequiredZstream=1,zstream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0})}function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var d=requireDeflate$1(),m=requireCommon(),g=requireStrings(),w=requireMessages(),$=requireZstream(),I=Object.prototype.toString,D=0,F=-1,U=0,j=8;function G(H){if(!(this instanceof G))return new G(H);this.options=m.assign({level:F,method:j,chunkSize:16384,windowBits:15,memLevel:8,strategy:U,to:""},H||{});var q=this.options;q.raw&&q.windowBits>0?q.windowBits=-q.windowBits:q.gzip&&q.windowBits>0&&q.windowBits<16&&(q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $,this.strm.avail_out=0;var V=d.deflateInit2(this.strm,q.level,q.method,q.windowBits,q.memLevel,q.strategy);if(V!==D)throw new Error(w[V]);if(q.header&&d.deflateSetHeader(this.strm,q.header),q.dictionary){var Q;if(Q=typeof q.dictionary=="string"?g.string2buf(q.dictionary):I.call(q.dictionary)==="[object ArrayBuffer]"?new Uint8Array(q.dictionary):q.dictionary,(V=d.deflateSetDictionary(this.strm,Q))!==D)throw new Error(w[V]);this._dict_set=!0}}function Z(H,q){var V=new G(q);if(V.push(H,!0),V.err)throw V.msg||w[V.err];return V.result}return G.prototype.push=function(H,q){var V,Q,X=this.strm,re=this.options.chunkSize;if(this.ended)return!1;Q=q===~~q?q:q===!0?4:0,typeof H=="string"?X.input=g.string2buf(H):I.call(H)==="[object ArrayBuffer]"?X.input=new Uint8Array(H):X.input=H,X.next_in=0,X.avail_in=X.input.length;do{if(X.avail_out===0&&(X.output=new m.Buf8(re),X.next_out=0,X.avail_out=re),(V=d.deflate(X,Q))!==1&&V!==D)return this.onEnd(V),this.ended=!0,!1;X.avail_out!==0&&(X.avail_in!==0||Q!==4&&Q!==2)||(this.options.to==="string"?this.onData(g.buf2binstring(m.shrinkBuf(X.output,X.next_out))):this.onData(m.shrinkBuf(X.output,X.next_out)))}while((X.avail_in>0||X.avail_out===0)&&V!==1);return Q===4?(V=d.deflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===D):Q!==2||(this.onEnd(D),X.avail_out=0,!0)},G.prototype.onData=function(H){this.chunks.push(H)},G.prototype.onEnd=function(H){H===D&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg},deflate$1.Deflate=G,deflate$1.deflate=Z,deflate$1.deflateRaw=function(H,q){return(q=q||{}).raw=!0,Z(H,q)},deflate$1.gzip=function(H,q){return(q=q||{}).gzip=!0,Z(H,q)},deflate$1}var inflate$1={},inflate={},inffast,hasRequiredInffast,inftrees,hasRequiredInftrees,hasRequiredInflate$1,constants,hasRequiredConstants,gzheader,hasRequiredGzheader,hasRequiredInflate,pako_1,hasRequiredPako;function requireInffast(){return hasRequiredInffast?inffast:(hasRequiredInffast=1,inffast=function(d,m){var g,w,$,I,D,F,U,j,G,Z,H,q,V,Q,X,re,J,se,ie,oe,pe,de,ge,ce,Ie;g=d.state,w=d.next_in,ce=d.input,$=w+(d.avail_in-5),I=d.next_out,Ie=d.output,D=I-(m-d.avail_out),F=I+(d.avail_out-257),U=g.dmax,j=g.wsize,G=g.whave,Z=g.wnext,H=g.window,q=g.hold,V=g.bits,Q=g.lencode,X=g.distcode,re=(1<<g.lenbits)-1,J=(1<<g.distbits)-1;e:do{V<15&&(q+=ce[w++]<<V,V+=8,q+=ce[w++]<<V,V+=8),se=Q[q&re];t:for(;;){if(q>>>=ie=se>>>24,V-=ie,(ie=se>>>16&255)===0)Ie[I++]=65535&se;else{if(!(16&ie)){if(64&ie){if(32&ie){g.mode=12;break e}d.msg="invalid literal/length code",g.mode=30;break e}se=Q[(65535&se)+(q&(1<<ie)-1)];continue t}for(oe=65535&se,(ie&=15)&&(V<ie&&(q+=ce[w++]<<V,V+=8),oe+=q&(1<<ie)-1,q>>>=ie,V-=ie),V<15&&(q+=ce[w++]<<V,V+=8,q+=ce[w++]<<V,V+=8),se=X[q&J];;){if(q>>>=ie=se>>>24,V-=ie,16&(ie=se>>>16&255)){if(pe=65535&se,V<(ie&=15)&&(q+=ce[w++]<<V,(V+=8)<ie&&(q+=ce[w++]<<V,V+=8)),(pe+=q&(1<<ie)-1)>U){d.msg="invalid distance too far back",g.mode=30;break e}if(q>>>=ie,V-=ie,pe>(ie=I-D)){if((ie=pe-ie)>G&&g.sane){d.msg="invalid distance too far back",g.mode=30;break e}if(de=0,ge=H,Z===0){if(de+=j-ie,ie<oe){oe-=ie;do Ie[I++]=H[de++];while(--ie);de=I-pe,ge=Ie}}else if(Z<ie){if(de+=j+Z-ie,(ie-=Z)<oe){oe-=ie;do Ie[I++]=H[de++];while(--ie);if(de=0,Z<oe){oe-=ie=Z;do Ie[I++]=H[de++];while(--ie);de=I-pe,ge=Ie}}}else if(de+=Z-ie,ie<oe){oe-=ie;do Ie[I++]=H[de++];while(--ie);de=I-pe,ge=Ie}for(;oe>2;)Ie[I++]=ge[de++],Ie[I++]=ge[de++],Ie[I++]=ge[de++],oe-=3;oe&&(Ie[I++]=ge[de++],oe>1&&(Ie[I++]=ge[de++]))}else{de=I-pe;do Ie[I++]=Ie[de++],Ie[I++]=Ie[de++],Ie[I++]=Ie[de++],oe-=3;while(oe>2);oe&&(Ie[I++]=Ie[de++],oe>1&&(Ie[I++]=Ie[de++]))}break}if(64&ie){d.msg="invalid distance code",g.mode=30;break e}se=X[(65535&se)+(q&(1<<ie)-1)]}}break}}while(w<$&&I<F);w-=oe=V>>3,q&=(1<<(V-=oe<<3))-1,d.next_in=w,d.next_out=I,d.avail_in=w<$?$-w+5:5-(w-$),d.avail_out=I<F?F-I+257:257-(I-F),g.hold=q,g.bits=V},inffast)}function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var d=requireCommon(),m=15,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],w=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],$=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],I=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(D,F,U,j,G,Z,H,q){var V,Q,X,re,J,se,ie,oe,pe,de=q.bits,ge=0,ce=0,Ie=0,fe=0,Te=0,ut=0,ze=0,Ce=0,Fe=0,Et=0,bt=null,ht=0,Zt=new d.Buf16(16),Ye=new d.Buf16(16),_t=null,Vt=0;for(ge=0;ge<=m;ge++)Zt[ge]=0;for(ce=0;ce<j;ce++)Zt[F[U+ce]]++;for(Te=de,fe=m;fe>=1&&Zt[fe]===0;fe--);if(Te>fe&&(Te=fe),fe===0)return G[Z++]=20971520,G[Z++]=20971520,q.bits=1,0;for(Ie=1;Ie<fe&&Zt[Ie]===0;Ie++);for(Te<Ie&&(Te=Ie),Ce=1,ge=1;ge<=m;ge++)if(Ce<<=1,(Ce-=Zt[ge])<0)return-1;if(Ce>0&&(D===0||fe!==1))return-1;for(Ye[1]=0,ge=1;ge<m;ge++)Ye[ge+1]=Ye[ge]+Zt[ge];for(ce=0;ce<j;ce++)F[U+ce]!==0&&(H[Ye[F[U+ce]]++]=ce);if(D===0?(bt=_t=H,se=19):D===1?(bt=g,ht-=257,_t=w,Vt-=257,se=256):(bt=$,_t=I,se=-1),Et=0,ce=0,ge=Ie,J=Z,ut=Te,ze=0,X=-1,re=(Fe=1<<Te)-1,D===1&&Fe>852||D===2&&Fe>592)return 1;for(;;){ie=ge-ze,H[ce]<se?(oe=0,pe=H[ce]):H[ce]>se?(oe=_t[Vt+H[ce]],pe=bt[ht+H[ce]]):(oe=96,pe=0),V=1<<ge-ze,Ie=Q=1<<ut;do G[J+(Et>>ze)+(Q-=V)]=ie<<24|oe<<16|pe;while(Q!==0);for(V=1<<ge-1;Et&V;)V>>=1;if(V!==0?(Et&=V-1,Et+=V):Et=0,ce++,--Zt[ge]==0){if(ge===fe)break;ge=F[U+H[ce]]}if(ge>Te&&(Et&re)!==X){for(ze===0&&(ze=Te),J+=Ie,Ce=1<<(ut=ge-ze);ut+ze<fe&&!((Ce-=Zt[ut+ze])<=0);)ut++,Ce<<=1;if(Fe+=1<<ut,D===1&&Fe>852||D===2&&Fe>592)return 1;G[X=Et&re]=Te<<24|ut<<16|J-Z}}return Et!==0&&(G[J+Et]=ge-ze<<24|64<<16),q.bits=Te,0}}function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var d=requireCommon(),m=requireAdler32(),g=requireCrc32(),w=requireInffast(),$=requireInftrees(),I=1,D=2,F=0,U=-2,j=1,G=12,Z=30,H=852,q=592;function V(ce){return(ce>>>24&255)+(ce>>>8&65280)+((65280&ce)<<8)+((255&ce)<<24)}function Q(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function X(ce){var Ie;return ce&&ce.state?(Ie=ce.state,ce.total_in=ce.total_out=Ie.total=0,ce.msg="",Ie.wrap&&(ce.adler=1&Ie.wrap),Ie.mode=j,Ie.last=0,Ie.havedict=0,Ie.dmax=32768,Ie.head=null,Ie.hold=0,Ie.bits=0,Ie.lencode=Ie.lendyn=new d.Buf32(H),Ie.distcode=Ie.distdyn=new d.Buf32(q),Ie.sane=1,Ie.back=-1,F):U}function re(ce){var Ie;return ce&&ce.state?((Ie=ce.state).wsize=0,Ie.whave=0,Ie.wnext=0,X(ce)):U}function J(ce,Ie){var fe,Te;return ce&&ce.state?(Te=ce.state,Ie<0?(fe=0,Ie=-Ie):(fe=1+(Ie>>4),Ie<48&&(Ie&=15)),Ie&&(Ie<8||Ie>15)?U:(Te.window!==null&&Te.wbits!==Ie&&(Te.window=null),Te.wrap=fe,Te.wbits=Ie,re(ce))):U}function se(ce,Ie){var fe,Te;return ce?(Te=new Q,ce.state=Te,Te.window=null,(fe=J(ce,Ie))!==F&&(ce.state=null),fe):U}var ie,oe,pe=!0;function de(ce){if(pe){var Ie;for(ie=new d.Buf32(512),oe=new d.Buf32(32),Ie=0;Ie<144;)ce.lens[Ie++]=8;for(;Ie<256;)ce.lens[Ie++]=9;for(;Ie<280;)ce.lens[Ie++]=7;for(;Ie<288;)ce.lens[Ie++]=8;for($(I,ce.lens,0,288,ie,0,ce.work,{bits:9}),Ie=0;Ie<32;)ce.lens[Ie++]=5;$(D,ce.lens,0,32,oe,0,ce.work,{bits:5}),pe=!1}ce.lencode=ie,ce.lenbits=9,ce.distcode=oe,ce.distbits=5}function ge(ce,Ie,fe,Te){var ut,ze=ce.state;return ze.window===null&&(ze.wsize=1<<ze.wbits,ze.wnext=0,ze.whave=0,ze.window=new d.Buf8(ze.wsize)),Te>=ze.wsize?(d.arraySet(ze.window,Ie,fe-ze.wsize,ze.wsize,0),ze.wnext=0,ze.whave=ze.wsize):((ut=ze.wsize-ze.wnext)>Te&&(ut=Te),d.arraySet(ze.window,Ie,fe-Te,ut,ze.wnext),(Te-=ut)?(d.arraySet(ze.window,Ie,fe-Te,Te,0),ze.wnext=Te,ze.whave=ze.wsize):(ze.wnext+=ut,ze.wnext===ze.wsize&&(ze.wnext=0),ze.whave<ze.wsize&&(ze.whave+=ut))),0}return inflate.inflateReset=re,inflate.inflateReset2=J,inflate.inflateResetKeep=X,inflate.inflateInit=function(ce){return se(ce,15)},inflate.inflateInit2=se,inflate.inflate=function(ce,Ie){var fe,Te,ut,ze,Ce,Fe,Et,bt,ht,Zt,Ye,_t,Vt,Lt,dt,It,dr,fr,pr,Nt,$e,At,Ge,st,Xe=0,gt=new d.Buf8(4),Qt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ce||!ce.state||!ce.output||!ce.input&&ce.avail_in!==0)return U;(fe=ce.state).mode===G&&(fe.mode=13),Ce=ce.next_out,ut=ce.output,Et=ce.avail_out,ze=ce.next_in,Te=ce.input,Fe=ce.avail_in,bt=fe.hold,ht=fe.bits,Zt=Fe,Ye=Et,At=F;e:for(;;)switch(fe.mode){case j:if(fe.wrap===0){fe.mode=13;break}for(;ht<16;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(2&fe.wrap&&bt===35615){fe.check=0,gt[0]=255&bt,gt[1]=bt>>>8&255,fe.check=g(fe.check,gt,2,0),bt=0,ht=0,fe.mode=2;break}if(fe.flags=0,fe.head&&(fe.head.done=!1),!(1&fe.wrap)||(((255&bt)<<8)+(bt>>8))%31){ce.msg="incorrect header check",fe.mode=Z;break}if((15&bt)!=8){ce.msg="unknown compression method",fe.mode=Z;break}if(ht-=4,$e=8+(15&(bt>>>=4)),fe.wbits===0)fe.wbits=$e;else if($e>fe.wbits){ce.msg="invalid window size",fe.mode=Z;break}fe.dmax=1<<$e,ce.adler=fe.check=1,fe.mode=512&bt?10:G,bt=0,ht=0;break;case 2:for(;ht<16;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(fe.flags=bt,(255&fe.flags)!=8){ce.msg="unknown compression method",fe.mode=Z;break}if(57344&fe.flags){ce.msg="unknown header flags set",fe.mode=Z;break}fe.head&&(fe.head.text=bt>>8&1),512&fe.flags&&(gt[0]=255&bt,gt[1]=bt>>>8&255,fe.check=g(fe.check,gt,2,0)),bt=0,ht=0,fe.mode=3;case 3:for(;ht<32;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}fe.head&&(fe.head.time=bt),512&fe.flags&&(gt[0]=255&bt,gt[1]=bt>>>8&255,gt[2]=bt>>>16&255,gt[3]=bt>>>24&255,fe.check=g(fe.check,gt,4,0)),bt=0,ht=0,fe.mode=4;case 4:for(;ht<16;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}fe.head&&(fe.head.xflags=255&bt,fe.head.os=bt>>8),512&fe.flags&&(gt[0]=255&bt,gt[1]=bt>>>8&255,fe.check=g(fe.check,gt,2,0)),bt=0,ht=0,fe.mode=5;case 5:if(1024&fe.flags){for(;ht<16;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}fe.length=bt,fe.head&&(fe.head.extra_len=bt),512&fe.flags&&(gt[0]=255&bt,gt[1]=bt>>>8&255,fe.check=g(fe.check,gt,2,0)),bt=0,ht=0}else fe.head&&(fe.head.extra=null);fe.mode=6;case 6:if(1024&fe.flags&&((_t=fe.length)>Fe&&(_t=Fe),_t&&(fe.head&&($e=fe.head.extra_len-fe.length,fe.head.extra||(fe.head.extra=new Array(fe.head.extra_len)),d.arraySet(fe.head.extra,Te,ze,_t,$e)),512&fe.flags&&(fe.check=g(fe.check,Te,_t,ze)),Fe-=_t,ze+=_t,fe.length-=_t),fe.length))break e;fe.length=0,fe.mode=7;case 7:if(2048&fe.flags){if(Fe===0)break e;_t=0;do $e=Te[ze+_t++],fe.head&&$e&&fe.length<65536&&(fe.head.name+=String.fromCharCode($e));while($e&&_t<Fe);if(512&fe.flags&&(fe.check=g(fe.check,Te,_t,ze)),Fe-=_t,ze+=_t,$e)break e}else fe.head&&(fe.head.name=null);fe.length=0,fe.mode=8;case 8:if(4096&fe.flags){if(Fe===0)break e;_t=0;do $e=Te[ze+_t++],fe.head&&$e&&fe.length<65536&&(fe.head.comment+=String.fromCharCode($e));while($e&&_t<Fe);if(512&fe.flags&&(fe.check=g(fe.check,Te,_t,ze)),Fe-=_t,ze+=_t,$e)break e}else fe.head&&(fe.head.comment=null);fe.mode=9;case 9:if(512&fe.flags){for(;ht<16;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(bt!==(65535&fe.check)){ce.msg="header crc mismatch",fe.mode=Z;break}bt=0,ht=0}fe.head&&(fe.head.hcrc=fe.flags>>9&1,fe.head.done=!0),ce.adler=fe.check=0,fe.mode=G;break;case 10:for(;ht<32;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}ce.adler=fe.check=V(bt),bt=0,ht=0,fe.mode=11;case 11:if(fe.havedict===0)return ce.next_out=Ce,ce.avail_out=Et,ce.next_in=ze,ce.avail_in=Fe,fe.hold=bt,fe.bits=ht,2;ce.adler=fe.check=1,fe.mode=G;case G:if(Ie===5||Ie===6)break e;case 13:if(fe.last){bt>>>=7&ht,ht-=7&ht,fe.mode=27;break}for(;ht<3;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}switch(fe.last=1&bt,ht-=1,3&(bt>>>=1)){case 0:fe.mode=14;break;case 1:if(de(fe),fe.mode=20,Ie===6){bt>>>=2,ht-=2;break e}break;case 2:fe.mode=17;break;case 3:ce.msg="invalid block type",fe.mode=Z}bt>>>=2,ht-=2;break;case 14:for(bt>>>=7&ht,ht-=7&ht;ht<32;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if((65535&bt)!=(bt>>>16^65535)){ce.msg="invalid stored block lengths",fe.mode=Z;break}if(fe.length=65535&bt,bt=0,ht=0,fe.mode=15,Ie===6)break e;case 15:fe.mode=16;case 16:if(_t=fe.length){if(_t>Fe&&(_t=Fe),_t>Et&&(_t=Et),_t===0)break e;d.arraySet(ut,Te,ze,_t,Ce),Fe-=_t,ze+=_t,Et-=_t,Ce+=_t,fe.length-=_t;break}fe.mode=G;break;case 17:for(;ht<14;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(fe.nlen=257+(31&bt),bt>>>=5,ht-=5,fe.ndist=1+(31&bt),bt>>>=5,ht-=5,fe.ncode=4+(15&bt),bt>>>=4,ht-=4,fe.nlen>286||fe.ndist>30){ce.msg="too many length or distance symbols",fe.mode=Z;break}fe.have=0,fe.mode=18;case 18:for(;fe.have<fe.ncode;){for(;ht<3;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}fe.lens[Qt[fe.have++]]=7&bt,bt>>>=3,ht-=3}for(;fe.have<19;)fe.lens[Qt[fe.have++]]=0;if(fe.lencode=fe.lendyn,fe.lenbits=7,Ge={bits:fe.lenbits},At=$(0,fe.lens,0,19,fe.lencode,0,fe.work,Ge),fe.lenbits=Ge.bits,At){ce.msg="invalid code lengths set",fe.mode=Z;break}fe.have=0,fe.mode=19;case 19:for(;fe.have<fe.nlen+fe.ndist;){for(;It=(Xe=fe.lencode[bt&(1<<fe.lenbits)-1])>>>16&255,dr=65535&Xe,!((dt=Xe>>>24)<=ht);){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(dr<16)bt>>>=dt,ht-=dt,fe.lens[fe.have++]=dr;else{if(dr===16){for(st=dt+2;ht<st;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(bt>>>=dt,ht-=dt,fe.have===0){ce.msg="invalid bit length repeat",fe.mode=Z;break}$e=fe.lens[fe.have-1],_t=3+(3&bt),bt>>>=2,ht-=2}else if(dr===17){for(st=dt+3;ht<st;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}ht-=dt,$e=0,_t=3+(7&(bt>>>=dt)),bt>>>=3,ht-=3}else{for(st=dt+7;ht<st;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}ht-=dt,$e=0,_t=11+(127&(bt>>>=dt)),bt>>>=7,ht-=7}if(fe.have+_t>fe.nlen+fe.ndist){ce.msg="invalid bit length repeat",fe.mode=Z;break}for(;_t--;)fe.lens[fe.have++]=$e}}if(fe.mode===Z)break;if(fe.lens[256]===0){ce.msg="invalid code -- missing end-of-block",fe.mode=Z;break}if(fe.lenbits=9,Ge={bits:fe.lenbits},At=$(I,fe.lens,0,fe.nlen,fe.lencode,0,fe.work,Ge),fe.lenbits=Ge.bits,At){ce.msg="invalid literal/lengths set",fe.mode=Z;break}if(fe.distbits=6,fe.distcode=fe.distdyn,Ge={bits:fe.distbits},At=$(D,fe.lens,fe.nlen,fe.ndist,fe.distcode,0,fe.work,Ge),fe.distbits=Ge.bits,At){ce.msg="invalid distances set",fe.mode=Z;break}if(fe.mode=20,Ie===6)break e;case 20:fe.mode=21;case 21:if(Fe>=6&&Et>=258){ce.next_out=Ce,ce.avail_out=Et,ce.next_in=ze,ce.avail_in=Fe,fe.hold=bt,fe.bits=ht,w(ce,Ye),Ce=ce.next_out,ut=ce.output,Et=ce.avail_out,ze=ce.next_in,Te=ce.input,Fe=ce.avail_in,bt=fe.hold,ht=fe.bits,fe.mode===G&&(fe.back=-1);break}for(fe.back=0;It=(Xe=fe.lencode[bt&(1<<fe.lenbits)-1])>>>16&255,dr=65535&Xe,!((dt=Xe>>>24)<=ht);){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(It&&!(240&It)){for(fr=dt,pr=It,Nt=dr;It=(Xe=fe.lencode[Nt+((bt&(1<<fr+pr)-1)>>fr)])>>>16&255,dr=65535&Xe,!(fr+(dt=Xe>>>24)<=ht);){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}bt>>>=fr,ht-=fr,fe.back+=fr}if(bt>>>=dt,ht-=dt,fe.back+=dt,fe.length=dr,It===0){fe.mode=26;break}if(32&It){fe.back=-1,fe.mode=G;break}if(64&It){ce.msg="invalid literal/length code",fe.mode=Z;break}fe.extra=15&It,fe.mode=22;case 22:if(fe.extra){for(st=fe.extra;ht<st;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}fe.length+=bt&(1<<fe.extra)-1,bt>>>=fe.extra,ht-=fe.extra,fe.back+=fe.extra}fe.was=fe.length,fe.mode=23;case 23:for(;It=(Xe=fe.distcode[bt&(1<<fe.distbits)-1])>>>16&255,dr=65535&Xe,!((dt=Xe>>>24)<=ht);){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(!(240&It)){for(fr=dt,pr=It,Nt=dr;It=(Xe=fe.distcode[Nt+((bt&(1<<fr+pr)-1)>>fr)])>>>16&255,dr=65535&Xe,!(fr+(dt=Xe>>>24)<=ht);){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}bt>>>=fr,ht-=fr,fe.back+=fr}if(bt>>>=dt,ht-=dt,fe.back+=dt,64&It){ce.msg="invalid distance code",fe.mode=Z;break}fe.offset=dr,fe.extra=15&It,fe.mode=24;case 24:if(fe.extra){for(st=fe.extra;ht<st;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}fe.offset+=bt&(1<<fe.extra)-1,bt>>>=fe.extra,ht-=fe.extra,fe.back+=fe.extra}if(fe.offset>fe.dmax){ce.msg="invalid distance too far back",fe.mode=Z;break}fe.mode=25;case 25:if(Et===0)break e;if(_t=Ye-Et,fe.offset>_t){if((_t=fe.offset-_t)>fe.whave&&fe.sane){ce.msg="invalid distance too far back",fe.mode=Z;break}_t>fe.wnext?(_t-=fe.wnext,Vt=fe.wsize-_t):Vt=fe.wnext-_t,_t>fe.length&&(_t=fe.length),Lt=fe.window}else Lt=ut,Vt=Ce-fe.offset,_t=fe.length;_t>Et&&(_t=Et),Et-=_t,fe.length-=_t;do ut[Ce++]=Lt[Vt++];while(--_t);fe.length===0&&(fe.mode=21);break;case 26:if(Et===0)break e;ut[Ce++]=fe.length,Et--,fe.mode=21;break;case 27:if(fe.wrap){for(;ht<32;){if(Fe===0)break e;Fe--,bt|=Te[ze++]<<ht,ht+=8}if(Ye-=Et,ce.total_out+=Ye,fe.total+=Ye,Ye&&(ce.adler=fe.check=fe.flags?g(fe.check,ut,Ye,Ce-Ye):m(fe.check,ut,Ye,Ce-Ye)),Ye=Et,(fe.flags?bt:V(bt))!==fe.check){ce.msg="incorrect data check",fe.mode=Z;break}bt=0,ht=0}fe.mode=28;case 28:if(fe.wrap&&fe.flags){for(;ht<32;){if(Fe===0)break e;Fe--,bt+=Te[ze++]<<ht,ht+=8}if(bt!==(4294967295&fe.total)){ce.msg="incorrect length check",fe.mode=Z;break}bt=0,ht=0}fe.mode=29;case 29:At=1;break e;case Z:At=-3;break e;case 31:return-4;default:return U}return ce.next_out=Ce,ce.avail_out=Et,ce.next_in=ze,ce.avail_in=Fe,fe.hold=bt,fe.bits=ht,(fe.wsize||Ye!==ce.avail_out&&fe.mode<Z&&(fe.mode<27||Ie!==4))&&ge(ce,ce.output,ce.next_out,Ye-ce.avail_out),Zt-=ce.avail_in,Ye-=ce.avail_out,ce.total_in+=Zt,ce.total_out+=Ye,fe.total+=Ye,fe.wrap&&Ye&&(ce.adler=fe.check=fe.flags?g(fe.check,ut,Ye,ce.next_out-Ye):m(fe.check,ut,Ye,ce.next_out-Ye)),ce.data_type=fe.bits+(fe.last?64:0)+(fe.mode===G?128:0)+(fe.mode===20||fe.mode===15?256:0),(Zt===0&&Ye===0||Ie===4)&&At===F&&(At=-5),At},inflate.inflateEnd=function(ce){if(!ce||!ce.state)return U;var Ie=ce.state;return Ie.window&&(Ie.window=null),ce.state=null,F},inflate.inflateGetHeader=function(ce,Ie){var fe;return ce&&ce.state&&2&(fe=ce.state).wrap?(fe.head=Ie,Ie.done=!1,F):U},inflate.inflateSetDictionary=function(ce,Ie){var fe,Te=Ie.length;return ce&&ce.state?(fe=ce.state).wrap!==0&&fe.mode!==11?U:fe.mode===11&&m(1,Ie,Te,0)!==fe.check?-3:ge(ce,Ie,Te,Te)?(fe.mode=31,-4):(fe.havedict=1,F):U},inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}function requireConstants(){return hasRequiredConstants?constants:(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function requireGzheader(){return hasRequiredGzheader?gzheader:(hasRequiredGzheader=1,gzheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1})}function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var d=requireInflate$1(),m=requireCommon(),g=requireStrings(),w=requireConstants(),$=requireMessages(),I=requireZstream(),D=requireGzheader(),F=Object.prototype.toString;function U(G){if(!(this instanceof U))return new U(G);this.options=m.assign({chunkSize:16384,windowBits:0,to:""},G||{});var Z=this.options;Z.raw&&Z.windowBits>=0&&Z.windowBits<16&&(Z.windowBits=-Z.windowBits,Z.windowBits===0&&(Z.windowBits=-15)),!(Z.windowBits>=0&&Z.windowBits<16)||G&&G.windowBits||(Z.windowBits+=32),Z.windowBits>15&&Z.windowBits<48&&(15&Z.windowBits||(Z.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new I,this.strm.avail_out=0;var H=d.inflateInit2(this.strm,Z.windowBits);if(H!==w.Z_OK)throw new Error($[H]);if(this.header=new D,d.inflateGetHeader(this.strm,this.header),Z.dictionary&&(typeof Z.dictionary=="string"?Z.dictionary=g.string2buf(Z.dictionary):F.call(Z.dictionary)==="[object ArrayBuffer]"&&(Z.dictionary=new Uint8Array(Z.dictionary)),Z.raw&&(H=d.inflateSetDictionary(this.strm,Z.dictionary))!==w.Z_OK))throw new Error($[H])}function j(G,Z){var H=new U(Z);if(H.push(G,!0),H.err)throw H.msg||$[H.err];return H.result}return U.prototype.push=function(G,Z){var H,q,V,Q,X,re=this.strm,J=this.options.chunkSize,se=this.options.dictionary,ie=!1;if(this.ended)return!1;q=Z===~~Z?Z:Z===!0?w.Z_FINISH:w.Z_NO_FLUSH,typeof G=="string"?re.input=g.binstring2buf(G):F.call(G)==="[object ArrayBuffer]"?re.input=new Uint8Array(G):re.input=G,re.next_in=0,re.avail_in=re.input.length;do{if(re.avail_out===0&&(re.output=new m.Buf8(J),re.next_out=0,re.avail_out=J),(H=d.inflate(re,w.Z_NO_FLUSH))===w.Z_NEED_DICT&&se&&(H=d.inflateSetDictionary(this.strm,se)),H===w.Z_BUF_ERROR&&ie===!0&&(H=w.Z_OK,ie=!1),H!==w.Z_STREAM_END&&H!==w.Z_OK)return this.onEnd(H),this.ended=!0,!1;re.next_out&&(re.avail_out!==0&&H!==w.Z_STREAM_END&&(re.avail_in!==0||q!==w.Z_FINISH&&q!==w.Z_SYNC_FLUSH)||(this.options.to==="string"?(V=g.utf8border(re.output,re.next_out),Q=re.next_out-V,X=g.buf2string(re.output,V),re.next_out=Q,re.avail_out=J-Q,Q&&m.arraySet(re.output,re.output,V,Q,0),this.onData(X)):this.onData(m.shrinkBuf(re.output,re.next_out)))),re.avail_in===0&&re.avail_out===0&&(ie=!0)}while((re.avail_in>0||re.avail_out===0)&&H!==w.Z_STREAM_END);return H===w.Z_STREAM_END&&(q=w.Z_FINISH),q===w.Z_FINISH?(H=d.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===w.Z_OK):q!==w.Z_SYNC_FLUSH||(this.onEnd(w.Z_OK),re.avail_out=0,!0)},U.prototype.onData=function(G){this.chunks.push(G)},U.prototype.onEnd=function(G){G===w.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},inflate$1.Inflate=U,inflate$1.inflate=j,inflate$1.inflateRaw=function(G,Z){return(Z=Z||{}).raw=!0,j(G,Z)},inflate$1.ungzip=j,inflate$1}function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var d={};return(0,requireCommon().assign)(d,requireDeflate(),requireInflate(),requireConstants()),pako_1=d}(function(d){(function(){var m={};function g(){typeof process<"u"||console.log.apply(console,arguments)}d.exports=m,(function(w,$){(function(){var I=(function(){function U(j){this.message="JPEG error: "+j}return U.prototype=new Error,U.prototype.name="JpegError",U.constructor=U,U})(),D=(function(){var U=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),j=4017,G=799,Z=3406,H=2276,q=1567,V=3784,Q=5793,X=2896;function re(ge){ge==null&&(ge={}),ge.w==null&&(ge.w=-1),this.V=ge.n,this.N=ge.w}function J(ge,ce){for(var Ie,fe,Te,ut=0,ze=[],Ce=16;Ce>0&&!ge[Ce-1];)Ce--;ze.push({children:[],index:0});var Fe=ze[0];for(Ie=0;Ie<Ce;Ie++){for(fe=0;fe<ge[Ie];fe++){for((Fe=ze.pop()).children[Fe.index]=ce[ut];Fe.index>0;)Fe=ze.pop();for(Fe.index++,ze.push(Fe);ze.length<=Ie;)ze.push(Te={children:[],index:0}),Fe.children[Fe.index]=Te.children,Fe=Te;ut++}Ie+1<Ce&&(ze.push(Te={children:[],index:0}),Fe.children[Fe.index]=Te.children,Fe=Te)}return ze[0].children}function se(ge,ce,Ie){return 64*((ge.P+1)*ce+Ie)}function ie(ge,ce,Ie,fe,Te,ut,ze,Ce,Fe,Et){Et==null&&(Et=!1);var bt,ht,Zt,Ye,_t,Vt,Lt,dt,It,dr,fr,pr=Ie.m,Nt=Ie.Z,$e=ce,At=0,Ge=0,st=0,Xe=0,gt=0,Qt=0;function me(){if(Ge>0)return Ge--,At>>Ge&1;if((At=ge[ce++])===255){var ai=ge[ce++];if(ai){if(ai===220&&Et){var fi=F(ge,ce+=2);if(ce+=2,fi>0&&fi!==Ie.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",fi)}else if(ai===217){if(Et){var ui=8*gt;if(ui>0&&ui<Ie.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",ui)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new I("unexpected marker")}}return Ge=7,At>>>7}function Be(ai){for(var fi=ai;;){switch(typeof(fi=fi[me()])){case"number":return fi;case"object":continue}throw new I("invalid huffman sequence")}}function lt(ai){for(var fi=0;ai>0;)fi=fi<<1|me(),ai--;return fi}function ft(ai){if(ai===1)return me()===1?1:-1;var fi=lt(ai);return fi>=1<<ai-1?fi:fi+(-1<<ai)+1}function mr(ai,fi,ui,wi,_i){var bi=ui%pr;gt=(ui/pr|0)*ai.A+wi;var Ei=bi*ai.h+_i;fi(ai,se(ai,gt,Ei))}function gr(ai,fi,ui){gt=ui/ai.P|0;var wi=ui%ai.P;fi(ai,se(ai,gt,wi))}var oi=fe.length;for(Lt=Nt?ut===0?Ce===0?function(ai,fi){var ui=Be(ai.J),wi=ui===0?0:ft(ui)<<Fe;ai.D[fi]=ai.Q+=wi}:function(ai,fi){ai.D[fi]|=me()<<Fe}:Ce===0?function(ai,fi){if(st>0)st--;else for(var ui=ut,wi=ze;ui<=wi;){var _i=Be(ai.i),bi=15&_i,Ei=_i>>4;if(bi!==0){var gi=U[ui+=Ei];ai.D[fi+gi]=ft(bi)*(1<<Fe),ui++}else{if(Ei<15){st=lt(Ei)+(1<<Ei)-1;break}ui+=16}}}:function(ai,fi){for(var ui,wi,_i=ut,bi=ze,Ei=0;_i<=bi;){var gi=fi+U[_i],Yt=ai.D[gi]<0?-1:1;switch(Xe){case 0:if(Ei=(wi=Be(ai.i))>>4,(ui=15&wi)==0)Ei<15?(st=lt(Ei)+(1<<Ei),Xe=4):(Ei=16,Xe=1);else{if(ui!==1)throw new I("invalid ACn encoding");bt=ft(ui),Xe=Ei?2:3}continue;case 1:case 2:ai.D[gi]?ai.D[gi]+=Yt*(me()<<Fe):--Ei==0&&(Xe=Xe===2?3:0);break;case 3:ai.D[gi]?ai.D[gi]+=Yt*(me()<<Fe):(ai.D[gi]=bt<<Fe,Xe=0);break;case 4:ai.D[gi]&&(ai.D[gi]+=Yt*(me()<<Fe))}_i++}Xe===4&&--st==0&&(Xe=0)}:function(ai,fi){var ui=Be(ai.J),wi=ui===0?0:ft(ui),_i=1;for(ai.D[fi]=ai.Q+=wi;_i<64;){var bi=Be(ai.i),Ei=15&bi,gi=bi>>4;if(Ei!==0){var Yt=U[_i+=gi];ai.D[fi+Yt]=ft(Ei),_i++}else{if(gi<15)break;_i+=16}}},It=oi===1?fe[0].P*fe[0].c:pr*Ie.R;Qt<=It;){var hi=Te?Math.min(It-Qt,Te):It;if(hi>0){for(Zt=0;Zt<oi;Zt++)fe[Zt].Q=0;if(st=0,oi===1)for(ht=fe[0],Vt=0;Vt<hi;Vt++)gr(ht,Lt,Qt),Qt++;else for(Vt=0;Vt<hi;Vt++){for(Zt=0;Zt<oi;Zt++)for(dr=(ht=fe[Zt]).h,fr=ht.A,Ye=0;Ye<fr;Ye++)for(_t=0;_t<dr;_t++)mr(ht,Lt,Qt,Ye,_t);Qt++}}if(Ge=0,!(dt=de(ge,ce))||(dt.u&&(ce=dt.offset),!(dt.M>=65488&&dt.M<=65495)))break;ce+=2}return ce-$e}function oe(ge,ce,Ie){var fe,Te,ut,ze,Ce,Fe,Et,bt,ht,Zt,Ye,_t,Vt,Lt,dt,It,dr,fr=ge.$,pr=ge.D;if(!fr)throw new I("missing required Quantization Table.");for(var Nt=0;Nt<64;Nt+=8)ht=pr[ce+Nt],Zt=pr[ce+Nt+1],Ye=pr[ce+Nt+2],_t=pr[ce+Nt+3],Vt=pr[ce+Nt+4],Lt=pr[ce+Nt+5],dt=pr[ce+Nt+6],It=pr[ce+Nt+7],ht*=fr[Nt],Zt|Ye|_t|Vt|Lt|dt|It?(Zt*=fr[Nt+1],Ye*=fr[Nt+2],_t*=fr[Nt+3],Vt*=fr[Nt+4],Lt*=fr[Nt+5],dt*=fr[Nt+6],It*=fr[Nt+7],Te=(fe=(fe=Q*ht+128>>8)+(Te=Q*Vt+128>>8)+1>>1)-Te,dr=(ut=Ye)*V+(ze=dt)*q+128>>8,ut=ut*q-ze*V+128>>8,Et=(Ce=(Ce=X*(Zt-It)+128>>8)+(Et=Lt<<4)+1>>1)-Et,Fe=(bt=(bt=X*(Zt+It)+128>>8)+(Fe=_t<<4)+1>>1)-Fe,ze=(fe=fe+(ze=dr)+1>>1)-ze,ut=(Te=Te+ut+1>>1)-ut,dr=Ce*H+bt*Z+2048>>12,Ce=Ce*Z-bt*H+2048>>12,bt=dr,dr=Fe*G+Et*j+2048>>12,Fe=Fe*j-Et*G+2048>>12,Et=dr,Ie[Nt]=fe+bt,Ie[Nt+7]=fe-bt,Ie[Nt+1]=Te+Et,Ie[Nt+6]=Te-Et,Ie[Nt+2]=ut+Fe,Ie[Nt+5]=ut-Fe,Ie[Nt+3]=ze+Ce,Ie[Nt+4]=ze-Ce):(dr=Q*ht+512>>10,Ie[Nt]=dr,Ie[Nt+1]=dr,Ie[Nt+2]=dr,Ie[Nt+3]=dr,Ie[Nt+4]=dr,Ie[Nt+5]=dr,Ie[Nt+6]=dr,Ie[Nt+7]=dr);for(var $e=0;$e<8;++$e)ht=Ie[$e],(Zt=Ie[$e+8])|(Ye=Ie[$e+16])|(_t=Ie[$e+24])|(Vt=Ie[$e+32])|(Lt=Ie[$e+40])|(dt=Ie[$e+48])|(It=Ie[$e+56])?(Te=(fe=4112+((fe=Q*ht+2048>>12)+(Te=Q*Vt+2048>>12)+1>>1))-Te,dr=(ut=Ye)*V+(ze=dt)*q+2048>>12,ut=ut*q-ze*V+2048>>12,ze=dr,Et=(Ce=(Ce=X*(Zt-It)+2048>>12)+(Et=Lt)+1>>1)-Et,Fe=(bt=(bt=X*(Zt+It)+2048>>12)+(Fe=_t)+1>>1)-Fe,dr=Ce*H+bt*Z+2048>>12,Ce=Ce*Z-bt*H+2048>>12,bt=dr,dr=Fe*G+Et*j+2048>>12,Fe=Fe*j-Et*G+2048>>12,(ht=(fe=fe+ze+1>>1)+bt)<16?ht=0:ht>=4080?ht=255:ht>>=4,(Zt=(Te=Te+ut+1>>1)+(Et=dr))<16?Zt=0:Zt>=4080?Zt=255:Zt>>=4,(Ye=(ut=Te-ut)+Fe)<16?Ye=0:Ye>=4080?Ye=255:Ye>>=4,(_t=(ze=fe-ze)+Ce)<16?_t=0:_t>=4080?_t=255:_t>>=4,(Vt=ze-Ce)<16?Vt=0:Vt>=4080?Vt=255:Vt>>=4,(Lt=ut-Fe)<16?Lt=0:Lt>=4080?Lt=255:Lt>>=4,(dt=Te-Et)<16?dt=0:dt>=4080?dt=255:dt>>=4,(It=fe-bt)<16?It=0:It>=4080?It=255:It>>=4,pr[ce+$e]=ht,pr[ce+$e+8]=Zt,pr[ce+$e+16]=Ye,pr[ce+$e+24]=_t,pr[ce+$e+32]=Vt,pr[ce+$e+40]=Lt,pr[ce+$e+48]=dt,pr[ce+$e+56]=It):(dr=(dr=Q*ht+8192>>14)<-2040?0:dr>=2024?255:dr+2056>>4,pr[ce+$e]=dr,pr[ce+$e+8]=dr,pr[ce+$e+16]=dr,pr[ce+$e+24]=dr,pr[ce+$e+32]=dr,pr[ce+$e+40]=dr,pr[ce+$e+48]=dr,pr[ce+$e+56]=dr)}function pe(ge,ce){for(var Ie=ce.P,fe=ce.c,Te=new Int16Array(64),ut=0;ut<fe;ut++)for(var ze=0;ze<Ie;ze++)oe(ce,se(ce,ut,ze),Te);return ce.D}function de(ge,ce,Ie){Ie==null&&(Ie=ce);var fe=ge.length-1,Te=Ie<ce?Ie:ce;if(ce>=fe)return null;var ut=F(ge,ce);if(ut>=65472&&ut<=65534)return{u:null,M:ut,offset:ce};for(var ze=F(ge,Te);!(ze>=65472&&ze<=65534);){if(++Te>=fe)return null;ze=F(ge,Te)}return{u:ut.toString(16),M:ze,offset:Te}}return re.prototype={parse(ge,ce){ce==null&&(ce={});var Ie,fe,Te=ce.F,ut=0,ze=null,Ce=null,Fe=0;function Et(){var _r=F(ge,ut),ri=(ut+=2)+_r-2,yt=de(ge,ri,ut);yt&&yt.u&&(ri=yt.offset);var ni=ge.subarray(ut,ri);return ut+=ni.length,ni}function bt(_r){for(var ri=Math.ceil(_r.o/8/_r.X),yt=Math.ceil(_r.s/8/_r.B),ni=0;ni<_r.W.length;ni++){gr=_r.W[ni];var $i=Math.ceil(Math.ceil(_r.o/8)*gr.h/_r.X),Oe=Math.ceil(Math.ceil(_r.s/8)*gr.A/_r.B),ii=ri*gr.h,br=64*(yt*gr.A)*(ii+1);gr.D=new Int16Array(br),gr.P=$i,gr.c=Oe}_r.m=ri,_r.R=yt}var ht=[],Zt=[],Ye=[],_t=F(ge,ut);if(ut+=2,_t!==65496)throw new I("SOI not found");_t=F(ge,ut),ut+=2;e:for(;_t!==65497;){var Vt,Lt,dt;switch(_t){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var It=Et();_t===65504&&It[0]===74&&It[1]===70&&It[2]===73&&It[3]===70&&It[4]===0&&(ze={version:{d:It[5],T:It[6]},K:It[7],j:It[8]<<8|It[9],H:It[10]<<8|It[11],S:It[12],I:It[13],C:It.subarray(14,14+3*It[12]*It[13])}),_t===65518&&It[0]===65&&It[1]===100&&It[2]===111&&It[3]===98&&It[4]===101&&(Ce={version:It[5]<<8|It[6],k:It[7]<<8|It[8],q:It[9]<<8|It[10],a:It[11]});break;case 65499:for(var dr=F(ge,ut)+(ut+=2)-2;ut<dr;){var fr=ge[ut++],pr=new Uint16Array(64);if(fr>>4){if(fr>>4!=1)throw new I("DQT - invalid table spec");for(Lt=0;Lt<64;Lt++)pr[U[Lt]]=F(ge,ut),ut+=2}else for(Lt=0;Lt<64;Lt++)pr[U[Lt]]=ge[ut++];ht[15&fr]=pr}break;case 65472:case 65473:case 65474:if(Ie)throw new I("Only single frame JPEGs supported");ut+=2,(Ie={}).G=_t===65473,Ie.Z=_t===65474,Ie.precision=ge[ut++];var Nt,$e=F(ge,ut),At=0,Ge=0;ut+=2,Ie.s=Te||$e,Ie.o=F(ge,ut),ut+=2,Ie.W=[],Ie._={};var st=ge[ut++];for(Vt=0;Vt<st;Vt++){Nt=ge[ut];var Xe=ge[ut+1]>>4,gt=15&ge[ut+1];At<Xe&&(At=Xe),Ge<gt&&(Ge=gt);var Qt=ge[ut+2];dt=Ie.W.push({h:Xe,A:gt,L:Qt,$:null}),Ie._[Nt]=dt-1,ut+=3}Ie.X=At,Ie.B=Ge,bt(Ie);break;case 65476:var me=F(ge,ut);for(ut+=2,Vt=2;Vt<me;){var Be=ge[ut++],lt=new Uint8Array(16),ft=0;for(Lt=0;Lt<16;Lt++,ut++)ft+=lt[Lt]=ge[ut];var mr=new Uint8Array(ft);for(Lt=0;Lt<ft;Lt++,ut++)mr[Lt]=ge[ut];Vt+=17+ft,(Be>>4?Zt:Ye)[15&Be]=J(lt,mr)}break;case 65501:fe=F(ge,ut+=2),ut+=2;break;case 65498:var gr,oi=++Fe==1&&!Te;ut+=2;var hi=ge[ut++],ai=[];for(Vt=0;Vt<hi;Vt++){var fi=ge[ut++],ui=Ie._[fi];(gr=Ie.W[ui]).index=fi;var wi=ge[ut++];gr.J=Ye[wi>>4],gr.i=Zt[15&wi],ai.push(gr)}var _i=ge[ut++],bi=ge[ut++],Ei=ge[ut++];try{var gi=ie(ge,ut,Ie,ai,fe,_i,bi,Ei>>4,15&Ei,oi);ut+=gi}catch(_r){if(_r instanceof DNLMarkerError)return this.parse(ge,{F:_r.s});if(_r instanceof EOIMarkerError)break e;throw _r}break;case 65500:ut+=4;break;case 65535:ge[ut]!==255&&ut--;break;default:var Yt=de(ge,ut-2,ut-3);if(Yt&&Yt.u){ut=Yt.offset;break}if(ut>=ge.length-1)break e;throw new I("JpegImage.parse - unknown marker: "+_t.toString(16))}_t=F(ge,ut),ut+=2}for(this.width=Ie.o,this.height=Ie.s,this.g=ze,this.b=Ce,this.W=[],Vt=0;Vt<Ie.W.length;Vt++){var di=ht[(gr=Ie.W[Vt]).L];di&&(gr.$=di),this.W.push({index:gr.index,e:pe(0,gr),l:gr.h/Ie.X,t:gr.A/Ie.B,P:gr.P,c:gr.c})}this.p=this.W.length},Y(ge,ce,Ie){Ie==null&&(Ie=!1);var fe,Te,ut,ze,Ce,Fe,Et,bt,ht,Zt,Ye,_t,Vt=this.width/ge,Lt=this.height/ce,dt=0,It=this.W.length,dr=ge*ce*It,fr=new Uint8ClampedArray(dr),pr=new Uint32Array(ge),Nt=4294967288;for(Et=0;Et<It;Et++){if(Te=(fe=this.W[Et]).l*Vt,ut=fe.t*Lt,dt=Et,Ye=fe.e,ze=fe.P+1<<3,Te!==_t){for(Ce=0;Ce<ge;Ce++)bt=0|Ce*Te,pr[Ce]=(bt&Nt)<<3|7&bt;_t=Te}for(Fe=0;Fe<ce;Fe++)for(Zt=ze*((bt=0|Fe*ut)&Nt)|(7&bt)<<3,Ce=0;Ce<ge;Ce++)fr[dt]=Ye[Zt+pr[Ce]],dt+=It}var $e=this.V;if(Ie||It!==4||$e||($e=new Int32Array([-256,255,-256,255,-256,255,-256,255])),$e)for(Et=0;Et<dr;)for(bt=0,ht=0;bt<It;bt++,Et++,ht+=2)fr[Et]=(fr[Et]*$e[ht]>>8)+$e[ht+1];return fr},get f(){return this.b?!!this.b.a:this.p===3?this.N!==0&&(this.W[0].index!==82||this.W[1].index!==71||this.W[2].index!==66):this.N===1},z:function(ge){for(var ce,Ie,fe,Te=0,ut=ge.length;Te<ut;Te+=3)ce=ge[Te],Ie=ge[Te+1],fe=ge[Te+2],ge[Te]=ce-179.456+1.402*fe,ge[Te+1]=ce+135.459-.344*Ie-.714*fe,ge[Te+2]=ce-226.816+1.772*Ie;return ge},O:function(ge){for(var ce,Ie,fe,Te,ut=0,ze=0,Ce=ge.length;ze<Ce;ze+=4)ce=ge[ze],Ie=ge[ze+1],fe=ge[ze+2],Te=ge[ze+3],ge[ut++]=Ie*(-660635669420364e-19*Ie+.000437130475926232*fe-54080610064599e-18*ce+.00048449797120281*Te-.154362151871126)-122.67195406894+fe*(-.000957964378445773*fe+.000817076911346625*ce-.00477271405408747*Te+1.53380253221734)+ce*(.000961250184130688*ce-.00266257332283933*Te+.48357088451265)+Te*(-.000336197177618394*Te+.484791561490776),ge[ut++]=107.268039397724+Ie*(219927104525741e-19*Ie-.000640992018297945*fe+.000659397001245577*ce+.000426105652938837*Te-.176491792462875)+fe*(-.000778269941513683*fe+.00130872261408275*ce+.000770482631801132*Te-.151051492775562)+ce*(.00126935368114843*ce-.00265090189010898*Te+.25802910206845)+Te*(-.000318913117588328*Te-.213742400323665),ge[ut++]=Ie*(-.000570115196973677*Ie-263409051004589e-19*fe+.0020741088115012*ce-.00288260236853442*Te+.814272968359295)-20.810012546947+fe*(-153496057440975e-19*fe-.000132689043961446*ce+.000560833691242812*Te-.195152027534049)+ce*(.00174418132927582*ce-.00255243321439347*Te+.116935020465145)+Te*(-.000343531996510555*Te+.24165260232407);return ge.subarray(0,ut)},r:function(ge){for(var ce,Ie,fe,Te=0,ut=ge.length;Te<ut;Te+=4)ce=ge[Te],Ie=ge[Te+1],fe=ge[Te+2],ge[Te]=434.456-ce-1.402*fe,ge[Te+1]=119.541-ce+.344*Ie+.714*fe,ge[Te+2]=481.816-ce-1.772*Ie;return ge},U:function(ge){for(var ce,Ie,fe,Te,ut=0,ze=0,Ce=ge.length;ze<Ce;ze+=4)ce=ge[ze],Ie=ge[ze+1],fe=ge[ze+2],Te=ge[ze+3],ge[ut++]=255+ce*(-6747147073602441e-20*ce+.0008379262121013727*Ie+.0002894718188643294*fe+.003264231057537806*Te-1.1185611867203937)+Ie*(26374107616089405e-21*Ie-8626949158638572e-20*fe-.0002748769067499491*Te-.02155688794978967)+fe*(-3878099212869363e-20*fe-.0003267808279485286*Te+.0686742238595345)-Te*(.0003361971776183937*Te+.7430659151342254),ge[ut++]=255+ce*(.00013596372813588848*ce+.000924537132573585*Ie+.00010567359618683593*fe+.0004791864687436512*Te-.3109689587515875)+Ie*(-.00023545346108370344*Ie+.0002702845253534714*fe+.0020200308977307156*Te-.7488052167015494)+fe*(6834815998235662e-20*fe+.00015168452363460973*Te-.09751927774728933)-Te*(.0003189131175883281*Te+.7364883807733168),ge[ut++]=255+ce*(13598650411385307e-21*ce+.00012423956175490851*Ie+.0004751985097583589*fe-36729317476630422e-22*Te-.05562186980264034)+Ie*(.00016141380598724676*Ie+.0009692239130725186*fe+.0007782692450036253*Te-.44015232367526463)+fe*(5068882914068769e-22*fe+.0017778369011375071*Te-.7591454649749609)-Te*(.0003435319965105553*Te+.7063770186160144);return ge.subarray(0,ut)},getData:function(ge){var ce=ge.width,Ie=ge.height,fe=ge.forceRGB,Te=ge.isSourcePDF;if(this.p>4)throw new I("Unsupported color mode");var ut=this.Y(ce,Ie,Te);if(this.p===1&&fe){for(var ze=ut.length,Ce=new Uint8ClampedArray(3*ze),Fe=0,Et=0;Et<ze;Et++){var bt=ut[Et];Ce[Fe++]=bt,Ce[Fe++]=bt,Ce[Fe++]=bt}return Ce}if(this.p===3&&this.f)return this.z(ut);if(this.p===4){if(this.f)return fe?this.O(ut):this.r(ut);if(fe)return this.U(ut)}return ut}},re})();function F(U,j){return U[j]<<8|U[j+1]}w.JpegDecoder=D})(),w.encodeImage=function(I,D,F,U){var j={t256:[D],t257:[F],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[F],t279:[D*F*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(U)for(var G in U)j[G]=U[G];var Z=new Uint8Array(w.encode([j])),H=new Uint8Array(I),q=new Uint8Array(1e3+D*F*4);for(G=0;G<Z.length;G++)q[G]=Z[G];for(G=0;G<H.length;G++)q[1e3+G]=H[G];return q.buffer},w.encode=function(I){var D=new Uint8Array(2e4),F=4,U=w._binBE;D[0]=D[1]=77,U.writeUshort(D,2,42);var j=8;U.writeUint(D,F,j),F+=4;for(var G=0;G<I.length;G++){var Z=w._writeIFD(U,w._types.basic,D,j,I[G]);j=Z[1],G<I.length-1&&(3&j&&(j+=4-(3&j)),U.writeUint(D,Z[0],j))}return D.slice(0,j).buffer},w.decode=function(I,D){D==null&&(D={parseMN:!0,debug:!1});var F=new Uint8Array(I),U=0,j=w._binBE.readASCII(F,U,2);U+=2;var G=j=="II"?w._binLE:w._binBE;G.readUshort(F,U),U+=2;var Z=G.readUint(F,U);U+=4;for(var H=[];;){var q=G.readUshort(F,Z),V=G.readUshort(F,Z+4);if(q!=0&&(V<1||13<V)){g("error in TIFF");break}if(w._readIFD(G,F,Z,H,0,D),(Z=G.readUint(F,Z+2+12*q))==0)break}return H},w.decodeImage=function(I,D,F){if(!D.data){var U=new Uint8Array(I),j=w._binBE.readASCII(U,0,2);if(D.t256!=null){D.isLE=j=="II",D.width=D.t256[0],D.height=D.t257[0];var G=D.t259?D.t259[0]:1,Z=D.t266?D.t266[0]:1;D.t284&&D.t284[0]==2&&g("PlanarConfiguration 2 should not be used!"),G==7&&D.t258&&D.t258.length>3&&(D.t258=D.t258.slice(0,3));var H=D.t277?D.t277[0]:1,q=(D.t258?D.t258[0]:1)*H;G==1&&D.t279!=null&&D.t278&&D.t262[0]==32803&&(q=Math.round(8*D.t279[0]/(D.width*D.t278[0]))),D.t50885&&D.t50885[0]==4&&(q=3*D.t258[0]);var V=8*Math.ceil(D.width*q/8),Q=D.t273;(Q==null||D.t322)&&(Q=D.t324);var X=D.t279;G==1&&Q.length==1&&(X=[D.height*(V>>>3)]),(X==null||D.t322)&&(X=D.t325);var re=new Uint8Array(D.height*(V>>>3)),J=0;if(D.t322!=null){var se=D.t322[0],ie=D.t323[0],oe=Math.floor((D.width+se-1)/se),pe=Math.floor((D.height+ie-1)/ie),de=new Uint8Array(0|Math.ceil(se*ie*q/8));console.log("====",oe,pe);for(var ge=0;ge<pe;ge++)for(var ce=0;ce<oe;ce++){var Ie=ge*oe+ce;de.fill(0),w.decode._decompress(D,F,U,Q[Ie],X[Ie],G,de,0,Z,se,ie),G==6?re=de:w._copyTile(de,0|Math.ceil(se*q/8),ie,re,0|Math.ceil(D.width*q/8),D.height,0|Math.ceil(ce*se*q/8),ge*ie)}J=8*re.length}else{if(Q==null)return;var fe=D.t278?D.t278[0]:D.height;for(fe=Math.min(fe,D.height),Ie=0;Ie<Q.length;Ie++)w.decode._decompress(D,F,U,Q[Ie],X[Ie],G,re,0|Math.ceil(J/8),Z,D.width,fe),J+=V*fe;J=Math.min(J,8*re.length)}D.data=new Uint8Array(re.buffer,0,0|Math.ceil(J/8))}}},w.decode._decompress=function(I,D,F,U,j,G,Z,H,q,V,Q){if(I.t271&&I.t271[0]=="Panasonic"&&I.t45&&I.t45[0]==6&&(G=34316),G==1)for(var X=0;X<j;X++)Z[H+X]=F[U+X];else if(G==2)w.decode._decodeG2(F,U,j,Z,H,V,q);else if(G==3)w.decode._decodeG3(F,U,j,Z,H,V,q,!!I.t292&&!(1&~I.t292[0]));else if(G==4)w.decode._decodeG4(F,U,j,Z,H,V,q);else if(G==5)w.decode._decodeLZW(F,U,j,Z,H,8);else if(G==6)w.decode._decodeOldJPEG(I,F,U,j,Z,H);else if(G==7||G==34892)w.decode._decodeNewJPEG(I,F,U,j,Z,H);else if(G==8||G==32946){var re=new Uint8Array(F.buffer,U+2,j-6),J=$.inflateRaw(re);H+J.length<=Z.length&&Z.set(J,H)}else G==9?w.decode._decodeVC5(F,U,j,Z,H,I.t33422):G==32767?w.decode._decodeARW(I,F,U,j,Z,H):G==32773?w.decode._decodePackBits(F,U,j,Z,H):G==32809?w.decode._decodeThunder(F,U,j,Z,H):G==34316?w.decode._decodePanasonic(I,F,U,j,Z,H):G==34713?w.decode._decodeNikon(I,D,F,U,j,Z,H):G==34676?w.decode._decodeLogLuv32(I,F,U,j,Z,H):g("Unknown compression",G);var se=I.t258?Math.min(32,I.t258[0]):1,ie=I.t277?I.t277[0]:1,oe=se*ie>>>3,pe=Math.ceil(se*ie*V/8);if(se==16&&!I.isLE&&I.t33422==null)for(var de=0;de<Q;de++)for(var ge=H+de*pe,ce=1;ce<pe;ce+=2){var Ie=Z[ge+ce];Z[ge+ce]=Z[ge+ce-1],Z[ge+ce-1]=Ie}if(I.t317&&I.t317[0]==2)for(de=0;de<Q;de++){var fe=H+de*pe;if(se==16)for(X=oe;X<pe;X+=2){var Te=(Z[fe+X+1]<<8|Z[fe+X])+(Z[fe+X-oe+1]<<8|Z[fe+X-oe]);Z[fe+X]=255&Te,Z[fe+X+1]=Te>>>8&255}else if(ie==3)for(X=3;X<pe;X+=3)Z[fe+X]=Z[fe+X]+Z[fe+X-3]&255,Z[fe+X+1]=Z[fe+X+1]+Z[fe+X-2]&255,Z[fe+X+2]=Z[fe+X+2]+Z[fe+X-1]&255;else for(X=oe;X<pe;X++)Z[fe+X]=Z[fe+X]+Z[fe+X-oe]&255}},w.decode._decodePanasonic=function(I,D,F,U,j,G){var Z,H,q,V,Q,X,re,J,se=D.buffer,ie=I.t2[0],oe=I.t3[0],pe=I.t10[0],de=I.t45[0],ge=0,ce=0,Ie=0,fe=0,Te=de==6?new Uint32Array(18):new Uint8Array(16),ut=[0,0],ze=[0,0],Ce=0,Fe=new Uint8Array(16384),Et=new Uint16Array(j.buffer);function bt(Qt){if(Ie==0){var me=new Uint8Array(se,F+ce+8184,8200),Be=new Uint8Array(se,F+ce,8184);Fe.set(me),Fe.set(Be,me.length),ce+=16384}if(de!=5)return(Fe[fe=(Ie=Ie-Qt&131071)>>3^16368]|Fe[fe+1]<<8)>>(7&Ie)&~(-1<<Qt);for(Z=0;Z<16;Z++)Te[Z]=Fe[Ie++],Ie&=16383}function ht(Qt){return Fe[Ie+15-Qt]}function Zt(){ut[0]=0,ut[1]=0,ze[0]=0,ze[1]=0}if(de==7)throw de;if(de==6){var Ye=pe==12,_t=Ye?function(){Te[0]=ht(0)<<4|ht(1)>>4,Te[1]=4095&((15&ht(1))<<8|ht(2)),Te[2]=ht(3)>>6&3,Te[3]=(63&ht(3))<<2|ht(4)>>6,Te[4]=(63&ht(4))<<2|ht(5)>>6,Te[5]=(63&ht(5))<<2|ht(6)>>6,Te[6]=ht(6)>>4&3,Te[7]=(15&ht(6))<<4|ht(7)>>4,Te[8]=(15&ht(7))<<4|ht(8)>>4,Te[9]=(15&ht(8))<<4|ht(9)>>4,Te[10]=ht(9)>>2&3,Te[11]=(3&ht(9))<<6|ht(10)>>2,Te[12]=(3&ht(10))<<6|ht(11)>>2,Te[13]=(3&ht(11))<<6|ht(12)>>2,Te[14]=3&ht(12),Te[15]=ht(13),Te[16]=ht(14),Te[17]=ht(15),Ie+=16,fe=0}:function(){Te[0]=ht(0)<<6|ht(1)>>2,Te[1]=16383&((3&ht(1))<<12|ht(2)<<4|ht(3)>>4),Te[2]=ht(3)>>2&3,Te[3]=(3&ht(3))<<8|ht(4),Te[4]=ht(5)<<2|ht(6)>>6,Te[5]=(63&ht(6))<<4|ht(7)>>4,Te[6]=ht(7)>>2&3,Te[7]=(3&ht(7))<<8|ht(8),Te[8]=ht(9)<<2&1020|ht(10)>>6,Te[9]=1023&(ht(10)<<4|ht(11)>>4),Te[10]=ht(11)>>2&3,Te[11]=(3&ht(11))<<8|ht(12),Te[12]=1023&(ht(13)<<2&1020|ht(14)>>6),Te[13]=1023&(ht(14)<<4|ht(15)>>4),Ie+=16,fe=0},Vt=Ye?14:11,Lt=Ye?128:512,dt=Ye?2048:8192,It=Ye?16383:65535,dr=Ye?4095:16383,fr=ie/Vt,pr=16*fr,Nt=Ye?18:14;for(X=0;X<oe-15;X+=16){var $e=Math.min(16,oe-X),At=pr*$e;for(Fe=new Uint8Array(se,F+ge,At),Ie=0,ge+=At,J=0,re=0;J<$e;J++,re=0){Ce=(X+J)*ie;for(var Ge=0;Ge<fr;Ge++)for(_t(),Zt(),q=0,Q=0,Z=0;Z<Vt;Z++){if(V=1&Z,Z%3==2){var st=fe<Nt?Te[fe++]:0;st==3&&(st=4),Q=Lt<<st,q=1<<st}var Xe=fe<Nt?Te[fe++]:0;ut[V]?(Xe*=q,Q<dt&&ze[V]>Q&&(Xe+=ze[V]-Q),ze[V]=Xe):(ut[V]=Xe,Xe?ze[V]=Xe:Xe=ze[V]),Et[Ce+re++]=Xe-15<=It?Xe-15&It:Xe+2147483633>>31&dr}}}}else if(de==5){var gt=pe==12?10:9;for(X=0;X<oe;X++)for(re=0;re<ie;re+=gt)bt(0),pe==12?(Et[Ce++]=((15&Te[1])<<8)+Te[0],Et[Ce++]=16*Te[2]+(Te[1]>>4),Et[Ce++]=((15&Te[4])<<8)+Te[3],Et[Ce++]=16*Te[5]+(Te[4]>>4),Et[Ce++]=((15&Te[7])<<8)+Te[6],Et[Ce++]=16*Te[8]+(Te[7]>>4),Et[Ce++]=((15&Te[10])<<8)+Te[9],Et[Ce++]=16*Te[11]+(Te[10]>>4),Et[Ce++]=((15&Te[13])<<8)+Te[12],Et[Ce++]=16*Te[14]+(Te[13]>>4)):pe==14&&(Et[Ce++]=Te[0]+((63&Te[1])<<8),Et[Ce++]=(Te[1]>>6)+4*Te[2]+((15&Te[3])<<10),Et[Ce++]=(Te[3]>>4)+16*Te[4]+((3&Te[5])<<12),Et[Ce++]=((252&Te[5])>>2)+(Te[6]<<6),Et[Ce++]=Te[7]+((63&Te[8])<<8),Et[Ce++]=(Te[8]>>6)+4*Te[9]+((15&Te[10])<<10),Et[Ce++]=(Te[10]>>4)+16*Te[11]+((3&Te[12])<<12),Et[Ce++]=((252&Te[12])>>2)+(Te[13]<<6),Et[Ce++]=Te[14]+((63&Te[15])<<8))}else{if(de!=4)throw de;for(X=0;X<oe;X++)for(re=0;re<ie;re++)V=1&(Z=re%14),Z==0&&Zt(),Z%3==2&&(q=4>>3-bt(2)),ze[V]?(H=bt(8))!=0&&(ut[V]-=128<<q,(ut[V]<0||q==4)&&(ut[V]&=~(-1<<q)),ut[V]+=H<<q):(ze[V]=bt(8),(ze[V]||Z>11)&&(ut[V]=ze[V]<<4|bt(4))),Et[Ce++]=ut[1&re]}},w.decode._decodeVC5=(function(){var I,D,F,U=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],j=[3,3,3,3,2,2,2,1,1,1];function G(J){var se=J[1],ie=J[0][se>>>3]>>>7-(7&se)&1;return J[1]++,ie}function Z(J,se){if(I==null){I={};for(var ie=0;ie<U.length;ie+=4)I[U[ie+1]]=U.slice(ie,ie+4)}for(var oe=G(J),pe=I[oe];pe==null;)oe=oe<<1|G(J),pe=I[oe];var de=pe[3];de!=0&&(de=G(J)==0?de:-de),se[0]=pe[2],se[1]=de}function H(J,se){for(var ie=0;ie<se;ie++)1&~J||J++,J>>>=1;return J}function q(J,se){return J>>se}function V(J,se,ie,oe,pe,de){se[ie]=q(q(11*J[pe]-4*J[pe+de]+J[pe+de+de]+4,3)+J[oe],1),se[ie+de]=q(q(5*J[pe]+4*J[pe+de]-J[pe+de+de]+4,3)-J[oe],1)}function Q(J,se,ie,oe,pe,de){var ge=J[pe-de]-J[pe+de],ce=J[pe],Ie=J[oe];se[ie]=q(q(ge+4,3)+ce+Ie,1),se[ie+de]=q(q(4-ge,3)+ce-Ie,1)}function X(J,se,ie,oe,pe,de){se[ie]=q(q(5*J[pe]+4*J[pe-de]-J[pe-de-de]+4,3)+J[oe],1),se[ie+de]=q(q(11*J[pe]-4*J[pe-de]+J[pe-de-de]+4,3)-J[oe],1)}function re(J){return J=F[J=J<0?0:J>4095?4095:J]>>>2}return function(J,se,ie,oe,pe,de){oe=new Uint16Array(oe.buffer);var ge,ce,Ie,fe,Te,ut,ze,Ce,Fe=Date.now(),Et=w._binBE,bt=se+ie;se+=4;for(var ht=de[0]==1;se<bt;){var Zt=Et.readShort(J,se),Ye=Et.readUshort(J,se+2);if(se+=4,Zt==12)fr=Ye;else if(Zt==20)ge=Ye;else if(Zt==21)ce=Ye;else if(Zt==48)Ie=Ye;else if(Zt==53)fe=Ye;else if(Zt!=35){if(Zt==62)Te=Ye;else if(Zt!=101){if(Zt==109)ut=Ye;else if(Zt!=84){if(Zt!=106){if(Zt!=107){if(Zt!=108){if(Zt!=102){if(Zt==104)ui=Ye;else if(Zt!=105){var _t=Zt<0?-Zt:Zt,Vt=65280&_t,Lt=0;if(24576&_t&&(8192&_t?(Lt=65535&Ye,Lt+=(255&_t)<<16):Lt=65535&Ye),24576&~_t){if(_t==16388)se+=4*Lt;else if(Vt!=8192&&Vt!=8448&&Vt!=9216)throw _t.toString(16)}else{if(ze==null){ze=[];for(var dt=0;dt<4;dt++)ze[dt]=new Int16Array((ge>>>1)*(ce>>>1));for(Ce=new Int16Array((ge>>>1)*(ce>>>1)),D=new Int16Array(1024),dt=0;dt<1024;dt++){var It=dt-512,dr=Math.abs(It),fr=Math.floor(768*dr*dr*dr/16581375)+dr;D[dt]=Math.sign(It)*fr}for(F=new Uint16Array(4096),dt=0;dt<4096;dt++){var pr=dt,Nt=65535*(Math.pow(113,pr/4095)-1)/112;F[dt]=Math.min(Nt,65535)}}var $e=ze[Te],At=H(ge,1+j[Ie]),Ge=H(ce,1+j[Ie]);if(Ie==0)for(var st=0;st<Ge;st++)for(var Xe=0;Xe<At;Xe++){var gt=se+2*(st*At+Xe);$e[st*(ge>>>1)+Xe]=J[gt]<<8|J[gt+1]}else{var Qt=[J,8*se],me=[],Be=0,lt=At*Ge,ft=[0,0],mr=0;for(Ye=0;Be<lt;)for(Z(Qt,ft),mr=ft[0],Ye=ft[1];mr>0;)me[Be++]=Ye,mr--;var gr=(Ie-1)%3,oi=gr!=1?At:0,hi=gr!=0?Ge:0;for(st=0;st<Ge;st++){var ai=(st+hi)*(ge>>>1)+oi,fi=st*At;for(Xe=0;Xe<At;Xe++)$e[ai+Xe]=D[me[fi+Xe]+512]*fe}if(gr==2){var ui=ge>>>1,wi=2*At,_i=2*Ge;for(st=0;st<Ge;st++)for(Xe=0;Xe<wi;Xe++){dt=2*st*ui+Xe;var bi=Ge*ui+(gi=st*ui+Xe);st==0?V($e,Ce,dt,bi,gi,ui):st==Ge-1?X($e,Ce,dt,bi,gi,ui):Q($e,Ce,dt,bi,gi,ui)}var Ei=$e;for($e=Ce,Ce=Ei,st=0;st<_i;st++)for(Xe=0;Xe<At;Xe++){var gi;dt=st*ui+2*Xe,bi=At+(gi=st*ui+Xe),Xe==0?V($e,Ce,dt,bi,gi,1):Xe==At-1?X($e,Ce,dt,bi,gi,1):Q($e,Ce,dt,bi,gi,1)}Ei=$e,$e=Ce,Ce=Ei;for(var Yt=[],di=2-~~((Ie-1)/3),_r=0;_r<3;_r++)Yt[_r]=ut>>14-2*_r&3;var ri=Yt[di];if(ri!=0)for(st=0;st<_i;st++)for(Xe=0;Xe<wi;Xe++)$e[dt=st*ui+Xe]=$e[dt]<<ri}}if(Ie==9&&Te==3){var yt=ze[0],ni=ze[1],$i=ze[2],Oe=ze[3];for(st=0;st<ce;st+=2)for(Xe=0;Xe<ge;Xe+=2){var ii=st*ge+Xe,br=yt[gt=(st>>>1)*(ge>>>1)+(Xe>>>1)],hr=ni[gt]-2048,yr=$i[gt]-2048,ti=Oe[gt]-2048,vi=(hr<<1)+br,mi=(yr<<1)+br,yi=br+ti,Si=br-ti;ht?(oe[ii]=re(yi),oe[ii+1]=re(mi),oe[ii+ge]=re(vi),oe[ii+ge+1]=re(Si)):(oe[ii]=re(vi),oe[ii+1]=re(yi),oe[ii+ge]=re(Si),oe[ii+ge+1]=re(mi))}}se+=4*Lt}}}}}}}}}}console.log(Date.now()-Fe)}})(),w.decode._decodeLogLuv32=function(I,D,F,U,j,G){for(var Z=I.width,H=4*Z,q=0,V=new Uint8Array(H);q<U;){for(var Q=0;Q<H;){var X=D[F+q];if(q++,X<128){for(var re=0;re<X;re++)V[Q+re]=D[F+q+re];Q+=X,q+=X}else{for(X-=126,re=0;re<X;re++)V[Q+re]=D[F+q];Q+=X,q++}}for(var J=0;J<Z;J++)j[G+0]=V[J],j[G+1]=V[J+Z],j[G+2]=V[J+2*Z],j[G+4]=V[J+3*Z],G+=6}},w.decode._ljpeg_diff=function(I,D,F){var U,j,G=w.decode._getbithuff;return U=G(I,D,F[0],F),(j=G(I,D,U,0))&1<<U-1||(j-=(1<<U)-1),j},w.decode._decodeARW=function(I,D,F,U,j,G){var Z=I.t256[0],H=I.t257[0],q=I.t258[0],V=I.isLE?w._binLE:w._binBE;if(Z*H==U||Z*H*1.5==U)if(Z*H*1.5!=U){var Q,X,re,J,se,ie,oe,pe,de=new Uint16Array(16),ge=new Uint8Array(Z+1);for(Fe=0;Fe<H;Fe++){for(var ce=0;ce<Z;ce++)ge[ce]=D[F++];for(pe=0,Ce=0;Ce<Z-30;pe+=16){for(X=2047&(Q=V.readUint(ge,pe)),re=2047&Q>>>11,J=15&Q>>>22,se=15&Q>>>26,ie=0;ie<4&&128<<ie<=X-re;ie++);for(oe=30,Ie=0;Ie<16;Ie++)Ie==J?de[Ie]=X:Ie==se?de[Ie]=re:(de[Ie]=((V.readUshort(ge,pe+(oe>>3))>>>(7&oe)&127)<<ie)+re,de[Ie]>2047&&(de[Ie]=2047),oe+=7);for(Ie=0;Ie<16;Ie++,Ce+=2)Lt=de[Ie]<<1,w.decode._putsF(j,(Fe*Z+Ce)*q,Lt<<16-q);Ce-=1&Ce?1:31}}}else for(var Ie=0;Ie<U;Ie+=3){var fe=D[F+Ie+0],Te=D[F+Ie+1],ut=D[F+Ie+2];j[G+Ie]=Te<<4|fe>>>4,j[G+Ie+1]=fe<<4|ut>>>4,j[G+Ie+2]=ut<<4|Te>>>4}else{H+=8;var ze,Ce,Fe,Et=[F,0,0,0],bt=new Uint16Array(32770),ht=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],Zt=0,Ye=w.decode._ljpeg_diff;for(bt[0]=15,ze=Ie=0;Ie<18;Ie++)for(var _t=32768>>>(ht[Ie]>>>8),Vt=0;Vt<_t;Vt++)bt[++ze]=ht[Ie];for(Ce=Z;Ce--;)for(Fe=0;Fe<H+1;Fe+=2)if(Fe==H&&(Fe=1),Zt+=Ye(D,Et,bt),Fe<H){var Lt=4095&Zt;w.decode._putsF(j,(Fe*Z+Ce)*q,Lt<<16-q)}}},w.decode._decodeNikon=function(I,D,F,U,j,G,Z){var H=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],q=I.t256[0],V=I.t257[0],Q=I.t258[0],X=0,re=0,J=w.decode._make_decoder,se=w.decode._getbithuff,ie=D[0].exifIFD.makerNote,oe=ie.t150?ie.t150:ie.t140,pe=0,de=oe[pe++],ge=oe[pe++];de!=73&&ge!=88||(pe+=2110),de==70&&(X=2),Q==14&&(X+=3);for(var ce=[[0,0],[0,0]],Ie=I.isLE?w._binLE:w._binBE,fe=0;fe<2;fe++)for(var Te=0;Te<2;Te++)ce[fe][Te]=Ie.readShort(oe,pe),pe+=2;var ut,ze,Ce,Fe,Et,bt=1<<Q&32767,ht=0,Zt=Ie.readShort(oe,pe);pe+=2,Zt>1&&(ht=Math.floor(bt/(Zt-1))),de==68&&ge==32&&ht>0&&(re=Ie.readShort(oe,562));var Ye=[0,0],_t=J(H[X]),Vt=[U,0,0,0];for(ut=0;ut<V;ut++)for(re&&ut==re&&(_t=J(H[X+1])),ze=0;ze<q;ze++){fe=se(F,Vt,_t[0],_t),(Et=1+(se(F,Vt,(Ce=15&fe)-(Fe=fe>>>4),0)<<1)<<Fe>>>1)&1<<Ce-1||(Et-=(1<<Ce)-(Fe==0?1:0)),ze<2?Ye[ze]=ce[1&ut][ze]+=Et:Ye[1&ze]+=Et;var Lt=Math.min(Math.max(Ye[1&ze],0),(1<<Q)-1),dt=(ut*q+ze)*Q;w.decode._putsF(G,dt,Lt<<16-Q)}},w.decode._putsF=function(I,D,F){F<<=8-(7&D);var U=D>>>3;I[U]|=F>>>16,I[U+1]|=F>>>8,I[U+2]|=F},w.decode._getbithuff=function(I,D,F,U){var j;w.decode._get_byte;var G=D[0],Z=D[1],H=D[2],q=D[3];if(F==0||H<0)return 0;for(;!q&&H<F&&(j=I[G++])!=-1&&!(q=0);)Z=(Z<<8)+j,H+=8;if(j=Z<<32-H>>>32-F,U?(H-=U[j+1]>>>8,j=255&U[j+1]):H-=F,H<0)throw"e";return D[0]=G,D[1]=Z,D[2]=H,D[3]=q,j},w.decode._make_decoder=function(I){var D,F,U,j,G,Z=[];for(D=16;D!=0&&!I[D];D--);var H=17;for(Z[0]=D,U=F=1;F<=D;F++)for(j=0;j<I[F];j++,++H)for(G=0;G<1<<D-F;G++)U<=1<<D&&(Z[U++]=F<<8|I[H]);return Z},w.decode._decodeNewJPEG=function(I,D,F,U,j,G){U=Math.min(U,D.length-F);var Z=I.t347,H=Z?Z.length:0,q=new Uint8Array(H+U);if(Z){for(var V=0,Q=0;Q<H-1&&(Z[Q]!=255||Z[Q+1]!=217);Q++)q[V++]=Z[Q];var X=D[F],re=D[F+1];for(X==255&&re==216||(q[V++]=X,q[V++]=re),Q=2;Q<U;Q++)q[V++]=D[F+Q]}else for(Q=0;Q<U;Q++)q[Q]=D[F+Q];if(I.t262[0]==32803||I.t259[0]==7&&I.t262[0]==34892){var J=I.t258[0],se=w.LosslessJpegDecode(q),ie=se.length;if(J==16)if(I.isLE)for(Q=0;Q<ie;Q++)j[G+(Q<<1)]=255&se[Q],j[G+(Q<<1)+1]=se[Q]>>>8;else for(Q=0;Q<ie;Q++)j[G+(Q<<1)]=se[Q]>>>8,j[G+(Q<<1)+1]=255&se[Q];else if(J==14||J==12||J==10){var oe=16-J;for(Q=0;Q<ie;Q++)w.decode._putsF(j,Q*J,se[Q]<<oe)}else{if(J!=8)throw new Error("unsupported bit depth "+J);for(Q=0;Q<ie;Q++)j[G+Q]=se[Q]}}else{var pe=new w.JpegDecoder;pe.parse(q);var de=pe.getData({width:pe.width,height:pe.height,forceRGB:!0,isSourcePDF:!1});for(Q=0;Q<de.length;Q++)j[G+Q]=de[Q]}I.t262[0]==6&&(I.t262[0]=2)},w.decode._decodeOldJPEGInit=function(I,D,F,U){var j,G,Z,H,q,V=216,Q=0,X=0,re=!1,J=I.t513,se=J?J[0]:0,ie=I.t514,oe=ie?ie[0]:0,pe=I.t324||I.t273||J,de=I.t530,ge=0,ce=0,Ie=I.t277?I.t277[0]:1,fe=I.t515;if(pe&&(X=pe[0],re=pe.length>1),!re){if(D[F]==255&&D[F+1]==V)return{jpegOffset:F};if(J!=null&&(D[F+se]==255&&D[F+se+1]==V?Q=F+se:g("JPEGInterchangeFormat does not point to SOI"),ie==null?g("JPEGInterchangeFormatLength field is missing"):(se>=X||se+oe<=X)&&g("JPEGInterchangeFormatLength field value is invalid"),Q!=null))return{jpegOffset:Q}}if(de!=null&&(ge=de[0],ce=de[1]),J!=null&&ie!=null)if(oe>=2&&se+oe<=X){for(j=D[F+se+oe-2]==255&&D[F+se+oe-1]==V?new Uint8Array(oe-2):new Uint8Array(oe),Z=0;Z<j.length;Z++)j[Z]=D[F+se+Z];g("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else g("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(j==null){var Te=0,ut=[];ut[Te++]=255,ut[Te++]=V;var ze=I.t519;if(ze==null)throw new Error("JPEGQTables tag is missing");for(Z=0;Z<ze.length;Z++)for(ut[Te++]=255,ut[Te++]=219,ut[Te++]=0,ut[Te++]=67,ut[Te++]=Z,H=0;H<64;H++)ut[Te++]=D[F+ze[Z]+H];for(q=0;q<2;q++){var Ce=I[q==0?"t520":"t521"];if(Ce==null)throw new Error((q==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(Z=0;Z<Ce.length;Z++){ut[Te++]=255,ut[Te++]=196;var Fe=19;for(H=0;H<16;H++)Fe+=D[F+Ce[Z]+H];for(ut[Te++]=Fe>>>8,ut[Te++]=255&Fe,ut[Te++]=Z|q<<4,H=0;H<16;H++)ut[Te++]=D[F+Ce[Z]+H];for(H=0;H<Fe;H++)ut[Te++]=D[F+Ce[Z]+16+H]}}if(ut[Te++]=255,ut[Te++]=192,ut[Te++]=0,ut[Te++]=8+3*Ie,ut[Te++]=8,ut[Te++]=I.height>>>8&255,ut[Te++]=255&I.height,ut[Te++]=I.width>>>8&255,ut[Te++]=255&I.width,ut[Te++]=Ie,Ie==1)ut[Te++]=1,ut[Te++]=17,ut[Te++]=0;else for(Z=0;Z<3;Z++)ut[Te++]=Z+1,ut[Te++]=Z!=0?17:(15&ge)<<4|15&ce,ut[Te++]=Z;fe!=null&&fe[0]!=0&&(ut[Te++]=255,ut[Te++]=221,ut[Te++]=0,ut[Te++]=4,ut[Te++]=fe[0]>>>8&255,ut[Te++]=255&fe[0]),j=new Uint8Array(ut)}var Et=-1;for(Z=0;Z<j.length-1;){if(j[Z]==255&&j[Z+1]==192){Et=Z;break}Z++}if(Et==-1){var bt=new Uint8Array(j.length+10+3*Ie);bt.set(j);var ht=j.length;if(Et=j.length,(j=bt)[ht++]=255,j[ht++]=192,j[ht++]=0,j[ht++]=8+3*Ie,j[ht++]=8,j[ht++]=I.height>>>8&255,j[ht++]=255&I.height,j[ht++]=I.width>>>8&255,j[ht++]=255&I.width,j[ht++]=Ie,Ie==1)j[ht++]=1,j[ht++]=17,j[ht++]=0;else for(Z=0;Z<3;Z++)j[ht++]=Z+1,j[ht++]=Z!=0?17:(15&ge)<<4|15&ce,j[ht++]=Z}if(D[X]==255&&D[X+1]==218){var Zt=D[X+2]<<8|D[X+3];for((G=new Uint8Array(Zt+2))[0]=D[X],G[1]=D[X+1],G[2]=D[X+2],G[3]=D[X+3],Z=0;Z<Zt-2;Z++)G[Z+4]=D[X+Z+4]}else{var Ye=0;if((G=new Uint8Array(8+2*Ie))[Ye++]=255,G[Ye++]=218,G[Ye++]=0,G[Ye++]=6+2*Ie,G[Ye++]=Ie,Ie==1)G[Ye++]=1,G[Ye++]=0;else for(Z=0;Z<3;Z++)G[Ye++]=Z+1,G[Ye++]=Z<<4|Z;G[Ye++]=0,G[Ye++]=63,G[Ye++]=0}return{jpegOffset:F,tables:j,sosMarker:G,sofPosition:Et}},w.decode._decodeOldJPEG=function(I,D,F,U,j,G){var Z,H,q,V,Q=w.decode._decodeOldJPEGInit(I,D,F,U);if(Q.jpegOffset!=null)for(Z=F+U-Q.jpegOffset,q=new Uint8Array(Z),J=0;J<Z;J++)q[J]=D[Q.jpegOffset+J];else{for(H=Q.tables.length,(q=new Uint8Array(H+Q.sosMarker.length+U+2)).set(Q.tables),V=H,q[Q.sofPosition+5]=I.height>>>8&255,q[Q.sofPosition+6]=255&I.height,q[Q.sofPosition+7]=I.width>>>8&255,q[Q.sofPosition+8]=255&I.width,D[F]==255&&D[F+1]==SOS||(q.set(Q.sosMarker,V),V+=sosMarker.length),J=0;J<U;J++)q[V++]=D[F+J];q[V++]=255,q[V++]=EOI}var X=new w.JpegDecoder;X.parse(q);for(var re=X.getData({width:X.width,height:X.height,forceRGB:!0,isSourcePDF:!1}),J=0;J<re.length;J++)j[G+J]=re[J];I.t262&&I.t262[0]==6&&(I.t262[0]=2)},w.decode._decodePackBits=function(I,D,F,U,j){for(var G=new Int8Array(I.buffer),Z=new Int8Array(U.buffer),H=D+F;D<H;){var q=G[D];if(D++,q>=0&&q<128)for(var V=0;V<q+1;V++)Z[j]=G[D],j++,D++;if(q>=-127&&q<0){for(V=0;V<1-q;V++)Z[j]=G[D],j++;D++}}return j},w.decode._decodeThunder=function(I,D,F,U,j){for(var G=[0,1,0,-1],Z=[0,1,2,3,0,-3,-2,-1],H=D+F,q=2*j,V=0;D<H;){var Q=I[D],X=Q>>>6,re=63&Q;if(D++,X==3&&(V=15&re,U[q>>>1]|=V<<4*(1-q&1),q++),X==0)for(var J=0;J<re;J++)U[q>>>1]|=V<<4*(1-q&1),q++;if(X==2)for(J=0;J<2;J++)(se=re>>>3*(1-J)&7)!=4&&(V+=Z[se],U[q>>>1]|=V<<4*(1-q&1),q++);if(X==1)for(J=0;J<3;J++){var se;(se=re>>>2*(2-J)&3)!=2&&(V+=G[se],U[q>>>1]|=V<<4*(1-q&1),q++)}}},w.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},w.decode._lens=(function(){var I=function(q,V,Q,X){for(var re=0;re<V.length;re++)q[V[re]]=Q+re*X},D="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",F="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",U="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",j="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",G="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";D=D.split(","),F=F.split(","),U=U.split(","),j=j.split(","),G=G.split(",");var Z={},H={};return I(Z,D,0,1),I(Z,U,64,64),I(Z,G,1792,64),I(H,F,0,1),I(H,j,64,64),I(H,G,1792,64),[Z,H]})(),w.decode._decodeG4=function(I,D,F,U,j,G,Z){for(var H=w.decode,q=D<<3,V=0,Q="",X=[],re=[],J=0;J<G;J++)re.push(0);re=H._makeDiff(re);for(var se=0,ie=0,oe=0,pe=0,de=0,ge=0,ce="",Ie=0,fe=8*Math.ceil(G/8);q>>>3<D+F;){oe=H._findDiff(re,se+(se==0?0:1),1-de),pe=H._findDiff(re,oe,de);var Te=0;if(Z==1&&(Te=I[q>>>3]>>>7-(7&q)&1),Z==2&&(Te=I[q>>>3]>>>(7&q)&1),q++,Q+=Te,ce=="H"){if(H._lens[de][Q]!=null){var ut=H._lens[de][Q];Q="",V+=ut,ut<64&&(H._addNtimes(X,V,de),se+=V,de=1-de,V=0,--Ie==0&&(ce=""))}}else Q=="0001"&&(Q="",H._addNtimes(X,pe-se,de),se=pe),Q=="001"&&(Q="",ce="H",Ie=2),H._dmap[Q]!=null&&(ie=oe+H._dmap[Q],H._addNtimes(X,ie-se,de),se=ie,Q="",de=1-de);X.length==G&&ce==""&&(H._writeBits(X,U,8*j+ge*fe),de=0,ge++,se=0,re=H._makeDiff(X),X=[])}},w.decode._findDiff=function(I,D,F){for(var U=0;U<I.length;U+=2)if(I[U]>=D&&I[U+1]==F)return I[U]},w.decode._makeDiff=function(I){var D=[];I[0]==1&&D.push(0,1);for(var F=1;F<I.length;F++)I[F-1]!=I[F]&&D.push(F,I[F]);return D.push(I.length,0,I.length,1),D},w.decode._decodeG2=function(I,D,F,U,j,G,Z){for(var H=w.decode,q=D<<3,V=0,Q="",X=[],re=0,J=0,se=8*Math.ceil(G/8);q>>>3<D+F;){var ie=0;Z==1&&(ie=I[q>>>3]>>>7-(7&q)&1),Z==2&&(ie=I[q>>>3]>>>(7&q)&1),q++,Q+=ie,(V=H._lens[re][Q])!=null&&(H._addNtimes(X,V,re),Q="",V<64&&(re=1-re),X.length==G&&(H._writeBits(X,U,8*j+J*se),X=[],J++,re=0,7&q&&(q+=8-(7&q)),V>=64&&(q+=8)))}},w.decode._decodeG3=function(I,D,F,U,j,G,Z,H){for(var q=w.decode,V=D<<3,Q=0,X="",re=[],J=[],se=0;se<G;se++)re.push(0);for(var ie=0,oe=0,pe=0,de=0,ge=0,ce=-1,Ie="",fe=0,Te=!0,ut=8*Math.ceil(G/8);V>>>3<D+F;){pe=q._findDiff(J,ie+(ie==0?0:1),1-ge),de=q._findDiff(J,pe,ge);var ze=0;if(Z==1&&(ze=I[V>>>3]>>>7-(7&V)&1),Z==2&&(ze=I[V>>>3]>>>(7&V)&1),V++,X+=ze,Te){if(q._lens[ge][X]!=null){var Ce=q._lens[ge][X];X="",Q+=Ce,Ce<64&&(q._addNtimes(re,Q,ge),ge=1-ge,Q=0)}}else Ie=="H"?q._lens[ge][X]!=null&&(Ce=q._lens[ge][X],X="",Q+=Ce,Ce<64&&(q._addNtimes(re,Q,ge),ie+=Q,ge=1-ge,Q=0,--fe==0&&(Ie=""))):(X=="0001"&&(X="",q._addNtimes(re,de-ie,ge),ie=de),X=="001"&&(X="",Ie="H",fe=2),q._dmap[X]!=null&&(oe=pe+q._dmap[X],q._addNtimes(re,oe-ie,ge),ie=oe,X="",ge=1-ge));X.endsWith("000000000001")&&(ce>=0&&q._writeBits(re,U,8*j+ce*ut),H&&(Z==1&&(Te=(I[V>>>3]>>>7-(7&V)&1)==1),Z==2&&(Te=(I[V>>>3]>>>(7&V)&1)==1),V++),X="",ge=0,ce++,ie=0,J=q._makeDiff(re),re=[])}re.length==G&&q._writeBits(re,U,8*j+ce*ut)},w.decode._addNtimes=function(I,D,F){for(var U=0;U<D;U++)I.push(F)},w.decode._writeBits=function(I,D,F){for(var U=0;U<I.length;U++)D[F+U>>>3]|=I[U]<<7-(F+U&7)},w.decode._decodeLZW=w.decode._decodeLZW=(function(){var I,D,F,U,j=0,G=0,Z=0,H=0,q=function(){var se=I>>>3,ie=(D[se]<<16|D[se+1]<<8|D[se+2])>>>24-(7&I)-G&(1<<G)-1;return I+=G,ie},V=new Uint32Array(16384),Q=0,X=function(se){G=se+1,j=H+1},re=function(se){for(var ie=se<<2,oe=V[ie+2],pe=U+oe-1;ie!=65535;)F[pe--]=V[ie],ie=V[ie+1];U+=oe},J=function(se,ie){var oe=j<<2,pe=se<<2;V[oe]=V[3+(ie<<2)],V[oe+1]=pe,V[oe+2]=V[pe+2]+1,V[oe+3]=V[pe+3],++j+1==1<<G&&G!=12&&G++};return function(se,ie,oe,pe,de,ge){I=ie<<3,D=se,F=pe,U=de;var ce=ie+oe<<3,Ie=0,fe=0;for((function(Te){if(Te!=Q){Q=Te,H=1+(Z=1<<Te);for(var ut=0;ut<H+1;ut++)V[4*ut]=V[4*ut+3]=ut,V[4*ut+1]=65535,V[4*ut+2]=1}})(ge),X(ge);I<ce&&(Ie=q())!=H;){if(Ie==Z){if(X(ge),(Ie=q())==H)break;re(Ie)}else Ie<j?(re(Ie),J(fe,Ie)):(J(fe,fe),re(j-1));fe=Ie}return U}})(),w.tags={},w._types=(function(){var I=new Array(250);return I.fill(0),{basic:{main:I=I.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}})(),w._readIFD=function(I,D,F,U,j,G){var Z=I.readUshort(D,F);F+=2;var H={};G.debug&&g("   ".repeat(j),U.length-1,">>>----------------");for(var q=0;q<Z;q++){var V=I.readUshort(D,F);F+=2;var Q=I.readUshort(D,F);F+=2;var X=I.readUint(D,F);F+=4;var re=I.readUint(D,F);F+=4;var J=[];if(Q==1||Q==7){var se=X<5?F-4:re;se+X>D.buffer.byteLength&&(X=D.buffer.byteLength-se),J=new Uint8Array(D.buffer,se,X)}if(Q==2){var ie=X<5?F-4:re,oe=D[ie],pe=Math.max(0,Math.min(X-1,D.length-ie));oe<128||pe==0?J.push(I.readASCII(D,ie,pe)):J=new Uint8Array(D.buffer,ie,pe)}if(Q==3)for(var de=0;de<X;de++)J.push(I.readUshort(D,(X<3?F-4:re)+2*de));if(Q==4||Q==13)for(de=0;de<X;de++)J.push(I.readUint(D,(X<2?F-4:re)+4*de));if(Q==5||Q==10){var ge=Q==5?I.readUint:I.readInt;for(de=0;de<X;de++)J.push([ge(D,re+8*de),ge(D,re+8*de+4)])}if(Q==8)for(de=0;de<X;de++)J.push(I.readShort(D,(X<3?F-4:re)+2*de));if(Q==9)for(de=0;de<X;de++)J.push(I.readInt(D,(X<2?F-4:re)+4*de));if(Q==11)for(de=0;de<X;de++)J.push(I.readFloat(D,re+4*de));if(Q==12)for(de=0;de<X;de++)J.push(I.readDouble(D,re+8*de));if(X==0||J.length!=0){if(G.debug&&g("   ".repeat(j),V,Q,w.tags[V],J),H["t"+V]=J,!(V==330&&H.t272&&H.t272[0]=="DSLR-A100")){if(V==330||V==34665||V==34853||V==50740&&I.readUshort(D,I.readUint(J,0))<300||V==61440){var ce=V==50740?[I.readUint(J,0)]:J,Ie=[];for(de=0;de<ce.length;de++)w._readIFD(I,D,ce[de],Ie,j+1,G);V==330&&(H.subIFD=Ie),V==34665&&(H.exifIFD=Ie[0]),V==34853&&(H.gpsiIFD=Ie[0]),V==50740&&(H.dngPrvt=Ie[0]),V==61440&&(H.fujiIFD=Ie[0])}}if(V==37500&&G.parseMN){var fe=J;if(I.readASCII(fe,0,5)=="Nikon")H.makerNote=w.decode(fe.slice(10).buffer)[0];else if(I.readASCII(fe,0,5)=="OLYMP"||I.readASCII(fe,0,9)=="OM SYSTEM"){var Te=[8208,8224,8240,8256,8272],ut=[];w._readIFD(I,fe,fe[1]==77?16:fe[5]==85?12:8,ut,j+1,G);var ze=H.makerNote=ut.pop();for(de=0;de<Te.length;de++){var Ce="t"+Te[de];ze[Ce]!=null&&(w._readIFD(I,fe,ze[Ce][0],ut,j+1,G),ze[Ce]=ut.pop())}ze.t12288&&(w._readIFD(I,ze.t12288,0,ut,j+1,G),ze.t12288=ut.pop())}else I.readUshort(D,re)<300&&I.readUshort(D,re+4)<=12&&(ut=[],w._readIFD(I,D,re,ut,j+1,G),H.makerNote=ut[0])}}else if(g(V,"unknown TIFF tag type: ",Q,"num:",X),q==0)return}return U.push(H),G.debug&&g("   ".repeat(j),"<<<---------------"),F},w._writeIFD=function(I,D,F,U,j){var G=Object.keys(j),Z=G.length;j.exifIFD&&Z--,j.gpsiIFD&&Z--,I.writeUshort(F,U,Z);for(var H=(U+=2)+12*Z+4,q=0;q<G.length;q++){var V=G[q];if(V!="t34665"&&V!="t34853"){V=="exifIFD"&&(V="t34665"),V=="gpsiIFD"&&(V="t34853");var Q=parseInt(V.slice(1)),X=D.main[Q];if(X==null&&(X=D.rest[Q]),X==null||X==0)throw new Error("unknown type of tag: "+Q);var re=j[V];Q==34665&&(re=[H],H=w._writeIFD(I,D,F,H,j.exifIFD)[1]),Q==34853&&(re=[H],H=w._writeIFD(I,w._types.gps,F,H,j.gpsiIFD)[1]),X==2&&(re=re[0]+"\0");var J=re.length;I.writeUshort(F,U,Q),U+=2,I.writeUshort(F,U,X),U+=2,I.writeUint(F,U,J);var se=[-1,1,1,2,4,8,0,1,0,4,8,0,8][X]*J,ie=U+=4;if(se>4&&(I.writeUint(F,U,H),ie=H),X==1||X==7)for(var oe=0;oe<J;oe++)F[ie+oe]=re[oe];else if(X==2)I.writeASCII(F,ie,re);else if(X==3)for(oe=0;oe<J;oe++)I.writeUshort(F,ie+2*oe,re[oe]);else if(X==4)for(oe=0;oe<J;oe++)I.writeUint(F,ie+4*oe,re[oe]);else if(X==5||X==10){var pe=X==5?I.writeUint:I.writeInt;for(oe=0;oe<J;oe++){var de=re[oe],ge=de[0],ce=de[1];if(ge==null)throw"e";pe(F,ie+8*oe,ge),pe(F,ie+8*oe+4,ce)}}else if(X==9)for(oe=0;oe<J;oe++)I.writeInt(F,ie+4*oe,re[oe]);else{if(X!=12)throw X;for(oe=0;oe<J;oe++)I.writeDouble(F,ie+8*oe,re[oe])}se>4&&(H+=se+=1&se),U+=4}}return[U,H]},w.toRGBA8=function(I,D){function F(oi){return oi<.0031308?12.92*oi:1.055*Math.pow(oi,1/2.4)-.055}var U=I.width,j=I.height,G=U*j,Z=I.data,H=new Uint8Array(4*G),q=I.t262?I.t262[0]:2,V=I.t258?Math.min(32,I.t258[0]):1;I.t262==null&&V==1&&(q=0);var Q=I.t277?I.t277[0]:I.t258?I.t258.length:[1,1,3,1,1,4,3][q],X=I.t339?I.t339[0]:null;if(q==1&&V==32&&X!=3)throw"e";var re=Math.ceil(Q*V*U/8);if(q==0){D=1/256;for(var J=0;J<j;J++){var se=J*re,ie=J*U;if(V==1)for(var oe=0;oe<U;oe++){var pe=ie+oe<<2,de=Z[se+(oe>>3)]>>7-(7&oe)&1;H[pe]=H[pe+1]=H[pe+2]=255*(1-de),H[pe+3]=255}if(V==4)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[se+(oe>>1)]>>4-4*(1&oe)&15,H[pe]=H[pe+1]=H[pe+2]=17*(15-de),H[pe+3]=255;if(V==8)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[se+oe],H[pe]=H[pe+1]=H[pe+2]=255-de,H[pe+3]=255;if(V==16)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[(ce=se+2*oe)+1]<<8|Z[ce],H[pe]=H[pe+1]=H[pe+2]=Math.min(255,255-~~(de*D)),H[pe+3]=255}}else if(q==1){D==null&&(D=1/256);var ge=3&Z.length?null:new Float32Array(Z.buffer);for(J=0;J<j;J++){if(se=J*re,ie=J*U,V==1)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[se+(oe>>3)]>>7-(7&oe)&1,H[pe]=H[pe+1]=H[pe+2]=255*de,H[pe+3]=255;if(V==2)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[se+(oe>>2)]>>6-2*(3&oe)&3,H[pe]=H[pe+1]=H[pe+2]=85*de,H[pe+3]=255;if(V==8)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[se+oe*Q],H[pe]=H[pe+1]=H[pe+2]=de,H[pe+3]=255;if(V==16)for(oe=0;oe<U;oe++)pe=ie+oe<<2,de=Z[(ce=se+2*oe)+1]<<8|Z[ce],H[pe]=H[pe+1]=H[pe+2]=Math.min(255,~~(de*D)),H[pe+3]=255;if(V==32)for(oe=0;oe<U;oe++){var ce;pe=ie+oe<<2,de=ge[ce=(se>>>2)+oe],H[pe]=H[pe+1]=H[pe+2]=~~(.5+255*de),H[pe+3]=255}}}else if(q==2)if(V==8){if(Q==1)for(oe=0;oe<G;oe++)H[4*oe]=H[4*oe+1]=H[4*oe+2]=Z[oe],H[4*oe+3]=255;if(Q==3)for(oe=0;oe<G;oe++){var Ie=3*oe;H[pe=oe<<2]=Z[Ie],H[pe+1]=Z[Ie+1],H[pe+2]=Z[Ie+2],H[pe+3]=255}if(Q>=4)for(oe=0;oe<G;oe++)Ie=oe*Q,H[pe=oe<<2]=Z[Ie],H[pe+1]=Z[Ie+1],H[pe+2]=Z[Ie+2],H[pe+3]=Z[Ie+3]}else if(V==16){if(Q==4)for(oe=0;oe<G;oe++)Ie=8*oe+1,H[pe=oe<<2]=Z[Ie],H[pe+1]=Z[Ie+2],H[pe+2]=Z[Ie+4],H[pe+3]=Z[Ie+6];if(Q==3)for(oe=0;oe<G;oe++)Ie=6*oe+1,H[pe=oe<<2]=Z[Ie],H[pe+1]=Z[Ie+2],H[pe+2]=Z[Ie+4],H[pe+3]=255}else{if(V!=32)throw V;var fe=new Float32Array(Z.buffer),Te=0;for(oe=0;oe<fe.length;oe++)Te=Math.min(Te,fe[oe]);if(Te<0)for(oe=0;oe<Z.length;oe+=4){var ut=Z[oe];Z[oe]=Z[oe+3],Z[oe+3]=ut,ut=Z[oe+1],Z[oe+1]=Z[oe+2],Z[oe+2]=ut}var ze=[];for(oe=0;oe<65536;oe++)ze.push(F(oe/65535));for(oe=0;oe<fe.length;oe++){var Ce=Math.max(0,Math.min(1,fe[oe]));fe[oe]=ze[~~(.5+65535*Ce)]}if(Q==3)for(oe=0;oe<G;oe++)Ie=3*oe,H[pe=oe<<2]=~~(.5+255*fe[Ie]),H[pe+1]=~~(.5+255*fe[Ie+1]),H[pe+2]=~~(.5+255*fe[Ie+2]),H[pe+3]=255;else{if(Q!=4)throw Q;for(oe=0;oe<G;oe++)Ie=4*oe,H[pe=oe<<2]=~~(.5+255*fe[Ie]),H[pe+1]=~~(.5+255*fe[Ie+1]),H[pe+2]=~~(.5+255*fe[Ie+2]),H[pe+3]=~~(.5+255*fe[Ie+3])}}else if(q==3){var Fe=I.t320,Et=1<<V,bt=V==8&&Q>1&&I.t338&&I.t338[0]!=0;for(J=0;J<j;J++)for(var ht=0;ht<U;ht++){pe=(oe=J*U+ht)<<2;var Zt=0,Ye=J*re;if(V==1)Zt=Z[Ye+(ht>>>3)]>>>7-(7&ht)&1;else if(V==2)Zt=Z[Ye+(ht>>>2)]>>>6-2*(3&ht)&3;else if(V==4)Zt=Z[Ye+(ht>>>1)]>>>4-4*(1&ht)&15;else{if(V!=8)throw V;Zt=Z[Ye+ht*Q]}H[pe]=Fe[Zt]>>8,H[pe+1]=Fe[Et+Zt]>>8,H[pe+2]=Fe[Et+Et+Zt]>>8,H[pe+3]=bt?Z[Ye+ht*Q+1]:255}}else if(q==5){var _t=Q>4?1:0;for(oe=0;oe<G;oe++){pe=oe<<2;var Vt=oe*Q;if(window.UDOC){var Lt=Z[Vt],dt=Z[Vt+1],It=Z[Vt+2],dr=Z[Vt+3],fr=UDOC.C.cmykToRgb([Lt*(1/255),dt*(1/255),It*(1/255),dr*(1/255)]);H[pe]=~~(.5+255*fr[0]),H[pe+1]=~~(.5+255*fr[1]),H[pe+2]=~~(.5+255*fr[2])}else Lt=255-Z[Vt],dt=255-Z[Vt+1],It=255-Z[Vt+2],dr=(255-Z[Vt+3])*(1/255),H[pe]=~~(Lt*dr+.5),H[pe+1]=~~(dt*dr+.5),H[pe+2]=~~(It*dr+.5);H[pe+3]=255*(1-_t)+Z[Vt+4]*_t}}else if(q==6&&I.t278){var pr=I.t278[0];for(J=0;J<j;J+=pr){oe=J*U;for(var Nt=pr*U,$e=0;$e<Nt;$e++){pe=4*(oe+$e),It=Z[(Vt=3*oe+4*($e>>>1))+(1&$e)];var At=Z[Vt+2]-128,Ge=Z[Vt+3]-128,st=It+((Ge>>2)+(Ge>>3)+(Ge>>5)),Xe=It-((At>>2)+(At>>4)+(At>>5))-((Ge>>1)+(Ge>>3)+(Ge>>4)+(Ge>>5)),gt=It+(At+(At>>1)+(At>>2)+(At>>6));H[pe]=Math.max(0,Math.min(255,st)),H[pe+1]=Math.max(0,Math.min(255,Xe)),H[pe+2]=Math.max(0,Math.min(255,gt)),H[pe+3]=255}}}else if(q==32845)for(J=0;J<j;J++)for(ht=0;ht<U;ht++){pe=4*(J*U+ht);var Qt=Z[(Vt=6*(J*U+ht))+1]<<8|Z[Vt],me=(Qt=Math.pow(2,(Qt+.5)/256-64),(Z[Vt+3]+.5)/410),Be=(Z[Vt+5]+.5)/410,lt=9*me/(6*me-16*Be+12),ft=4*Be/(6*me-16*Be+12),mr=lt*Qt/ft,gr=(1-lt-ft)*Qt/ft;st=2.69*mr-1.276*(It=Qt)-.414*gr,Xe=-1.022*mr+1.978*It+.044*gr,gt=.061*mr-.224*It+1.163*gr,H[pe]=255*F(Math.min(st,1)),H[pe+1]=255*F(Math.min(Xe,1)),H[pe+2]=255*F(Math.min(gt,1)),H[pe+3]=255}else g("Unknown Photometric interpretation: "+q);return H},w.replaceIMG=function(I){I==null&&(I=document.getElementsByTagName("img"));for(var D=["tif","tiff","dng","cr2","nef"],F=0;F<I.length;F++){var U=I[F],j=U.getAttribute("src");if(j!=null){var G=j.split(".").pop().toLowerCase();if(D.indexOf(G)!=-1){var Z=new XMLHttpRequest;w._xhrs.push(Z),w._imgs.push(U),Z.open("GET",j),Z.responseType="arraybuffer",Z.onload=w._imgLoaded,Z.send()}}}},w._xhrs=[],w._imgs=[],w._imgLoaded=function(I){var D=w._xhrs.indexOf(I.target),F=w._imgs[D];w._xhrs.splice(D,1),w._imgs.splice(D,1),F.setAttribute("src",w.bufferToURI(I.target.response))},w.bufferToURI=function(I){var D=w.decode(I),F=D,U=0,j=F[0];D[0].subIFD&&(F=F.concat(D[0].subIFD));for(var G=0;G<F.length;G++){var Z=F[G];if(!(Z.t258==null||Z.t258.length<3)){var H=Z.t256*Z.t257;H>U&&(U=H,j=Z)}}w.decodeImage(I,j,D);var q=w.toRGBA8(j),V=j.width,Q=j.height,X=document.createElement("canvas");X.width=V,X.height=Q;var re=X.getContext("2d"),J=new ImageData(new Uint8ClampedArray(q.buffer),V,Q);return re.putImageData(J,0,0),X.toDataURL()},w._binBE={nextZero:function(I,D){for(;I[D]!=0;)D++;return D},readUshort:function(I,D){return I[D]<<8|I[D+1]},readShort:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+1],F[1]=I[D+0],w._binBE.i16[0]},readInt:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+3],F[1]=I[D+2],F[2]=I[D+1],F[3]=I[D+0],w._binBE.i32[0]},readUint:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+3],F[1]=I[D+2],F[2]=I[D+1],F[3]=I[D+0],w._binBE.ui32[0]},readASCII:function(I,D,F){for(var U="",j=0;j<F;j++)U+=String.fromCharCode(I[D+j]);return U},readFloat:function(I,D){for(var F=w._binBE.ui8,U=0;U<4;U++)F[U]=I[D+3-U];return w._binBE.fl32[0]},readDouble:function(I,D){for(var F=w._binBE.ui8,U=0;U<8;U++)F[U]=I[D+7-U];return w._binBE.fl64[0]},writeUshort:function(I,D,F){I[D]=F>>8&255,I[D+1]=255&F},writeInt:function(I,D,F){var U=w._binBE.ui8;w._binBE.i32[0]=F,I[D+3]=U[0],I[D+2]=U[1],I[D+1]=U[2],I[D+0]=U[3]},writeUint:function(I,D,F){I[D]=F>>24&255,I[D+1]=F>>16&255,I[D+2]=F>>8&255,I[D+3]=255&F},writeASCII:function(I,D,F){for(var U=0;U<F.length;U++)I[D+U]=F.charCodeAt(U)},writeDouble:function(I,D,F){w._binBE.fl64[0]=F;for(var U=0;U<8;U++)I[D+U]=w._binBE.ui8[7-U]}},w._binBE.ui8=new Uint8Array(8),w._binBE.i16=new Int16Array(w._binBE.ui8.buffer),w._binBE.i32=new Int32Array(w._binBE.ui8.buffer),w._binBE.ui32=new Uint32Array(w._binBE.ui8.buffer),w._binBE.fl32=new Float32Array(w._binBE.ui8.buffer),w._binBE.fl64=new Float64Array(w._binBE.ui8.buffer),w._binLE={nextZero:w._binBE.nextZero,readUshort:function(I,D){return I[D+1]<<8|I[D]},readShort:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+0],F[1]=I[D+1],w._binBE.i16[0]},readInt:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+0],F[1]=I[D+1],F[2]=I[D+2],F[3]=I[D+3],w._binBE.i32[0]},readUint:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+0],F[1]=I[D+1],F[2]=I[D+2],F[3]=I[D+3],w._binBE.ui32[0]},readASCII:w._binBE.readASCII,readFloat:function(I,D){for(var F=w._binBE.ui8,U=0;U<4;U++)F[U]=I[D+U];return w._binBE.fl32[0]},readDouble:function(I,D){for(var F=w._binBE.ui8,U=0;U<8;U++)F[U]=I[D+U];return w._binBE.fl64[0]},writeUshort:function(I,D,F){I[D]=255&F,I[D+1]=F>>8&255},writeInt:function(I,D,F){var U=w._binBE.ui8;w._binBE.i32[0]=F,I[D+0]=U[0],I[D+1]=U[1],I[D+2]=U[2],I[D+3]=U[3]},writeUint:function(I,D,F){I[D]=F>>>0&255,I[D+1]=F>>>8&255,I[D+2]=F>>>16&255,I[D+3]=F>>>24&255},writeASCII:w._binBE.writeASCII},w._copyTile=function(I,D,F,U,j,G,Z,H){for(var q=Math.min(D,j-Z),V=Math.min(F,G-H),Q=0;Q<V;Q++)for(var X=(H+Q)*j+Z,re=Q*D,J=0;J<q;J++)U[X+J]=I[re+J]},w.LosslessJpegDecode=(function(){var I,D;function F(){return I[D++]}function U(){return I[D++]<<8|I[D++]}function j(se){for(var ie=F(),oe=[0,0,0,255],pe=[],de=0;de<16;de++)pe[de]=F();for(de=0;de<16;de++)for(var ge=0;ge<pe[de];ge++)oe[G(oe,0,de+1,1)+3]=F();var ce=new Uint8Array(256);for(se[ie]=[new Uint8Array(oe),ce],de=0;de<256;de++){for(var Ie=8,fe=de,Te=0;oe[Te+3]==255&&Ie!=0;)Te=oe[Te+(fe>>--Ie&1)];ce[de]=Te}}function G(se,ie,oe,pe){if(se[ie+3]!=255)return 0;if(oe==0)return ie;for(var de=0;de<2;de++){se[ie+de]==0&&(se[ie+de]=se.length,se.push(0,0,pe,255));var ge=G(se,se[ie+de],oe-1,pe+1);if(ge!=0)return ge}return 0}function Z(se){for(var ie=se.b,oe=se.f;ie<25&&se.a<se.d;){var pe=se.data[se.a++];pe!=255||se.c||se.a++,oe=oe<<8|pe,ie+=8}if(ie<0)throw"e";se.b=ie,se.f=oe}function H(se,ie){return ie.b<se&&Z(ie),ie.f>>(ie.b-=se)&65535>>16-se}function q(se,ie){var oe=se[0],pe=0,de=255;ie.b<16&&Z(ie);var ge=ie.f>>ie.b-8&255;for(de=oe[(pe=se[1][ge])+3],ie.b-=oe[pe+2];de==255;)de=oe[(pe=oe[pe+(ie.f>>--ie.b&1)])+3];return de}function V(se,ie){return se<32768>>16-ie&&(se+=1-(1<<ie)),se}function Q(se,ie){var oe=q(se,ie);return oe==0?0:oe==16?-32768:V(H(oe,ie),oe)}function X(se,ie,oe,pe,de,ge){for(var ce=0,Ie=0;Ie<ge;Ie++){for(var fe=Ie*ie,Te=0;Te<ie;Te+=de){ce++;for(var ut=0;ut<de;ut++)se[fe+Te+ut]=Q(pe[ut],oe)}if(oe.e!=0&&ce%oe.e==0&&Ie!=0){for(var ze=oe.a,Ce=oe.data;Ce[ze]!=255||!(208<=Ce[ze+1]&&Ce[ze+1]<=215);)ze--;oe.a=ze+2,oe.f=0,oe.b=0}}}function re(se,ie){return V(H(se,ie),se)}function J(se,ie,oe,pe,de,ge,ce,Ie){for(var fe=oe*ce,Te=de;Te<ge;Te++)se[Te]+=1<<Ie-1;for(var ut=ce;ut<fe;ut+=ce)for(Te=de;Te<ge;Te++)se[ut+Te]+=se[ut+Te-ce];for(var ze=1;ze<pe;ze++){var Ce=ze*fe;for(Te=de;Te<ge;Te++)se[Ce+Te]+=se[Ce+Te-fe];for(ut=ce;ut<fe;ut+=ce)for(Te=de;Te<ge;Te++){var Fe=Ce+ut+Te,Et=Fe-fe,bt=se[Fe-ce],ht=0;if(ie==0)ht=0;else if(ie==1)ht=bt;else if(ie==2)ht=se[Et];else if(ie==3)ht=se[Et-ce];else if(ie==4)ht=bt+(se[Et]-se[Et-ce]);else if(ie==5)ht=bt+(se[Et]-se[Et-ce]>>>1);else if(ie==6)ht=se[Et]+(bt-se[Et-ce]>>>1);else{if(ie!=7)throw ie;ht=bt+se[Et]>>>1}se[Fe]+=ht}}}return function(se){if(I=se,D=0,U()!=65496)throw"e";for(var ie=[],oe=0,pe=0,de=0,ge=[],ce=[],Ie=[],fe=0,Te=0,ut=0;;){var ze=U();if(ze!=65535){var Ce=U();if(ze==65475){pe=F(),Te=U(),ut=U(),fe=F();for(var Fe=0;Fe<fe;Fe++){var Et=F(),bt=F();if(F()!=0)throw"e";ie[Et]=[Fe,bt>>4,15&bt]}}else if(ze==65476)for(var ht=D+Ce-2;D<ht;)j(ce);else{if(ze==65498){for(D++,Fe=0;Fe<fe;Fe++){var Zt=ie[F()];Ie[Zt[0]]=ce[F()>>>4],ge[Zt[0]]=Zt.slice(1)}oe=F(),D+=2;break}ze==65501?de=U():D+=Ce-2}}else D--}var Ye=new(pe>8?Uint16Array:Uint8Array)(Te*ut*fe),_t={b:0,f:0,c:oe==8,a:D,data:I,d:I.length,e:de};if(_t.c)(function(mr,gr,oi,hi,ai){for(var fi=I.length-D,ui=0;ui<fi;ui+=4){var wi=I[D+ui];I[D+ui]=I[D+ui+3],I[D+ui+3]=wi,wi=I[D+ui+1],I[D+ui+1]=I[D+ui+2],I[D+ui+2]=wi}for(var _i=0;_i<ai;_i++)for(var bi=32768,Ei=32768,gi=0;gi<gr;gi+=2){var Yt=q(hi,oi),di=q(hi,oi);Yt!=0&&(bi+=re(Yt,oi)),di!=0&&(Ei+=re(di,oi)),mr[_i*gr+gi]=65535&bi,mr[_i*gr+gi+1]=65535&Ei}})(Ye,ut*fe,_t,Ie[0],Te);else{var Vt=[],Lt=0,dt=0;for(Fe=0;Fe<fe;Fe++){var It=ge[Fe];(gt=It[0])>Lt&&(Lt=gt),(Xe=It[1])>dt&&(dt=Xe),Vt.push(gt*Xe)}if(Lt!=1||dt!=1){if(fe!=3||Vt[1]!=1||Vt[2]!=1||Lt!=2||dt!=1&&dt!=2)throw"e";var dr=[],fr=0;for(Fe=0;Fe<fe;Fe++){for(var pr=0;pr<Vt[Fe];pr++)dr.push(Ie[Fe]);fr+=Vt[Fe]}var Nt=ut/Lt,$e=Te/dt,At=Nt*$e;X(Ye,Nt*fr,_t,dr,fr,$e),J(Ye,oe,Nt,$e,fr-2,fr,fr,pe);var Ge=new Uint16Array(At*Vt[0]);if(Lt==2&&dt==2){for(Fe=0;Fe<At;Fe++)Ge[4*Fe]=Ye[6*Fe],Ge[4*Fe+1]=Ye[6*Fe+1],Ge[4*Fe+2]=Ye[6*Fe+2],Ge[4*Fe+3]=Ye[6*Fe+3];for(J(Ge,oe,4*Nt,$e,0,1,1,pe),Fe=0;Fe<At;Fe++)Ye[6*Fe]=Ge[4*Fe],Ye[6*Fe+1]=Ge[4*Fe+1],Ye[6*Fe+2]=Ge[4*Fe+2],Ye[6*Fe+3]=Ge[4*Fe+3]}if(Lt==2&&dt==1){for(Fe=0;Fe<At;Fe++)Ge[2*Fe]=Ye[4*Fe],Ge[2*Fe+1]=Ye[4*Fe+1];for(J(Ge,oe,2*Nt,$e,0,1,1,pe),Fe=0;Fe<At;Fe++)Ye[4*Fe]=Ge[2*Fe],Ye[4*Fe+1]=Ge[2*Fe+1]}for(var st=Ye.slice(0),Xe=0;Xe<Te;Xe++)if(dt==2)for(var gt=0;gt<ut;gt++){var Qt=((Xe>>>1)*Nt+(gt>>>1))*fr,me=2*(1&Xe)+(1&gt);Ye[Be=(Xe*ut+gt)*fe]=st[Qt+me],Ye[Be+1]=st[Qt+4],Ye[Be+2]=st[Qt+5]}else for(gt=0;gt<ut;gt++){var Be;Qt=(Xe*Nt+(gt>>>1))*fr,me=1&gt,Ye[Be=(Xe*ut+gt)*fe]=st[Qt+me],Ye[Be+1]=st[Qt+2],Ye[Be+2]=st[Qt+3]}}else if(X(Ye,ut*fe,_t,Ie,fe,Te),de==0)J(Ye,oe,ut,Te,0,fe,fe,pe);else{var lt=Math.floor(de/ut);for(Xe=0;Xe<Te;Xe+=lt){var ft=Ye.slice(Xe*ut*fe,(Xe+lt)*ut*fe);J(ft,oe,ut,lt,0,fe,fe,pe),Ye.set(ft,Xe*ut*fe)}}}return Ye}})(),(function(){var I=2,D=4,F=5,U=6,j=7,G=12,Z=13,H=14,q=15,V=17;function Q(ge){var ce={c:new Int8Array(2<<ge.u)};return(function(Ie,fe,Te){var ut=[fe,3*fe+18,5*fe+67,7*fe+276,Te];Ie.o=fe,Ie.w=(ut[4]+2*fe)/(2*fe+1)+1|0,Ie.v=Math.ceil(Math.log2(Ie.w)),Ie.t=9,(function(ze,Ce){for(var Fe=-Ce[4],Et=0;Fe<=Ce[4];Et++,Fe++)ze[Et]=Fe<=-276?-4:Fe<=-67?-3:Fe<=-18?-2:Fe<-0?-1:Fe<=Ce[0]?0:Fe<Ce[1]?1:Fe<Ce[2]?2:Fe<Ce[3]?3:4})(Ie.c,ut)})(ce,0,ge.g),ce}function X(ge){for(var ce=[[],[],[]],Ie=Math.max(2,ge.w+32>>>6),fe=0;fe<3;fe++)for(var Te=0;Te<41;Te++)ce[fe][Te]=[Ie,1];return ce}function re(ge,ce){var Ie=0,fe=8-ge.a;if(ge.j,ge.a,ce){if(ce>=fe)do Ie<<=fe,ce-=fe,Ie|=ge[ge.j]&(1<<fe)-1,ge.j++,fe=8;while(ce>=8);ce&&(Ie<<=ce,fe-=ce,Ie|=ge[ge.j]>>>fe&(1<<ce)-1),ge.a=8-fe}return Ie}function J(ge,ce,Ie,fe,Te,ut,ze,Ce){Ce==null&&(Ce=0);var Fe,Et,bt,ht,Zt,Ye,_t=ut+1,Vt=_t%2,Lt=0,dt=fe[Te],It=fe[Te-1],dr=fe[Te-2][_t],fr=It[_t-1],pr=It[_t],Nt=It[_t+1],$e=dt[_t-1],At=dt[_t+1],Ge=Math.abs;if(Vt&&(bt=Ge(Nt-pr),ht=Ge(dr-pr),Zt=Ge(fr-pr)),Vt){if(Ye=(Ye=bt>Zt&&ht<bt?dr+fr:bt<Zt&&ht<Zt?dr+Nt:Nt+fr)+2*pr>>>2,Ce)return void(dt[_t]=Ye);Fe=ce.t*ce.c[ge.g+pr-dr]+ce.c[ge.g+fr-pr]}else Ye=pr>fr&&pr>Nt||pr<fr&&pr<Nt?At+$e+2*pr>>>2:$e+At>>>1,Fe=ce.t*ce.c[ge.g+pr-fr]+ce.c[ge.g+fr-$e];Et=Ge(Fe);var st=(function(gt){for(var Qt=-1,me=0;!me;Qt++)me=gt[gt.j]>>>7-gt.a&1,gt.a++,gt.a&=7,gt.a||gt.j++;return Qt})(Ie);if(st<ge.n-ce.v-1){var Xe=(function(gt,Qt){var me=0;if(Qt<gt)for(;me<=14&&Qt<<++me<gt;);return me})(ze[Et][0],ze[Et][1]);Lt=re(Ie,Xe)+(st<<Xe)}else Lt=re(Ie,ce.v)+1;Lt=1&Lt?-1-(Lt>>>1):Lt>>>1,ze[Et][0]+=Ge(Lt),ze[Et][1]==ge.f&&(ze[Et][0]>>>=1,ze[Et][1]>>>=1),ze[Et][1]++,Ye=Fe<0?Ye-Lt:Ye+Lt,ge.i&&(Ye<0?Ye+=ce.w:Ye>ge.g&&(Ye-=ce.w)),dt[_t]=Ye>=0?Math.min(Ye,ge.g):0}function se(ge,ce,Ie){for(var fe=ge[0].length,Te=ce;Te<=Ie;Te++)ge[Te][0]=ge[Te-1][1],ge[Te][fe-1]=ge[Te-1][fe-2]}function ie(ge){se(ge,j,G),se(ge,I,D),se(ge,q,V)}function oe(ge,ce,Ie,fe,Te,ut,ze,Ce,Fe,Et,bt,ht,Zt){for(var Ye=0,_t=1,Vt=Te<Z&&Te>D;_t<ge.m;)Ye<ge.m&&(J(ge,ce,Ie,fe,Te,Ye,ze[Fe],ge.h&&(Vt&&Et||!Vt&&(bt||(Ye&ht)==Zt))),J(ge,ce,Ie,fe,ut,Ye,ze[Fe],ge.h&&(!Vt&&Et||Vt&&(bt||(Ye&ht)==Zt))),Ye+=2),Ye>8&&(J(ge,ce,Ie,fe,Te,_t,Ce[Fe]),J(ge,ce,Ie,fe,ut,_t,Ce[Fe]),_t+=2);ie(fe)}function pe(ge,ce,Ie,fe,Te,ut){oe(ge,ce,Ie,fe,I,j,Te,ut,0,0,1,0,8),oe(ge,ce,Ie,fe,8,q,Te,ut,1,0,1,0,8),oe(ge,ce,Ie,fe,3,9,Te,ut,2,1,0,3,0),oe(ge,ce,Ie,fe,10,16,Te,ut,0,0,0,3,2),oe(ge,ce,Ie,fe,D,11,Te,ut,1,0,0,3,2),oe(ge,ce,Ie,fe,G,V,Te,ut,2,1,0,3,0)}function de(ge,ce,Ie,fe,Te,ut){var ze=ut.length,Ce=ge.l;Te+1==ge.s&&(Ce=ge.e-Te*ge.l);for(var Fe=6*ge.e*fe+Te*ge.l,Et=0;Et<6;Et++){for(var bt=0;bt<Ce;bt++){var ht,Zt=ut[Et%ze][bt%ze];ht=Zt==0?I+(Et>>>1):Zt==2?q+(Et>>>1):j+Et;var Ye=ge.h?(2*bt/3&2147483646|bt%3&1)+(bt%3>>>1):bt>>>1;ce[Fe+bt]=Ie[ht][Ye+1]}Fe+=ge.e}}w._decompressRAF=function(ge,ce){var Ie=(function(_t){var Vt=w._binBE.readUshort,Lt={b:Vt(_t,0),i:_t[2],C:_t[3],u:_t[4],q:Vt(_t,5),k:Vt(_t,7),e:Vt(_t,9),l:Vt(_t,11),s:_t[13],d:Vt(_t,14)};if(Lt.b!=18771||Lt.i>1||Lt.q<6||Lt.q%6||Lt.e<768||Lt.e%24||Lt.l!=768||Lt.k<Lt.l||Lt.k%Lt.l||Lt.k-Lt.e>=Lt.l||Lt.s>16||Lt.s!=Lt.k/Lt.l||Lt.s!=Math.ceil(Lt.e/Lt.l)||Lt.d!=Lt.q/6||Lt.u!=12&&Lt.u!=14&&Lt.u!=16||Lt.C!=16&&Lt.C!=0)throw"Invalid data";if(Lt.i==0)throw"Not implemented. We need this file!";return Lt.h=Lt.C==16,Lt.m=0|(Lt.h?2*Lt.l/3:Lt.l>>>1),Lt.A=Lt.m+2,Lt.f=64,Lt.g=(1<<Lt.u)-1,Lt.n=4*Lt.u,Lt})(ge),fe=(function(_t,Vt){var Lt=new Array(Vt.s),dt=4*Vt.s,It=16+dt;12&dt&&(It+=16-(12&dt));for(var dr=0,fr=16;dr<Vt.s;fr+=4){var pr=w._binBE.readUint(_t,fr);Lt[dr]=_t.slice(It,It+pr),Lt[dr].j=0,Lt[dr].a=0,It+=pr,dr++}if(It!=_t.length)throw"Invalid data";return Lt})(ge,Ie),Te=Q(Ie),ut=new Int16Array(Ie.e*Ie.q);ce==null&&(ce=Ie.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var ze=[[0,3],[1,D],[F,11],[U,G],[Z,16],[H,V]],Ce=[],Fe=0;Fe<18;Fe++)Ce[Fe]=new Uint16Array(Ie.A);for(var Et=0;Et<Ie.s;Et++){var bt=X(Te),ht=X(Te);for(Fe=0;Fe<18;Fe++)for(var Zt=0;Zt<Ie.A;Zt++)Ce[Fe][Zt]=0;for(var Ye=0;Ye<Ie.d;Ye++){for(pe(Ie,Te,fe[Et],Ce,bt,ht),Fe=0;Fe<6;Fe++)for(Zt=0;Zt<Ie.A;Zt++)Ce[ze[Fe][0]][Zt]=Ce[ze[Fe][1]][Zt];for(de(Ie,ut,Ce,Ye,Et,ce),Fe=I;Fe<18;Fe++)if([F,U,Z,H].indexOf(Fe)==-1)for(Zt=0;Zt<Ie.A;Zt++)Ce[Fe][Zt]=0;ie(Ce)}}return ut}})()})(m,typeof commonjsRequire=="function"?requirePako():self.pako)})()})(UTIF);var UTIFExports=UTIF.exports,utif=getDefaultExportFromCjs(UTIFExports),util$1,objectUtil;function getDimensionValue(d){return typeof d=="number"?d:d instanceof Uint8Array?d[0]:typeof d[0]=="string"?parseInt(d[0]):d[0]}function tiff(){return{mime:"image/tiff",encode:d=>{const m=utif.encodeImage(d.data,d.width,d.height);return Buffer.from(m)},decode:d=>{const m=utif.decode(d),g=m[0];if(!g)throw new Error("No page found in TIFF");if(!g.t256)throw new Error("No image width found in TIFF");if(!g.t257)throw new Error("No image height found in TIFF");m.forEach(($=>{utif.decodeImage(d,$)}));const w=utif.toRGBA8(g);return{data:Buffer.from(w),width:getDimensionValue(g.t256),height:getDimensionValue(g.t257)}}}}(function(d){d.assertEqual=m=>m,d.assertIs=function(m){},d.assertNever=function(m){throw new Error},d.arrayToEnum=m=>{const g={};for(const w of m)g[w]=w;return g},d.getValidEnumValues=m=>{const g=d.objectKeys(m).filter(($=>typeof m[m[$]]!="number")),w={};for(const $ of g)w[$]=m[$];return d.objectValues(w)},d.objectValues=m=>d.objectKeys(m).map((function(g){return m[g]})),d.objectKeys=typeof Object.keys=="function"?m=>Object.keys(m):m=>{const g=[];for(const w in m)Object.prototype.hasOwnProperty.call(m,w)&&g.push(w);return g},d.find=(m,g)=>{for(const w of m)if(g(w))return w},d.isInteger=typeof Number.isInteger=="function"?m=>Number.isInteger(m):m=>typeof m=="number"&&isFinite(m)&&Math.floor(m)===m,d.joinValues=function(m,g=" | "){return m.map((w=>typeof w=="string"?`'${w}'`:w)).join(g)},d.jsonStringifyReplacer=(m,g)=>typeof g=="bigint"?g.toString():g})(util$1||(util$1={})),(function(d){d.mergeShapes=(m,g)=>({...m,...g})})(objectUtil||(objectUtil={}));const ZodParsedType=util$1.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=d=>{switch(typeof d){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(d)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(d)?ZodParsedType.array:d===null?ZodParsedType.null:d.then&&typeof d.then=="function"&&d.catch&&typeof d.catch=="function"?ZodParsedType.promise:typeof Map<"u"&&d instanceof Map?ZodParsedType.map:typeof Set<"u"&&d instanceof Set?ZodParsedType.set:typeof Date<"u"&&d instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util$1.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=d=>JSON.stringify(d,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(m){super(),this.issues=[],this.addIssue=w=>{this.issues=[...this.issues,w]},this.addIssues=(w=[])=>{this.issues=[...this.issues,...w]};const g=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,g):this.__proto__=g,this.name="ZodError",this.issues=m}get errors(){return this.issues}format(m){const g=m||function(I){return I.message},w={_errors:[]},$=I=>{for(const D of I.issues)if(D.code==="invalid_union")D.unionErrors.map($);else if(D.code==="invalid_return_type")$(D.returnTypeError);else if(D.code==="invalid_arguments")$(D.argumentsError);else if(D.path.length===0)w._errors.push(g(D));else{let F=w,U=0;for(;U<D.path.length;){const j=D.path[U];U===D.path.length-1?(F[j]=F[j]||{_errors:[]},F[j]._errors.push(g(D))):F[j]=F[j]||{_errors:[]},F=F[j],U++}}};return $(this),w}static assert(m){if(!(m instanceof ZodError))throw new Error(`Not a ZodError: ${m}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util$1.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(m=(g=>g.message)){const g={},w=[];for(const $ of this.issues)$.path.length>0?(g[$.path[0]]=g[$.path[0]]||[],g[$.path[0]].push(m($))):w.push(m($));return{formErrors:w,fieldErrors:g}}get formErrors(){return this.flatten()}}ZodError.create=d=>new ZodError(d);const errorMap=(d,m)=>{let g;switch(d.code){case ZodIssueCode.invalid_type:g=d.received===ZodParsedType.undefined?"Required":`Expected ${d.expected}, received ${d.received}`;break;case ZodIssueCode.invalid_literal:g=`Invalid literal value, expected ${JSON.stringify(d.expected,util$1.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:g=`Unrecognized key(s) in object: ${util$1.joinValues(d.keys,", ")}`;break;case ZodIssueCode.invalid_union:g="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:g=`Invalid discriminator value. Expected ${util$1.joinValues(d.options)}`;break;case ZodIssueCode.invalid_enum_value:g=`Invalid enum value. Expected ${util$1.joinValues(d.options)}, received '${d.received}'`;break;case ZodIssueCode.invalid_arguments:g="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:g="Invalid function return type";break;case ZodIssueCode.invalid_date:g="Invalid date";break;case ZodIssueCode.invalid_string:typeof d.validation=="object"?"includes"in d.validation?(g=`Invalid input: must include "${d.validation.includes}"`,typeof d.validation.position=="number"&&(g=`${g} at one or more positions greater than or equal to ${d.validation.position}`)):"startsWith"in d.validation?g=`Invalid input: must start with "${d.validation.startsWith}"`:"endsWith"in d.validation?g=`Invalid input: must end with "${d.validation.endsWith}"`:util$1.assertNever(d.validation):g=d.validation!=="regex"?`Invalid ${d.validation}`:"Invalid";break;case ZodIssueCode.too_small:g=d.type==="array"?`Array must contain ${d.exact?"exactly":d.inclusive?"at least":"more than"} ${d.minimum} element(s)`:d.type==="string"?`String must contain ${d.exact?"exactly":d.inclusive?"at least":"over"} ${d.minimum} character(s)`:d.type==="number"?`Number must be ${d.exact?"exactly equal to ":d.inclusive?"greater than or equal to ":"greater than "}${d.minimum}`:d.type==="date"?`Date must be ${d.exact?"exactly equal to ":d.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(d.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:g=d.type==="array"?`Array must contain ${d.exact?"exactly":d.inclusive?"at most":"less than"} ${d.maximum} element(s)`:d.type==="string"?`String must contain ${d.exact?"exactly":d.inclusive?"at most":"under"} ${d.maximum} character(s)`:d.type==="number"?`Number must be ${d.exact?"exactly":d.inclusive?"less than or equal to":"less than"} ${d.maximum}`:d.type==="bigint"?`BigInt must be ${d.exact?"exactly":d.inclusive?"less than or equal to":"less than"} ${d.maximum}`:d.type==="date"?`Date must be ${d.exact?"exactly":d.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(d.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:g="Invalid input";break;case ZodIssueCode.invalid_intersection_types:g="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:g=`Number must be a multiple of ${d.multipleOf}`;break;case ZodIssueCode.not_finite:g="Number must be finite";break;default:g=m.defaultError,util$1.assertNever(d)}return{message:g}};let overrideErrorMap=errorMap;function setErrorMap(d){overrideErrorMap=d}function getErrorMap(){return overrideErrorMap}const makeIssue=d=>{const{data:m,path:g,errorMaps:w,issueData:$}=d,I=[...g,...$.path||[]],D={...$,path:I};if($.message!==void 0)return{...$,path:I,message:$.message};let F="";const U=w.filter((j=>!!j)).slice().reverse();for(const j of U)F=j(D,{data:m,defaultError:F}).message;return{...$,path:I,message:F}},EMPTY_PATH=[];function addIssueToContext(d,m){const g=getErrorMap(),w=makeIssue({issueData:m,data:d.data,path:d.path,errorMaps:[d.common.contextualErrorMap,d.schemaErrorMap,g,g===errorMap?void 0:errorMap].filter(($=>!!$))});d.common.issues.push(w)}class ParseStatus{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(m,g){const w=[];for(const $ of g){if($.status==="aborted")return INVALID;$.status==="dirty"&&m.dirty(),w.push($.value)}return{status:m.value,value:w}}static async mergeObjectAsync(m,g){const w=[];for(const $ of g){const I=await $.key,D=await $.value;w.push({key:I,value:D})}return ParseStatus.mergeObjectSync(m,w)}static mergeObjectSync(m,g){const w={};for(const $ of g){const{key:I,value:D}=$;if(I.status==="aborted"||D.status==="aborted")return INVALID;I.status==="dirty"&&m.dirty(),D.status==="dirty"&&m.dirty(),I.value==="__proto__"||D.value===void 0&&!$.alwaysSet||(w[I.value]=D.value)}return{status:m.value,value:w}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=d=>({status:"dirty",value:d}),OK=d=>({status:"valid",value:d}),isAborted=d=>d.status==="aborted",isDirty=d=>d.status==="dirty",isValid=d=>d.status==="valid",isAsync=d=>typeof Promise<"u"&&d instanceof Promise;function __classPrivateFieldGet(d,m,g,w){if(typeof m=="function"?d!==m||!0:!m.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return m.get(d)}function __classPrivateFieldSet(d,m,g,w,$){if(typeof m=="function"?d!==m||!0:!m.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return m.set(d,g),g}var errorUtil,_ZodEnum_cache,_ZodNativeEnum_cache;typeof SuppressedError=="function"&&SuppressedError,(function(d){d.errToObj=m=>typeof m=="string"?{message:m}:m||{},d.toString=m=>typeof m=="string"?m:m?.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(m,g,w,$){this._cachedPath=[],this.parent=m,this.data=g,this._path=w,this._key=$}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(d,m)=>{if(isValid(m))return{success:!0,data:m.value};if(!d.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const g=new ZodError(d.common.issues);return this._error=g,this._error}}};function processCreateParams(d){if(!d)return{};const{errorMap:m,invalid_type_error:g,required_error:w,description:$}=d;if(m&&(g||w))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return m?{errorMap:m,description:$}:{errorMap:(I,D)=>{var F,U;const{message:j}=d;return I.code==="invalid_enum_value"?{message:j??D.defaultError}:D.data===void 0?{message:(F=j??w)!==null&&F!==void 0?F:D.defaultError}:I.code!=="invalid_type"?{message:D.defaultError}:{message:(U=j??g)!==null&&U!==void 0?U:D.defaultError}},description:$}}class ZodType{constructor(m){this.spa=this.safeParseAsync,this._def=m,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(m){return getParsedType(m.data)}_getOrReturnCtx(m,g){return g||{common:m.parent.common,data:m.data,parsedType:getParsedType(m.data),schemaErrorMap:this._def.errorMap,path:m.path,parent:m.parent}}_processInputParams(m){return{status:new ParseStatus,ctx:{common:m.parent.common,data:m.data,parsedType:getParsedType(m.data),schemaErrorMap:this._def.errorMap,path:m.path,parent:m.parent}}}_parseSync(m){const g=this._parse(m);if(isAsync(g))throw new Error("Synchronous parse encountered promise.");return g}_parseAsync(m){const g=this._parse(m);return Promise.resolve(g)}parse(m,g){const w=this.safeParse(m,g);if(w.success)return w.data;throw w.error}safeParse(m,g){var w;const $={common:{issues:[],async:(w=g?.async)!==null&&w!==void 0&&w,contextualErrorMap:g?.errorMap},path:g?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:m,parsedType:getParsedType(m)},I=this._parseSync({data:m,path:$.path,parent:$});return handleResult($,I)}async parseAsync(m,g){const w=await this.safeParseAsync(m,g);if(w.success)return w.data;throw w.error}async safeParseAsync(m,g){const w={common:{issues:[],contextualErrorMap:g?.errorMap,async:!0},path:g?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:m,parsedType:getParsedType(m)},$=this._parse({data:m,path:w.path,parent:w}),I=await(isAsync($)?$:Promise.resolve($));return handleResult(w,I)}refine(m,g){const w=$=>typeof g=="string"||g===void 0?{message:g}:typeof g=="function"?g($):g;return this._refinement((($,I)=>{const D=m($),F=()=>I.addIssue({code:ZodIssueCode.custom,...w($)});return typeof Promise<"u"&&D instanceof Promise?D.then((U=>!!U||(F(),!1))):!!D||(F(),!1)}))}refinement(m,g){return this._refinement(((w,$)=>!!m(w)||($.addIssue(typeof g=="function"?g(w,$):g),!1)))}_refinement(m){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:m}})}superRefine(m){return this._refinement(m)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(m){return ZodUnion.create([this,m],this._def)}and(m){return ZodIntersection.create(this,m,this._def)}transform(m){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:m}})}default(m){const g=typeof m=="function"?m:()=>m;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:g,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(m){const g=typeof m=="function"?m:()=>m;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:g,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(m){return new this.constructor({...this._def,description:m})}pipe(m){return ZodPipeline.create(this,m)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let emojiRegex;const ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=new RegExp(`^${dateRegexSource}$`);function timeRegexSource(d){let m="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return d.precision?m=`${m}\\.\\d{${d.precision}}`:d.precision==null&&(m=`${m}(\\.\\d+)?`),m}function timeRegex(d){return new RegExp(`^${timeRegexSource(d)}$`)}function datetimeRegex(d){let m=`${dateRegexSource}T${timeRegexSource(d)}`;const g=[];return g.push(d.local?"Z?":"Z"),d.offset&&g.push("([+-]\\d{2}:?\\d{2})"),m=`${m}(${g.join("|")})`,new RegExp(`^${m}$`)}function isValidIP(d,m){return!(m!=="v4"&&m||!ipv4Regex.test(d))||!(m!=="v6"&&m||!ipv6Regex.test(d))}class ZodString extends ZodType{_parse(m){if(this._def.coerce&&(m.data=String(m.data)),this._getType(m)!==ZodParsedType.string){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:$.parsedType}),INVALID}const g=new ParseStatus;let w;for(const $ of this._def.checks)if($.kind==="min")m.data.length<$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.value,type:"string",inclusive:!0,exact:!1,message:$.message}),g.dirty());else if($.kind==="max")m.data.length>$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.value,type:"string",inclusive:!0,exact:!1,message:$.message}),g.dirty());else if($.kind==="length"){const I=m.data.length>$.value,D=m.data.length<$.value;(I||D)&&(w=this._getOrReturnCtx(m,w),I?addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.value,type:"string",inclusive:!0,exact:!0,message:$.message}):D&&addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.value,type:"string",inclusive:!0,exact:!0,message:$.message}),g.dirty())}else if($.kind==="email")emailRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"email",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="emoji")emojiRegex||(emojiRegex=new RegExp(_emojiRegex,"u")),emojiRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"emoji",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="uuid")uuidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"uuid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="nanoid")nanoidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"nanoid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="cuid")cuidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"cuid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="cuid2")cuid2Regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="ulid")ulidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"ulid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="url")try{new URL(m.data)}catch{w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"url",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()}else $.kind==="regex"?($.regex.lastIndex=0,$.regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"regex",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty())):$.kind==="trim"?m.data=m.data.trim():$.kind==="includes"?m.data.includes($.value,$.position)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{includes:$.value,position:$.position},message:$.message}),g.dirty()):$.kind==="toLowerCase"?m.data=m.data.toLowerCase():$.kind==="toUpperCase"?m.data=m.data.toUpperCase():$.kind==="startsWith"?m.data.startsWith($.value)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{startsWith:$.value},message:$.message}),g.dirty()):$.kind==="endsWith"?m.data.endsWith($.value)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{endsWith:$.value},message:$.message}),g.dirty()):$.kind==="datetime"?datetimeRegex($).test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"datetime",message:$.message}),g.dirty()):$.kind==="date"?dateRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"date",message:$.message}),g.dirty()):$.kind==="time"?timeRegex($).test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"time",message:$.message}),g.dirty()):$.kind==="duration"?durationRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"duration",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):$.kind==="ip"?isValidIP(m.data,$.version)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"ip",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):$.kind==="base64"?base64Regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"base64",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):util$1.assertNever($);return{status:g.value,value:m.data}}_regex(m,g,w){return this.refinement(($=>m.test($)),{validation:g,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(w)})}_addCheck(m){return new ZodString({...this._def,checks:[...this._def.checks,m]})}email(m){return this._addCheck({kind:"email",...errorUtil.errToObj(m)})}url(m){return this._addCheck({kind:"url",...errorUtil.errToObj(m)})}emoji(m){return this._addCheck({kind:"emoji",...errorUtil.errToObj(m)})}uuid(m){return this._addCheck({kind:"uuid",...errorUtil.errToObj(m)})}nanoid(m){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(m)})}cuid(m){return this._addCheck({kind:"cuid",...errorUtil.errToObj(m)})}cuid2(m){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(m)})}ulid(m){return this._addCheck({kind:"ulid",...errorUtil.errToObj(m)})}base64(m){return this._addCheck({kind:"base64",...errorUtil.errToObj(m)})}ip(m){return this._addCheck({kind:"ip",...errorUtil.errToObj(m)})}datetime(m){var g,w;return typeof m=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:m}):this._addCheck({kind:"datetime",precision:m?.precision===void 0?null:m?.precision,offset:(g=m?.offset)!==null&&g!==void 0&&g,local:(w=m?.local)!==null&&w!==void 0&&w,...errorUtil.errToObj(m?.message)})}date(m){return this._addCheck({kind:"date",message:m})}time(m){return typeof m=="string"?this._addCheck({kind:"time",precision:null,message:m}):this._addCheck({kind:"time",precision:m?.precision===void 0?null:m?.precision,...errorUtil.errToObj(m?.message)})}duration(m){return this._addCheck({kind:"duration",...errorUtil.errToObj(m)})}regex(m,g){return this._addCheck({kind:"regex",regex:m,...errorUtil.errToObj(g)})}includes(m,g){return this._addCheck({kind:"includes",value:m,position:g?.position,...errorUtil.errToObj(g?.message)})}startsWith(m,g){return this._addCheck({kind:"startsWith",value:m,...errorUtil.errToObj(g)})}endsWith(m,g){return this._addCheck({kind:"endsWith",value:m,...errorUtil.errToObj(g)})}min(m,g){return this._addCheck({kind:"min",value:m,...errorUtil.errToObj(g)})}max(m,g){return this._addCheck({kind:"max",value:m,...errorUtil.errToObj(g)})}length(m,g){return this._addCheck({kind:"length",value:m,...errorUtil.errToObj(g)})}nonempty(m){return this.min(1,errorUtil.errToObj(m))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((m=>m.kind==="datetime"))}get isDate(){return!!this._def.checks.find((m=>m.kind==="date"))}get isTime(){return!!this._def.checks.find((m=>m.kind==="time"))}get isDuration(){return!!this._def.checks.find((m=>m.kind==="duration"))}get isEmail(){return!!this._def.checks.find((m=>m.kind==="email"))}get isURL(){return!!this._def.checks.find((m=>m.kind==="url"))}get isEmoji(){return!!this._def.checks.find((m=>m.kind==="emoji"))}get isUUID(){return!!this._def.checks.find((m=>m.kind==="uuid"))}get isNANOID(){return!!this._def.checks.find((m=>m.kind==="nanoid"))}get isCUID(){return!!this._def.checks.find((m=>m.kind==="cuid"))}get isCUID2(){return!!this._def.checks.find((m=>m.kind==="cuid2"))}get isULID(){return!!this._def.checks.find((m=>m.kind==="ulid"))}get isIP(){return!!this._def.checks.find((m=>m.kind==="ip"))}get isBase64(){return!!this._def.checks.find((m=>m.kind==="base64"))}get minLength(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxLength(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}}function floatSafeRemainder(d,m){const g=(d.toString().split(".")[1]||"").length,w=(m.toString().split(".")[1]||"").length,$=g>w?g:w;return parseInt(d.toFixed($).replace(".",""))%parseInt(m.toFixed($).replace(".",""))/Math.pow(10,$)}ZodString.create=d=>{var m;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:(m=d?.coerce)!==null&&m!==void 0&&m,...processCreateParams(d)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(m){if(this._def.coerce&&(m.data=Number(m.data)),this._getType(m)!==ZodParsedType.number){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:$.parsedType}),INVALID}let g;const w=new ParseStatus;for(const $ of this._def.checks)$.kind==="int"?util$1.isInteger(m.data)||(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:$.message}),w.dirty()):$.kind==="min"?($.inclusive?m.data<$.value:m.data<=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_small,minimum:$.value,type:"number",inclusive:$.inclusive,exact:!1,message:$.message}),w.dirty()):$.kind==="max"?($.inclusive?m.data>$.value:m.data>=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_big,maximum:$.value,type:"number",inclusive:$.inclusive,exact:!1,message:$.message}),w.dirty()):$.kind==="multipleOf"?floatSafeRemainder(m.data,$.value)!==0&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_multiple_of,multipleOf:$.value,message:$.message}),w.dirty()):$.kind==="finite"?Number.isFinite(m.data)||(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_finite,message:$.message}),w.dirty()):util$1.assertNever($);return{status:w.value,value:m.data}}gte(m,g){return this.setLimit("min",m,!0,errorUtil.toString(g))}gt(m,g){return this.setLimit("min",m,!1,errorUtil.toString(g))}lte(m,g){return this.setLimit("max",m,!0,errorUtil.toString(g))}lt(m,g){return this.setLimit("max",m,!1,errorUtil.toString(g))}setLimit(m,g,w,$){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:m,value:g,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(m){return new ZodNumber({...this._def,checks:[...this._def.checks,m]})}int(m){return this._addCheck({kind:"int",message:errorUtil.toString(m)})}positive(m){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(m)})}negative(m){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(m)})}nonpositive(m){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(m)})}nonnegative(m){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(m)})}multipleOf(m,g){return this._addCheck({kind:"multipleOf",value:m,message:errorUtil.toString(g)})}finite(m){return this._addCheck({kind:"finite",message:errorUtil.toString(m)})}safe(m){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(m)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(m)})}get minValue(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxValue(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}get isInt(){return!!this._def.checks.find((m=>m.kind==="int"||m.kind==="multipleOf"&&util$1.isInteger(m.value)))}get isFinite(){let m=null,g=null;for(const w of this._def.checks){if(w.kind==="finite"||w.kind==="int"||w.kind==="multipleOf")return!0;w.kind==="min"?(g===null||w.value>g)&&(g=w.value):w.kind==="max"&&(m===null||w.value<m)&&(m=w.value)}return Number.isFinite(g)&&Number.isFinite(m)}}ZodNumber.create=d=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:d?.coerce||!1,...processCreateParams(d)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(m){if(this._def.coerce&&(m.data=BigInt(m.data)),this._getType(m)!==ZodParsedType.bigint){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:$.parsedType}),INVALID}let g;const w=new ParseStatus;for(const $ of this._def.checks)$.kind==="min"?($.inclusive?m.data<$.value:m.data<=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_small,type:"bigint",minimum:$.value,inclusive:$.inclusive,message:$.message}),w.dirty()):$.kind==="max"?($.inclusive?m.data>$.value:m.data>=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_big,type:"bigint",maximum:$.value,inclusive:$.inclusive,message:$.message}),w.dirty()):$.kind==="multipleOf"?m.data%$.value!==BigInt(0)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_multiple_of,multipleOf:$.value,message:$.message}),w.dirty()):util$1.assertNever($);return{status:w.value,value:m.data}}gte(m,g){return this.setLimit("min",m,!0,errorUtil.toString(g))}gt(m,g){return this.setLimit("min",m,!1,errorUtil.toString(g))}lte(m,g){return this.setLimit("max",m,!0,errorUtil.toString(g))}lt(m,g){return this.setLimit("max",m,!1,errorUtil.toString(g))}setLimit(m,g,w,$){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:m,value:g,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(m){return new ZodBigInt({...this._def,checks:[...this._def.checks,m]})}positive(m){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(m)})}negative(m){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(m)})}nonpositive(m){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(m)})}nonnegative(m){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(m)})}multipleOf(m,g){return this._addCheck({kind:"multipleOf",value:m,message:errorUtil.toString(g)})}get minValue(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxValue(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}}ZodBigInt.create=d=>{var m;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:(m=d?.coerce)!==null&&m!==void 0&&m,...processCreateParams(d)})};class ZodBoolean extends ZodType{_parse(m){if(this._def.coerce&&(m.data=!!m.data),this._getType(m)!==ZodParsedType.boolean){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:g.parsedType}),INVALID}return OK(m.data)}}ZodBoolean.create=d=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:d?.coerce||!1,...processCreateParams(d)});class ZodDate extends ZodType{_parse(m){if(this._def.coerce&&(m.data=new Date(m.data)),this._getType(m)!==ZodParsedType.date){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:$.parsedType}),INVALID}if(isNaN(m.data.getTime()))return addIssueToContext(this._getOrReturnCtx(m),{code:ZodIssueCode.invalid_date}),INVALID;const g=new ParseStatus;let w;for(const $ of this._def.checks)$.kind==="min"?m.data.getTime()<$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_small,message:$.message,inclusive:!0,exact:!1,minimum:$.value,type:"date"}),g.dirty()):$.kind==="max"?m.data.getTime()>$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_big,message:$.message,inclusive:!0,exact:!1,maximum:$.value,type:"date"}),g.dirty()):util$1.assertNever($);return{status:g.value,value:new Date(m.data.getTime())}}_addCheck(m){return new ZodDate({...this._def,checks:[...this._def.checks,m]})}min(m,g){return this._addCheck({kind:"min",value:m.getTime(),message:errorUtil.toString(g)})}max(m,g){return this._addCheck({kind:"max",value:m.getTime(),message:errorUtil.toString(g)})}get minDate(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m!=null?new Date(m):null}get maxDate(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m!=null?new Date(m):null}}ZodDate.create=d=>new ZodDate({checks:[],coerce:d?.coerce||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(d)});class ZodSymbol extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.symbol){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:g.parsedType}),INVALID}return OK(m.data)}}ZodSymbol.create=d=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(d)});class ZodUndefined extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.undefined){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:g.parsedType}),INVALID}return OK(m.data)}}ZodUndefined.create=d=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(d)});class ZodNull extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.null){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:g.parsedType}),INVALID}return OK(m.data)}}ZodNull.create=d=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(d)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(m){return OK(m.data)}}ZodAny.create=d=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(d)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(m){return OK(m.data)}}ZodUnknown.create=d=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(d)});class ZodNever extends ZodType{_parse(m){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:g.parsedType}),INVALID}}ZodNever.create=d=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(d)});class ZodVoid extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.undefined){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:g.parsedType}),INVALID}return OK(m.data)}}ZodVoid.create=d=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(d)});class ZodArray extends ZodType{_parse(m){const{ctx:g,status:w}=this._processInputParams(m),$=this._def;if(g.parsedType!==ZodParsedType.array)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:g.parsedType}),INVALID;if($.exactLength!==null){const D=g.data.length>$.exactLength.value,F=g.data.length<$.exactLength.value;(D||F)&&(addIssueToContext(g,{code:D?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:F?$.exactLength.value:void 0,maximum:D?$.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:$.exactLength.message}),w.dirty())}if($.minLength!==null&&g.data.length<$.minLength.value&&(addIssueToContext(g,{code:ZodIssueCode.too_small,minimum:$.minLength.value,type:"array",inclusive:!0,exact:!1,message:$.minLength.message}),w.dirty()),$.maxLength!==null&&g.data.length>$.maxLength.value&&(addIssueToContext(g,{code:ZodIssueCode.too_big,maximum:$.maxLength.value,type:"array",inclusive:!0,exact:!1,message:$.maxLength.message}),w.dirty()),g.common.async)return Promise.all([...g.data].map(((D,F)=>$.type._parseAsync(new ParseInputLazyPath(g,D,g.path,F))))).then((D=>ParseStatus.mergeArray(w,D)));const I=[...g.data].map(((D,F)=>$.type._parseSync(new ParseInputLazyPath(g,D,g.path,F))));return ParseStatus.mergeArray(w,I)}get element(){return this._def.type}min(m,g){return new ZodArray({...this._def,minLength:{value:m,message:errorUtil.toString(g)}})}max(m,g){return new ZodArray({...this._def,maxLength:{value:m,message:errorUtil.toString(g)}})}length(m,g){return new ZodArray({...this._def,exactLength:{value:m,message:errorUtil.toString(g)}})}nonempty(m){return this.min(1,m)}}function deepPartialify(d){if(d instanceof ZodObject){const m={};for(const g in d.shape){const w=d.shape[g];m[g]=ZodOptional.create(deepPartialify(w))}return new ZodObject({...d._def,shape:()=>m})}return d instanceof ZodArray?new ZodArray({...d._def,type:deepPartialify(d.element)}):d instanceof ZodOptional?ZodOptional.create(deepPartialify(d.unwrap())):d instanceof ZodNullable?ZodNullable.create(deepPartialify(d.unwrap())):d instanceof ZodTuple?ZodTuple.create(d.items.map((m=>deepPartialify(m)))):d}ZodArray.create=(d,m)=>new ZodArray({type:d,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(m)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const m=this._def.shape(),g=util$1.objectKeys(m);return this._cached={shape:m,keys:g}}_parse(m){if(this._getType(m)!==ZodParsedType.object){const U=this._getOrReturnCtx(m);return addIssueToContext(U,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:U.parsedType}),INVALID}const{status:g,ctx:w}=this._processInputParams(m),{shape:$,keys:I}=this._getCached(),D=[];if(!(this._def.catchall instanceof ZodNever&&this._def.unknownKeys==="strip"))for(const U in w.data)I.includes(U)||D.push(U);const F=[];for(const U of I){const j=$[U],G=w.data[U];F.push({key:{status:"valid",value:U},value:j._parse(new ParseInputLazyPath(w,G,w.path,U)),alwaysSet:U in w.data})}if(this._def.catchall instanceof ZodNever){const U=this._def.unknownKeys;if(U==="passthrough")for(const j of D)F.push({key:{status:"valid",value:j},value:{status:"valid",value:w.data[j]}});else if(U==="strict")D.length>0&&(addIssueToContext(w,{code:ZodIssueCode.unrecognized_keys,keys:D}),g.dirty());else if(U!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const U=this._def.catchall;for(const j of D){const G=w.data[j];F.push({key:{status:"valid",value:j},value:U._parse(new ParseInputLazyPath(w,G,w.path,j)),alwaysSet:j in w.data})}}return w.common.async?Promise.resolve().then((async()=>{const U=[];for(const j of F){const G=await j.key,Z=await j.value;U.push({key:G,value:Z,alwaysSet:j.alwaysSet})}return U})).then((U=>ParseStatus.mergeObjectSync(g,U))):ParseStatus.mergeObjectSync(g,F)}get shape(){return this._def.shape()}strict(m){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...m!==void 0?{errorMap:(g,w)=>{var $,I,D,F;const U=(D=(I=($=this._def).errorMap)===null||I===void 0?void 0:I.call($,g,w).message)!==null&&D!==void 0?D:w.defaultError;return g.code==="unrecognized_keys"?{message:(F=errorUtil.errToObj(m).message)!==null&&F!==void 0?F:U}:{message:U}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(m){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...m})})}merge(m){return new ZodObject({unknownKeys:m._def.unknownKeys,catchall:m._def.catchall,shape:()=>({...this._def.shape(),...m._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(m,g){return this.augment({[m]:g})}catchall(m){return new ZodObject({...this._def,catchall:m})}pick(m){const g={};return util$1.objectKeys(m).forEach((w=>{m[w]&&this.shape[w]&&(g[w]=this.shape[w])})),new ZodObject({...this._def,shape:()=>g})}omit(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{m[w]||(g[w]=this.shape[w])})),new ZodObject({...this._def,shape:()=>g})}deepPartial(){return deepPartialify(this)}partial(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{const $=this.shape[w];m&&!m[w]?g[w]=$:g[w]=$.optional()})),new ZodObject({...this._def,shape:()=>g})}required(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{if(m&&!m[w])g[w]=this.shape[w];else{let $=this.shape[w];for(;$ instanceof ZodOptional;)$=$._def.innerType;g[w]=$}})),new ZodObject({...this._def,shape:()=>g})}keyof(){return createZodEnum(util$1.objectKeys(this.shape))}}ZodObject.create=(d,m)=>new ZodObject({shape:()=>d,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)}),ZodObject.strictCreate=(d,m)=>new ZodObject({shape:()=>d,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)}),ZodObject.lazycreate=(d,m)=>new ZodObject({shape:d,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)});class ZodUnion extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w=this._def.options;if(g.common.async)return Promise.all(w.map((async $=>{const I={...g,common:{...g.common,issues:[]},parent:null};return{result:await $._parseAsync({data:g.data,path:g.path,parent:I}),ctx:I}}))).then((function($){for(const D of $)if(D.result.status==="valid")return D.result;for(const D of $)if(D.result.status==="dirty")return g.common.issues.push(...D.ctx.common.issues),D.result;const I=$.map((D=>new ZodError(D.ctx.common.issues)));return addIssueToContext(g,{code:ZodIssueCode.invalid_union,unionErrors:I}),INVALID}));{let $;const I=[];for(const F of w){const U={...g,common:{...g.common,issues:[]},parent:null},j=F._parseSync({data:g.data,path:g.path,parent:U});if(j.status==="valid")return j;j.status!=="dirty"||$||($={result:j,ctx:U}),U.common.issues.length&&I.push(U.common.issues)}if($)return g.common.issues.push(...$.ctx.common.issues),$.result;const D=I.map((F=>new ZodError(F)));return addIssueToContext(g,{code:ZodIssueCode.invalid_union,unionErrors:D}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(d,m)=>new ZodUnion({options:d,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(m)});const getDiscriminator=d=>d instanceof ZodLazy?getDiscriminator(d.schema):d instanceof ZodEffects?getDiscriminator(d.innerType()):d instanceof ZodLiteral?[d.value]:d instanceof ZodEnum?d.options:d instanceof ZodNativeEnum?util$1.objectValues(d.enum):d instanceof ZodDefault?getDiscriminator(d._def.innerType):d instanceof ZodUndefined?[void 0]:d instanceof ZodNull?[null]:d instanceof ZodOptional?[void 0,...getDiscriminator(d.unwrap())]:d instanceof ZodNullable?[null,...getDiscriminator(d.unwrap())]:d instanceof ZodBranded||d instanceof ZodReadonly?getDiscriminator(d.unwrap()):d instanceof ZodCatch?getDiscriminator(d._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.object)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:g.parsedType}),INVALID;const w=this.discriminator,$=g.data[w],I=this.optionsMap.get($);return I?g.common.async?I._parseAsync({data:g.data,path:g.path,parent:g}):I._parseSync({data:g.data,path:g.path,parent:g}):(addIssueToContext(g,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[w]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(m,g,w){const $=new Map;for(const I of g){const D=getDiscriminator(I.shape[m]);if(!D.length)throw new Error(`A discriminator value for key \`${m}\` could not be extracted from all schema options`);for(const F of D){if($.has(F))throw new Error(`Discriminator property ${String(m)} has duplicate value ${String(F)}`);$.set(F,I)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:m,options:g,optionsMap:$,...processCreateParams(w)})}}function mergeValues(d,m){const g=getParsedType(d),w=getParsedType(m);if(d===m)return{valid:!0,data:d};if(g===ZodParsedType.object&&w===ZodParsedType.object){const $=util$1.objectKeys(m),I=util$1.objectKeys(d).filter((F=>$.indexOf(F)!==-1)),D={...d,...m};for(const F of I){const U=mergeValues(d[F],m[F]);if(!U.valid)return{valid:!1};D[F]=U.data}return{valid:!0,data:D}}if(g===ZodParsedType.array&&w===ZodParsedType.array){if(d.length!==m.length)return{valid:!1};const $=[];for(let I=0;I<d.length;I++){const D=mergeValues(d[I],m[I]);if(!D.valid)return{valid:!1};$.push(D.data)}return{valid:!0,data:$}}return g===ZodParsedType.date&&w===ZodParsedType.date&&+d==+m?{valid:!0,data:d}:{valid:!1}}class ZodIntersection extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m),$=(I,D)=>{if(isAborted(I)||isAborted(D))return INVALID;const F=mergeValues(I.value,D.value);return F.valid?((isDirty(I)||isDirty(D))&&g.dirty(),{status:g.value,value:F.data}):(addIssueToContext(w,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return w.common.async?Promise.all([this._def.left._parseAsync({data:w.data,path:w.path,parent:w}),this._def.right._parseAsync({data:w.data,path:w.path,parent:w})]).then((([I,D])=>$(I,D))):$(this._def.left._parseSync({data:w.data,path:w.path,parent:w}),this._def.right._parseSync({data:w.data,path:w.path,parent:w}))}}ZodIntersection.create=(d,m,g)=>new ZodIntersection({left:d,right:m,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(g)});class ZodTuple extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.array)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:w.parsedType}),INVALID;if(w.data.length<this._def.items.length)return addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&w.data.length>this._def.items.length&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g.dirty());const $=[...w.data].map(((I,D)=>{const F=this._def.items[D]||this._def.rest;return F?F._parse(new ParseInputLazyPath(w,I,w.path,D)):null})).filter((I=>!!I));return w.common.async?Promise.all($).then((I=>ParseStatus.mergeArray(g,I))):ParseStatus.mergeArray(g,$)}get items(){return this._def.items}rest(m){return new ZodTuple({...this._def,rest:m})}}ZodTuple.create=(d,m)=>{if(!Array.isArray(d))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:d,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(m)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.object)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:w.parsedType}),INVALID;const $=[],I=this._def.keyType,D=this._def.valueType;for(const F in w.data)$.push({key:I._parse(new ParseInputLazyPath(w,F,w.path,F)),value:D._parse(new ParseInputLazyPath(w,w.data[F],w.path,F)),alwaysSet:F in w.data});return w.common.async?ParseStatus.mergeObjectAsync(g,$):ParseStatus.mergeObjectSync(g,$)}get element(){return this._def.valueType}static create(m,g,w){return new ZodRecord(g instanceof ZodType?{keyType:m,valueType:g,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(w)}:{keyType:ZodString.create(),valueType:m,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(g)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.map)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:w.parsedType}),INVALID;const $=this._def.keyType,I=this._def.valueType,D=[...w.data.entries()].map((([F,U],j)=>({key:$._parse(new ParseInputLazyPath(w,F,w.path,[j,"key"])),value:I._parse(new ParseInputLazyPath(w,U,w.path,[j,"value"]))})));if(w.common.async){const F=new Map;return Promise.resolve().then((async()=>{for(const U of D){const j=await U.key,G=await U.value;if(j.status==="aborted"||G.status==="aborted")return INVALID;j.status!=="dirty"&&G.status!=="dirty"||g.dirty(),F.set(j.value,G.value)}return{status:g.value,value:F}}))}{const F=new Map;for(const U of D){const j=U.key,G=U.value;if(j.status==="aborted"||G.status==="aborted")return INVALID;j.status!=="dirty"&&G.status!=="dirty"||g.dirty(),F.set(j.value,G.value)}return{status:g.value,value:F}}}}ZodMap.create=(d,m,g)=>new ZodMap({valueType:m,keyType:d,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(g)});class ZodSet extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.set)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:w.parsedType}),INVALID;const $=this._def;$.minSize!==null&&w.data.size<$.minSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.minSize.value,type:"set",inclusive:!0,exact:!1,message:$.minSize.message}),g.dirty()),$.maxSize!==null&&w.data.size>$.maxSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.maxSize.value,type:"set",inclusive:!0,exact:!1,message:$.maxSize.message}),g.dirty());const I=this._def.valueType;function D(U){const j=new Set;for(const G of U){if(G.status==="aborted")return INVALID;G.status==="dirty"&&g.dirty(),j.add(G.value)}return{status:g.value,value:j}}const F=[...w.data.values()].map(((U,j)=>I._parse(new ParseInputLazyPath(w,U,w.path,j))));return w.common.async?Promise.all(F).then((U=>D(U))):D(F)}min(m,g){return new ZodSet({...this._def,minSize:{value:m,message:errorUtil.toString(g)}})}max(m,g){return new ZodSet({...this._def,maxSize:{value:m,message:errorUtil.toString(g)}})}size(m,g){return this.min(m,g).max(m,g)}nonempty(m){return this.min(1,m)}}ZodSet.create=(d,m)=>new ZodSet({valueType:d,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(m)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.function)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:g.parsedType}),INVALID;function w(F,U){return makeIssue({data:F,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,getErrorMap(),errorMap].filter((j=>!!j)),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:U}})}function $(F,U){return makeIssue({data:F,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,getErrorMap(),errorMap].filter((j=>!!j)),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:U}})}const I={errorMap:g.common.contextualErrorMap},D=g.data;if(this._def.returns instanceof ZodPromise){const F=this;return OK((async function(...U){const j=new ZodError([]),G=await F._def.args.parseAsync(U,I).catch((q=>{throw j.addIssue(w(U,q)),j})),Z=await Reflect.apply(D,this,G);return await F._def.returns._def.type.parseAsync(Z,I).catch((q=>{throw j.addIssue($(Z,q)),j}))}))}{const F=this;return OK((function(...U){const j=F._def.args.safeParse(U,I);if(!j.success)throw new ZodError([w(U,j.error)]);const G=Reflect.apply(D,this,j.data),Z=F._def.returns.safeParse(G,I);if(!Z.success)throw new ZodError([$(G,Z.error)]);return Z.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...m){return new ZodFunction({...this._def,args:ZodTuple.create(m).rest(ZodUnknown.create())})}returns(m){return new ZodFunction({...this._def,returns:m})}implement(m){return this.parse(m)}strictImplement(m){return this.parse(m)}static create(m,g,w){return new ZodFunction({args:m||ZodTuple.create([]).rest(ZodUnknown.create()),returns:g||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(w)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(m){const{ctx:g}=this._processInputParams(m);return this._def.getter()._parse({data:g.data,path:g.path,parent:g})}}ZodLazy.create=(d,m)=>new ZodLazy({getter:d,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(m)});class ZodLiteral extends ZodType{_parse(m){if(m.data!==this._def.value){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{received:g.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:m.data}}get value(){return this._def.value}}function createZodEnum(d,m){return new ZodEnum({values:d,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(m)})}ZodLiteral.create=(d,m)=>new ZodLiteral({value:d,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(m)});class ZodEnum extends ZodType{constructor(){super(...arguments),_ZodEnum_cache.set(this,void 0)}_parse(m){if(typeof m.data!="string"){const g=this._getOrReturnCtx(m),w=this._def.values;return addIssueToContext(g,{expected:util$1.joinValues(w),received:g.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodEnum_cache)||__classPrivateFieldSet(this,_ZodEnum_cache,new Set(this._def.values)),!__classPrivateFieldGet(this,_ZodEnum_cache).has(m.data)){const g=this._getOrReturnCtx(m),w=this._def.values;return addIssueToContext(g,{received:g.data,code:ZodIssueCode.invalid_enum_value,options:w}),INVALID}return OK(m.data)}get options(){return this._def.values}get enum(){const m={};for(const g of this._def.values)m[g]=g;return m}get Values(){const m={};for(const g of this._def.values)m[g]=g;return m}get Enum(){const m={};for(const g of this._def.values)m[g]=g;return m}extract(m,g=this._def){return ZodEnum.create(m,{...this._def,...g})}exclude(m,g=this._def){return ZodEnum.create(this.options.filter((w=>!m.includes(w))),{...this._def,...g})}}_ZodEnum_cache=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),_ZodNativeEnum_cache.set(this,void 0)}_parse(m){const g=util$1.getValidEnumValues(this._def.values),w=this._getOrReturnCtx(m);if(w.parsedType!==ZodParsedType.string&&w.parsedType!==ZodParsedType.number){const $=util$1.objectValues(g);return addIssueToContext(w,{expected:util$1.joinValues($),received:w.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodNativeEnum_cache)||__classPrivateFieldSet(this,_ZodNativeEnum_cache,new Set(util$1.getValidEnumValues(this._def.values))),!__classPrivateFieldGet(this,_ZodNativeEnum_cache).has(m.data)){const $=util$1.objectValues(g);return addIssueToContext(w,{received:w.data,code:ZodIssueCode.invalid_enum_value,options:$}),INVALID}return OK(m.data)}get enum(){return this._def.values}}_ZodNativeEnum_cache=new WeakMap,ZodNativeEnum.create=(d,m)=>new ZodNativeEnum({values:d,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(m)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.promise&&g.common.async===!1)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:g.parsedType}),INVALID;const w=g.parsedType===ZodParsedType.promise?g.data:Promise.resolve(g.data);return OK(w.then(($=>this._def.type.parseAsync($,{path:g.path,errorMap:g.common.contextualErrorMap}))))}}ZodPromise.create=(d,m)=>new ZodPromise({type:d,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(m)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(m){const{status:g,ctx:w}=this._processInputParams(m),$=this._def.effect||null,I={addIssue:D=>{addIssueToContext(w,D),D.fatal?g.abort():g.dirty()},get path(){return w.path}};if(I.addIssue=I.addIssue.bind(I),$.type==="preprocess"){const D=$.transform(w.data,I);if(w.common.async)return Promise.resolve(D).then((async F=>{if(g.value==="aborted")return INVALID;const U=await this._def.schema._parseAsync({data:F,path:w.path,parent:w});return U.status==="aborted"?INVALID:U.status==="dirty"||g.value==="dirty"?DIRTY(U.value):U}));{if(g.value==="aborted")return INVALID;const F=this._def.schema._parseSync({data:D,path:w.path,parent:w});return F.status==="aborted"?INVALID:F.status==="dirty"||g.value==="dirty"?DIRTY(F.value):F}}if($.type==="refinement"){const D=F=>{const U=$.refinement(F,I);if(w.common.async)return Promise.resolve(U);if(U instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return F};if(w.common.async===!1){const F=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});return F.status==="aborted"?INVALID:(F.status==="dirty"&&g.dirty(),D(F.value),{status:g.value,value:F.value})}return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then((F=>F.status==="aborted"?INVALID:(F.status==="dirty"&&g.dirty(),D(F.value).then((()=>({status:g.value,value:F.value}))))))}if($.type==="transform"){if(w.common.async===!1){const D=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});if(!isValid(D))return D;const F=$.transform(D.value,I);if(F instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:g.value,value:F}}return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then((D=>isValid(D)?Promise.resolve($.transform(D.value,I)).then((F=>({status:g.value,value:F}))):D))}util$1.assertNever($)}}ZodEffects.create=(d,m,g)=>new ZodEffects({schema:d,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:m,...processCreateParams(g)}),ZodEffects.createWithPreprocess=(d,m,g)=>new ZodEffects({schema:m,effect:{type:"preprocess",transform:d},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(g)});class ZodOptional extends ZodType{_parse(m){return this._getType(m)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(m)}unwrap(){return this._def.innerType}}ZodOptional.create=(d,m)=>new ZodOptional({innerType:d,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(m)});class ZodNullable extends ZodType{_parse(m){return this._getType(m)===ZodParsedType.null?OK(null):this._def.innerType._parse(m)}unwrap(){return this._def.innerType}}ZodNullable.create=(d,m)=>new ZodNullable({innerType:d,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(m)});class ZodDefault extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m);let w=g.data;return g.parsedType===ZodParsedType.undefined&&(w=this._def.defaultValue()),this._def.innerType._parse({data:w,path:g.path,parent:g})}removeDefault(){return this._def.innerType}}ZodDefault.create=(d,m)=>new ZodDefault({innerType:d,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:typeof m.default=="function"?m.default:()=>m.default,...processCreateParams(m)});class ZodCatch extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w={...g,common:{...g.common,issues:[]}},$=this._def.innerType._parse({data:w.data,path:w.path,parent:{...w}});return isAsync($)?$.then((I=>({status:"valid",value:I.status==="valid"?I.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}))):{status:"valid",value:$.status==="valid"?$.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(d,m)=>new ZodCatch({innerType:d,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:typeof m.catch=="function"?m.catch:()=>m.catch,...processCreateParams(m)});class ZodNaN extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.nan){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:g.parsedType}),INVALID}return{status:"valid",value:m.data}}}ZodNaN.create=d=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(d)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w=g.data;return this._def.type._parse({data:w,path:g.path,parent:g})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.common.async)return(async()=>{const $=await this._def.in._parseAsync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(g.dirty(),DIRTY($.value)):this._def.out._parseAsync({data:$.value,path:w.path,parent:w})})();{const $=this._def.in._parseSync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(g.dirty(),{status:"dirty",value:$.value}):this._def.out._parseSync({data:$.value,path:w.path,parent:w})}}static create(m,g){return new ZodPipeline({in:m,out:g,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(m){const g=this._def.innerType._parse(m),w=$=>(isValid($)&&($.value=Object.freeze($.value)),$);return isAsync(g)?g.then(($=>w($))):w(g)}unwrap(){return this._def.innerType}}function custom(d,m={},g){return d?ZodAny.create().superRefine(((w,$)=>{var I,D;if(!d(w)){const F=typeof m=="function"?m(w):typeof m=="string"?{message:m}:m,U=(D=(I=F.fatal)!==null&&I!==void 0?I:g)===null||D===void 0||D,j=typeof F=="string"?{message:F}:F;$.addIssue({code:"custom",...j,fatal:U})}})):ZodAny.create()}ZodReadonly.create=(d,m)=>new ZodReadonly({innerType:d,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(m)});const late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;(function(d){d.ZodString="ZodString",d.ZodNumber="ZodNumber",d.ZodNaN="ZodNaN",d.ZodBigInt="ZodBigInt",d.ZodBoolean="ZodBoolean",d.ZodDate="ZodDate",d.ZodSymbol="ZodSymbol",d.ZodUndefined="ZodUndefined",d.ZodNull="ZodNull",d.ZodAny="ZodAny",d.ZodUnknown="ZodUnknown",d.ZodNever="ZodNever",d.ZodVoid="ZodVoid",d.ZodArray="ZodArray",d.ZodObject="ZodObject",d.ZodUnion="ZodUnion",d.ZodDiscriminatedUnion="ZodDiscriminatedUnion",d.ZodIntersection="ZodIntersection",d.ZodTuple="ZodTuple",d.ZodRecord="ZodRecord",d.ZodMap="ZodMap",d.ZodSet="ZodSet",d.ZodFunction="ZodFunction",d.ZodLazy="ZodLazy",d.ZodLiteral="ZodLiteral",d.ZodEnum="ZodEnum",d.ZodEffects="ZodEffects",d.ZodNativeEnum="ZodNativeEnum",d.ZodOptional="ZodOptional",d.ZodNullable="ZodNullable",d.ZodDefault="ZodDefault",d.ZodCatch="ZodCatch",d.ZodPromise="ZodPromise",d.ZodBranded="ZodBranded",d.ZodPipeline="ZodPipeline",d.ZodReadonly="ZodReadonly"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(d,m={message:`Input not instance of ${d.name}`})=>custom((g=>g instanceof d),m),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:d=>ZodString.create({...d,coerce:!0}),number:d=>ZodNumber.create({...d,coerce:!0}),boolean:d=>ZodBoolean.create({...d,coerce:!0}),bigint:d=>ZodBigInt.create({...d,coerce:!0}),date:d=>ZodDate.create({...d,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap,getErrorMap,makeIssue,EMPTY_PATH,addIssueToContext,ParseStatus,INVALID,DIRTY,OK,isAborted,isDirty,isValid,isAsync,get util(){return util$1},get objectUtil(){return objectUtil},ZodParsedType,getParsedType,ZodType,datetimeRegex,ZodString,ZodNumber,ZodBigInt,ZodBoolean,ZodDate,ZodSymbol,ZodUndefined,ZodNull,ZodAny,ZodUnknown,ZodNever,ZodVoid,ZodArray,ZodObject,ZodUnion,ZodDiscriminatedUnion,ZodIntersection,ZodTuple,ZodRecord,ZodMap,ZodSet,ZodFunction,ZodLazy,ZodLiteral,ZodEnum,ZodNativeEnum,ZodPromise,ZodEffects,ZodTransformer:ZodEffects,ZodOptional,ZodNullable,ZodDefault,ZodCatch,ZodNaN,BRAND,ZodBranded,ZodPipeline,ZodReadonly,custom,Schema:ZodType,ZodSchema:ZodType,late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean,onumber,optional:optionalType,ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER,ZodIssueCode,quotelessJson,ZodError}),Edge,Edge2;Edge2=Edge||(Edge={}),Edge2[Edge2.EXTEND=1]="EXTEND",Edge2[Edge2.WRAP=2]="WRAP",Edge2[Edge2.CROP=3]="CROP";const JimpClassSchema=z.object({bitmap:z.object({data:z.union([z.instanceof(Buffer),z.instanceof(Uint8Array)]),width:z.number(),height:z.number()})}),BlitOptionsSchemaComplex=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional(),srcX:z.number().optional(),srcY:z.number().optional(),srcW:z.number().optional(),srcH:z.number().optional()}),BlitOptionsSchema=z.union([JimpClassSchema,BlitOptionsSchemaComplex]),methods$h={blit(d,m){const g=BlitOptionsSchema.parse(m);let{src:w,x:$=0,y:I=0,srcX:D=0,srcY:F=0,srcW:U=w.bitmap.width,srcH:j=w.bitmap.height}="bitmap"in g?{src:g}:g;if(!("bitmap"in w))throw new Error("The source must be a Jimp image");if(typeof $!="number"||typeof I!="number")throw new Error("x and y must be numbers");$=Math.round($),I=Math.round(I),D=Math.round(D),F=Math.round(F),U=Math.round(U),j=Math.round(j);const G=d.bitmap.width,Z=d.bitmap.height;return scan(w,D,F,U,j,(function(H,q,V){const Q=$+H-D,X=I+q-F;if(Q>=0&&X>=0&&G-Q>0&&Z-X>0){const re=d.getPixelIndex(Q,X),J={r:w.bitmap.data[V]||0,g:w.bitmap.data[V+1]||0,b:w.bitmap.data[V+2]||0,a:w.bitmap.data[V+3]||0},se={r:d.bitmap.data[re]||0,g:d.bitmap.data[re+1]||0,b:d.bitmap.data[re+2]||0,a:d.bitmap.data[re+3]||0};d.bitmap.data[re]=(J.a*(J.r-se.r)-se.r+255>>8)+se.r,d.bitmap.data[re+1]=(J.a*(J.g-se.g)-se.g+255>>8)+se.g,d.bitmap.data[re+2]=(J.a*(J.b-se.b)-se.b+255>>8)+se.b,d.bitmap.data[re+3]=limit255(se.a+J.a)}})),d}},mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18],methods$g={blur(d,m){if(typeof m!="number")throw new Error("r must be a number");if(m<1)throw new Error("r must be greater than 0");let g,w,$,I,D,F,U,j,G,Z,H,q,V;const Q=d.bitmap.width-1,X=d.bitmap.height-1,re=m+1,J=mulTable[m],se=shgTable[m],ie=[],oe=[],pe=[],de=[],ge=[],ce=[];let Ie=2;for(;Ie-- >0;){for(q=0,V=0,F=0;F<d.bitmap.height;F++){for(g=d.bitmap.data[V]*re,w=d.bitmap.data[V+1]*re,$=d.bitmap.data[V+2]*re,I=d.bitmap.data[V+3]*re,U=1;U<=m;U++)j=V+((U>Q?Q:U)<<2),g+=d.bitmap.data[j++],w+=d.bitmap.data[j++],$+=d.bitmap.data[j++],I+=d.bitmap.data[j];for(D=0;D<d.bitmap.width;D++)ie[q]=g,oe[q]=w,pe[q]=$,de[q]=I,F===0&&(ge[D]=((j=D+re)<Q?j:Q)<<2,ce[D]=(j=D-m)>0?j<<2:0),G=V+ge[D],Z=V+ce[D],g+=d.bitmap.data[G++]-d.bitmap.data[Z++],w+=d.bitmap.data[G++]-d.bitmap.data[Z++],$+=d.bitmap.data[G++]-d.bitmap.data[Z++],I+=d.bitmap.data[G]-d.bitmap.data[Z++],q++;V+=d.bitmap.width<<2}for(D=0;D<d.bitmap.width;D++){for(H=D,g=ie[H]*re,w=oe[H]*re,$=pe[H]*re,I=de[H]*re,U=1;U<=m;U++)H+=U>X?0:d.bitmap.width,g+=ie[H],w+=oe[H],$+=pe[H],I+=de[H];for(q=D<<2,F=0;F<d.bitmap.height;F++)d.bitmap.data[q]=limit255(g*J>>>se),d.bitmap.data[q+1]=limit255(w*J>>>se),d.bitmap.data[q+2]=limit255($*J>>>se),d.bitmap.data[q+3]=limit255(I*J>>>se),D===0&&(ge[F]=((j=F+re)<X?j:X)*d.bitmap.width,ce[F]=(j=F-m)>0?j*d.bitmap.width:0),G=D+ge[F],Z=D+ce[F],g+=ie[G]-ie[Z],w+=oe[G]-oe[Z],$+=pe[G]-pe[Z],I+=de[G]-de[Z],q+=d.bitmap.width<<2}}return d},gaussian(d,m){if(typeof m!="number")throw new Error("r must be a number");if(m<1)throw new Error("r must be greater than 0");const g=Math.ceil(2.57*m),w=2*g+1,$=m*m*2,I=$*Math.PI,D=[];for(let F=0;F<w;F++){const U=[];for(let j=0;j<w;j++){const G=(j-g)**2+(F-g)**2;U[j]=Math.exp(-G/$)/I}D.push(U)}for(let F=0;F<d.bitmap.height;F++)for(let U=0;U<d.bitmap.width;U++){let j=0,G=0,Z=0,H=0,q=0;for(let V=0;V<w;V++){for(let X=0;X<w;X++){const re=Math.min(d.bitmap.width-1,Math.max(0,X+U-g)),J=Math.min(d.bitmap.height-1,Math.max(0,V+F-g)),se=D[V][X],ie=J*d.bitmap.width+re<<2;j+=d.bitmap.data[ie]*se,G+=d.bitmap.data[ie+1]*se,Z+=d.bitmap.data[ie+2]*se,H+=d.bitmap.data[ie+3]*se,q+=se}const Q=F*d.bitmap.width+U<<2;d.bitmap.data[Q]=Math.round(j/q),d.bitmap.data[Q+1]=Math.round(G/q),d.bitmap.data[Q+2]=Math.round(Z/q),d.bitmap.data[Q+3]=Math.round(H/q)}}return d}},CircleOptionsSchema=z.object({x:z.number().optional(),y:z.number().optional(),radius:z.number().min(0).optional()}),methods$f={circle(d,m={}){const g=CircleOptionsSchema.parse(m),w=g.radius||(d.bitmap.width>d.bitmap.height?d.bitmap.height:d.bitmap.width)/2,$=typeof g.x=="number"?g.x:d.bitmap.width/2,I=typeof g.y=="number"?g.y:d.bitmap.height/2;return d.scan(((D,F,U)=>{const j=Math.sqrt(Math.pow(D-$,2)+Math.pow(F-I,2));w-j<=0?d.bitmap.data[U+3]=0:w-j<1&&(d.bitmap.data[U+3]=255*(w-j))})),d}},ConvolutionMatrixSchema=z.array(z.number()).min(1).array(),ConvolutionComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,edgeHandling:z.nativeEnum(Edge).optional()}),ConvolutionOptionsSchema=z.union([ConvolutionMatrixSchema,ConvolutionComplexOptionsSchema]),ConvoluteComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),ConvoluteOptionsSchema=z.union([ConvolutionMatrixSchema,ConvoluteComplexOptionsSchema]),PixelateSize=z.number().min(1).max(1/0),PixelateComplexOptionsSchema=z.object({size:PixelateSize,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),PixelateOptionsSchema=z.union([PixelateSize,PixelateComplexOptionsSchema]);function applyKernel(d,m,g,w){const $=[0,0,0,0],I=(m.length-1)/2;for(let D=0;D<m.length;D+=1)for(let F=0;F<m[D].length;F+=1){const U=d.getPixelIndex(g+D-I,w+F-I);$[0]+=d.bitmap.data[U]*m[D][F],$[1]+=d.bitmap.data[U+1]*m[D][F],$[2]+=d.bitmap.data[U+2]*m[D][F],$[3]+=d.bitmap.data[U+3]*m[D][F]}return $}function mix(d,m,g=50){return{r:(m.r-d.r)*(g/100)+d.r,g:(m.g-d.g)*(g/100)+d.g,b:(m.b-d.b)*(g/100)+d.b}}const HueActionSchema=z.object({apply:z.literal("hue"),params:z.tuple([z.number().min(-360).max(360)])}),SpinActionSchema=z.object({apply:z.literal("spin"),params:z.tuple([z.number().min(-360).max(360)])}),LightenActionSchema=z.object({apply:z.literal("lighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),RGBColorSchema=z.object({r:z.number().min(0).max(255),g:z.number().min(0).max(255),b:z.number().min(0).max(255)}),MixActionSchema=z.object({apply:z.literal("mix"),params:z.union([z.tuple([RGBColorSchema]),z.tuple([RGBColorSchema,z.number().min(0).max(100)])])}),TintActionSchema=z.object({apply:z.literal("tint"),params:z.tuple([z.number().min(0).max(100)]).optional()}),ShadeActionSchema=z.object({apply:z.literal("shade"),params:z.tuple([z.number().min(0).max(100)]).optional()}),XorActionSchema=z.object({apply:z.literal("xor"),params:z.tuple([RGBColorSchema])}),RedActionSchema=z.object({apply:z.literal("red"),params:z.tuple([z.number().min(-255).max(255)])}),GreenActionSchema=z.object({apply:z.literal("green"),params:z.tuple([z.number().min(-255).max(255)])}),BlueActionSchema=z.object({apply:z.literal("blue"),params:z.tuple([z.number().min(-255).max(255)])}),BrightenActionSchema=z.object({apply:z.literal("brighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DarkenActionSchema=z.object({apply:z.literal("darken"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DesaturateActionSchema=z.object({apply:z.literal("desaturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),SaturateActionSchema=z.object({apply:z.literal("saturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),GrayscaleActionSchema=z.object({apply:z.literal("greyscale"),params:z.tuple([]).optional()}),ColorActionNameSchema=z.union([HueActionSchema,SpinActionSchema,LightenActionSchema,MixActionSchema,TintActionSchema,ShadeActionSchema,XorActionSchema,RedActionSchema,GreenActionSchema,BlueActionSchema,BrightenActionSchema,DarkenActionSchema,DesaturateActionSchema,SaturateActionSchema,GrayscaleActionSchema]);function histogram(d){const m={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return d.scan(((g,w,$)=>{m.r[d.bitmap.data[$+0]]++,m.g[d.bitmap.data[$+1]]++,m.b[d.bitmap.data[$+2]]++})),m}const normalizeValue=function(d,m,g){return 255*(d-m)/(g-m)},getBounds=function(d){return[d.findIndex((m=>m>0)),255-d.slice().reverse().findIndex((m=>m>0))]},methods$e={normalize(d){const m=histogram(d),g={r:getBounds(m.r),g:getBounds(m.g),b:getBounds(m.b)};return d.scan(((w,$,I)=>{const D=d.bitmap.data[I+0],F=d.bitmap.data[I+1],U=d.bitmap.data[I+2];d.bitmap.data[I+0]=normalizeValue(D,g.r[0],g.r[1]),d.bitmap.data[I+1]=normalizeValue(F,g.g[0],g.g[1]),d.bitmap.data[I+2]=normalizeValue(U,g.b[0],g.b[1])})),d},invert:d=>(d.scan(((m,g,w)=>{d.bitmap.data[w]=255-d.bitmap.data[w],d.bitmap.data[w+1]=255-d.bitmap.data[w+1],d.bitmap.data[w+2]=255-d.bitmap.data[w+2]})),d),brightness(d,m){if(typeof m!="number")throw new Error("val must be numbers");return d.scan(((g,w,$)=>{d.bitmap.data[$]=limit255(d.bitmap.data[$]*m),d.bitmap.data[$+1]=limit255(d.bitmap.data[$+1]*m),d.bitmap.data[$+2]=limit255(d.bitmap.data[$+2]*m)})),d},contrast(d,m){if(typeof m!="number")throw new Error("val must be numbers");if(m<-1||m>1)throw new Error("val must be a number between -1 and +1");const g=(m+1)/(1-m);function w($){return($=Math.floor(g*($-127)+127))<0?0:$>255?255:$}return d.scan((($,I,D)=>{d.bitmap.data[D]=w(d.bitmap.data[D]),d.bitmap.data[D+1]=w(d.bitmap.data[D+1]),d.bitmap.data[D+2]=w(d.bitmap.data[D+2])})),d},posterize(d,m){if(typeof m!="number")throw new Error("n must be numbers");return m<2&&(m=2),d.scan(((g,w,$)=>{const I=d.bitmap.data[$],D=d.bitmap.data[$+1],F=d.bitmap.data[$+2];d.bitmap.data[$]=Math.floor(I/255*(m-1))/(m-1)*255,d.bitmap.data[$+1]=Math.floor(D/255*(m-1))/(m-1)*255,d.bitmap.data[$+2]=Math.floor(F/255*(m-1))/(m-1)*255})),d},greyscale:d=>(d.scan(((m,g,w)=>{const $=.2126*d.bitmap.data[w]+.7152*d.bitmap.data[w+1]+.0722*d.bitmap.data[w+2];d.bitmap.data[w]=$,d.bitmap.data[w+1]=$,d.bitmap.data[w+2]=$})),d),opacity(d,m){if(typeof m!="number")throw new Error("f must be a number");if(m<0||m>1)throw new Error("f must be a number from 0 to 1");return d.scan(((g,w,$)=>{const I=d.bitmap.data[$+3]*m;d.bitmap.data[$+3]=I})),d},sepia:d=>(d.scan(((m,g,w)=>{let $=d.bitmap.data[w],I=d.bitmap.data[w+1],D=d.bitmap.data[w+2];$=.393*$+.769*I+.189*D,I=.349*$+.686*I+.168*D,D=.272*$+.534*I+.131*D,d.bitmap.data[w]=$<255?$:255,d.bitmap.data[w+1]=I<255?I:255,d.bitmap.data[w+2]=D<255?D:255})),d),fade(d,m){if(typeof m!="number")throw new Error("f must be a number");if(m<0||m>1)throw new Error("f must be a number from 0 to 1");return this.opacity(d,1-m)},convolution(d,m){const g=ConvolutionOptionsSchema.parse(m),{kernel:w,edgeHandling:$=Edge.EXTEND}="kernel"in g?g:{kernel:g,edgeHandling:void 0};if(!w[0])throw new Error("kernel must be a matrix");const I=Buffer.from(d.bitmap.data),D=w.length,F=w[0].length,U=Math.floor(D/2),j=Math.floor(F/2),G=-U,Z=-j;let H,q,V,Q,X,re,J,se,ie,oe;return d.scan(((pe,de,ge)=>{Q=0,V=0,q=0;for(let ce=G;ce<=U;ce++)for(let Ie=Z;Ie<=j;Ie++)se=pe+Ie,ie=de+ce,H=w[ce+U][Ie+j],oe=d.getPixelIndex(se,ie,$),oe===-1?(J=0,re=0,X=0):(X=d.bitmap.data[oe+0],re=d.bitmap.data[oe+1],J=d.bitmap.data[oe+2]),q+=H*X,V+=H*re,Q+=H*J;q<0&&(q=0),V<0&&(V=0),Q<0&&(Q=0),q>255&&(q=255),V>255&&(V=255),Q>255&&(Q=255),I[ge+0]=q,I[ge+1]=V,I[ge+2]=Q})),d.bitmap.data=I,d},opaque:d=>(d.scan(((m,g,w)=>{d.bitmap.data[w+3]=255})),d),pixelate(d,m){const g=PixelateOptionsSchema.parse(m),{size:w,x:$=0,y:I=0,w:D=d.bitmap.width-$,h:F=d.bitmap.height-I}=typeof g=="number"?{size:g}:g,U=[[1/16,2/16,1/16],[2/16,.25,2/16],[1/16,2/16,1/16]],j=clone(d);return scan(j,$,I,D,F,((G,Z,H)=>{G=w*Math.floor(G/w),Z=w*Math.floor(Z/w);const q=applyKernel(j,U,G,Z);d.bitmap.data[H]=q[0],d.bitmap.data[H+1]=q[1],d.bitmap.data[H+2]=q[2],d.bitmap.data[H+3]=q[3]})),d},convolute(d,m){const g=ConvoluteOptionsSchema.parse(m),{kernel:w,x:$=0,y:I=0,w:D=d.bitmap.width-$,h:F=d.bitmap.height-I}="kernel"in g?g:{kernel:g},U=clone(d);return scan(U,$,I,D,F,((j,G,Z)=>{const H=applyKernel(U,w,j,G);d.bitmap.data[Z]=limit255(H[0]),d.bitmap.data[Z+1]=limit255(H[1]),d.bitmap.data[Z+2]=limit255(H[2]),d.bitmap.data[Z+3]=limit255(H[3])})),d},color(d,m){if(!m||!Array.isArray(m))throw new Error("actions must be an array");return m.forEach((g=>ColorActionNameSchema.parse(g))),m=m.map((g=>(g.apply!=="xor"&&g.apply!=="mix"||(g.params[0]=tinycolor(g.params[0]).toRgb()),g))),d.scan(((g,w,$)=>{let I={r:d.bitmap.data[$],g:d.bitmap.data[$+1],b:d.bitmap.data[$+2]};const D=(F,U)=>limit255(I[F]+U);m.forEach((F=>{if(F.apply==="mix")I=mix(I,F.params[0],F.params[1]);else if(F.apply==="tint")I=mix(I,{r:255,g:255,b:255},F.params?.[0]);else if(F.apply==="shade")I=mix(I,{r:0,g:0,b:0},F.params?.[0]);else if(F.apply==="xor")I={r:I.r^F.params[0].r,g:I.g^F.params[0].g,b:I.b^F.params[0].b};else if(F.apply==="red")I.r=D("r",F.params[0]);else if(F.apply==="green")I.g=D("g",F.params[0]);else if(F.apply==="blue")I.b=D("b",F.params[0]);else{F.apply==="hue"&&(F.apply="spin");const U=tinycolor(I),j=U[F.apply].bind(U);if(!j)throw new Error("action "+F.apply+" not supported");I=j(...F.params||[]).toRgb()}})),d.bitmap.data[$]=I.r,d.bitmap.data[$+1]=I.g,d.bitmap.data[$+2]=I.b})),d}};var lib$1={},ieee754={read:function(d,m,g,w,$){var I,D,F=8*$-w-1,U=(1<<F)-1,j=U>>1,G=-7,Z=g?$-1:0,H=g?-1:1,q=d[m+Z];for(Z+=H,I=q&(1<<-G)-1,q>>=-G,G+=F;G>0;I=256*I+d[m+Z],Z+=H,G-=8);for(D=I&(1<<-G)-1,I>>=-G,G+=w;G>0;D=256*D+d[m+Z],Z+=H,G-=8);if(I===0)I=1-j;else{if(I===U)return D?NaN:1/0*(q?-1:1);D+=Math.pow(2,w),I-=j}return(q?-1:1)*D*Math.pow(2,I-w)},write:function(d,m,g,w,$,I){var D,F,U,j=8*I-$-1,G=(1<<j)-1,Z=G>>1,H=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=w?0:I-1,V=w?1:-1,Q=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(F=isNaN(m)?1:0,D=G):(D=Math.floor(Math.log(m)/Math.LN2),m*(U=Math.pow(2,-D))<1&&(D--,U*=2),(m+=D+Z>=1?H/U:H*Math.pow(2,1-Z))*U>=2&&(D++,U/=2),D+Z>=G?(F=0,D=G):D+Z>=1?(F=(m*U-1)*Math.pow(2,$),D+=Z):(F=m*Math.pow(2,Z-1)*Math.pow(2,$),D=0));$>=8;d[g+q]=255&F,q+=V,F/=256,$-=8);for(D=D<<$|F,j+=$;j>0;d[g+q]=255&D,q+=V,D/=256,j-=8);d[g+q-V]|=128*Q}};(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.AnsiStringType=d.StringType=d.BufferType=d.Uint8ArrayType=d.IgnoreType=d.Float80_LE=d.Float80_BE=d.Float64_LE=d.Float64_BE=d.Float32_LE=d.Float32_BE=d.Float16_LE=d.Float16_BE=d.INT64_BE=d.UINT64_BE=d.INT64_LE=d.UINT64_LE=d.INT32_LE=d.INT32_BE=d.INT24_BE=d.INT24_LE=d.INT16_LE=d.INT16_BE=d.INT8=d.UINT32_BE=d.UINT32_LE=d.UINT24_BE=d.UINT24_LE=d.UINT16_BE=d.UINT16_LE=d.UINT8=void 0;const m=ieee754;function g($){return new DataView($.buffer,$.byteOffset)}d.UINT8={len:1,get:($,I)=>g($).getUint8(I),put:($,I,D)=>(g($).setUint8(I,D),I+1)},d.UINT16_LE={len:2,get:($,I)=>g($).getUint16(I,!0),put:($,I,D)=>(g($).setUint16(I,D,!0),I+2)},d.UINT16_BE={len:2,get:($,I)=>g($).getUint16(I),put:($,I,D)=>(g($).setUint16(I,D),I+2)},d.UINT24_LE={len:3,get($,I){const D=g($);return D.getUint8(I)+(D.getUint16(I+1,!0)<<8)},put($,I,D){const F=g($);return F.setUint8(I,255&D),F.setUint16(I+1,D>>8,!0),I+3}},d.UINT24_BE={len:3,get($,I){const D=g($);return(D.getUint16(I)<<8)+D.getUint8(I+2)},put($,I,D){const F=g($);return F.setUint16(I,D>>8),F.setUint8(I+2,255&D),I+3}},d.UINT32_LE={len:4,get:($,I)=>g($).getUint32(I,!0),put:($,I,D)=>(g($).setUint32(I,D,!0),I+4)},d.UINT32_BE={len:4,get:($,I)=>g($).getUint32(I),put:($,I,D)=>(g($).setUint32(I,D),I+4)},d.INT8={len:1,get:($,I)=>g($).getInt8(I),put:($,I,D)=>(g($).setInt8(I,D),I+1)},d.INT16_BE={len:2,get:($,I)=>g($).getInt16(I),put:($,I,D)=>(g($).setInt16(I,D),I+2)},d.INT16_LE={len:2,get:($,I)=>g($).getInt16(I,!0),put:($,I,D)=>(g($).setInt16(I,D,!0),I+2)},d.INT24_LE={len:3,get($,I){const D=d.UINT24_LE.get($,I);return D>8388607?D-16777216:D},put($,I,D){const F=g($);return F.setUint8(I,255&D),F.setUint16(I+1,D>>8,!0),I+3}},d.INT24_BE={len:3,get($,I){const D=d.UINT24_BE.get($,I);return D>8388607?D-16777216:D},put($,I,D){const F=g($);return F.setUint16(I,D>>8),F.setUint8(I+2,255&D),I+3}},d.INT32_BE={len:4,get:($,I)=>g($).getInt32(I),put:($,I,D)=>(g($).setInt32(I,D),I+4)},d.INT32_LE={len:4,get:($,I)=>g($).getInt32(I,!0),put:($,I,D)=>(g($).setInt32(I,D,!0),I+4)},d.UINT64_LE={len:8,get:($,I)=>g($).getBigUint64(I,!0),put:($,I,D)=>(g($).setBigUint64(I,D,!0),I+8)},d.INT64_LE={len:8,get:($,I)=>g($).getBigInt64(I,!0),put:($,I,D)=>(g($).setBigInt64(I,D,!0),I+8)},d.UINT64_BE={len:8,get:($,I)=>g($).getBigUint64(I),put:($,I,D)=>(g($).setBigUint64(I,D),I+8)},d.INT64_BE={len:8,get:($,I)=>g($).getBigInt64(I),put:($,I,D)=>(g($).setBigInt64(I,D),I+8)},d.Float16_BE={len:2,get($,I){return m.read($,I,!1,10,this.len)},put($,I,D){return m.write($,D,I,!1,10,this.len),I+this.len}},d.Float16_LE={len:2,get($,I){return m.read($,I,!0,10,this.len)},put($,I,D){return m.write($,D,I,!0,10,this.len),I+this.len}},d.Float32_BE={len:4,get:($,I)=>g($).getFloat32(I),put:($,I,D)=>(g($).setFloat32(I,D),I+4)},d.Float32_LE={len:4,get:($,I)=>g($).getFloat32(I,!0),put:($,I,D)=>(g($).setFloat32(I,D,!0),I+4)},d.Float64_BE={len:8,get:($,I)=>g($).getFloat64(I),put:($,I,D)=>(g($).setFloat64(I,D),I+8)},d.Float64_LE={len:8,get:($,I)=>g($).getFloat64(I,!0),put:($,I,D)=>(g($).setFloat64(I,D,!0),I+8)},d.Float80_BE={len:10,get($,I){return m.read($,I,!1,63,this.len)},put($,I,D){return m.write($,D,I,!1,63,this.len),I+this.len}},d.Float80_LE={len:10,get($,I){return m.read($,I,!0,63,this.len)},put($,I,D){return m.write($,D,I,!0,63,this.len),I+this.len}},d.IgnoreType=class{constructor($){this.len=$}get($,I){}},d.Uint8ArrayType=class{constructor($){this.len=$}get($,I){return $.subarray(I,I+this.len)}},d.BufferType=class{constructor($){this.len=$}get($,I){return Buffer.from($.subarray(I,I+this.len))}},d.StringType=class{constructor($,I){this.len=$,this.encoding=I}get($,I){return Buffer.from($).toString(this.encoding,I,I+this.len)}};class w{constructor(I){this.len=I}static decode(I,D,F){let U="";for(let j=D;j<F;++j)U+=w.codePointToString(w.singleByteDecoder(I[j]));return U}static inRange(I,D,F){return D<=I&&I<=F}static codePointToString(I){return I<=65535?String.fromCharCode(I):(I-=65536,String.fromCharCode(55296+(I>>10),56320+(1023&I)))}static singleByteDecoder(I){if(w.inRange(I,0,127))return I;const D=w.windows1252[I-128];if(D===null)throw Error("invaliding encoding");return D}get(I,D=0){return w.decode(I,D,D+this.len)}}d.AnsiStringType=w,w.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib$1);var core$1={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib={},EndOfFileStream={};(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.EndOfStreamError=d.defaultMessages=void 0,d.defaultMessages="End-Of-Stream";class m extends Error{constructor(){super(d.defaultMessages)}}d.EndOfStreamError=m})(EndOfFileStream);var StreamReader={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0}),Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise(((m,g)=>{this.reject=g,this.resolve=m}))}}Deferred$1.Deferred=Deferred,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.StreamReader=d.EndOfStreamError=void 0;const m=EndOfFileStream,g=Deferred$1;var w=EndOfFileStream;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return w.EndOfStreamError}}),d.StreamReader=class{constructor($){if(this.s=$,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!$.read||!$.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",(()=>this.reject(new m.EndOfStreamError))),this.s.once("error",(I=>this.reject(I))),this.s.once("close",(()=>this.reject(new Error("Stream closed"))))}async peek($,I,D){const F=await this.read($,I,D);return this.peekQueue.push($.subarray(I,I+F)),F}async read($,I,D){if(D===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new m.EndOfStreamError;let F=D,U=0;for(;this.peekQueue.length>0&&F>0;){const j=this.peekQueue.pop();if(!j)throw new Error("peekData should be defined");const G=Math.min(j.length,F);$.set(j.subarray(0,G),I+U),U+=G,F-=G,G<j.length&&this.peekQueue.push(j.subarray(G))}for(;F>0&&!this.endOfStream;){const j=Math.min(F,1048576),G=await this.readFromStream($,I+U,j);if(U+=G,G<j)break;F-=G}return U}async readFromStream($,I,D){const F=this.s.read(D);if(F)return $.set(F,I),F.length;{const U={buffer:$,offset:I,length:D,deferred:new g.Deferred};return this.deferred=U.deferred,this.s.once("readable",(()=>{this.readDeferred(U)})),U.deferred.promise}}readDeferred($){const I=this.s.read($.length);I?($.buffer.set(I,$.offset),$.deferred.resolve(I.length),this.deferred=null):this.s.once("readable",(()=>{this.readDeferred($)}))}reject($){this.endOfStream=!0,this.deferred&&(this.deferred.reject($),this.deferred=null)}}})(StreamReader),(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.StreamReader=d.EndOfStreamError=void 0;var m=EndOfFileStream;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return m.EndOfStreamError}});var g=StreamReader;Object.defineProperty(d,"StreamReader",{enumerable:!0,get:function(){return g.StreamReader}})})(lib),Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0}),AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$2=lib;class AbstractTokenizer{constructor(m){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=m||{}}async readToken(m,g=this.position){const w=Buffer.alloc(m.len);if(await this.readBuffer(w,{position:g})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(w,0)}async peekToken(m,g=this.position){const w=Buffer.alloc(m.len);if(await this.peekBuffer(w,{position:g})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(w,0)}async readNumber(m){if(await this.readBuffer(this.numBuffer,{length:m.len})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(this.numBuffer,0)}async peekNumber(m){if(await this.peekBuffer(this.numBuffer,{length:m.len})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(this.numBuffer,0)}async ignore(m){if(this.fileInfo.size!==void 0){const g=this.fileInfo.size-this.position;if(m>g)return this.position+=g,g}return this.position+=m,m}async close(){}normalizeOptions(m,g){if(g&&g.position!==void 0&&g.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return g?{mayBeLess:g.mayBeLess===!0,offset:g.offset?g.offset:0,length:g.length?g.length:m.length-(g.offset?g.offset:0),position:g.position?g.position:this.position}:{mayBeLess:!1,offset:0,length:m.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer,Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0}),ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(m,g){super(g),this.streamReader=new peek_readable_1$1.StreamReader(m)}async getFileInfo(){return this.fileInfo}async readBuffer(m,g){const w=this.normalizeOptions(m,g),$=w.position-this.position;if($>0)return await this.ignore($),this.readBuffer(m,g);if($<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(w.length===0)return 0;const I=await this.streamReader.read(m,w.offset,w.length);if(this.position+=I,(!g||!g.mayBeLess)&&I<w.length)throw new peek_readable_1$1.EndOfStreamError;return I}async peekBuffer(m,g){const w=this.normalizeOptions(m,g);let $=0;if(w.position){const I=w.position-this.position;if(I>0){const D=new Uint8Array(w.length+I);return $=await this.peekBuffer(D,{mayBeLess:w.mayBeLess}),m.set(D.subarray(I),w.offset),$-I}if(I<0)throw new Error("Cannot peek from a negative offset in a stream")}if(w.length>0){try{$=await this.streamReader.peek(m,w.offset,w.length)}catch(I){if(g&&g.mayBeLess&&I instanceof peek_readable_1$1.EndOfStreamError)return 0;throw I}if(!w.mayBeLess&&$<w.length)throw new peek_readable_1$1.EndOfStreamError}return $}async ignore(m){const g=Math.min(maxBufferSize,m),w=new Uint8Array(g);let $=0;for(;$<m;){const I=m-$,D=await this.readBuffer(w,{length:Math.min(g,I)});if(D<0)return D;$+=D}return $}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0}),BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1=lib,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(m,g){super(g),this.uint8Array=m,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:m.length}async readBuffer(m,g){if(g&&g.position){if(g.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=g.position}const w=await this.peekBuffer(m,g);return this.position+=w,w}async peekBuffer(m,g){const w=this.normalizeOptions(m,g),$=Math.min(this.uint8Array.length-w.position,w.length);if(!w.mayBeLess&&$<w.length)throw new peek_readable_1.EndOfStreamError;return m.set(this.uint8Array.subarray(w.position,w.position+$),w.offset),$}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.fromBuffer=d.fromStream=d.EndOfStreamError=void 0;const m=ReadStreamTokenizer$1,g=BufferTokenizer$1;var w=lib;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return w.EndOfStreamError}}),d.fromStream=function($,I){return I=I||{},new m.ReadStreamTokenizer($,I)},d.fromBuffer=function($,I){return new g.BufferTokenizer($,I)}})(core$1);var util={stringToBytes:d=>[...d].map((m=>m.charCodeAt(0))),tarHeaderChecksumMatches:(d,m=0)=>{const g=parseInt(d.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(g))return!1;let w=256;for(let $=m;$<m+148;$++)w+=d[$];for(let $=m+156;$<m+512;$++)w+=d[$];return g===w},uint32SyncSafeToken:{get:(d,m)=>127&d[m+3]|d[m+2]<<7|d[m+1]<<14|d[m]<<21,len:4}},supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token=lib$1,strtok3=core$1,{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=util,supported=supported$1,minimumBytes=4100;async function fromStream(d){const m=await strtok3.fromStream(d);try{return await fromTokenizer(m)}finally{await m.close()}}async function fromBuffer(d){if(!(d instanceof Uint8Array||d instanceof ArrayBuffer||Buffer.isBuffer(d)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof d}\``);const m=d instanceof Buffer?d:Buffer.from(d);if(m&&m.length>1)return fromTokenizer(strtok3.fromBuffer(m))}function _check(d,m,g){g={offset:0,...g};for(const[w,$]of m.entries())if(g.mask){if($!==(g.mask[w]&d[w+g.offset]))return!1}else if($!==d[w+g.offset])return!1;return!0}async function fromTokenizer(d){try{return _fromTokenizer(d)}catch(m){if(!(m instanceof strtok3.EndOfStreamError))throw m}}async function _fromTokenizer(d){let m=Buffer.alloc(minimumBytes);const g=($,I)=>_check(m,$,I),w=($,I)=>g(stringToBytes($),I);if(d.fileInfo.size||(d.fileInfo.size=Number.MAX_SAFE_INTEGER),await d.peekBuffer(m,{length:12,mayBeLess:!0}),g([66,77]))return{ext:"bmp",mime:"image/bmp"};if(g([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(g([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(g([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(g([37,33]))return await d.peekBuffer(m,{length:24,mayBeLess:!0}),w("PS-Adobe-",{offset:2})&&w(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(g([31,160])||g([31,157]))return{ext:"Z",mime:"application/x-compress"};if(g([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(g([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(g([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(g([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(w("ID3")){await d.ignore(6);const $=await d.readToken(uint32SyncSafeToken);return d.position+$>d.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await d.ignore($),fromTokenizer(d))}if(w("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((m[0]===67||m[0]===70)&&g([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(g([71,73,70]))return{ext:"gif",mime:"image/gif"};if(w("FLIF"))return{ext:"flif",mime:"image/flif"};if(w("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(w("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(w("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(w("FORM"))return{ext:"aif",mime:"audio/aiff"};if(w("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(g([80,75,3,4])){try{for(;d.position+30<d.fileInfo.size;){await d.readBuffer(m,{length:30});const $={compressedSize:m.readUInt32LE(18),uncompressedSize:m.readUInt32LE(22),filenameLength:m.readUInt16LE(26),extraFieldLength:m.readUInt16LE(28)};if($.filename=await d.readToken(new Token.StringType($.filenameLength,"utf-8")),await d.ignore($.extraFieldLength),$.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if($.filename.endsWith(".rels")||$.filename.endsWith(".xml"))switch($.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}if($.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if($.filename.startsWith("3D/")&&$.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if($.filename==="mimetype"&&$.compressedSize===$.uncompressedSize)switch(await d.readToken(new Token.StringType($.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}if($.compressedSize===0){let I=-1;for(;I<0&&d.position<d.fileInfo.size;)await d.peekBuffer(m,{mayBeLess:!0}),I=m.indexOf("504B0304",0,"hex"),await d.ignore(I>=0?I:m.length)}else await d.ignore($.compressedSize)}}catch($){if(!($ instanceof strtok3.EndOfStreamError))throw $}return{ext:"zip",mime:"application/zip"}}if(w("OggS")){await d.ignore(28);const $=Buffer.alloc(8);return await d.readBuffer($),_check($,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check($,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check($,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check($,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check($,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check($,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(g([80,75])&&(m[2]===3||m[2]===5||m[2]===7)&&(m[3]===4||m[3]===6||m[3]===8))return{ext:"zip",mime:"application/zip"};if(w("ftyp",{offset:4})&&96&m[8]){const $=m.toString("binary",8,12).replace("\0"," ").trim();switch($){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return $.startsWith("3g")?$.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(w("MThd"))return{ext:"mid",mime:"audio/midi"};if(w("wOFF")&&(g([0,1,0,0],{offset:4})||w("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(w("wOF2")&&(g([0,1,0,0],{offset:4})||w("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(g([212,195,178,161])||g([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(w("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(w("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(w("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(g([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(w("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(w("%PDF")){await d.ignore(1350);const $=10485760,I=Buffer.alloc(Math.min($,d.fileInfo.size));return await d.readBuffer(I,{mayBeLess:!0}),I.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(g([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(g([73,73,42,0]))return w("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:g([28,0,254,0],{offset:8})||g([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:g([8,0,0,0],{offset:4})&&(g([45,0,254,0],{offset:8})||g([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(m=Buffer.alloc(24),await d.peekBuffer(m),(g([16,251,134,1],{offset:4})||g([8,0,0,0],{offset:4}))&&g([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(g([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(w("MAC "))return{ext:"ape",mime:"audio/ape"};if(g([26,69,223,163])){async function $(){const U=await d.peekNumber(Token.UINT8);let j=128,G=0;for(;!(U&j)&&j!==0;)++G,j>>=1;const Z=Buffer.alloc(G+1);return await d.readBuffer(Z),Z}async function I(){const U=await $(),j=await $();j[0]^=128>>j.length-1;const G=Math.min(6,j.length);return{id:U.readUIntBE(0,U.length),len:j.readUIntBE(j.length-G,G)}}async function D(U,j){for(;j>0;){const G=await I();if(G.id===17026)return d.readToken(new Token.StringType(G.len,"utf-8"));await d.ignore(G.len),--j}}const F=await I();switch(await D(0,F.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(g([82,73,70,70])){if(g([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(g([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(g([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(w("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(g([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(w("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(w("MSCF")||w("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(g([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(g([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(g([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(g([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(w("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(w("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(g([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(w("IMPM"))return{ext:"it",mime:"audio/x-it"};if(w("-lh0-",{offset:2})||w("-lh1-",{offset:2})||w("-lh2-",{offset:2})||w("-lh3-",{offset:2})||w("-lh4-",{offset:2})||w("-lh5-",{offset:2})||w("-lh6-",{offset:2})||w("-lh7-",{offset:2})||w("-lzs-",{offset:2})||w("-lz4-",{offset:2})||w("-lz5-",{offset:2})||w("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(g([0,0,1,186])){if(g([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(g([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(w("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(g([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(w("<?xml "))return{ext:"xml",mime:"application/xml"};if(g([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(g([82,97,114,33,26,7])&&(m[6]===0||m[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(w("solid "))return{ext:"stl",mime:"model/stl"};if(w("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(w("!<arch>"))return await d.ignore(8),await d.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(g([137,80,78,71,13,10,26,10])){async function $(){return{length:await d.readToken(Token.INT32_BE),type:await d.readToken(new Token.StringType(4,"binary"))}}await d.ignore(8);do{const I=await $();if(I.length<0)return;switch(I.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await d.ignore(I.length+4)}}while(d.position+8<d.fileInfo.size);return{ext:"png",mime:"image/png"}}if(g([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(g([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(g([102,114,101,101],{offset:4})||g([109,100,97,116],{offset:4})||g([109,111,111,118],{offset:4})||g([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(g([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(w("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(g([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(g([48,38,178,117,142,102,207,17,166,217])){async function $(){const I=Buffer.alloc(16);return await d.readBuffer(I),{id:I,size:Number(await d.readToken(Token.UINT64_LE))}}for(await d.ignore(30);d.position+24<d.fileInfo.size;){const I=await $();let D=I.size-24;if(_check(I.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const F=Buffer.alloc(16);if(D-=await d.readBuffer(F),_check(F,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(F,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await d.ignore(D)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(g([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((g([126,16,4])||g([126,24,4]))&&g([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(g([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(g([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await d.ignore(20),await d.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(g([255,10])||g([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(g([0,0,1,186])||g([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(g([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(g([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(g([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(g([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await d.peekBuffer(m,{length:Math.min(256,d.fileInfo.size),mayBeLess:!0}),w("BEGIN:")){if(w("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(w("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(w("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(w("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(w("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(g([4,0,0,0])&&m.length>=16){const $=m.readUInt32LE(12);if($>12&&m.length>=$+16)try{const I=m.slice(16,$+16).toString();if(JSON.parse(I).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(g([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(w("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(g([71],{offset:4})&&(g([71],{offset:192})||g([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(g([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(g([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(g([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(g([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(g([76,80],{offset:34})&&(g([0,0,1],{offset:8})||g([1,0,2],{offset:8})||g([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(g([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await d.peekBuffer(m,{length:Math.min(512,d.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(m))return{ext:"tar",mime:"application/x-tar"};if(g([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(w("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(m.length>=2&&g([255,224],{offset:0,mask:[255,224]})){if(g([16],{offset:1,mask:[22]}))return g([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(g([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(g([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(g([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise(((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",(async()=>{const d=new stream.PassThrough;let m;m=stream.pipeline?stream.pipeline(readableStream,d,(()=>{})):readableStream.pipe(d);const g=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const w=await fromBuffer(g);d.fileType=w}catch(w){reject(w)}resolve(m)}))})),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get:()=>new Set(supported.extensions)}),Object.defineProperty(fileType,"mimeTypes",{get:()=>new Set(supported.mimeTypes)});var core=fileType,fileType$1=getDefaultExportFromCjs(core);function to(d,m){return d.then((function(g){return[null,g]})).catch((function(g){return[g,void 0]}))}const writeFile=async()=>{throw new Error("Not supported")};function Mime$1(){this._types=Object.create(null),this._extensions=Object.create(null);for(let d=0;d<arguments.length;d++)this.define(arguments[d]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Mime$1.prototype.define=function(d,m){for(let g in d){let w=d[g].map((function($){return $.toLowerCase()}));g=g.toLowerCase();for(let $=0;$<w.length;$++){const I=w[$];if(I[0]!=="*"){if(!m&&I in this._types)throw new Error('Attempt to change mapping for "'+I+'" extension from "'+this._types[I]+'" to "'+g+'". Pass `force=true` to allow this, otherwise remove "'+I+'" from the list of extensions for "'+g+'".');this._types[I]=g}}if(m||!this._extensions[g]){const $=w[0];this._extensions[g]=$[0]!=="*"?$:$.substr(1)}}},Mime$1.prototype.getType=function(d){let m=(d=String(d)).replace(/^.*[/\\]/,"").toLowerCase(),g=m.replace(/^.*\./,"").toLowerCase(),w=m.length<d.length;return(g.length<m.length-1||!w)&&this._types[g]||null},Mime$1.prototype.getExtension=function(d){return(d=/^\s*([^;\s]*)/.test(d)&&RegExp.$1)&&this._extensions[d.toLowerCase()]||null};var Mime_1=Mime$1,standard={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let Mime=Mime_1;var lite=new Mime(standard),mime=getDefaultExportFromCjs(lite),HorizontalAlign,HorizontalAlign2,VerticalAlign,VerticalAlign2,BlendMode,BlendMode2;function srcOver(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a;return{r:(d.r*d.a+m.r*m.a*(1-d.a))/w,g:(d.g*d.a+m.g*m.a*(1-d.a))/w,b:(d.b*d.a+m.b*m.a*(1-d.a))/w,a:w}}function dstOver(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a;return{r:(m.r*m.a+d.r*d.a*(1-m.a))/w,g:(m.g*m.a+d.g*d.a*(1-m.a))/w,b:(m.b*m.a+d.b*d.a*(1-m.a))/w,a:w}}function multiply(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:($*F+$*(1-m.a)+F*(1-d.a))/w,g:(I*U+I*(1-m.a)+U*(1-d.a))/w,b:(D*j+D*(1-m.a)+j*(1-d.a))/w,a:w}}function add(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a;return{r:($+m.r*m.a)/w,g:(I+m.g*m.a)/w,b:(D+m.b*m.a)/w,a:w}}function screen(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:($*m.a+F*d.a-$*F+$*(1-m.a)+F*(1-d.a))/w,g:(I*m.a+U*d.a-I*U+I*(1-m.a)+U*(1-d.a))/w,b:(D*m.a+j*d.a-D*j+D*(1-m.a)+j*(1-d.a))/w,a:w}}function overlay(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:(2*F<=m.a?2*$*F+$*(1-m.a)+F*(1-d.a):$*(1+m.a)+F*(1+d.a)-2*F*$-m.a*d.a)/w,g:(2*U<=m.a?2*I*U+I*(1-m.a)+U*(1-d.a):I*(1+m.a)+U*(1+d.a)-2*U*I-m.a*d.a)/w,b:(2*j<=m.a?2*D*j+D*(1-m.a)+j*(1-d.a):D*(1+m.a)+j*(1+d.a)-2*j*D-m.a*d.a)/w,a:w}}function darken(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:(Math.min($*m.a,F*d.a)+$*(1-m.a)+F*(1-d.a))/w,g:(Math.min(I*m.a,U*d.a)+I*(1-m.a)+U*(1-d.a))/w,b:(Math.min(D*m.a,j*d.a)+D*(1-m.a)+j*(1-d.a))/w,a:w}}function lighten(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:(Math.max($*m.a,F*d.a)+$*(1-m.a)+F*(1-d.a))/w,g:(Math.max(I*m.a,U*d.a)+I*(1-m.a)+U*(1-d.a))/w,b:(Math.max(D*m.a,j*d.a)+D*(1-m.a)+j*(1-d.a))/w,a:w}}function hardLight(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:(2*$<=d.a?2*$*F+$*(1-m.a)+F*(1-d.a):$*(1+m.a)+F*(1+d.a)-2*F*$-m.a*d.a)/w,g:(2*I<=d.a?2*I*U+I*(1-m.a)+U*(1-d.a):I*(1+m.a)+U*(1+d.a)-2*U*I-m.a*d.a)/w,b:(2*D<=d.a?2*D*j+D*(1-m.a)+j*(1-d.a):D*(1+m.a)+j*(1+d.a)-2*j*D-m.a*d.a)/w,a:w}}function difference(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:($+F-2*Math.min($*m.a,F*d.a))/w,g:(I+U-2*Math.min(I*m.a,U*d.a))/w,b:(D+j-2*Math.min(D*m.a,j*d.a))/w,a:w}}function exclusion(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,j=m.b*m.a;return{r:($*m.a+F*d.a-2*$*F+$*(1-m.a)+F*(1-d.a))/w,g:(I*m.a+U*d.a-2*I*U+I*(1-m.a)+U*(1-d.a))/w,b:(D*m.a+j*d.a-2*D*j+D*(1-m.a)+j*(1-d.a))/w,a:w}}HorizontalAlign2=HorizontalAlign||(HorizontalAlign={}),HorizontalAlign2[HorizontalAlign2.LEFT=1]="LEFT",HorizontalAlign2[HorizontalAlign2.CENTER=2]="CENTER",HorizontalAlign2[HorizontalAlign2.RIGHT=4]="RIGHT",VerticalAlign2=VerticalAlign||(VerticalAlign={}),VerticalAlign2[VerticalAlign2.TOP=8]="TOP",VerticalAlign2[VerticalAlign2.MIDDLE=16]="MIDDLE",VerticalAlign2[VerticalAlign2.BOTTOM=32]="BOTTOM",BlendMode2=BlendMode||(BlendMode={}),BlendMode2.SRC_OVER="srcOver",BlendMode2.DST_OVER="dstOver",BlendMode2.MULTIPLY="multiply",BlendMode2.ADD="add",BlendMode2.SCREEN="screen",BlendMode2.OVERLAY="overlay",BlendMode2.DARKEN="darken",BlendMode2.LIGHTEN="lighten",BlendMode2.HARD_LIGHT="hardLight",BlendMode2.DIFFERENCE="difference",BlendMode2.EXCLUSION="exclusion";const names=[srcOver,dstOver,multiply,add,screen,overlay,darken,lighten,hardLight,difference,exclusion];var compositeModes=Object.freeze({__proto__:null,add,darken,difference,dstOver,exclusion,hardLight,lighten,multiply,names,overlay,screen,srcOver});function composite(d,m,g=0,w=0,$={}){if(!(m instanceof d.constructor))throw new Error("The source must be a Jimp image");if(typeof g!="number"||typeof w!="number")throw new Error("x and y must be numbers");const{mode:I=BlendMode.SRC_OVER}=$;let{opacitySource:D=1,opacityDest:F=1}=$;(typeof D!="number"||D<0||D>1)&&(D=1),(typeof F!="number"||F<0||F>1)&&(F=1);const U=compositeModes[I];return g=Math.round(g),w=Math.round(w),F!==1&&d.scan(((j,G,Z)=>{const H=d.bitmap.data[Z+3]*F;d.bitmap.data[Z+3]=H})),m.scan(((j,G,Z)=>{const H=d.getPixelIndex(g+j,w+G,Edge.CROP);if(H===-1)return;const q=U({r:m.bitmap.data[Z+0]/255,g:m.bitmap.data[Z+1]/255,b:m.bitmap.data[Z+2]/255,a:m.bitmap.data[Z+3]/255},{r:d.bitmap.data[H+0]/255,g:d.bitmap.data[H+1]/255,b:d.bitmap.data[H+2]/255,a:d.bitmap.data[H+3]/255},D);d.bitmap.data[H+0]=limit255(255*q.r),d.bitmap.data[H+1]=limit255(255*q.g),d.bitmap.data[H+2]=limit255(255*q.b),d.bitmap.data[H+3]=limit255(255*q.a)})),d}var jpeg$1={parseSections:function(d,m){var g,w;for(d.setBigEndian(!0);d.remainingLength()>0&&w!==218;){if(d.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");g=(w=d.nextUInt8())>=208&&w<=217||w===218?0:d.nextUInt16()-2,m(w,d.branch(0,g)),d.skip(g)}},getSizeFromSOFSection:function(d){return d.skip(1),{height:d.nextUInt16(),width:d.nextUInt16()}},getSectionName:function(d){var m,g;switch(d){case 216:m="SOI";break;case 196:m="DHT";break;case 219:m="DQT";break;case 221:m="DRI";break;case 218:m="SOS";break;case 254:m="COM";break;case 217:m="EOI";break;default:d>=224&&d<=239?(m="APP",g=d-224):d>=192&&d<=207&&d!==196&&d!==200&&d!==204?(m="SOF",g=d-192):d>=208&&d<=215&&(m="RST",g=d-208)}var w={name:m};return typeof g=="number"&&(w.index=g),w}};function readExifValue(d,m){switch(d){case 1:return m.nextUInt8();case 3:case 8:return m.nextUInt16();case 4:case 9:return m.nextUInt32();case 5:return[m.nextUInt32(),m.nextUInt32()];case 6:return m.nextInt8();case 10:return[m.nextInt32(),m.nextInt32()];case 11:return m.nextFloat();case 12:return m.nextDouble();default:throw new Error("Invalid format while decoding: "+d)}}function getBytesPerComponent(d){switch(d){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function readExifTag(d,m){var g,w,$=m.nextUInt16(),I=m.nextUInt16(),D=getBytesPerComponent(I),F=m.nextUInt32(),U=D*F;if(U>4&&(m=d.openWithOffset(m.nextUInt32())),I===2){var j=(g=m.nextString(F)).indexOf("\0");j!==-1&&(g=g.substr(0,j))}else if(I===7)g=m.nextBuffer(F);else if(I!==0)for(g=[],w=0;w<F;++w)g.push(readExifValue(I,m));return U<4&&m.skip(4-U),[$,g,I]}function readIFDSection(d,m,g){var w,$,I=m.nextUInt16();for($=0;$<I;++$)g((w=readExifTag(d,m))[0],w[1],w[2])}function readHeader(d){if(d.nextString(6)!=="Exif\0\0")throw new Error("Invalid EXIF header");var m=d.mark(),g=d.nextUInt16();if(g===18761)d.setBigEndian(!1);else{if(g!==19789)throw new Error("Invalid TIFF header");d.setBigEndian(!0)}if(d.nextUInt16()!==42)throw new Error("Invalid TIFF data");return m}var exif$2={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(d,m){var g,w,$,I;try{g=readHeader(d)}catch{return!1}var D=g.openWithOffset(d.nextUInt32()),F=this.IFD0;readIFDSection(g,D,(function(V,Q,X){switch(V){case 34853:$=Q[0];break;case 34665:w=Q[0];break;default:m(F,V,Q,X)}}));var U=D.nextUInt32();if(U!==0){var j=g.openWithOffset(U);readIFDSection(g,j,m.bind(null,this.IFD1))}if($){var G=g.openWithOffset($);readIFDSection(g,G,m.bind(null,this.GPSIFD))}if(w){var Z=g.openWithOffset(w),H=this.InteropIFD;readIFDSection(g,Z,(function(V,Q,X){V===40965?I=Q[0]:m(H,V,Q,X)}))}if(I){var q=g.openWithOffset(I);readIFDSection(g,q,m.bind(null,this.InteropIFD))}return!0}};function parseNumber(d){return parseInt(d,10)}var hours=3600,minutes=60;function parseDateTimeParts(d,m){d=d.map(parseNumber),m=m.map(parseNumber);var g=d[0],w=d[1]-1,$=d[2],I=m[0],D=m[1],F=m[2];return Date.UTC(g,w,$,I,D,F,0)/1e3}function parseDateWithTimezoneFormat(d){var m=d.substr(0,10).split("-"),g=d.substr(11,8).split(":"),w=d.substr(19,6).split(":").map(parseNumber),$=w[0]*hours+w[1]*minutes,I=parseDateTimeParts(m,g);if(typeof(I-=$)=="number"&&!isNaN(I))return I}function parseDateWithSpecFormat(d){var m=d.split(" "),g=parseDateTimeParts(m[0].split(":"),m[1].split(":"));if(typeof g=="number"&&!isNaN(g))return g}function parseExifDate(d){var m=d.length===19&&d.charAt(4)===":";return d.length===25&&d.charAt(10)==="T"?parseDateWithTimezoneFormat(d):m?parseDateWithSpecFormat(d):void 0}var date$1={parseDateWithSpecFormat,parseDateWithTimezoneFormat,parseExifDate},exif$1=exif$2,date=date$1,degreeTags=[{section:exif$1.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:exif$1.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],dateTags=[{section:exif$1.SubIFD,type:306,name:"ModifyDate"},{section:exif$1.SubIFD,type:36867,name:"DateTimeOriginal"},{section:exif$1.SubIFD,type:36868,name:"CreateDate"},{section:exif$1.SubIFD,type:306,name:"ModifyDate"}],simplify$1={castDegreeValues:function(d,m){degreeTags.forEach((function(g){var w=d(g);if(w){var $=d({section:g.section,type:g.refType,name:g.refName})===g.posVal?1:-1,I=(w[0]+w[1]/60+w[2]/3600)*$;m(g,I)}}))},castDateValues:function(d,m){dateTags.forEach((function(g){var w=d(g);if(w){var $=date.parseExifDate(w);$!==void 0&&m(g,$)}}))},simplifyValue:function(d,m){return Array.isArray(d)&&(d=d.map((function(g){return m===10||m===5?g[0]/g[1]:g}))).length===1&&(d=d[0]),d}},exifTags,hasRequiredExifTags;function requireExifTags(){return hasRequiredExifTags?exifTags:(hasRequiredExifTags=1,exifTags={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}})}var jpeg=jpeg$1,exif=exif$2,simplify=simplify$1;function ExifResult(d,m,g,w,$,I,D){this.startMarker=d,this.tags=m,this.imageSize=g,this.thumbnailOffset=w,this.thumbnailLength=$,this.thumbnailType=I,this.app1Offset=D}function Parser$1(d){this.stream=d,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ExifResult.prototype={hasThumbnail:function(d){return!(!this.thumbnailOffset||!this.thumbnailLength)&&(typeof d!="string"||(d.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:d.toLowerCase().trim()==="image/tiff"&&this.thumbnailType===1))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var d,m=this._getThumbnailStream();return jpeg.parseSections(m,(function(g,w){jpeg.getSectionName(g).name==="SOF"&&(d=jpeg.getSizeFromSOFSection(w))})),d}},Parser$1.prototype={enableBinaryFields:function(d){return this.flags.readBinaryTags=!!d,this},enablePointers:function(d){return this.flags.hidePointers=!d,this},enableTagNames:function(d){return this.flags.resolveTagNames=!!d,this},enableImageSize:function(d){return this.flags.imageSize=!!d,this},enableReturnTags:function(d){return this.flags.returnTags=!!d,this},enableSimpleValues:function(d){return this.flags.simplifyValues=!!d,this},parse:function(){var d,m,g,w,$,I,D,F,U,j=this.stream.mark(),G=j.openWithOffset(0),Z=this.flags;return Z.resolveTagNames&&(D=requireExifTags()),Z.resolveTagNames?(d={},F=function(H){return d[H.name]},U=function(H,q){d[H.name]=q}):(d=[],F=function(H){var q;for(q=0;q<d.length;++q)if(d[q].type===H.type&&d[q].section===H.section)return d.value},U=function(H,q){var V;for(V=0;V<d.length;++V)if(d[V].type===H.type&&d[V].section===H.section)return void(d.value=q)}),jpeg.parseSections(G,(function(H,q){var V=q.offsetFrom(j);H===225?exif.parseTags(q,(function(Q,X,re,J){if(Z.readBinaryTags||J!==7){if(X===513){if(g=re[0],Z.hidePointers)return}else if(X===514){if(w=re[0],Z.hidePointers)return}else if(X===259&&($=re[0],Z.hidePointers))return;if(Z.returnTags)if(Z.simplifyValues&&(re=simplify.simplifyValue(re,J)),Z.resolveTagNames){var se=(Q===exif.GPSIFD?D.gps:D.exif)[X];se||(se=D.exif[X]),d.hasOwnProperty(se)||(d[se]=re)}else d.push({section:Q,type:X,value:re})}}))&&(I=V):Z.imageSize&&jpeg.getSectionName(H).name==="SOF"&&(m=jpeg.getSizeFromSOFSection(q))})),Z.simplifyValues&&(simplify.castDegreeValues(F,U),simplify.castDateValues(F,U)),new ExifResult(j,d,m,g,w,$,I)}};var parser=Parser$1,domBufferstream,hasRequiredDomBufferstream,bufferstream,hasRequiredBufferstream;function requireDomBufferstream(){if(hasRequiredDomBufferstream)return domBufferstream;function d(m,g,w,$,I,D){this.global=I,g=g||0,w=w||m.byteLength-g,this.arrayBuffer=m.slice(g,g+w),this.view=new I.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian($),this.offset=0,this.parentOffset=(D||0)+g}return hasRequiredDomBufferstream=1,d.prototype={setBigEndian:function(m){this.littleEndian=!m},nextUInt8:function(){var m=this.view.getUint8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.view.getInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,m},nextUInt32:function(){var m=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,m},nextInt16:function(){var m=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,m},nextInt32:function(){var m=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,m},nextFloat:function(){var m=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,m},nextDouble:function(){var m=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,m},nextBuffer:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return g=String.fromCharCode.apply(null,new this.global.Uint8Array(g)),this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.arrayBuffer,g,m.arrayBuffer.byteLength-g,!m.littleEndian,m.global,m.parentOffset)},offset:this.offset,getParentOffset:function(){return m.parentOffset}}},offsetFrom:function(m){return this.parentOffset+this.offset-(m.offset+m.getParentOffset())},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.arrayBuffer.byteLength-(this.offset+m),new d(this.arrayBuffer,this.offset+m,g,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream=d}function requireBufferstream(){if(hasRequiredBufferstream)return bufferstream;function d(m,g,w,$){this.buffer=m,this.offset=g||0,w=typeof w=="number"?w:m.length,this.endPosition=this.offset+w,this.setBigEndian($)}return hasRequiredBufferstream=1,d.prototype={setBigEndian:function(m){this.bigEndian=!!m},nextUInt8:function(){var m=this.buffer.readUInt8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.buffer.readInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,m},nextUInt32:function(){var m=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,m},nextInt16:function(){var m=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,m},nextInt32:function(){var m=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,m},nextFloat:function(){var m=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,m},nextDouble:function(){var m=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,m},nextBuffer:function(m){var g=this.buffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.endPosition-this.offset},nextString:function(m){var g=this.buffer.toString("utf8",this.offset,this.offset+m);return this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.buffer,g,m.endPosition-g,m.bigEndian)},offset:this.offset}},offsetFrom:function(m){return this.offset-m.offset},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.endPosition-(this.offset+m),new d(this.buffer,this.offset+m,g,this.bigEndian)}},bufferstream=d}var Parser=parser;function getGlobal(){return(0,eval)("this")}var exifParser={create:function(d,m){if(d instanceof(m=m||getGlobal()).ArrayBuffer){var g=requireDomBufferstream();return new Parser(new g(d,0,d.byteLength,!0,m))}var w=requireBufferstream();return new Parser(new w(d,0,d.length,!0))}},EXIFParser=getDefaultExportFromCjs(exifParser);function getExifOrientation(d){const m=d._exif;return m&&m.tags&&m.tags.Orientation||1}function getExifOrientationTransformation(d){const m=d.bitmap.width,g=d.bitmap.height;switch(getExifOrientation(d)){case 1:default:return null;case 2:return function(w,$){return[m-w-1,$]};case 3:return function(w,$){return[m-w-1,g-$-1]};case 4:return function(w,$){return[w,g-$-1]};case 5:return function(w,$){return[$,w]};case 6:return function(w,$){return[$,g-w-1]};case 7:return function(w,$){return[m-$-1,g-w-1]};case 8:return function(w,$){return[m-$-1,w]}}}function transformBitmap(d,m,g,w){const $=d.bitmap.data,I=d.bitmap.width,D=Buffer.alloc($.length);for(let F=0;F<m;F++)for(let U=0;U<g;U++){const[j,G]=w(F,U),Z=m*U+F<<2,H=I*G+j<<2,q=$.readUInt32BE(H);D.writeUInt32BE(q,Z)}d.bitmap.data=D,d.bitmap.width=m,d.bitmap.height=g,d._exif.tags.Orientation=1}function exifRotate(d){if(getExifOrientation(d)<2)return;const m=getExifOrientationTransformation(d),g=getExifOrientation(d)>4,w=g?d.bitmap.height:d.bitmap.width,$=g?d.bitmap.width:d.bitmap.height;m&&transformBitmap(d,w,$,m)}async function attemptExifRotate(d,m){try{d._exif=EXIFParser.create(m).parse(),exifRotate(d)}catch{}}var __defProp$2=Object.defineProperty,__defNormalProp$2=(d,m,g)=>m in d?__defProp$2(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__publicField$2=(d,m,g)=>__defNormalProp$2(d,typeof m!="symbol"?m+"":m,g);const emptyBitmap={data:Buffer.alloc(0),width:0,height:0};function bufferFromArrayBuffer(d){const m=Buffer.alloc(d.byteLength),g=new Uint8Array(d);for(let w=0;w<m.length;++w)m[w]=g[w];return m}function createJimp({plugins:d,formats:m}={}){const g=d||[],w=(m||[]).map((I=>I())),$=class{constructor(I=emptyBitmap){if(__publicField$2(this,"bitmap",emptyBitmap),__publicField$2(this,"background",0),__publicField$2(this,"formats",[]),__publicField$2(this,"mime"),this.formats=w,"data"in I)this.bitmap=I;else if(this.bitmap={data:Buffer.alloc(I.width*I.height*4),width:I.width,height:I.height},I.color){this.background=typeof I.color=="string"?cssColorToHex(I.color):I.color;for(let D=0;D<this.bitmap.data.length;D+=4)this.bitmap.data.writeUInt32BE(this.background,D)}for(const D of g)for(const F in D)this[F]=(...U)=>{const j=D[F]?.(this,...U);return typeof j=="object"&&"bitmap"in j?(this.bitmap=j.bitmap,this):j}}static async read(I,D){if(Buffer.isBuffer(I)||I instanceof ArrayBuffer)return this.fromBuffer(I);const[F,U]=await to(fetch(I));if(F)throw new Error(`Could not load Buffer from URL: ${I}`);if(!U.ok)throw new Error(`HTTP Status ${U.status} for url ${I}`);const[j,G]=await to(U.arrayBuffer());if(j)throw new Error(`Could not load Buffer from ${I}`);const Z=bufferFromArrayBuffer(G);return this.fromBuffer(Z,D)}static fromBitmap(I){let D;if(I.data instanceof Buffer&&(D=Buffer.from(I.data)),(I.data instanceof Uint8Array||I.data instanceof Uint8ClampedArray)&&(D=Buffer.from(I.data.buffer)),Array.isArray(I.data)&&(D=Buffer.concat(I.data.map((F=>Buffer.from(F.toString(16).padStart(8,"0"),"hex"))))),!D)throw new Error("data must be a Buffer");if(typeof I.height!="number"||typeof I.width!="number")throw new Error("bitmap must have width and height");return new $({height:I.height,width:I.width,data:D})}static async fromBuffer(I,D){const F=I instanceof ArrayBuffer?bufferFromArrayBuffer(I):I,U=await fileType$1.fromBuffer(F);if(!U||!U.mime)throw new Error("Could not find MIME for Buffer");const j=w.find((Z=>Z.mime===U.mime));if(!j||!j.decode)throw new Error(`Mime type ${U.mime} does not support decoding`);const G=new $(await j.decode(F,D?.[j.mime]));return G.mime=U.mime,attemptExifRotate(G,F),G}inspect(){return"<Jimp "+(this.bitmap===emptyBitmap?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}toString(){return"[object Jimp]"}get width(){return this.bitmap.width}get height(){return this.bitmap.height}async getBuffer(I,D){const F=this.formats.find((j=>j.mime===I));if(!F||!F.encode)throw new Error(`Unsupported MIME type: ${I}`);let U;return F.hasAlpha?U=this:(U=new $({width:this.bitmap.width,height:this.bitmap.height,color:this.background}),composite(U,this)),F.encode(U.bitmap,D)}async getBase64(I,D){return"data:"+I+";base64,"+(await this.getBuffer(I,D)).toString("base64")}async write(I,D){const F=mime.getType(I);await writeFile(I,await this.getBuffer(F,D))}clone(){return new $({...this.bitmap,data:Buffer.from(this.bitmap.data)})}getPixelIndex(I,D,F){let U,j;if(F||(F=Edge.EXTEND),typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");U=I=Math.round(I),j=D=Math.round(D),F===Edge.EXTEND&&(I<0&&(U=0),I>=this.bitmap.width&&(U=this.bitmap.width-1),D<0&&(j=0),D>=this.bitmap.height&&(j=this.bitmap.height-1)),F===Edge.WRAP&&(I<0&&(U=this.bitmap.width+I),I>=this.bitmap.width&&(U=I%this.bitmap.width),D<0&&(j=this.bitmap.height+D),D>=this.bitmap.height&&(j=D%this.bitmap.height));let G=this.bitmap.width*j+U<<2;return(U<0||U>=this.bitmap.width)&&(G=-1),(j<0||j>=this.bitmap.height)&&(G=-1),G}getPixelColor(I,D){if(typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");const F=this.getPixelIndex(I,D);return this.bitmap.data.readUInt32BE(F)}setPixelColor(I,D,F){if(typeof I!="number"||typeof D!="number"||typeof F!="number")throw new Error("hex, x and y must be numbers");const U=this.getPixelIndex(D,F);return this.bitmap.data.writeUInt32BE(I,U),this}hasAlpha(){const{width:I,height:D,data:F}=this.bitmap,U=I*D<<2;for(let j=3;j<U;j+=4)if(F[j]!==255)return!0;return!1}composite(I,D=0,F=0,U={}){return composite(this,I,D,F,U)}scan(I,D,F,U,j){return scan(this,I,D,F,U,j)}scanIterator(I=0,D=0,F=this.bitmap.width,U=this.bitmap.height){if(typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");if(typeof F!="number"||typeof U!="number")throw new Error("w and h must be numbers");return scanIterator(this,I,D,F,U)}};return $}var ResizeStrategy,ResizeStrategy2;function Resize(d,m,g,w,$,I,D){this.widthOriginal=Math.abs(Math.floor(d)||0),this.heightOriginal=Math.abs(Math.floor(m)||0),this.targetWidth=Math.abs(Math.floor(g)||0),this.targetHeight=Math.abs(Math.floor(w)||0),this.colorChannels=$?4:3,this.interpolationPass=!!I,this.resizeCallback=typeof D=="function"?D:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}ResizeStrategy2=ResizeStrategy||(ResizeStrategy={}),ResizeStrategy2.NEAREST_NEIGHBOR="nearestNeighbor",ResizeStrategy2.BILINEAR="bilinearInterpolation",ResizeStrategy2.BICUBIC="bicubicInterpolation",ResizeStrategy2.HERMITE="hermiteInterpolation",ResizeStrategy2.BEZIER="bezierInterpolation",Resize.prototype.initialize=function(){if(!(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0))throw console.log(this),new Error("Invalid settings specified for the resizer.");this.configurePasses()},Resize.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=this.colorChannels===4?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=this.colorChannels===4?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=this.colorChannels===4?this.resizeHeightRGBA:this.resizeHeightRGB))},Resize.prototype._resizeWidthInterpolatedRGBChannels=function(d,m){const g=m?4:3,w=this.ratioWeightWidthPass,$=this.widthBuffer;let I,D,F=0,U=0,j=0,G=0,Z=0;for(I=0;F<1/3;I+=g,F+=w)for(U=I,j=0;U<this.widthPassResultSize;j+=this.originalWidthMultipliedByChannels,U+=this.targetWidthMultipliedByChannels)$[U]=d[j],$[U+1]=d[j+1],$[U+2]=d[j+2],m&&($[U+3]=d[j+3]);for(F-=1/3,D=this.widthOriginal-1;F<D;I+=g,F+=w)for(Z=F%1,G=1-Z,U=I,j=Math.floor(F)*g;U<this.widthPassResultSize;j+=this.originalWidthMultipliedByChannels,U+=this.targetWidthMultipliedByChannels)$[U+0]=d[j+0]*G+d[j+g+0]*Z,$[U+1]=d[j+1]*G+d[j+g+1]*Z,$[U+2]=d[j+2]*G+d[j+g+2]*Z,m&&($[U+3]=d[j+3]*G+d[j+g+3]*Z);for(D=this.originalWidthMultipliedByChannels-g;I<this.targetWidthMultipliedByChannels;I+=g)for(U=I,j=D;U<this.widthPassResultSize;j+=this.originalWidthMultipliedByChannels,U+=this.targetWidthMultipliedByChannels)$[U]=d[j],$[U+1]=d[j+1],$[U+2]=d[j+2],m&&($[U+3]=d[j+3]);return $},Resize.prototype._resizeWidthRGBChannels=function(d,m){const g=m?4:3,w=this.ratioWeightWidthPass,$=1/w,I=this.originalWidthMultipliedByChannels-g+1,D=this.targetWidthMultipliedByChannels-g+1,F=this.outputWidthWorkBench,U=this.widthBuffer,j=this.outputWidthWorkBenchOpaquePixelsCount;let G=0,Z=0,H=0,q=0,V=0,Q=0,X=0,re=1,J=0,se=0,ie=0,oe=0;do{for(V=0;V<this.originalHeightMultipliedByChannels;)F[V++]=0,F[V++]=0,F[V++]=0,m&&(F[V++]=0,j[V/g-1]=0);G=w;do{for(Z=1+H-q,re=Math.min(G,Z),V=0,Q=H;V<this.originalHeightMultipliedByChannels;Q+=I)J=d[Q],se=d[++Q],ie=d[++Q],oe=m?d[++Q]:255,F[V++]+=(oe?J:0)*re,F[V++]+=(oe?se:0)*re,F[V++]+=(oe?ie:0)*re,m&&(F[V++]+=oe*re,j[V/g-1]+=oe?re:0);if(!(G>=Z)){q+=G;break}H+=g,q=H,G-=Z}while(G>0&&H<this.originalWidthMultipliedByChannels);for(V=0,Q=X;V<this.originalHeightMultipliedByChannels;Q+=D)G=m?j[V/g]:1,re=m?G?1/G:0:$,U[Q]=F[V++]*re,U[++Q]=F[V++]*re,U[++Q]=F[V++]*re,m&&(U[++Q]=F[V++]*$);X+=g}while(X<this.targetWidthMultipliedByChannels);return U},Resize.prototype._resizeHeightRGBChannels=function(d,m){const g=this.ratioWeightHeightPass,w=1/g,$=this.outputHeightWorkBench,I=this.heightBuffer,D=this.outputHeightWorkBenchOpaquePixelsCount;let F=0,U=0,j=0,G=0,Z=0,H=0,q=0,V=1,Q=0,X=0,re=0,J=0;do{for(Z=0;Z<this.targetWidthMultipliedByChannels;)$[Z++]=0,$[Z++]=0,$[Z++]=0,m&&($[Z++]=0,D[Z/4-1]=0);F=g;do{for(U=1+j-G,V=Math.min(F,U),q=j,Z=0;Z<this.targetWidthMultipliedByChannels;)Q=d[q++],X=d[q++],re=d[q++],J=m?d[q++]:255,$[Z++]+=(J?Q:0)*V,$[Z++]+=(J?X:0)*V,$[Z++]+=(J?re:0)*V,m&&($[Z++]+=J*V,D[Z/4-1]+=J?V:0);if(!(F>=U)){G+=F;break}j=q,G=j,F-=U}while(F>0&&j<this.widthPassResultSize);for(Z=0;Z<this.targetWidthMultipliedByChannels;)F=m?D[Z/4]:1,V=m?F?1/F:0:w,I[H++]=Math.round($[Z++]*V),I[H++]=Math.round($[Z++]*V),I[H++]=Math.round($[Z++]*V),m&&(I[H++]=Math.round($[Z++]*w))}while(H<this.finalResultSize);return I},Resize.prototype.resizeWidthInterpolatedRGB=function(d){return this._resizeWidthInterpolatedRGBChannels(d,!1)},Resize.prototype.resizeWidthInterpolatedRGBA=function(d){return this._resizeWidthInterpolatedRGBChannels(d,!0)},Resize.prototype.resizeWidthRGB=function(d){return this._resizeWidthRGBChannels(d,!1)},Resize.prototype.resizeWidthRGBA=function(d){return this._resizeWidthRGBChannels(d,!0)},Resize.prototype.resizeHeightInterpolated=function(d){const m=this.ratioWeightHeightPass,g=this.heightBuffer;let w,$=0,I=0,D=0,F=0,U=0,j=0,G=0;for(;$<1/3;$+=m)for(D=0;D<this.targetWidthMultipliedByChannels;)g[I++]=Math.round(d[D++]);for($-=1/3,w=this.heightOriginal-1;$<w;$+=m)for(G=$%1,j=1-G,F=Math.floor($)*this.targetWidthMultipliedByChannels,U=F+this.targetWidthMultipliedByChannels,D=0;D<this.targetWidthMultipliedByChannels;++D)g[I++]=Math.round(d[F++]*j+d[U++]*G);for(;I<this.finalResultSize;)for(D=0,F=w*this.targetWidthMultipliedByChannels;D<this.targetWidthMultipliedByChannels;++D)g[I++]=Math.round(d[F++]);return g},Resize.prototype.resizeHeightRGB=function(d){return this._resizeHeightRGBChannels(d,!1)},Resize.prototype.resizeHeightRGBA=function(d){return this._resizeHeightRGBChannels(d,!0)},Resize.prototype.resize=function(d){this.resizeCallback(this.resizeHeight(this.resizeWidth(d)))},Resize.prototype.bypassResizer=function(d){return d},Resize.prototype.initializeFirstPassBuffers=function(d){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),d||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},Resize.prototype.initializeSecondPassBuffers=function(d){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),d||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},Resize.prototype.generateFloatBuffer=function(d){try{return new Float32Array(d)}catch(m){return console.error(m),[]}},Resize.prototype.generateFloat64Buffer=function(d){try{return new Float64Array(d)}catch(m){return console.error(m),[]}},Resize.prototype.generateUint8Buffer=function(d){try{return new Uint8Array(d)}catch(m){return console.error(m),[]}};const operations={nearestNeighbor(d,m){const g=d.width,w=d.height,$=m.width,I=m.height,D=d.data,F=m.data;for(let U=0;U<I;U++)for(let j=0;j<$;j++){let G=4*(U*$+j),Z=4*(Math.floor(U*w/I)*g+Math.floor(j*g/$));F[G++]=D[Z++],F[G++]=D[Z++],F[G++]=D[Z++],F[G++]=D[Z++]}},bilinearInterpolation(d,m){const g=d.width,w=d.height,$=m.width,I=m.height,D=d.data,F=m.data,U=function(G,Z,H,q,V){return Z===q?H:Math.round((G-Z)*V+(q-G)*H)},j=function(G,Z,H,q,V,Q,X,re){let J=4*(X*g+q)+Z,se=4*(X*g+V)+Z;const ie=U(H,q,D[J],V,D[se]);if(re===X)F[G+Z]=ie;else{J=4*(re*g+q)+Z,se=4*(re*g+V)+Z;const oe=U(H,q,D[J],V,D[se]);F[G+Z]=U(Q,X,ie,re,oe)}};for(let G=0;G<I;G++)for(let Z=0;Z<$;Z++){const H=4*(G*$+Z),q=Z*g/$,V=Math.floor(q),Q=Math.min(Math.ceil(q),g-1),X=G*w/I,re=Math.floor(X),J=Math.min(Math.ceil(X),w-1);j(H,0,q,V,Q,X,re,J),j(H,1,q,V,Q,X,re,J),j(H,2,q,V,Q,X,re,J),j(H,3,q,V,Q,X,re,J)}},_interpolate2D(d,m,g,w){const $=d.data,I=m.data,D=d.width,F=d.height,U=m.width,j=m.height,G=Math.max(1,Math.floor(D/U)),Z=U*G,H=Math.max(1,Math.floor(F/j)),q=j*H,V=Buffer.alloc(Z*F*4);for(let re=0;re<F;re++)for(let J=0;J<Z;J++){const se=J*(D-1)/Z,ie=Math.floor(se),oe=se-ie,pe=4*(re*D+ie),de=4*(re*Z+J);for(let ge=0;ge<4;ge++){const ce=pe+ge,Ie=ie>0?$[ce-4]:2*$[ce]-$[ce+4],fe=$[ce],Te=$[ce+4],ut=ie<D-2?$[ce+8]:2*$[ce+4]-$[ce];V[de+ge]=w(Ie,fe,Te,ut,oe)}}const Q=Buffer.alloc(Z*q*4);for(let re=0;re<q;re++)for(let J=0;J<Z;J++){const se=re*(F-1)/q,ie=Math.floor(se),oe=se-ie,pe=4*(ie*Z+J),de=4*(re*Z+J);for(let ge=0;ge<4;ge++){const ce=pe+ge,Ie=ie>0?V[ce-4*Z]:2*V[ce]-V[ce+4*Z],fe=V[ce],Te=V[ce+4*Z],ut=ie<F-2?V[ce+8*Z]:2*V[ce+4*Z]-V[ce];Q[de+ge]=w(Ie,fe,Te,ut,oe)}}const X=G*H;if(X>1)for(let re=0;re<j;re++)for(let J=0;J<U;J++){let se=0,ie=0,oe=0,pe=0,de=0;for(let ce=0;ce<H;ce++){const Ie=re*H+ce;for(let fe=0;fe<G;fe++){const Te=4*(Ie*Z+(J*G+fe)),ut=Q[Te+3];ut&&(se+=Q[Te],ie+=Q[Te+1],oe+=Q[Te+2],de++),pe+=ut}}const ge=4*(re*U+J);I[ge]=de?Math.round(se/de):0,I[ge+1]=de?Math.round(ie/de):0,I[ge+2]=de?Math.round(oe/de):0,I[ge+3]=Math.round(pe/X)}else m.data=Q},bicubicInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,F){const U=D-I-w+$,j=w-$-U,G=I-w,Z=$;return Math.max(0,Math.min(255,U*(F*F*F)+j*(F*F)+G*F+Z))}))},hermiteInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,F){const U=$,j=.5*(I-w),G=w-2.5*$+2*I-.5*D,Z=.5*(D-w)+1.5*($-I);return Math.max(0,Math.min(255,Math.round(((Z*F+G)*F+j)*F+U)))}))},bezierInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,F){const U=1-F,j=$*U*U*U,G=3*($+(I-w)/4)*U*U*F,Z=3*(I-(D-$)/4)*U*F*F,H=I*F*F*F;return Math.max(0,Math.min(255,Math.round(j+G+Z+H)))}))}},ResizeOptionsSchema=z.union([z.object({w:z.number().min(0),h:z.number().min(0).optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),z.object({w:z.number().min(0).optional(),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()})]),ScaleToFitOptionsSchema=z.object({w:z.number().min(0),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),ScaleComplexOptionsSchema=z.object({f:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$d={resize(d,m){const{mode:g}=ResizeOptionsSchema.parse(m);let w,$;if(typeof m.w=="number")w=m.w,$=m.h??d.bitmap.height*(w/d.bitmap.width);else{if(typeof m.h!="number")throw new Error("w must be a number");$=m.h,w=m.w??d.bitmap.width*($/d.bitmap.height)}if(w=Math.round(w)||1,$=Math.round($)||1,g&&typeof operations[g]=="function"){const I={data:Buffer.alloc(w*$*4),width:w,height:$};operations[g](d.bitmap,I),d.bitmap=I}else new Resize(d.bitmap.width,d.bitmap.height,w,$,!0,!0,(I=>{d.bitmap.data=Buffer.from(I),d.bitmap.width=w,d.bitmap.height=$})).resize(d.bitmap.data);return d},scale(d,m){const{f:g,mode:w}=typeof m=="number"?{f:m}:ScaleComplexOptionsSchema.parse(m),$=d.bitmap.width*g,I=d.bitmap.height*g;return this.resize(d,{w:$,h:I,mode:w})},scaleToFit(d,m){const{h:g,w,mode:$}=ScaleToFitOptionsSchema.parse(m),I=w/g>d.bitmap.width/d.bitmap.height?g/d.bitmap.height:w/d.bitmap.width;return this.scale(d,{f:I,mode:$})}},ContainOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$c={contain(d,m){const{w:g,h:w,align:$=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:I}=ContainOptionsSchema.parse(m),D=7&$,F=$>>3;if((D===0||D&D-1)&&(F===0||F&F-1))throw new Error("only use one flag per alignment direction");const U=D>>1,j=F>>1,G=g/w>d.bitmap.width/d.bitmap.height?w/d.bitmap.height:g/d.bitmap.width,Z=methods$d.scale(clone(d),{f:G,mode:I});return(d=methods$d.resize(d,{w:g,h:w,mode:I})).scan(((H,q,V)=>{d.bitmap.data.writeUInt32BE(d.background,V)})),d=methods$h.blit(d,{src:Z,x:(d.bitmap.width-Z.bitmap.width)/2*U,y:(d.bitmap.height-Z.bitmap.height)/2*j})}},CropOptionsSchema=z.object({x:z.number(),y:z.number(),w:z.number(),h:z.number()}),AutocropComplexOptionsSchema=z.object({tolerance:z.number().min(0).max(1).optional(),cropOnlyFrames:z.boolean().optional(),cropSymmetric:z.boolean().optional(),leaveBorder:z.number().optional(),ignoreSides:z.object({north:z.boolean().optional(),south:z.boolean().optional(),east:z.boolean().optional(),west:z.boolean().optional()}).optional()}),methods$b={crop(d,m){let{x:g,y:w,w:$,h:I}=CropOptionsSchema.parse(m);if(g=Math.round(g),w=Math.round(w),$=Math.round($),I=Math.round(I),g===0&&$===d.bitmap.width){const D=$*w+g<<2,F=D+(I*$<<2);d.bitmap.data=d.bitmap.data.slice(D,F)}else{const D=Buffer.allocUnsafe($*I*4);let F=0;scan(d,g,w,$,I,(function(U,j,G){const Z=d.bitmap.data.readUInt32BE(G);D.writeUInt32BE(Z,F),F+=4})),d.bitmap.data=D}return d.bitmap.width=$,d.bitmap.height=I,d},autocrop(d,m={}){const{tolerance:g=2e-4,cropOnlyFrames:w=!0,cropSymmetric:$=!1,leaveBorder:I=0,ignoreSides:D}=typeof m=="number"?{tolerance:m}:AutocropComplexOptionsSchema.parse(m),F=d.bitmap.width,U=d.bitmap.height,j={north:!1,south:!1,east:!1,west:!1,...D};let G=d.getPixelColor(0,0);const Z=intToRGBA$1(G);let H=0,q=0,V=0,Q=0;if(G=d.getPixelColor(0,0),!j.north)e:for(let se=0;se<U-1;se++){for(let ie=0;ie<F;ie++)if(colorDiff(Z,intToRGBA$1(d.getPixelColor(ie,se)))>g)break e;H++}if(G=d.getPixelColor(F,0),!j.west)e:for(let se=0;se<F-1;se++){for(let ie=0+H;ie<U;ie++)if(colorDiff(Z,intToRGBA$1(d.getPixelColor(se,ie)))>g)break e;Q++}if(G=d.getPixelColor(0,U),!j.south)e:for(let se=U-1;se>=H+1;se--){for(let ie=F-q-1;ie>=0;ie--)if(colorDiff(Z,intToRGBA$1(d.getPixelColor(ie,se)))>g)break e;V++}if(G=d.getPixelColor(F,U),!j.east)e:for(let se=F-1;se>=0+Q+1;se--){for(let ie=U-1;ie>=0+H;ie--)if(colorDiff(Z,intToRGBA$1(d.getPixelColor(se,ie)))>g)break e;q++}let X=!1;if(Q-=I,q-=I,H-=I,V-=I,$){const se=Math.min(q,Q),ie=Math.min(H,V);Q=se,q=se,H=ie,V=ie}Q=Q>=0?Q:0,q=q>=0?q:0,H=H>=0?H:0,V=V>=0?V:0;const re=F-(Q+q),J=U-(V+H);return X=w?q!==0&&H!==0&&Q!==0&&V!==0:q!==0||H!==0||Q!==0||V!==0,X&&this.crop(d,{x:Q,y:H,w:re,h:J}),d}},CoverOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$a={cover(d,m){const{w:g,h:w,align:$=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:I}=CoverOptionsSchema.parse(m),D=7&$,F=$>>3;if((D===0||D&D-1)&&(F===0||F&F-1))throw new Error("only use one flag per alignment direction");const U=D>>1,j=F>>1,G=g/w>d.bitmap.width/d.bitmap.height?g/d.bitmap.width:w/d.bitmap.height;return d=methods$d.scale(d,{f:G,mode:I}),d=methods$b.crop(d,{x:(d.bitmap.width-g)/2*U,y:(d.bitmap.height-w)/2*j,w:g,h:w})}},DisplaceOptionsSchema=z.object({map:JimpClassSchema,offset:z.number()}),methods$9={displace(d,m){const{map:g,offset:w}=DisplaceOptionsSchema.parse(m),$=clone(d);return d.scan(((I,D,F)=>{let U=g.bitmap.data[F]/256*w;U=Math.round(U);const j=d.getPixelIndex(I+U,D);d.bitmap.data[j]=$.bitmap.data[F],d.bitmap.data[j+1]=$.bitmap.data[F+1],d.bitmap.data[j+2]=$.bitmap.data[F+2]})),d}},methods$8={dither(d){const m=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return d.scan(((g,w,$)=>{const I=m[((3&w)<<2)+g%4];d.bitmap.data[$]=Math.min(d.bitmap.data[$]+I,255),d.bitmap.data[$+1]=Math.min(d.bitmap.data[$+1]+I,255),d.bitmap.data[$+2]=Math.min(d.bitmap.data[$+2]+I,255)})),d}},FisheyeOptionsSchema=z.object({radius:z.number().min(0).optional()}),methods$7={fisheye(d,m={}){const{radius:g=2.5}=FisheyeOptionsSchema.parse(m),w=clone(d),{width:$,height:I}=w.bitmap;return w.scan(((D,F)=>{const U=D/$,j=F/I,G=Math.sqrt(Math.pow(U-.5,2)+Math.pow(j-.5,2)),Z=2*Math.pow(G,g),H=(U-.5)/G,q=(j-.5)/G,V=Math.round((Z*H+.5)*$),Q=Math.round((Z*q+.5)*I),X=w.getPixelColor(V,Q);d.setPixelColor(X,D,F)})),d.setPixelColor(w.getPixelColor($/2,I/2),$/2,I/2),d}},FlipOptionsSchema=z.object({horizontal:z.boolean().optional(),vertical:z.boolean().optional()}),methods$6={flip(d,m){const{horizontal:g,vertical:w}=FlipOptionsSchema.parse(m),$=Buffer.alloc(d.bitmap.data.length);return d.scan(((I,D,F)=>{const U=g?d.bitmap.width-1-I:I,j=w?d.bitmap.height-1-D:D,G=d.bitmap.width*j+U<<2,Z=d.bitmap.data.readUInt32BE(F);$.writeUInt32BE(Z,G)})),d.bitmap.data=Buffer.from($),d}};function Converter$1(d,m){if(!(d&&m&&d.length&&m.length))throw new Error("Bad alphabet");this.srcAlphabet=d,this.dstAlphabet=m}Converter$1.prototype.convert=function(d){var m,g,w,$={},I=this.srcAlphabet.length,D=this.dstAlphabet.length,F=d.length,U=typeof d=="string"?"":[];if(!this.isValid(d))throw new Error('Number "'+d+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return d;for(m=0;m<F;m++)$[m]=this.srcAlphabet.indexOf(d[m]);do{for(g=0,w=0,m=0;m<F;m++)(g=g*I+$[m])>=D?($[w++]=parseInt(g/D,10),g%=D):w>0&&($[w++]=0);F=w,U=this.dstAlphabet.slice(g,g+1).concat(U)}while(w!==0);return U},Converter$1.prototype.isValid=function(d){for(var m=0;m<d.length;++m)if(this.srcAlphabet.indexOf(d[m])===-1)return!1;return!0};var converter=Converter$1,Converter=converter;function anyBase(d,m){var g=new Converter(d,m);return function(w){return g.convert(w)}}anyBase.BIN="01",anyBase.OCT="01234567",anyBase.DEC="0123456789",anyBase.HEX="0123456789abcdef";var anyBase_1=anyBase,anyBase$1=getDefaultExportFromCjs(anyBase_1),__defProp$1=Object.defineProperty,__defNormalProp$1=(d,m,g)=>m in d?__defProp$1(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__publicField$1=(d,m,g)=>__defNormalProp$1(d,typeof m!="symbol"?m+"":m,g);class ImagePHash{constructor(m,g){__publicField$1(this,"size"),__publicField$1(this,"smallerSize"),this.size=m||32,this.smallerSize=g||8,initCoefficients(this.size)}distance(m,g){let w=0;for(let $=0;$<m.length;$++)m[$]!==g[$]&&w++;return w/m.length}getHash(m){m=methods$d.resize(clone(m),{w:this.size,h:this.size}),m=methods$e.greyscale(m);const g=[];for(let F=0;F<m.bitmap.width;F++){const U=[];for(let j=0;j<m.bitmap.height;j++)U[j]=intToRGBA(m.getPixelColor(F,j)).b;g[F]=U}const w=applyDCT(g,this.size);let $=0;for(let F=0;F<this.smallerSize;F++)for(let U=0;U<this.smallerSize;U++)$+=w[F][U];const I=$/(this.smallerSize*this.smallerSize);let D="";for(let F=0;F<this.smallerSize;F++)for(let U=0;U<this.smallerSize;U++)D+=w[F][U]>I?"1":"0";return D}}function intToRGBA(d){const m=255&d,g=255&(d>>>=8),w=255&(d>>>=8);return{r:255&(d>>>=8),g:w,b:g,a:m}}const c$1=[];function initCoefficients(d){for(let m=1;m<d;m++)c$1[m]=1;c$1[0]=1/Math.sqrt(2)}function applyDCT(d,m){const g=m,w=[];for(let $=0;$<g;$++){const I=[];for(let D=0;D<g;D++){let F=0;for(let U=0;U<g;U++)for(let j=0;j<g;j++)F+=Math.cos((2*U+1)/(2*g)*$*Math.PI)*Math.cos((2*j+1)/(2*g)*D*Math.PI)*d[U][j];F*=c$1[$]*c$1[D]/4,I[D]=F,w[$]=I}}return w}const alphabet="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",maxHashLength=[NaN,NaN];for(let d=2;d<65;d++){const m=anyBase$1(anyBase$1.BIN,alphabet.slice(0,d))(new Array(65).join("1"));maxHashLength.push(m.length)}const methods$5={pHash:d=>new ImagePHash().getHash(d),hash(d,m=64){if(m<2||m>64)throw new Error("base must be a number between 2 and 64");const g=alphabet.slice(0,m),w=this.pHash(d),$=maxHashLength[m];return anyBase$1(anyBase$1.BIN,g)(w).padStart($,"0")},distanceFromHash(d,m){const g=new ImagePHash,w=g.getHash(d);return g.distance(w,m)}},MaskOptionsObjectSchema=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional()}),MaskOptionsSchema=z.union([JimpClassSchema,MaskOptionsObjectSchema]),methods$4={mask(d,m){let g,w,$;MaskOptionsSchema.parse(m),"bitmap"in m?(g=m,w=0,$=0):(g=m.src,w=m.x??0,$=m.y??0),w=Math.round(w),$=Math.round($);const I=d.bitmap.width,D=d.bitmap.height;return g.scan((function(F,U,j){const G=w+F,Z=$+U;if(G>=0&&Z>=0&&G<I&&Z<D){const H=d.getPixelIndex(G,Z),{data:q}=g.bitmap,V=(q[j+0]+q[j+1]+q[j+2])/3;d.bitmap.data[H+3]*=V/255}})),d}};function measureText(d,m){let g=0;for(let w=0;w<m.length;w++){const $=m[w],I=d.chars[$];if(I){const D=d.kernings[$],F=m[w+1],U=D&&F&&D[F]&&D[F]||0;g+=(I.xadvance||0)+U}}return g}function splitLines(d,m,g){const w=m.replace(/[\r\n]+/g,` 
`).split(" "),$=[];let I=[],D=0;return w.forEach((F=>{if(measureText(d,F+(w.length>1?" ":""))>g){const G=F[Symbol.iterator]();let Z="";for(const H of G){const q=[...I,Z+H].join(" "),V=measureText(d,q);V<g?Z+=H:V>g?($.push([...I,Z]),I=[],Z=H):($.push([...I,Z+H]),I=[],Z="")}return}const U=[...I,F].join(" "),j=measureText(d,U);j<=g&&!F.includes(`
`)?(j>D&&(D=j),I.push(F)):($.push(I),I=[F.replace(`
`,"")])})),$.push(I),{lines:$,longestLine:D}}function measureTextHeight(d,m,g){const{lines:w}=splitLines(d,m,g);return w.length*d.common.lineHeight}const PrintOptionsSchema=z.object({x:z.number(),y:z.number(),text:z.union([z.union([z.string(),z.number()]),z.object({text:z.union([z.string(),z.number()]),alignmentX:z.nativeEnum(HorizontalAlign).optional(),alignmentY:z.nativeEnum(VerticalAlign).optional()})]),maxWidth:z.number().optional(),maxHeight:z.number().optional(),cb:z.function(z.tuple([z.object({x:z.number(),y:z.number()})])).optional()});function xOffsetBasedOnAlignment(d,m,g,w){return w===HorizontalAlign.LEFT?0:w===HorizontalAlign.CENTER?(g-measureText(d,m))/2:g-measureText(d,m)}function drawCharacter(d,m,g,w,$){if($.width>0&&$.height>0){const I=m.pages[$.page];I&&(d=methods$h.blit(d,{src:I,x:g+$.xoffset,y:w+$.yoffset,srcX:$.x,srcY:$.y,srcW:$.width,srcH:$.height}))}return d}function printText(d,m,g,w,$,I){for(let D=0;D<$.length;D++){const F=$[D];let U;U=m.chars[F]?F:/\s/.test(F)?"":"?";const j=m.chars[U]||{xadvance:void 0},G=m.kernings[U];j&&drawCharacter(d,m,g,w,j);const Z=$[D+1];g+=(G&&Z&&G[Z]&&G[Z]||0)+(j.xadvance||I)}}const methods$3={print(d,{font:m,...g}){let w,$,{x:I,y:D,text:F,maxWidth:U=1/0,maxHeight:j=1/0,cb:G=(()=>{})}=PrintOptionsSchema.parse(g);typeof F=="object"&&F.text!==null&&F.text!==void 0?(w=F.alignmentX||HorizontalAlign.LEFT,$=F.alignmentY||VerticalAlign.TOP,{text:F}=F):(w=HorizontalAlign.LEFT,$=VerticalAlign.TOP,F=F.toString()),typeof F=="number"&&(F=F.toString()),j!==1/0&&$===VerticalAlign.BOTTOM?D+=j-measureTextHeight(m,F,U):j!==1/0&&$===VerticalAlign.MIDDLE&&(D+=j/2-measureTextHeight(m,F,U)/2);const Z=Object.entries(m.chars).find((V=>V[1].xadvance))?.[1].xadvance;if(typeof Z!="number")throw new Error("Could not find default character width");const{lines:H,longestLine:q}=splitLines(m,F,U);return H.forEach((V=>{const Q=V.join(" "),X=xOffsetBasedOnAlignment(m,Q,U,w);printText(d,m,I+X,D,Q,Z),D+=m.common.lineHeight})),G.bind(d)({x:I+q,y:D}),d}},RotateOptionsSchema=z.union([z.number(),z.object({deg:z.number(),mode:z.union([z.boolean(),z.nativeEnum(ResizeStrategy)]).optional()})]);function createIdxTranslationFunction(d){return function(m,g){return g*d+m<<2}}function matrixRotate(d,m){if(Math.abs(m)%90!=0)throw new Error("Unsupported matrix rotation degree");const g=d.bitmap.width,w=d.bitmap.height;let $;switch(m){case 90:case-270:$=90;break;case 180:case-180:$=180;break;case 270:case-90:$=-90;break;default:throw new Error("Unsupported matrix rotation degree")}const I=$===180?g:w,D=$===180?w:g,F=Buffer.alloc(d.bitmap.data.length),U=createIdxTranslationFunction(g),j=createIdxTranslationFunction(I);for(let G=0;G<g;G++)for(let Z=0;Z<w;Z++){const H=U(G,Z),q=d.bitmap.data.readUInt32BE(H);let V;switch($){case 90:V=j(Z,g-G-1);break;case-90:V=j(w-Z-1,G);break;case 180:V=j(g-G-1,w-Z-1);break;default:throw new Error("Unsupported matrix rotation angle")}F.writeUInt32BE(q,V)}d.bitmap.data=F,d.bitmap.width=I,d.bitmap.height=D}function createTranslationFunction(d,m){return function(g,w){return{x:g+d,y:w+m}}}function advancedRotate(d,m,g){const w=m*Math.PI/180,$=Math.cos(w),I=Math.sin(w);let D=d.bitmap.width,F=d.bitmap.height;if(g===!0||typeof g=="string"){D=Math.ceil(Math.abs(d.bitmap.width*$)+Math.abs(d.bitmap.height*I))+1,F=Math.ceil(Math.abs(d.bitmap.width*I)+Math.abs(d.bitmap.height*$))+1,D%2!=0&&D++,F%2!=0&&F++;const q=clone(d);d.scan(((Q,X,re)=>{d.bitmap.data.writeUInt32BE(d.background,re)}));const V=Math.max(D,F,d.bitmap.width,d.bitmap.height);d=composite(d=methods$d.resize(d,{h:V,w:V,mode:g===!0?void 0:g}),q,d.bitmap.width/2-q.bitmap.width/2,d.bitmap.height/2-q.bitmap.height/2)}const U=d.bitmap.width,j=d.bitmap.height,G=Buffer.alloc(d.bitmap.data.length),Z=createTranslationFunction(-U/2,-j/2),H=createTranslationFunction(U/2+.5,j/2+.5);for(let q=1;q<=j;q++)for(let V=1;V<=U;V++){const Q=Z(V,q),X=H($*Q.x-I*Q.y,$*Q.y+I*Q.x),re=U*(q-1)+V-1<<2;if(X.x>=0&&X.x<U&&X.y>=0&&X.y<j){const J=U*(0|X.y)+X.x<<2,se=d.bitmap.data.readUInt32BE(J);G.writeUInt32BE(se,re)}else G.writeUInt32BE(d.background,re)}if(d.bitmap.data=G,g===!0||typeof g=="string"){const q=Math.max(U/2-D/2,0),V=Math.max(j/2-F/2,0);d=methods$b.crop(d,{x:q,y:V,w:D,h:F})}}const methods$2={rotate(d,m){const g=RotateOptionsSchema.parse(m),w=typeof g=="number"?{deg:g}:g,{mode:$=!0}=w;let{deg:I}=w;return I%=360,I%360==0||(I%90==0&&($||d.bitmap.width===d.bitmap.height||I%180==0)?matrixRotate(d,I):advancedRotate(d,I,$)),d}},ThresholdOptionsSchema=z.object({max:z.number().min(0).max(255),replace:z.number().min(0).max(255).optional(),autoGreyscale:z.boolean().optional()}),methods$1={threshold(d,m){let{max:g,replace:w=255,autoGreyscale:$=!0}=ThresholdOptionsSchema.parse(m);return g=limit255(g),w=limit255(w),$&&methods$e.greyscale(d),d.scan(((I,D,F)=>{const U=d.bitmap.data[F]<g?d.bitmap.data[F]:w;d.bitmap.data[F]=U,d.bitmap.data[F+1]=U,d.bitmap.data[F+2]=U})),d}};var __defProp=Object.defineProperty,__defNormalProp=(d,m,g)=>m in d?__defProp(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__export=(d,m)=>{for(var g in m)__defProp(d,g,{get:m[g],enumerable:!0})},__publicField=(d,m,g)=>(__defNormalProp(d,typeof m!="symbol"?m+"":m,g),g),constants_exports={};__export(constants_exports,{bt709:()=>bt709_exports});var bt709_exports={};__export(bt709_exports,{Y:()=>Y,x:()=>x$1,y:()=>y$1});var Y=(d=>(d[d.RED=.2126]="RED",d[d.GREEN=.7152]="GREEN",d[d.BLUE=.0722]="BLUE",d[d.WHITE=1]="WHITE",d))(Y||{}),x$1=(d=>(d[d.RED=.64]="RED",d[d.GREEN=.3]="GREEN",d[d.BLUE=.15]="BLUE",d[d.WHITE=.3127]="WHITE",d))(x$1||{}),y$1=(d=>(d[d.RED=.33]="RED",d[d.GREEN=.6]="GREEN",d[d.BLUE=.06]="BLUE",d[d.WHITE=.329]="WHITE",d))(y$1||{}),conversion_exports={};function correctGamma(d){return d>.04045?((d+.055)/1.055)**2.4:d/12.92}function rgb2xyz(d,m,g){return{x:.4124*(d=correctGamma(d/255))+.3576*(m=correctGamma(m/255))+.1805*(g=correctGamma(g/255)),y:.2126*d+.7152*m+.0722*g,z:.0193*d+.1192*m+.9505*g}}__export(conversion_exports,{lab2rgb:()=>lab2rgb,lab2xyz:()=>lab2xyz,rgb2hsl:()=>rgb2hsl,rgb2lab:()=>rgb2lab,rgb2xyz:()=>rgb2xyz,xyz2lab:()=>xyz2lab,xyz2rgb:()=>xyz2rgb});var arithmetic_exports={};function degrees2radians(d){return d*(Math.PI/180)}function max3(d,m,g){let w=d;return w<m&&(w=m),w<g&&(w=g),w}function min3(d,m,g){let w=d;return w>m&&(w=m),w>g&&(w=g),w}function intInRange(d,m,g){return d>g&&(d=g),d<m&&(d=m),0|d}function inRange0to255Rounded(d){return(d=Math.round(d))>255?d=255:d<0&&(d=0),d}function inRange0to255(d){return d>255?d=255:d<0&&(d=0),d}function stableSort(d,m){const g=typeof d[0];let w;if(g==="number"||g==="string"){const $=Object.create(null);for(let I=0,D=d.length;I<D;I++){const F=d[I];$[F]||$[F]===0||($[F]=I)}w=d.sort(((I,D)=>m(I,D)||$[I]-$[D]))}else{const $=d.slice(0);w=d.sort(((I,D)=>m(I,D)||$.indexOf(I)-$.indexOf(D)))}return w}function rgb2hsl(d,m,g){const w=min3(d,m,g),$=max3(d,m,g),I=$-w,D=(w+$)/510;let F=0;D>0&&D<1&&(F=I/(D<.5?$+w:510-$-w));let U=0;return I>0&&(U=$===d?(m-g)/I:$===m?2+(g-d)/I:4+(d-m)/I,U*=60,U<0&&(U+=360)),{h:U,s:F,l:D}}__export(arithmetic_exports,{degrees2radians:()=>degrees2radians,inRange0to255:()=>inRange0to255,inRange0to255Rounded:()=>inRange0to255Rounded,intInRange:()=>intInRange,max3:()=>max3,min3:()=>min3,stableSort:()=>stableSort});var refX=.95047,refY=1,refZ=1.08883;function pivot(d){return d>.008856?d**(1/3):7.787*d+16/116}function xyz2lab(d,m,g){if(d=pivot(d/refX),m=pivot(m/refY),g=pivot(g/refZ),116*m-16<0)throw new Error("xxx");return{L:Math.max(0,116*m-16),a:500*(d-m),b:200*(m-g)}}function rgb2lab(d,m,g){const w=rgb2xyz(d,m,g);return xyz2lab(w.x,w.y,w.z)}var refX2=.95047,refY2=1,refZ2=1.08883;function pivot2(d){return d>.206893034?d**3:(d-16/116)/7.787}function lab2xyz(d,m,g){const w=(d+16)/116,$=w-g/200;return{x:refX2*pivot2(m/500+w),y:refY2*pivot2(w),z:refZ2*pivot2($)}}function correctGamma2(d){return d>.0031308?1.055*d**(1/2.4)-.055:12.92*d}function xyz2rgb(d,m,g){const w=correctGamma2(3.2406*d+-1.5372*m+-.4986*g),$=correctGamma2(-.9689*d+1.8758*m+.0415*g),I=correctGamma2(.0557*d+-.204*m+1.057*g);return{r:inRange0to255Rounded(255*w),g:inRange0to255Rounded(255*$),b:inRange0to255Rounded(255*I)}}function lab2rgb(d,m,g){const w=lab2xyz(d,m,g);return xyz2rgb(w.x,w.y,w.z)}var distance_exports={};__export(distance_exports,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator,AbstractEuclidean:()=>AbstractEuclidean,AbstractManhattan:()=>AbstractManhattan,CIE94GraphicArts:()=>CIE94GraphicArts,CIE94Textiles:()=>CIE94Textiles,CIEDE2000:()=>CIEDE2000,CMetric:()=>CMetric,Euclidean:()=>Euclidean,EuclideanBT709:()=>EuclideanBT709,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha,Manhattan:()=>Manhattan,ManhattanBT709:()=>ManhattanBT709,ManhattanNommyde:()=>ManhattanNommyde,PNGQuant:()=>PNGQuant});var AbstractDistanceCalculator=class{constructor(){__publicField(this,"_maxDistance"),__publicField(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(d,m,g,w){this._whitePoint={r:d>0?255/d:0,g:m>0?255/m:0,b:g>0?255/g:0,a:w>0?255/w:0},this._maxDistance=this.calculateRaw(d,m,g,w,0,0,0,0)}calculateNormalized(d,m){return this.calculateRaw(d.r,d.g,d.b,d.a,m.r,m.g,m.b,m.a)/this._maxDistance}},AbstractCIE94=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab(inRange0to255(d*this._whitePoint.r),inRange0to255(m*this._whitePoint.g),inRange0to255(g*this._whitePoint.b)),j=rgb2lab(inRange0to255($*this._whitePoint.r),inRange0to255(I*this._whitePoint.g),inRange0to255(D*this._whitePoint.b)),G=U.L-j.L,Z=U.a-j.a,H=U.b-j.b,q=Math.sqrt(U.a*U.a+U.b*U.b),V=q-Math.sqrt(j.a*j.a+j.b*j.b);let Q=Z*Z+H*H-V*V;Q=Q<0?0:Math.sqrt(Q);const X=(F-w)*this._whitePoint.a*this._kA;return Math.sqrt((G/this._Kl)**2+(V/(1+this._K1*q))**2+(Q/(1+this._K2*q))**2+X**2)}},CIE94Textiles=class extends AbstractCIE94{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts=class extends AbstractCIE94{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000=class extends AbstractDistanceCalculator{_setDefaults(){}static _calculatehp(d,m){const g=Math.atan2(d,m);return g>=0?g:g+_CIEDE2000._deg360InRad}static _calculateRT(d,m){const g=m**7,w=2*Math.sqrt(g/(g+_CIEDE2000._pow25to7)),$=_CIEDE2000._deg30InRad*Math.exp(-(((d-_CIEDE2000._deg275InRad)/_CIEDE2000._deg25InRad)**2));return-Math.sin(2*$)*w}static _calculateT(d){return 1-.17*Math.cos(d-_CIEDE2000._deg30InRad)+.24*Math.cos(2*d)+.32*Math.cos(3*d+_CIEDE2000._deg6InRad)-.2*Math.cos(4*d-_CIEDE2000._deg63InRad)}static _calculate_ahp(d,m,g,w){const $=g+w;return d===0?$:m<=_CIEDE2000._deg180InRad?$/2:$<_CIEDE2000._deg360InRad?($+_CIEDE2000._deg360InRad)/2:($-_CIEDE2000._deg360InRad)/2}static _calculate_dHp(d,m,g,w){let $;return $=d===0?0:m<=_CIEDE2000._deg180InRad?g-w:g<=w?g-w+_CIEDE2000._deg360InRad:g-w-_CIEDE2000._deg360InRad,2*Math.sqrt(d)*Math.sin($/2)}calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab(inRange0to255(d*this._whitePoint.r),inRange0to255(m*this._whitePoint.g),inRange0to255(g*this._whitePoint.b)),j=rgb2lab(inRange0to255($*this._whitePoint.r),inRange0to255(I*this._whitePoint.g),inRange0to255(D*this._whitePoint.b)),G=(F-w)*this._whitePoint.a*_CIEDE2000._kA,Z=this.calculateRawInLab(U,j);return Math.sqrt(Z+G*G)}calculateRawInLab(d,m){const g=d.L,w=d.a,$=d.b,I=m.L,D=m.a,F=m.b,U=((Math.sqrt(w*w+$*$)+Math.sqrt(D*D+F*F))/2)**7,j=.5*(1-Math.sqrt(U/(U+_CIEDE2000._pow25to7))),G=(1+j)*w,Z=(1+j)*D,H=Math.sqrt(G*G+$*$),q=Math.sqrt(Z*Z+F*F),V=H*q,Q=_CIEDE2000._calculatehp($,G),X=_CIEDE2000._calculatehp(F,Z),re=Math.abs(Q-X),J=I-g,se=q-H,ie=_CIEDE2000._calculate_dHp(V,re,X,Q),oe=_CIEDE2000._calculate_ahp(V,re,Q,X),pe=(H+q)/2,de=((g+I)/2-50)**2,ge=se/(1+.045*pe),ce=ie/(1+.015*_CIEDE2000._calculateT(oe)*pe);return(J/(1+.015*de/Math.sqrt(20+de)))**2+ge**2+ce**2+_CIEDE2000._calculateRT(oe,pe)*ge*ce}},CIEDE2000=_CIEDE2000;__publicField(CIEDE2000,"_kA",25/255),__publicField(CIEDE2000,"_pow25to7",25**7),__publicField(CIEDE2000,"_deg360InRad",degrees2radians(360)),__publicField(CIEDE2000,"_deg180InRad",degrees2radians(180)),__publicField(CIEDE2000,"_deg30InRad",degrees2radians(30)),__publicField(CIEDE2000,"_deg6InRad",degrees2radians(6)),__publicField(CIEDE2000,"_deg63InRad",degrees2radians(63)),__publicField(CIEDE2000,"_deg275InRad",degrees2radians(275)),__publicField(CIEDE2000,"_deg25InRad",degrees2radians(25));var CMetric=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=(d+$)/2*this._whitePoint.r,j=(d-$)*this._whitePoint.r,G=(m-I)*this._whitePoint.g,Z=(g-D)*this._whitePoint.b,H=((512+U)*j*j>>8)+4*G*G+((767-U)*Z*Z>>8),q=(F-w)*this._whitePoint.a;return Math.sqrt(H+q*q)}_setDefaults(){}},AbstractEuclidean=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=$-d,j=I-m,G=D-g,Z=F-w;return Math.sqrt(this._kR*U*U+this._kG*j*j+this._kB*G*G+this._kA*Z*Z)}},Euclidean=class extends AbstractEuclidean{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){let U=$-d,j=I-m,G=D-g,Z=F-w;return U<0&&(U=0-U),j<0&&(j=0-j),G<0&&(G=0-G),Z<0&&(Z=0-Z),this._kR*U+this._kG*j+this._kB*G+this._kA*Z}},Manhattan=class extends AbstractManhattan{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde=class extends AbstractManhattan{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709=class extends AbstractManhattan{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=(F-w)*this._whitePoint.a;return this._colordifferenceCh(d*this._whitePoint.r,$*this._whitePoint.r,U)+this._colordifferenceCh(m*this._whitePoint.g,I*this._whitePoint.g,U)+this._colordifferenceCh(g*this._whitePoint.b,D*this._whitePoint.b,U)}_colordifferenceCh(d,m,g){const w=d-m,$=w+g;return w*w+$*$}_setDefaults(){}},palette_exports={};__export(palette_exports,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer,ColorHistogram:()=>ColorHistogram,NeuQuant:()=>NeuQuant,NeuQuantFloat:()=>NeuQuantFloat,RGBQuant:()=>RGBQuant,WuColorCube:()=>WuColorCube,WuQuant:()=>WuQuant});var AbstractPaletteQuantizer=class{quantizeSync(){for(const d of this.quantize())if(d.palette)return d.palette;throw new Error("unreachable")}},Point=class{constructor(){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),__publicField(this,"uint32"),__publicField(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(d){const m=new Point;return m.r=0|d[0],m.g=0|d[1],m.b=0|d[2],m.a=0|d[3],m._loadUINT32(),m._loadQuadruplet(),m}static createByRGBA(d,m,g,w){const $=new Point;return $.r=0|d,$.g=0|m,$.b=0|g,$.a=0|w,$._loadUINT32(),$._loadQuadruplet(),$}static createByUint32(d){const m=new Point;return m.uint32=d>>>0,m._loadRGBA(),m._loadQuadruplet(),m}from(d){this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this.uint32=d.uint32,this.rgba[0]=d.r,this.rgba[1]=d.g,this.rgba[2]=d.b,this.rgba[3]=d.a}getLuminosity(d){let m=this.r,g=this.g,w=this.b;return d&&(m=Math.min(255,255-this.a+this.a*m/255),g=Math.min(255,255-this.a+this.a*g/255),w=Math.min(255,255-this.a+this.a*w/255)),.2126*m+.7152*g+.0722*w}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer=class{constructor(){__publicField(this,"_pointArray"),__publicField(this,"_width"),__publicField(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(d){this._width=d}setHeight(d){this._height=d}getPointArray(){return this._pointArray}clone(){const d=new PointContainer;d._width=this._width,d._height=this._height;for(let m=0,g=this._pointArray.length;m<g;m++)d._pointArray[m]=Point.createByUint32(0|this._pointArray[m].uint32);return d}toUint32Array(){const d=this._pointArray.length,m=new Uint32Array(d);for(let g=0;g<d;g++)m[g]=this._pointArray[g].uint32;return m}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(d){const m=d.naturalWidth,g=d.naturalHeight,w=document.createElement("canvas");return w.width=m,w.height=g,w.getContext("2d").drawImage(d,0,0,m,g,0,0,m,g),PointContainer.fromHTMLCanvasElement(w)}static fromHTMLCanvasElement(d){const m=d.width,g=d.height,w=d.getContext("2d").getImageData(0,0,m,g);return PointContainer.fromImageData(w)}static fromImageData(d){const m=d.width,g=d.height;return PointContainer.fromUint8Array(d.data,m,g)}static fromUint8Array(d,m,g){switch(Object.prototype.toString.call(d)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:d=new Uint8Array(d)}const w=new Uint32Array(d.buffer);return PointContainer.fromUint32Array(w,m,g)}static fromUint32Array(d,m,g){const w=new PointContainer;w._width=m,w._height=g;for(let $=0,I=d.length;$<I;$++)w._pointArray[$]=Point.createByUint32(0|d[$]);return w}static fromBuffer(d,m,g){const w=new Uint32Array(d.buffer,d.byteOffset,d.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer.fromUint32Array(w,m,g)}},hueGroups=10;function hueGroup(d,m){const g=360/m;for(let w=1,$=g-g/2;w<m;w++,$+=g)if(d>=$&&d<$+g)return w;return 0}var Palette=class{constructor(){__publicField(this,"_pointContainer"),__publicField(this,"_pointArray",[]),__publicField(this,"_i32idx",{}),this._pointContainer=new PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(d){this._pointArray.push(d),this._pointContainer.setWidth(this._pointArray.length)}has(d){for(let m=this._pointArray.length-1;m>=0;m--)if(d.uint32===this._pointArray[m].uint32)return!0;return!1}getNearestColor(d,m){return this._pointArray[0|this._getNearestIndex(d,m)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(d){return typeof this._i32idx[d]=="number"?this._i32idx[d]:-1}_getNearestIndex(d,m){let g=this._nearestPointFromCache(""+m.uint32);if(g>=0)return g;let w=Number.MAX_VALUE;g=0;for(let $=0,I=this._pointArray.length;$<I;$++){const D=this._pointArray[$],F=d.calculateRaw(m.r,m.g,m.b,m.a,D.r,D.g,D.b,D.a);F<w&&(w=F,g=$)}return this._i32idx[m.uint32]=g,g}sort(){this._i32idx={},this._pointArray.sort(((d,m)=>{const g=rgb2hsl(d.r,d.g,d.b),w=rgb2hsl(m.r,m.g,m.b),$=d.r===d.g&&d.g===d.b?0:1+hueGroup(g.h,hueGroups),I=(m.r===m.g&&m.g===m.b?0:1+hueGroup(w.h,hueGroups))-$;if(I)return-I;const D=d.getLuminosity(!0),F=m.getLuminosity(!0);if(F-D!=0)return F-D;const U=(100*w.s|0)-(100*g.s|0);return U?-U:0}))}},utils_exports={};__export(utils_exports,{HueStatistics:()=>HueStatistics,Palette:()=>Palette,Point:()=>Point,PointContainer:()=>PointContainer,ProgressTracker:()=>ProgressTracker,arithmetic:()=>arithmetic_exports});var HueGroup=class{constructor(){__publicField(this,"num",0),__publicField(this,"cols",[])}},HueStatistics=class{constructor(d,m){__publicField(this,"_numGroups"),__publicField(this,"_minCols"),__publicField(this,"_stats"),__publicField(this,"_groupsFull"),this._numGroups=d,this._minCols=m,this._stats=[];for(let g=0;g<=d;g++)this._stats[g]=new HueGroup;this._groupsFull=0}check(d){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const m=255&d,g=d>>>8&255,w=d>>>16&255,$=m===g&&g===w?0:1+hueGroup(rgb2hsl(m,g,w).h,this._numGroups),I=this._stats[$],D=this._minCols;I.num++,I.num>D||(I.num===D&&this._groupsFull++,I.num<=D&&this._stats[$].cols.push(d))}injectIntoDictionary(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d[g]?d[g]++:d[g]=1}))}injectIntoArray(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d.indexOf(g)===-1&&d.push(g)}))}},_ProgressTracker=class{constructor(d,m){__publicField(this,"progress"),__publicField(this,"_step"),__publicField(this,"_range"),__publicField(this,"_last"),__publicField(this,"_progressRange"),this._range=d,this._progressRange=m,this._step=Math.max(1,this._range/(_ProgressTracker.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(d){return d-this._last>=this._step&&(this._last=d,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker=_ProgressTracker;__publicField(ProgressTracker,"steps",100);var networkBiasShift=3,Neuron=class{constructor(d){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift,this.g>>networkBiasShift,this.b>>networkBiasShift,this.a>>networkBiasShift)}subtract(d,m,g,w){this.r-=0|d,this.g-=0|m,this.b-=0|g,this.a-=0|w}},_NeuQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new Neuron((d<<networkBiasShift+8)/this._networkSize|0),this._freq[d]=_NeuQuant._initialBias/this._networkSize|0,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuant._minpicturebytes&&(d=1);const g=30+(d-1)/3|0,w=m/d|0;let $,I=w/_NeuQuant._nCycles|0,D=_NeuQuant._initAlpha,F=(this._networkSize>>3)*_NeuQuant._radiusBias,U=F>>_NeuQuant._radiusBiasShift;U<=1&&(U=0);for(let G=0;G<U;G++)this._radPower[G]=D*((U*U-G*G)*_NeuQuant._radBias/(U*U))>>>0;$=m<_NeuQuant._minpicturebytes?1:m%_NeuQuant._prime1!=0?_NeuQuant._prime1:m%_NeuQuant._prime2!=0?_NeuQuant._prime2:m%_NeuQuant._prime3!=0?_NeuQuant._prime3:_NeuQuant._prime4;const j=new ProgressTracker(w,99);for(let G=0,Z=0;G<w;){j.shouldNotify(G)&&(yield{progress:j.progress});const H=this._pointArray[Z],q=H.b<<networkBiasShift,V=H.g<<networkBiasShift,Q=H.r<<networkBiasShift,X=H.a<<networkBiasShift,re=this._contest(q,V,Q,X);if(this._alterSingle(D,re,q,V,Q,X),U!==0&&this._alterNeighbour(U,re,q,V,Q,X),Z+=$,Z>=m&&(Z-=m),G++,I===0&&(I=1),G%I==0){D-=D/g|0,F-=F/_NeuQuant._radiusDecrease|0,U=F>>_NeuQuant._radiusBiasShift,U<=1&&(U=0);for(let J=0;J<U;J++)this._radPower[J]=D*((U*U-J*J)*_NeuQuant._radBias/(U*U))>>>0}}}_buildPalette(){const d=new Palette;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,j=m-1,G=1;for(;U<F||j>D;){const Z=this._radPower[G++]/_NeuQuant._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}if(j>D){const H=this._network[j--];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuant._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift;let I=2147483647,D=I,F=-1,U=F;for(let j=0;j<this._networkSize;j++){const G=this._network[j],Z=this._distance.calculateNormalized(G,{r:g,g:m,b:d,a:w})*$|0;Z<I&&(I=Z,F=j);const H=Z-(this._bias[j]>>_NeuQuant._initialBiasShift-networkBiasShift);H<D&&(D=H,U=j);const q=this._freq[j]>>_NeuQuant._betaShift;this._freq[j]-=q,this._bias[j]+=q<<_NeuQuant._gammaShift}return this._freq[F]+=_NeuQuant._beta,this._bias[F]-=_NeuQuant._betaGamma,U}},NeuQuant=_NeuQuant;__publicField(NeuQuant,"_prime1",499),__publicField(NeuQuant,"_prime2",491),__publicField(NeuQuant,"_prime3",487),__publicField(NeuQuant,"_prime4",503),__publicField(NeuQuant,"_minpicturebytes",_NeuQuant._prime4),__publicField(NeuQuant,"_nCycles",100),__publicField(NeuQuant,"_initialBiasShift",16),__publicField(NeuQuant,"_initialBias",1<<_NeuQuant._initialBiasShift),__publicField(NeuQuant,"_gammaShift",10),__publicField(NeuQuant,"_betaShift",10),__publicField(NeuQuant,"_beta",_NeuQuant._initialBias>>_NeuQuant._betaShift),__publicField(NeuQuant,"_betaGamma",_NeuQuant._initialBias<<_NeuQuant._gammaShift-_NeuQuant._betaShift),__publicField(NeuQuant,"_radiusBiasShift",6),__publicField(NeuQuant,"_radiusBias",1<<_NeuQuant._radiusBiasShift),__publicField(NeuQuant,"_radiusDecrease",30),__publicField(NeuQuant,"_alphaBiasShift",10),__publicField(NeuQuant,"_initAlpha",1<<_NeuQuant._alphaBiasShift),__publicField(NeuQuant,"_radBiasShift",8),__publicField(NeuQuant,"_radBias",1<<_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBiasShift",_NeuQuant._alphaBiasShift+_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBias",1<<_NeuQuant._alphaRadBiasShift);var networkBiasShift2=3,NeuronFloat=class{constructor(d){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift2,this.g>>networkBiasShift2,this.b>>networkBiasShift2,this.a>>networkBiasShift2)}subtract(d,m,g,w){this.r-=d,this.g-=m,this.b-=g,this.a-=w}},_NeuQuantFloat=class extends AbstractPaletteQuantizer{constructor(d,m=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new NeuronFloat((d<<networkBiasShift2+8)/this._networkSize),this._freq[d]=_NeuQuantFloat._initialBias/this._networkSize,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuantFloat._minpicturebytes&&(d=1);const g=30+(d-1)/3,w=m/d;let $,I=w/_NeuQuantFloat._nCycles|0,D=_NeuQuantFloat._initAlpha,F=(this._networkSize>>3)*_NeuQuantFloat._radiusBias,U=F>>_NeuQuantFloat._radiusBiasShift;U<=1&&(U=0);for(let G=0;G<U;G++)this._radPower[G]=D*((U*U-G*G)*_NeuQuantFloat._radBias/(U*U));$=m<_NeuQuantFloat._minpicturebytes?1:m%_NeuQuantFloat._prime1!=0?_NeuQuantFloat._prime1:m%_NeuQuantFloat._prime2!=0?_NeuQuantFloat._prime2:m%_NeuQuantFloat._prime3!=0?_NeuQuantFloat._prime3:_NeuQuantFloat._prime4;const j=new ProgressTracker(w,99);for(let G=0,Z=0;G<w;){j.shouldNotify(G)&&(yield{progress:j.progress});const H=this._pointArray[Z],q=H.b<<networkBiasShift2,V=H.g<<networkBiasShift2,Q=H.r<<networkBiasShift2,X=H.a<<networkBiasShift2,re=this._contest(q,V,Q,X);if(this._alterSingle(D,re,q,V,Q,X),U!==0&&this._alterNeighbour(U,re,q,V,Q,X),Z+=$,Z>=m&&(Z-=m),G++,I===0&&(I=1),G%I==0){D-=D/g,F-=F/_NeuQuantFloat._radiusDecrease,U=F>>_NeuQuantFloat._radiusBiasShift,U<=1&&(U=0);for(let J=0;J<U;J++)this._radPower[J]=D*((U*U-J*J)*_NeuQuantFloat._radBias/(U*U))}}}_buildPalette(){const d=new Palette;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,j=m-1,G=1;for(;U<F||j>D;){const Z=this._radPower[G++]/_NeuQuantFloat._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}if(j>D){const H=this._network[j--];H.subtract(Z*(H.r-$),Z*(H.g-w),Z*(H.b-g),Z*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuantFloat._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift2;let I=2147483647,D=I,F=-1,U=F;for(let j=0;j<this._networkSize;j++){const G=this._network[j],Z=this._distance.calculateNormalized(G,{r:g,g:m,b:d,a:w})*$;Z<I&&(I=Z,F=j);const H=Z-(this._bias[j]>>_NeuQuantFloat._initialBiasShift-networkBiasShift2);H<D&&(D=H,U=j);const q=this._freq[j]>>_NeuQuantFloat._betaShift;this._freq[j]-=q,this._bias[j]+=q<<_NeuQuantFloat._gammaShift}return this._freq[F]+=_NeuQuantFloat._beta,this._bias[F]-=_NeuQuantFloat._betaGamma,U}},NeuQuantFloat=_NeuQuantFloat;__publicField(NeuQuantFloat,"_prime1",499),__publicField(NeuQuantFloat,"_prime2",491),__publicField(NeuQuantFloat,"_prime3",487),__publicField(NeuQuantFloat,"_prime4",503),__publicField(NeuQuantFloat,"_minpicturebytes",_NeuQuantFloat._prime4),__publicField(NeuQuantFloat,"_nCycles",100),__publicField(NeuQuantFloat,"_initialBiasShift",16),__publicField(NeuQuantFloat,"_initialBias",1<<_NeuQuantFloat._initialBiasShift),__publicField(NeuQuantFloat,"_gammaShift",10),__publicField(NeuQuantFloat,"_betaShift",10),__publicField(NeuQuantFloat,"_beta",_NeuQuantFloat._initialBias>>_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_betaGamma",_NeuQuantFloat._initialBias<<_NeuQuantFloat._gammaShift-_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_radiusBiasShift",6),__publicField(NeuQuantFloat,"_radiusBias",1<<_NeuQuantFloat._radiusBiasShift),__publicField(NeuQuantFloat,"_radiusDecrease",30),__publicField(NeuQuantFloat,"_alphaBiasShift",10),__publicField(NeuQuantFloat,"_initAlpha",1<<_NeuQuantFloat._alphaBiasShift),__publicField(NeuQuantFloat,"_radBiasShift",8),__publicField(NeuQuantFloat,"_radBias",1<<_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBiasShift",_NeuQuantFloat._alphaBiasShift+_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBias",1<<_NeuQuantFloat._alphaRadBiasShift);var _ColorHistogram=class{constructor(d,m){__publicField(this,"_method"),__publicField(this,"_hueStats"),__publicField(this,"_histogram"),__publicField(this,"_initColors"),__publicField(this,"_minHueCols"),this._method=d,this._minHueCols=m<<2,this._initColors=m<<2,this._hueStats=new HueStatistics(_ColorHistogram._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(d){switch(this._method){case 1:this._colorStats1D(d);break;case 2:this._colorStats2D(d)}}getImportanceSortedColorsIDXI32(){const d=stableSort(Object.keys(this._histogram),((g,w)=>this._histogram[w]-this._histogram[g]));if(d.length===0)return[];let m;switch(this._method){case 1:const g=Math.min(d.length,this._initColors),w=d[g-1],$=this._histogram[w];m=d.slice(0,g);let I=g;const D=d.length;for(;I<D&&this._histogram[d[I]]===$;)m.push(d[I++]);this._hueStats.injectIntoArray(m);break;case 2:m=d;break;default:throw new Error("Incorrect method")}return m.map((g=>+g))}_colorStats1D(d){const m=this._histogram,g=d.getPointArray(),w=g.length;for(let $=0;$<w;$++){const I=g[$].uint32;this._hueStats.check(I),I in m?m[I]++:m[I]=1}}_colorStats2D(d){const m=d.getWidth(),g=d.getHeight(),w=d.getPointArray(),$=_ColorHistogram._boxSize[0],I=_ColorHistogram._boxSize[1],D=$*I,F=this._makeBoxes(m,g,$,I),U=this._histogram;F.forEach((j=>{let G=Math.round(j.w*j.h/D)*_ColorHistogram._boxPixels;G<2&&(G=2);const Z={};this._iterateBox(j,m,(H=>{const q=w[H].uint32;this._hueStats.check(q),q in U?U[q]++:q in Z?++Z[q]>=G&&(U[q]=Z[q]):Z[q]=1}))})),this._hueStats.injectIntoDictionary(U)}_iterateBox(d,m,g){const w=d,$=w.y*m+w.x,I=(w.y+w.h-1)*m+(w.x+w.w-1),D=m-w.w+1;let F=0,U=$;do g.call(this,U),U+=++F%w.w==0?D:1;while(U<=I)}_makeBoxes(d,m,g,w){const $=d%g,I=m%w,D=d-$,F=m-I,U=[];for(let j=0;j<m;j+=w)for(let G=0;G<d;G+=g)U.push({x:G,y:j,w:G===D?$:g,h:j===F?I:w});return U}},ColorHistogram=_ColorHistogram;__publicField(ColorHistogram,"_boxSize",[64,64]),__publicField(ColorHistogram,"_boxPixels",2),__publicField(ColorHistogram,"_hueGroups",10);var RemovedColor=class{constructor(d,m,g){__publicField(this,"index"),__publicField(this,"color"),__publicField(this,"distance"),this.index=d,this.color=m,this.distance=g}},RGBQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256,g=2){super(),__publicField(this,"_colors"),__publicField(this,"_initialDistance"),__publicField(this,"_distanceIncrement"),__publicField(this,"_histogram"),__publicField(this,"_distance"),this._distance=d,this._colors=m,this._histogram=new ColorHistogram(g,m),this._initialDistance=.01,this._distanceIncrement=.005}sample(d){this._histogram.sample(d)}*quantize(){const d=this._histogram.getImportanceSortedColorsIDXI32();if(d.length===0)throw new Error("No colors in image");yield*this._buildPalette(d)}*_buildPalette(d){const m=new Palette,g=m.getPointContainer().getPointArray(),w=new Array(d.length);for(let G=0;G<d.length;G++)g.push(Point.createByUint32(d[G])),w[G]=1;const $=g.length,I=[];let D=$,F=this._initialDistance;const U=new ProgressTracker(D-this._colors,99);for(;D>this._colors;){I.length=0;for(let G=0;G<$;G++){if(U.shouldNotify($-D)&&(yield{progress:U.progress}),w[G]===0)continue;const Z=g[G];for(let H=G+1;H<$;H++){if(w[H]===0)continue;const q=g[H],V=this._distance.calculateNormalized(Z,q);V<F&&(I.push(new RemovedColor(H,q,V)),w[H]=0,D--)}}F+=D>3*this._colors?this._initialDistance:this._distanceIncrement}if(D<this._colors){stableSort(I,((Z,H)=>H.distance-Z.distance));let G=0;for(;D<this._colors&&G<I.length;)w[I[G].index]=1,D++,G++}let j=g.length;for(let G=j-1;G>=0;G--)w[G]===0&&(G!==j-1&&(g[G]=g[j-1]),--j);g.length=j,m.sort(),yield{palette:m,progress:100}}};function createArray1D(d){const m=[];for(let g=0;g<d;g++)m[g]=0;return m}function createArray4D(d,m,g,w){const $=new Array(d);for(let I=0;I<d;I++){$[I]=new Array(m);for(let D=0;D<m;D++){$[I][D]=new Array(g);for(let F=0;F<g;F++){$[I][D][F]=new Array(w);for(let U=0;U<w;U++)$[I][D][F][U]=0}}}return $}function createArray3D(d,m,g){const w=new Array(d);for(let $=0;$<d;$++){w[$]=new Array(m);for(let I=0;I<m;I++){w[$][I]=new Array(g);for(let D=0;D<g;D++)w[$][I][D]=0}}return w}function fillArray3D(d,m,g,w,$){for(let I=0;I<m;I++){d[I]=[];for(let D=0;D<g;D++){d[I][D]=[];for(let F=0;F<w;F++)d[I][D][F]=$}}}function fillArray1D(d,m,g){for(let w=0;w<m;w++)d[w]=g}var WuColorCube=class{constructor(){__publicField(this,"redMinimum"),__publicField(this,"redMaximum"),__publicField(this,"greenMinimum"),__publicField(this,"greenMaximum"),__publicField(this,"blueMinimum"),__publicField(this,"blueMaximum"),__publicField(this,"volume"),__publicField(this,"alphaMinimum"),__publicField(this,"alphaMaximum")}},_WuQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256,g=5){super(),__publicField(this,"_reds"),__publicField(this,"_greens"),__publicField(this,"_blues"),__publicField(this,"_alphas"),__publicField(this,"_sums"),__publicField(this,"_weights"),__publicField(this,"_momentsRed"),__publicField(this,"_momentsGreen"),__publicField(this,"_momentsBlue"),__publicField(this,"_momentsAlpha"),__publicField(this,"_moments"),__publicField(this,"_table"),__publicField(this,"_pixels"),__publicField(this,"_cubes"),__publicField(this,"_colors"),__publicField(this,"_significantBitsPerChannel"),__publicField(this,"_maxSideIndex"),__publicField(this,"_alphaMaxSideIndex"),__publicField(this,"_sideSize"),__publicField(this,"_alphaSideSize"),__publicField(this,"_distance"),this._distance=d,this._setQuality(g),this._initialize(m)}sample(d){const m=d.getPointArray();for(let g=0,w=m.length;g<w;g++)this._addColor(m[g]);this._pixels=this._pixels.concat(m)}*quantize(){yield*this._preparePalette();const d=new Palette;for(let m=0;m<this._colors;m++)if(this._sums[m]>0){const g=this._sums[m],w=this._reds[m]/g,$=this._greens[m]/g,I=this._blues[m]/g,D=this._alphas[m]/g,F=Point.createByRGBA(0|w,0|$,0|I,0|D);d.add(F)}d.sort(),yield{palette:d,progress:100}}*_preparePalette(){yield*this._calculateMoments();let d=0;const m=createArray1D(this._colors);for(let D=1;D<this._colors;++D){this._cut(this._cubes[d],this._cubes[D])?(m[d]=this._cubes[d].volume>1?this._calculateVariance(this._cubes[d]):0,m[D]=this._cubes[D].volume>1?this._calculateVariance(this._cubes[D]):0):(m[d]=0,D--),d=0;let F=m[0];for(let U=1;U<=D;++U)m[U]>F&&(F=m[U],d=U);if(F<=0){this._colors=D+1;break}}const g=[],w=[],$=[],I=[];for(let D=0;D<this._colors;++D){const F=_WuQuant._volume(this._cubes[D],this._weights);F>0?(g[D]=_WuQuant._volume(this._cubes[D],this._momentsRed)/F|0,w[D]=_WuQuant._volume(this._cubes[D],this._momentsGreen)/F|0,$[D]=_WuQuant._volume(this._cubes[D],this._momentsBlue)/F|0,I[D]=_WuQuant._volume(this._cubes[D],this._momentsAlpha)/F|0):(g[D]=0,w[D]=0,$[D]=0,I[D]=0)}this._reds=createArray1D(this._colors+1),this._greens=createArray1D(this._colors+1),this._blues=createArray1D(this._colors+1),this._alphas=createArray1D(this._colors+1),this._sums=createArray1D(this._colors+1);for(let D=0,F=this._pixels.length;D<F;D++){const U=this._pixels[D];let j=-1,G=Number.MAX_VALUE;for(let Z=0;Z<this._colors;Z++){const H=g[Z],q=w[Z],V=$[Z],Q=I[Z],X=this._distance.calculateRaw(H,q,V,Q,U.r,U.g,U.b,U.a);X<G&&(G=X,j=Z)}this._reds[j]+=U.r,this._greens[j]+=U.g,this._blues[j]+=U.b,this._alphas[j]+=U.a,this._sums[j]++}}_addColor(d){const m=8-this._significantBitsPerChannel,g=1+(d.r>>m),w=1+(d.g>>m),$=1+(d.b>>m),I=1+(d.a>>m);this._weights[I][g][w][$]++,this._momentsRed[I][g][w][$]+=d.r,this._momentsGreen[I][g][w][$]+=d.g,this._momentsBlue[I][g][w][$]+=d.b,this._momentsAlpha[I][g][w][$]+=d.a,this._moments[I][g][w][$]+=this._table[d.r]+this._table[d.g]+this._table[d.b]+this._table[d.a]}*_calculateMoments(){const d=[],m=[],g=[],w=[],$=[],I=[],D=createArray3D(this._sideSize,this._sideSize,this._sideSize),F=createArray3D(this._sideSize,this._sideSize,this._sideSize),U=createArray3D(this._sideSize,this._sideSize,this._sideSize),j=createArray3D(this._sideSize,this._sideSize,this._sideSize),G=createArray3D(this._sideSize,this._sideSize,this._sideSize),Z=createArray3D(this._sideSize,this._sideSize,this._sideSize);let H=0;const q=new ProgressTracker(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let V=1;V<=this._alphaMaxSideIndex;++V){fillArray3D(D,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(F,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(U,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(j,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(G,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(Z,this._sideSize,this._sideSize,this._sideSize,0);for(let Q=1;Q<=this._maxSideIndex;++Q,++H){q.shouldNotify(H)&&(yield{progress:q.progress}),fillArray1D(d,this._sideSize,0),fillArray1D(m,this._sideSize,0),fillArray1D(g,this._sideSize,0),fillArray1D(w,this._sideSize,0),fillArray1D($,this._sideSize,0),fillArray1D(I,this._sideSize,0);for(let X=1;X<=this._maxSideIndex;++X){let re=0,J=0,se=0,ie=0,oe=0,pe=0;for(let de=1;de<=this._maxSideIndex;++de)re+=this._weights[V][Q][X][de],J+=this._momentsRed[V][Q][X][de],se+=this._momentsGreen[V][Q][X][de],ie+=this._momentsBlue[V][Q][X][de],oe+=this._momentsAlpha[V][Q][X][de],pe+=this._moments[V][Q][X][de],d[de]+=re,m[de]+=J,g[de]+=se,w[de]+=ie,$[de]+=oe,I[de]+=pe,D[Q][X][de]=D[Q-1][X][de]+d[de],F[Q][X][de]=F[Q-1][X][de]+m[de],U[Q][X][de]=U[Q-1][X][de]+g[de],j[Q][X][de]=j[Q-1][X][de]+w[de],G[Q][X][de]=G[Q-1][X][de]+$[de],Z[Q][X][de]=Z[Q-1][X][de]+I[de],this._weights[V][Q][X][de]=this._weights[V-1][Q][X][de]+D[Q][X][de],this._momentsRed[V][Q][X][de]=this._momentsRed[V-1][Q][X][de]+F[Q][X][de],this._momentsGreen[V][Q][X][de]=this._momentsGreen[V-1][Q][X][de]+U[Q][X][de],this._momentsBlue[V][Q][X][de]=this._momentsBlue[V-1][Q][X][de]+j[Q][X][de],this._momentsAlpha[V][Q][X][de]=this._momentsAlpha[V-1][Q][X][de]+G[Q][X][de],this._moments[V][Q][X][de]=this._moments[V-1][Q][X][de]+Z[Q][X][de]}}}}static _volumeFloat(d,m){return m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMaximum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum])}static _volume(d,m){return 0|_WuQuant._volumeFloat(d,m)}static _top(d,m,g,w){let $;switch(m){case _WuQuant._alpha:$=w[g][d.redMaximum][d.greenMaximum][d.blueMaximum]-w[g][d.redMaximum][d.greenMinimum][d.blueMaximum]-w[g][d.redMinimum][d.greenMaximum][d.blueMaximum]+w[g][d.redMinimum][d.greenMinimum][d.blueMaximum]-(w[g][d.redMaximum][d.greenMaximum][d.blueMinimum]-w[g][d.redMaximum][d.greenMinimum][d.blueMinimum]-w[g][d.redMinimum][d.greenMaximum][d.blueMinimum]+w[g][d.redMinimum][d.greenMinimum][d.blueMinimum]);break;case _WuQuant._red:$=w[d.alphaMaximum][g][d.greenMaximum][d.blueMaximum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMaximum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMaximum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMaximum]-(w[d.alphaMaximum][g][d.greenMaximum][d.blueMinimum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMinimum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMinimum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMinimum]);break;case _WuQuant._green:$=w[d.alphaMaximum][d.redMaximum][g][d.blueMaximum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMaximum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMaximum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMaximum]-(w[d.alphaMaximum][d.redMaximum][g][d.blueMinimum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMinimum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMinimum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMinimum]);break;case _WuQuant._blue:$=w[d.alphaMaximum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMaximum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMaximum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMaximum][d.redMinimum][d.greenMinimum][g]-(w[d.alphaMinimum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMinimum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMinimum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMinimum][d.redMinimum][d.greenMinimum][g]);break;default:throw new Error("impossible")}return 0|$}static _bottom(d,m,g){switch(m){case _WuQuant._alpha:return-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._red:return-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._green:return-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._blue:return-g[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);default:return 0}}_calculateVariance(d){const m=_WuQuant._volume(d,this._momentsRed),g=_WuQuant._volume(d,this._momentsGreen),w=_WuQuant._volume(d,this._momentsBlue),$=_WuQuant._volume(d,this._momentsAlpha);return _WuQuant._volumeFloat(d,this._moments)-(m*m+g*g+w*w+$*$)/_WuQuant._volume(d,this._weights)}_maximize(d,m,g,w,$,I,D,F,U){const j=0|_WuQuant._bottom(d,m,this._momentsRed),G=0|_WuQuant._bottom(d,m,this._momentsGreen),Z=0|_WuQuant._bottom(d,m,this._momentsBlue),H=0|_WuQuant._bottom(d,m,this._momentsAlpha),q=0|_WuQuant._bottom(d,m,this._weights);let V=0,Q=-1;for(let X=g;X<w;++X){let re=j+_WuQuant._top(d,m,X,this._momentsRed),J=G+_WuQuant._top(d,m,X,this._momentsGreen),se=Z+_WuQuant._top(d,m,X,this._momentsBlue),ie=H+_WuQuant._top(d,m,X,this._momentsAlpha),oe=q+_WuQuant._top(d,m,X,this._weights);if(oe!==0){let pe=re*re+J*J+se*se+ie*ie,de=pe/oe;re=$-re,J=I-J,se=D-se,ie=F-ie,oe=U-oe,oe!==0&&(pe=re*re+J*J+se*se+ie*ie,de+=pe/oe,de>V&&(V=de,Q=X))}}return{max:V,position:Q}}_cut(d,m){let g;const w=_WuQuant._volume(d,this._momentsRed),$=_WuQuant._volume(d,this._momentsGreen),I=_WuQuant._volume(d,this._momentsBlue),D=_WuQuant._volume(d,this._momentsAlpha),F=_WuQuant._volume(d,this._weights),U=this._maximize(d,_WuQuant._red,d.redMinimum+1,d.redMaximum,w,$,I,D,F),j=this._maximize(d,_WuQuant._green,d.greenMinimum+1,d.greenMaximum,w,$,I,D,F),G=this._maximize(d,_WuQuant._blue,d.blueMinimum+1,d.blueMaximum,w,$,I,D,F),Z=this._maximize(d,_WuQuant._alpha,d.alphaMinimum+1,d.alphaMaximum,w,$,I,D,F);if(Z.max>=U.max&&Z.max>=j.max&&Z.max>=G.max){if(g=_WuQuant._alpha,Z.position<0)return!1}else g=U.max>=Z.max&&U.max>=j.max&&U.max>=G.max?_WuQuant._red:j.max>=Z.max&&j.max>=U.max&&j.max>=G.max?_WuQuant._green:_WuQuant._blue;switch(m.redMaximum=d.redMaximum,m.greenMaximum=d.greenMaximum,m.blueMaximum=d.blueMaximum,m.alphaMaximum=d.alphaMaximum,g){case _WuQuant._red:m.redMinimum=d.redMaximum=U.position,m.greenMinimum=d.greenMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._green:m.greenMinimum=d.greenMaximum=j.position,m.redMinimum=d.redMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._blue:m.blueMinimum=d.blueMaximum=G.position,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._alpha:m.alphaMinimum=d.alphaMaximum=Z.position,m.blueMinimum=d.blueMinimum,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum}return d.volume=(d.redMaximum-d.redMinimum)*(d.greenMaximum-d.greenMinimum)*(d.blueMaximum-d.blueMinimum)*(d.alphaMaximum-d.alphaMinimum),m.volume=(m.redMaximum-m.redMinimum)*(m.greenMaximum-m.greenMinimum)*(m.blueMaximum-m.blueMinimum)*(m.alphaMaximum-m.alphaMinimum),!0}_initialize(d){this._colors=d,this._cubes=[];for(let m=0;m<d;m++)this._cubes[m]=new WuColorCube;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let m=0;m<256;++m)this._table[m]=m*m;this._pixels=[]}_setQuality(d=5){this._significantBitsPerChannel=d,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant=_WuQuant;__publicField(WuQuant,"_alpha",3),__publicField(WuQuant,"_red",2),__publicField(WuQuant,"_green",1),__publicField(WuQuant,"_blue",0);var image_exports={};__export(image_exports,{AbstractImageQuantizer:()=>AbstractImageQuantizer,ErrorDiffusionArray:()=>ErrorDiffusionArray,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma,NearestColor:()=>NearestColor});var AbstractImageQuantizer=class{quantizeSync(d,m){for(const g of this.quantize(d,m))if(g.pointContainer)return g.pointContainer;throw new Error("unreachable")}},NearestColor=class extends AbstractImageQuantizer{constructor(d){super(),__publicField(this,"_distance"),this._distance=d}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=new ProgressTracker($,99);for(let D=0;D<$;D++){I.shouldNotify(D)&&(yield{progress:I.progress});for(let F=0,U=D*w;F<w;F++,U++){const j=g[U];j.from(m.getNearestColor(this._distance,j))}}yield{pointContainer:d,progress:100}}},ErrorDiffusionArrayKernel=(d=>(d[d.FloydSteinberg=0]="FloydSteinberg",d[d.FalseFloydSteinberg=1]="FalseFloydSteinberg",d[d.Stucki=2]="Stucki",d[d.Atkinson=3]="Atkinson",d[d.Jarvis=4]="Jarvis",d[d.Burkes=5]="Burkes",d[d.Sierra=6]="Sierra",d[d.TwoSierra=7]="TwoSierra",d[d.SierraLite=8]="SierraLite",d))(ErrorDiffusionArrayKernel||{}),ErrorDiffusionArray=class extends AbstractImageQuantizer{constructor(d,m,g=!0,w=0,$=!1){super(),__publicField(this,"_minColorDistance"),__publicField(this,"_serpentine"),__publicField(this,"_kernel"),__publicField(this,"_calculateErrorLikeGIMP"),__publicField(this,"_distance"),this._setKernel(m),this._distance=d,this._minColorDistance=w,this._serpentine=g,this._calculateErrorLikeGIMP=$}*quantize(d,m){const g=d.getPointArray(),w=new Point,$=d.getWidth(),I=d.getHeight(),D=[];let F=1,U=1;for(const G of this._kernel){const Z=G[2]+1;U<Z&&(U=Z)}for(let G=0;G<U;G++)this._fillErrorLine(D[G]=[],$);const j=new ProgressTracker(I,99);for(let G=0;G<I;G++){j.shouldNotify(G)&&(yield{progress:j.progress}),this._serpentine&&(F*=-1);const Z=G*$,H=F===1?0:$-1,q=F===1?$:-1;this._fillErrorLine(D[0],$),D.push(D.shift());const V=D[0];for(let Q=H,X=Z+H;Q!==q;Q+=F,X+=F){const re=g[X],J=V[Q];w.from(re);const se=Point.createByRGBA(inRange0to255Rounded(re.r+J[0]),inRange0to255Rounded(re.g+J[1]),inRange0to255Rounded(re.b+J[2]),inRange0to255Rounded(re.a+J[3])),ie=m.getNearestColor(this._distance,se);if(re.from(ie),this._minColorDistance&&this._distance.calculateNormalized(w,ie)<this._minColorDistance)continue;let oe,pe,de,ge;this._calculateErrorLikeGIMP?(oe=se.r-ie.r,pe=se.g-ie.g,de=se.b-ie.b,ge=se.a-ie.a):(oe=w.r-ie.r,pe=w.g-ie.g,de=w.b-ie.b,ge=w.a-ie.a);const ce=F===1?0:this._kernel.length-1,Ie=F===1?this._kernel.length:-1;for(let fe=ce;fe!==Ie;fe+=F){const Te=this._kernel[fe][1]*F,ut=this._kernel[fe][2];if(Te+Q>=0&&Te+Q<$&&ut+G>=0&&ut+G<I){const ze=this._kernel[fe][0],Ce=D[ut][Te+Q];Ce[0]+=oe*ze,Ce[1]+=pe*ze,Ce[2]+=de*ze,Ce[3]+=ge*ze}}}}yield{pointContainer:d,progress:100}}_fillErrorLine(d,m){d.length>m&&(d.length=m);const g=d.length;for(let w=0;w<g;w++){const $=d[w];$[0]=$[1]=$[2]=$[3]=0}for(let w=g;w<m;w++)d[w]=[0,0,0,0]}_setKernel(d){switch(d){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${d}`)}}};function*hilbertCurve(d,m,g){const w=Math.max(d,m),$={width:d,height:m,level:Math.floor(Math.log(w)/Math.log(2)+1),callback:g,tracker:new ProgressTracker(d*m,99),index:0,x:0,y:0};yield*walkHilbert($,1),visit($,0)}function*walkHilbert(d,m){if(!(d.level<1)){switch(d.tracker.shouldNotify(d.index)&&(yield{progress:d.tracker.progress}),d.level--,m){case 2:yield*walkHilbert(d,1),visit(d,3),yield*walkHilbert(d,2),visit(d,4),yield*walkHilbert(d,2),visit(d,2),yield*walkHilbert(d,4);break;case 3:yield*walkHilbert(d,4),visit(d,2),yield*walkHilbert(d,3),visit(d,1),yield*walkHilbert(d,3),visit(d,3),yield*walkHilbert(d,1);break;case 1:yield*walkHilbert(d,2),visit(d,4),yield*walkHilbert(d,1),visit(d,3),yield*walkHilbert(d,1),visit(d,1),yield*walkHilbert(d,3);break;case 4:yield*walkHilbert(d,3),visit(d,1),yield*walkHilbert(d,4),visit(d,2),yield*walkHilbert(d,4),visit(d,4),yield*walkHilbert(d,2)}d.level++}}function visit(d,m){switch(d.x>=0&&d.x<d.width&&d.y>=0&&d.y<d.height&&(d.callback(d.x,d.y),d.index++),m){case 2:d.x--;break;case 3:d.x++;break;case 1:d.y--;break;case 4:d.y++}}var ErrorDiffusionRiemersma=class extends AbstractImageQuantizer{constructor(d,m=16,g=1){super(),__publicField(this,"_distance"),__publicField(this,"_weights"),__publicField(this,"_errorQueueSize"),this._distance=d,this._errorQueueSize=m,this._weights=ErrorDiffusionRiemersma._createWeights(g,m)}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=[];let D=0;for(let F=0;F<this._errorQueueSize;F++)I[F]={r:0,g:0,b:0,a:0};yield*hilbertCurve(w,$,((F,U)=>{const j=g[F+U*w];let{r:G,g:Z,b:H,a:q}=j;for(let re=0;re<this._errorQueueSize;re++){const J=this._weights[re],se=I[(re+D)%this._errorQueueSize];G+=se.r*J,Z+=se.g*J,H+=se.b*J,q+=se.a*J}const V=Point.createByRGBA(inRange0to255Rounded(G),inRange0to255Rounded(Z),inRange0to255Rounded(H),inRange0to255Rounded(q)),Q=m.getNearestColor(this._distance,V);D=(D+1)%this._errorQueueSize;const X=(D+this._errorQueueSize-1)%this._errorQueueSize;I[X].r=j.r-Q.r,I[X].g=j.g-Q.g,I[X].b=j.b-Q.b,I[X].a=j.a-Q.a,j.from(Q)})),yield{pointContainer:d,progress:100}}static _createWeights(d,m){const g=[],w=Math.exp(Math.log(m)/(m-1));for(let $=0,I=1;$<m;$++)g[$]=(I+.5|0)/m*d,I*=w;return g}},quality_exports={};__export(quality_exports,{ssim:()=>ssim});var K1=.01,K2=.03;function ssim(d,m){if(d.getHeight()!==m.getHeight()||d.getWidth()!==m.getWidth())throw new Error("Images have different sizes!");const g=(255*K1)**2,w=(255*K2)**2;let $=0,I=0;return iterate(d,m,((D,F,U,j)=>{let G=0,Z=0,H=0;for(let V=0;V<D.length;V++)Z+=(D[V]-U)**2,H+=(F[V]-j)**2,G+=(D[V]-U)*(F[V]-j);const q=D.length-1;Z/=q,H/=q,G/=q,I+=(2*U*j+g)*(2*G+w)/((U**2+j**2+g)*(Z+H+w)),$++})),I/$}function iterate(d,m,g){const w=d.getWidth(),$=d.getHeight();for(let I=0;I<$;I+=8)for(let D=0;D<w;D+=8){const F=Math.min(8,w-D),U=Math.min(8,$-I),j=calculateLumaValuesForWindow(d,D,I,F,U),G=calculateLumaValuesForWindow(m,D,I,F,U);g(j,G,calculateAverageLuma(j),calculateAverageLuma(G))}}function calculateLumaValuesForWindow(d,m,g,w,$){const I=d.getPointArray(),D=[];let F=0;for(let U=g;U<g+$;U++){const j=U*d.getWidth();for(let G=m;G<m+w;G++){const Z=I[j+G];D[F]=.2126*Z.r+.7152*Z.g+.0722*Z.b,F++}}return D}function calculateAverageLuma(d){let m=0;for(const g of d)m+=g;return m/d.length}function buildPaletteSync(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w}={}){const $=paletteQuantizationToPaletteQuantizer(colorDistanceFormulaToColorDistance(m),g,w);return d.forEach((I=>$.sample(I))),$.quantizeSync()}function applyPaletteSync(d,m,{colorDistanceFormula:g,imageQuantization:w}={}){return imageQuantizationToImageQuantizer(colorDistanceFormulaToColorDistance(g),w).quantizeSync(d,m)}function colorDistanceFormulaToColorDistance(d="euclidean-bt709"){switch(d){case"cie94-graphic-arts":return new CIE94GraphicArts;case"cie94-textiles":return new CIE94Textiles;case"ciede2000":return new CIEDE2000;case"color-metric":return new CMetric;case"euclidean":return new Euclidean;case"euclidean-bt709":return new EuclideanBT709;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha;case"manhattan":return new Manhattan;case"manhattan-bt709":return new ManhattanBT709;case"manhattan-nommyde":return new ManhattanNommyde;case"pngquant":return new PNGQuant;default:throw new Error(`Unknown colorDistanceFormula ${d}`)}}function imageQuantizationToImageQuantizer(d,m="floyd-steinberg"){switch(m){case"nearest":return new NearestColor(d);case"riemersma":return new ErrorDiffusionRiemersma(d);case"floyd-steinberg":return new ErrorDiffusionArray(d,0);case"false-floyd-steinberg":return new ErrorDiffusionArray(d,1);case"stucki":return new ErrorDiffusionArray(d,2);case"atkinson":return new ErrorDiffusionArray(d,3);case"jarvis":return new ErrorDiffusionArray(d,4);case"burkes":return new ErrorDiffusionArray(d,5);case"sierra":return new ErrorDiffusionArray(d,6);case"two-sierra":return new ErrorDiffusionArray(d,7);case"sierra-lite":return new ErrorDiffusionArray(d,8);default:throw new Error(`Unknown imageQuantization ${m}`)}}function paletteQuantizationToPaletteQuantizer(d,m="wuquant",g=256){switch(m){case"neuquant":return new NeuQuant(d,g);case"rgbquant":return new RGBQuant(d,g);case"wuquant":return new WuQuant(d,g);case"neuquant-float":return new NeuQuantFloat(d,g);default:throw new Error(`Unknown paletteQuantization ${m}`)}}/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cie94.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ciede2000.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cmetric.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * common.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * constants.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ditherErrorDiffusionArray.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * euclidean.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * helper.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * hueStatistics.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2rgb.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2xyz.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * manhattanNeuQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * nearestColor.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * palette.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pngQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * point.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pointContainer.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2hsl.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2lab.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2xyz.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ssim.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * wuQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2lab.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2rgb.ts - part of Image Quantization Library
 *//**
 * @preserve
 * MIT License
 *
 * Copyright 2015-2018 Igor Bezkrovnyi
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * riemersma.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * colorHistogram.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgbquant.ts - part of Image Quantization Library
 */typeof setImmediate=="function"?setImmediate:typeof process<"u"&&process?.nextTick;const QuantizeOptionsSchema=z.object({colors:z.number().optional(),colorDistanceFormula:z.union([z.literal("cie94-textiles"),z.literal("cie94-graphic-arts"),z.literal("ciede2000"),z.literal("color-metric"),z.literal("euclidean"),z.literal("euclidean-bt709-noalpha"),z.literal("euclidean-bt709"),z.literal("manhattan"),z.literal("manhattan-bt709"),z.literal("manhattan-nommyde"),z.literal("pngquant")]).optional(),paletteQuantization:z.union([z.literal("neuquant"),z.literal("neuquant-float"),z.literal("rgbquant"),z.literal("wuquant")]).optional(),imageQuantization:z.union([z.literal("nearest"),z.literal("riemersma"),z.literal("floyd-steinberg"),z.literal("false-floyd-steinberg"),z.literal("stucki"),z.literal("atkinson"),z.literal("jarvis"),z.literal("burkes"),z.literal("sierra"),z.literal("two-sierra"),z.literal("sierra-lite")]).optional()}),methods={quantize(d,m){const{colors:g,colorDistanceFormula:w,paletteQuantization:$,imageQuantization:I}=QuantizeOptionsSchema.parse(m),D=utils_exports.PointContainer.fromUint8Array(d.bitmap.data,d.bitmap.width,d.bitmap.height),F=applyPaletteSync(D,buildPaletteSync([D],{colors:g,colorDistanceFormula:w,paletteQuantization:$}),{colorDistanceFormula:w,imageQuantization:I});return d.bitmap.data=Buffer.from(F.toUint8Array()),d}};var parseBmfontAscii=function(d){if(!d)throw new Error("no data provided");var m={pages:[],chars:[],kernings:[]},g=(d=d.toString().trim()).split(/\r\n?|\n/g);if(g.length===0)throw new Error("no data in BMFont file");for(var w=0;w<g.length;w++){var $=splitLine(g[w],w);if($)if($.key==="page"){if(typeof $.data.id!="number")throw new Error("malformed file at line "+w+" -- needs page id=N");if(typeof $.data.file!="string")throw new Error("malformed file at line "+w+' -- needs page file="path"');m.pages[$.data.id]=$.data.file}else $.key==="chars"||$.key==="kernings"||($.key==="char"?m.chars.push($.data):$.key==="kerning"?m.kernings.push($.data):m[$.key]=$.data)}return m};function splitLine(d,m){if(!(d=d.replace(/\t+/g," ").trim()))return null;var g=d.indexOf(" ");if(g===-1)throw new Error("no named row at line "+m);var w=d.substring(0,g);d=(d=(d=(d=d.substring(g+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map((function(U){return U.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)}));for(var $=[],I=0;I<d.length;I++){var D=d[I];I===0?$.push({key:D[0],data:""}):I===d.length-1?$[$.length-1].data=parseData(D[0]):($[$.length-1].data=parseData(D[0]),$.push({key:D[1],data:""}))}var F={key:w,data:{}};return $.forEach((function(U){F.data[U.key]=U.data})),F}function parseData(d){return d&&d.length!==0?d.indexOf('"')===0||d.indexOf("'")===0?d.substring(1,d.length-1):d.indexOf(",")!==-1?parseIntList$1(d):parseInt(d,10):""}function parseIntList$1(d){return d.split(",").map((function(m){return parseInt(m,10)}))}getDefaultExportFromCjs(parseBmfontAscii);var GLYPH_DESIGNER_ERROR="chasrset",parseAttribs=function(d){for(var m in d=Object.assign({},d),GLYPH_DESIGNER_ERROR in d&&(d.charset=d[GLYPH_DESIGNER_ERROR],delete d[GLYPH_DESIGNER_ERROR]),d)m!=="face"&&m!=="charset"&&(d[m]=m==="padding"||m==="spacing"?parseIntList(d[m]):parseInt(d[m],10));return d};function parseIntList(d){return d.split(",").map((function(m){return parseInt(m,10)}))}var xmlParseFromString=self.DOMParser!==void 0?function(d){return new self.DOMParser().parseFromString(d,"application/xml")}:self.ActiveXObject!==void 0&&new self.ActiveXObject("Microsoft.XMLDOM")?function(d){var m=new self.ActiveXObject("Microsoft.XMLDOM");return m.async="false",m.loadXML(d),m}:function(d){var m=document.createElement("div");return m.innerHTML=d,m},parseAttributes=parseAttribs,parseFromString=xmlParseFromString,NAME_MAP={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"},browser=function(d){d=d.toString();var m=parseFromString(d),g={pages:[],chars:[],kernings:[]};["info","common"].forEach((function(j){var G=m.getElementsByTagName(j)[0];G&&(g[j]=parseAttributes(getAttribs(G)))}));var w=m.getElementsByTagName("pages")[0];if(!w)throw new Error("malformed file -- no <pages> element");for(var $=w.getElementsByTagName("page"),I=0;I<$.length;I++){var D=$[I],F=parseInt(D.getAttribute("id"),10),U=D.getAttribute("file");if(isNaN(F))throw new Error('malformed file -- page "id" attribute is NaN');if(!U)throw new Error('malformed file -- needs page "file" attribute');g.pages[parseInt(F,10)]=U}return["chars","kernings"].forEach((function(j){var G=m.getElementsByTagName(j)[0];if(G)for(var Z=j.substring(0,j.length-1),H=G.getElementsByTagName(Z),q=0;q<H.length;q++){var V=H[q];g[j].push(parseAttributes(getAttribs(V)))}})),g};function getAttribs(d){return getAttribList(d).reduce((function(m,g){return m[mapName(g.nodeName)]=g.nodeValue,m}),{})}function getAttribList(d){for(var m=[],g=0;g<d.attributes.length;g++)m.push(d.attributes[g]);return m}function mapName(d){return NAME_MAP[d.toLowerCase()]||d}getDefaultExportFromCjs(browser);var HEADER$1=[66,77,70],parseBmfontBinary=function(d){if(d.length<6)throw new Error("invalid buffer length for BMFont");var m=HEADER$1.every((function(I,D){return d.readUInt8(D)===I}));if(!m)throw new Error("BMFont missing BMF byte header");var g=3;if(d.readUInt8(g++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var w={kernings:[],chars:[]},$=0;$<5;$++)g+=readBlock(w,d,g);return w};function readBlock(d,m,g){if(g>m.length-1)return 0;var w=m.readUInt8(g++),$=m.readInt32LE(g);switch(g+=4,w){case 1:d.info=readInfo(m,g);break;case 2:d.common=readCommon(m,g);break;case 3:d.pages=readPages(m,g,$);break;case 4:d.chars=readChars(m,g,$);break;case 5:d.kernings=readKernings(m,g,$)}return 5+$}function readInfo(d,m){var g={};g.size=d.readInt16LE(m);var w=d.readUInt8(m+2);return g.smooth=w>>7&1,g.unicode=w>>6&1,g.italic=w>>5&1,g.bold=w>>4&1,w>>3&1&&(g.fixedHeight=1),g.charset=d.readUInt8(m+3)||"",g.stretchH=d.readUInt16LE(m+4),g.aa=d.readUInt8(m+6),g.padding=[d.readInt8(m+7),d.readInt8(m+8),d.readInt8(m+9),d.readInt8(m+10)],g.spacing=[d.readInt8(m+11),d.readInt8(m+12)],g.outline=d.readUInt8(m+13),g.face=readStringNT(d,m+14),g}function readCommon(d,m){var g={};return g.lineHeight=d.readUInt16LE(m),g.base=d.readUInt16LE(m+2),g.scaleW=d.readUInt16LE(m+4),g.scaleH=d.readUInt16LE(m+6),g.pages=d.readUInt16LE(m+8),d.readUInt8(m+10),g.packed=0,g.alphaChnl=d.readUInt8(m+11),g.redChnl=d.readUInt8(m+12),g.greenChnl=d.readUInt8(m+13),g.blueChnl=d.readUInt8(m+14),g}function readPages(d,m,g){for(var w=[],$=readNameNT(d,m),I=$.length+1,D=g/I,F=0;F<D;F++)w[F]=d.slice(m,m+$.length).toString("utf8"),m+=I;return w}function readChars(d,m,g){for(var w=[],$=g/20,I=0;I<$;I++){var D={},F=20*I;D.id=d.readUInt32LE(m+0+F),D.x=d.readUInt16LE(m+4+F),D.y=d.readUInt16LE(m+6+F),D.width=d.readUInt16LE(m+8+F),D.height=d.readUInt16LE(m+10+F),D.xoffset=d.readInt16LE(m+12+F),D.yoffset=d.readInt16LE(m+14+F),D.xadvance=d.readInt16LE(m+16+F),D.page=d.readUInt8(m+18+F),D.chnl=d.readUInt8(m+19+F),w[I]=D}return w}function readKernings(d,m,g){for(var w=[],$=g/10,I=0;I<$;I++){var D={},F=10*I;D.first=d.readUInt32LE(m+0+F),D.second=d.readUInt32LE(m+4+F),D.amount=d.readInt16LE(m+8+F),w[I]=D}return w}function readNameNT(d,m){for(var g=m;g<d.length&&d[g]!==0;g++);return d.slice(m,g)}function readStringNT(d,m){return readNameNT(d,m).toString("utf8")}getDefaultExportFromCjs(parseBmfontBinary);function e(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}const t=d=>{if(!d)return null;const m={};switch(d.type){case"ELEMENT":{let g={};const w=E(d.value.attributes),$=t(d.value.children);if(w&&(g=Object.assign(g,w)),$){const I=r(d.value.children);g=Object.assign(g,I)}m[d.value.type]=g;break}case"ATTRIBUTE":{const g=d.value;m[g.name]=g.value;break}case"CONTENT":return{content:d.value}}return m},r=d=>d&&Array.isArray(d)&&d.length!==0?n(d)?{content:d[0].value}:{children:d.map(t)}:null,n=d=>d&&Array.isArray(d)&&d.length===1&&d[0].type==="CONTENT",E=d=>d&&Array.isArray(d)?d.map(t).reduce(((m,g)=>Object.assign(m,g)),{}):null;var s={convert:d=>t(d.value.children[0])},a={Token:(d,m)=>({type:d,value:m}),TOKEN_TYPE:{OPEN_BRACKET:"OPEN_BRACKET",ELEMENT_TYPE:"ELEMENT_TYPE",CLOSE_ELEMENT:"CLOSE_ELEMENT",ATTRIB_NAME:"ATTRIB_NAME",ATTRIB_VALUE:"ATTRIB_VALUE",ASSIGN:"ASSIGN",CLOSE_BRACKET:"CLOSE_BRACKET",CONTENT:"CONTENT",EOF:"EOF"}};const{Token:T,TOKEN_TYPE:u}=a,c=T("EOF"),l=d=>d===" "||d===`
`||d==="\r"||d==="	",o=d=>d.replace(/'/g,'"');var N={createLexer:function(d){let m=null,g=(Z=>{let H=0;for(;H<Z.length&&l(Z[H]);)H++;return((q,V)=>{if(q.startsWith("<?xml",V)){const Q=q.length;for(;V<Q;)if(q[V]!=="?")V++;else{if(q[V+1]===">")return V+2;V++}}return V})(Z,H)})(d),w=[];const $=()=>d[g],I=()=>m!==c&&g<d.length,D=Z=>Z==='"'||Z==="'",F=()=>{for(;I()&&l(d[g]);)g++},U=Z=>{if(I()){if(d[g]==="<"){let H="<";return g++,I()&&d[g]==="/"?(g++,H="</"):I()&&d[g]==="!"&&d[g+1]==="-"&&d[g+2]==="-"&&(g++,g++,g++,H="<!--"),H}if($()==="/"){let H="/";return g++,I()&&$()===">"&&(g++,H="/>"),H}if(d[g]==="="||d[g]===">"){const H=d[g];return g++,H}}return j(!!Z)},j=Z=>{const H=Z?/[^>=<]/u:/[a-zA-Z0-9_:-]/;let q=g;for(;I()&&d[g].match(H);)g++;return o(d.substring(q,g))},G=()=>{const Z=g;F();const H=g-Z;if(I())if(m&&m.type===u.OPEN_BRACKET){F();const q=U(!1);m=T(u.ELEMENT_TYPE,q),w.push(q)}else if(m&&m.type===u.ASSIGN){I()&&D($())&&g++;let q=g;for(;I()&&!D($());)g++;const V=o(d.substring(q,g));g++,m=T(u.ATTRIB_VALUE,V)}else{F();let q=U(!0);switch(q){case"=":m=m.type===u.ATTRIB_NAME?T(u.ASSIGN):T(u.CONTENT,q);break;case"</":{const V=g;for(;d[g]!==">";)g++;m=T(u.CLOSE_ELEMENT,d.substring(V,g)),g++,w.pop();break}case"/>":{const V=w.pop();m=T(u.CLOSE_ELEMENT,V);break}case"<!--":{const V=["!","-","-"];for(;I()&&(V[2]!==">"||V[1]!=="-"||V[0]!=="-");)V.shift(),V.push(d[g]),g++;return G()}case">":m=T(u.CLOSE_BRACKET);break;case"<":m=T(u.OPEN_BRACKET);break;default:if(q&&q.length>0){if(m.type===u.CLOSE_BRACKET){let V="";$()!=="<"&&(V=j(!0)),m=T(u.CONTENT,q+V)}else if(m.type!==u.ATTRIB_NAME&&m.type!==u.CONTENT)m.type===u.CLOSE_ELEMENT?(q=" ".repeat(H)+q,m=T(u.CONTENT,q)):m=T(u.ATTRIB_NAME,q);else{const V=" ".repeat(H)+q;m=T(u.CONTENT,V)}break}{const V='Unknown Syntax : "'+d[g]+'"';throw new Error(V)}}}else m=c;return m};return{peek:$,next:G,hasNext:I}}};const{createLexer:i}=N,{Token:p,TOKEN_TYPE:O}=a,[A,f,C,h]=["ROOT","ELEMENT","ATTRIBUTE","CONTENT"],_=(d,m)=>({type:d,value:m}),L=d=>_(h,d),y=(d,m,g)=>_(f,{type:d,attributes:m,children:g}),v=(d,m)=>_(C,{name:d,value:m}),S=(d,m)=>{const g=[];for(;d.hasNext();){const w=d.next();switch(w.type){case O.OPEN_BRACKET:{const $=d.next(),[I,D]=R(d);let F=[];D.type!==O.CLOSE_ELEMENT&&(F=S(d,$)),F&&F.length>0&&F[0].type===O.CONTENT&&(F=b(F)),g.push(y($.value,I,F));break}case O.CLOSE_ELEMENT:if(w.value===m.value)return g;break;case O.CONTENT:g.push(L(w.value));break;case O.EOF:return g;default:throw new Error(`Unknown Lexem type: ${w.type} "${w.value}, scoping element: ${m.value}"`)}}return g},R=d=>{const m=[];let g=d.peek();if(!d.hasNext()||g&&g.type===O.CLOSE_BRACKET||g&&g.type===O.CLOSE_ELEMENT)return[m,g];for(g=d.next();d.hasNext()&&g&&g.type!==O.CLOSE_BRACKET&&g.type!==O.CLOSE_ELEMENT;){const w=g;d.next();const $=d.next(),I=v(w.value,$.value);m.push(I),g=d.next()}return[m,g]};function b(d){let m=[],g="";return d.forEach((w=>{w.type===O.CONTENT?g+=w.value:(g.length&&(m.push(L(g)),g=""),m.push(w))})),g.length&&m.push(L(g)),m}var B={transpile:function(d,m){const g=(w=>_(A,{children:S(w,p(A,"ROOT"))}))(i(d));return m?m.convert(g):g}};const M=s,{transpile:x}=B;var k=e({convertXML:function(d,m){return x(d,m||M)},createAST:function(d){return x(d)}}),simpleXmlToJson_min=k,xmlPackage=getDefaultExportFromCjs(simpleXmlToJson_min);const{convertXML}=xmlPackage;createJimp({formats:[png]});Buffer.from([66,77,70,3]);var pixelmatch_1=pixelmatch;const defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function pixelmatch(d,m,g,w,$,I){if(!isPixelData(d)||!isPixelData(m)||g&&!isPixelData(g))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(d.length!==m.length||g&&g.length!==d.length)throw new Error("Image sizes do not match.");if(d.length!==w*$*4)throw new Error("Image data size does not match width/height.");I=Object.assign({},defaultOptions,I);const D=w*$,F=new Uint32Array(d.buffer,d.byteOffset,D),U=new Uint32Array(m.buffer,m.byteOffset,D);let j=!0;for(let H=0;H<D;H++)if(F[H]!==U[H]){j=!1;break}if(j){if(g&&!I.diffMask)for(let H=0;H<D;H++)drawGrayPixel(d,4*H,I.alpha,g);return 0}const G=35215*I.threshold*I.threshold;let Z=0;for(let H=0;H<$;H++)for(let q=0;q<w;q++){const V=4*(H*w+q),Q=colorDelta(d,m,V,V);Math.abs(Q)>G?I.includeAA||!antialiased(d,q,H,w,$,m)&&!antialiased(m,q,H,w,$,d)?(g&&drawPixel(g,V,...Q<0&&I.diffColorAlt||I.diffColor),Z++):g&&!I.diffMask&&drawPixel(g,V,...I.aaColor):g&&(I.diffMask||drawGrayPixel(d,V,I.alpha,g))}return Z}function isPixelData(d){return ArrayBuffer.isView(d)&&d.constructor.BYTES_PER_ELEMENT===1}function antialiased(d,m,g,w,$,I){const D=Math.max(m-1,0),F=Math.max(g-1,0),U=Math.min(m+1,w-1),j=Math.min(g+1,$-1),G=4*(g*w+m);let Z,H,q,V,Q=m===D||m===U||g===F||g===j?1:0,X=0,re=0;for(let J=D;J<=U;J++)for(let se=F;se<=j;se++){if(J===m&&se===g)continue;const ie=colorDelta(d,d,G,4*(se*w+J),!0);if(ie===0){if(Q++,Q>2)return!1}else ie<X?(X=ie,Z=J,H=se):ie>re&&(re=ie,q=J,V=se)}return X!==0&&re!==0&&(hasManySiblings(d,Z,H,w,$)&&hasManySiblings(I,Z,H,w,$)||hasManySiblings(d,q,V,w,$)&&hasManySiblings(I,q,V,w,$))}function hasManySiblings(d,m,g,w,$){const I=Math.max(m-1,0),D=Math.max(g-1,0),F=Math.min(m+1,w-1),U=Math.min(g+1,$-1),j=4*(g*w+m);let G=m===I||m===F||g===D||g===U?1:0;for(let Z=I;Z<=F;Z++)for(let H=D;H<=U;H++){if(Z===m&&H===g)continue;const q=4*(H*w+Z);if(d[j]===d[q]&&d[j+1]===d[q+1]&&d[j+2]===d[q+2]&&d[j+3]===d[q+3]&&G++,G>2)return!0}return!1}function colorDelta(d,m,g,w,$){let I=d[g+0],D=d[g+1],F=d[g+2],U=d[g+3],j=m[w+0],G=m[w+1],Z=m[w+2],H=m[w+3];if(U===H&&I===j&&D===G&&F===Z)return 0;U<255&&(U/=255,I=blend(I,U),D=blend(D,U),F=blend(F,U)),H<255&&(H/=255,j=blend(j,H),G=blend(G,H),Z=blend(Z,H));const q=rgb2y(I,D,F),V=rgb2y(j,G,Z),Q=q-V;if($)return Q;const X=rgb2i(I,D,F)-rgb2i(j,G,Z),re=rgb2q(I,D,F)-rgb2q(j,G,Z),J=.5053*Q*Q+.299*X*X+.1957*re*re;return q>V?-J:J}function rgb2y(d,m,g){return .29889531*d+.58662247*m+.11448223*g}function rgb2i(d,m,g){return .59597799*d-.2741761*m-.32180189*g}function rgb2q(d,m,g){return .21147017*d-.52261711*m+.31114694*g}function blend(d,m){return 255+(d-255)*m}function drawPixel(d,m,g,w,$){d[m+0]=g,d[m+1]=w,d[m+2]=$,d[m+3]=255}function drawGrayPixel(d,m,g,w){const $=blend(rgb2y(d[m+0],d[m+1],d[m+2]),g*d[m+3]/255);drawPixel(w,m,$,$,$)}getDefaultExportFromCjs(pixelmatch_1);const defaultPlugins=[methods$h,methods$g,methods$f,methods$e,methods$c,methods$a,methods$b,methods$9,methods$8,methods$7,methods$6,methods$5,methods$4,methods$3,methods$d,methods$2,methods$1,methods],defaultFormats=[bmp,msBmp,gif,jpeg$2,png,tiff];bmp().mime,gif().mime,jpeg$2().mime,png().mime,tiff().mime;const Jimp=createJimp({formats:defaultFormats,plugins:defaultPlugins});let model=Kp.create("model.onnx");const jimpToTensor=d=>{const m=new Float32Array(d.height*d.width*3);for(let g=0;g<3;g++)for(let w=0;w<d.height;w++)for(let $=0;$<d.width;$++)m[g*(d.height*d.width)+w*d.width+$]=(d.getPixelColor($,w)>>(3-g)*8&255)/255;return new qe("float32",m,[1,3,d.height,d.width])},cropImage=d=>{if((d.width%128!==0||d.height%112!==0)&&(d.width%160!==0||d.height%144!==0))throw new Error("Image has invalid size!");const m=d.width%160===0,g=m?160/d.width:128/d.width;return d=d.scale({f:g,mode:ResizeStrategy.NEAREST_NEIGHBOR}),m&&(d=d.crop({x:16,y:16,w:128,h:112})),d},processImageTensor=d=>{const m=d.data,g=new BigInt64Array(d.data.length/3),w=d.dims[2]*d.dims[3];for(let $=0;$<g.length;$++)g[$]=BigInt(Math.round(m[$]+m[$+w]+m[$+w*2]));if(Array.from(new Set(g)).length!==4)throw new Error("Image has too many colors!");return new qe("int64",g,[1,1,d.dims[2],d.dims[3]])},handleImage=async d=>{const m=d.target;if(!m||!m.files||m.files.length===0)return;const w=await m.files[0].arrayBuffer();let $=await Jimp.read(w);$=cropImage($);const I=jimpToTensor($),D=I.toImageData({format:"RGB",tensorLayout:"NCHW"});document.getElementById("inputCanvas").getContext("2d").putImageData(D,0,0);const j=processImageTensor(I);model.then(async G=>{const Z=await G.run({gb_image:j});document.getElementById("outputCanvas").getContext("2d").putImageData(Z.color_image.toImageData({format:"RGB",tensorLayout:"NCHW"}),0,0)})};document.querySelector("#imageInput").addEventListener("change",handleImage);document.querySelector("#input").addEventListener("click",()=>document.querySelector("#imageInput").click());
